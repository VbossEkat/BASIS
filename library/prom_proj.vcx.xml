<?xml version = "1.0" encoding="UTF-8" standalone="yes"?>
<VFPData>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>Class</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname/>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>VERSION =   3.00</reserved1>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1A610IJYB</uniqueid>
		<timestamp>961372348</timestamp>
		<class>frmprimarydocview</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>form</baseclass>
		<objname>frmprimarydocviewtvr</objname>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1KW12FP5V</uniqueid>
		<timestamp>1057592081</timestamp>
		<class>scrfrmview</class>
		<classloc>basis.vcx</classloc>
		<baseclass>form</baseclass>
		<objname>frmmakesmt_pls</objname>
		<parent/>
		<properties>Top = 0
Left = 0
Height = 768
Width = 1024
DoCreate = .T.
Caption = "Êîìïàíîâêà àêòîâ ïî  ëîêàëüíîé ñìåòå"
WindowType = 0
BackColor = 212,208,200
nfrmid = 0
nscrfrmid = 0
_standarttoolbar = tlbstandart;basetoolbar_v1.vcx
_memberdata =      359&lt;VFPData&gt;&lt;memberdata name="nfrmid" display="nFrmId"/&gt;&lt;memberdata name="addtogrdwork" type="method" display="AddToGrdWork"/&gt;&lt;memberdata name="_addrectogrdinwork" type="method" display="_AddRecToGrdInWork"/&gt;&lt;memberdata name="_delrectogrdinwork" type="method" display="_DelRecToGrdInWork"/&gt;&lt;memberdata name="smtsave" type="method" display="SmtSave"/&gt;&lt;/VFPData&gt;

Name = "frmmakesmt"
cstmsghandler.Left = 0
cstmsghandler.Name = "cstmsghandler"
cstresizable.Name = "cstresizable"
Img1.Left = -122
Img1.Name = "Img1"
</properties>
		<protected/>
		<methods>PROCEDURE _addrectogrdinwork
LOCAL lnTvrId,;
	  nRecnoGrdWork,;
	  nGrdWorkTvrIdCalc,;
	  nFrmparttvrviewTvrIdCalc,;
	  nPartTvrID,;
	  nTvrsumbuy ,;
	  nTvrsumbuy,;
	  nRecnoFrmparttvrview
	
nGrdWorkTvrIdCalc = grdWork.TvrIdCalc
nRecnoGrdWork = RECNO('GrdWork')
nRecnoFrmparttvrview = RECNO('Frmparttvrview')
nFrmparttvrviewTvrIdCalc = Frmparttvrview.tvridcalc
IF nFrmparttvrviewTvrIdCalc = nGrdWorkTvrIdCalc OR ISNULL(nGrdWorkTvrIdCalc)
RETURN
ENDIF
lnTvrId = Frmparttvrview.tvrid
nPartTvrID = Frmparttvrview.PartTvrID
nTvrsumbuy  = Frmparttvrview.tvrsumbuy
nTvrsumbuyWork = grdWork.tvrsumbuy
IF !(ISNULL(Frmparttvrview.tvridcalc) OR Frmparttvrview.tvridcalc = 0)
	IF MESSAGEBOX('Ïîçèöèÿ ñìåòû ïðèíàäëåæèò äðóãîé ðàáîòå.'+CHR(13)+ 'Ïðîäîëæèòü èçìåíåíèÿ?',4+64+256,'Ïîçèöèÿ çàíÿòà äðóãîé ðàáîòîé ...')=7
		RETURN
		ELSE
	ENDIF
ENDIF

IF ISNULL(nFrmparttvrviewTvrIdCalc)
	UPDATE GrdWork ;
		SET grdWork.tvrsumbuy = grdWork.tvrsumbuy - nTvrsumbuy  ;
		   WHERE GrdWork.tvridcalc IS Null
ELSE
	UPDATE GrdWork ;
		SET grdWork.tvrsumbuy = grdWork.tvrsumbuy - nTvrsumbuy  ;
		   WHERE GrdWork.tvridcalc = nFrmparttvrviewTvrIdCalc
ENDIF
UPDATE Frmparttvrview SET Frmparttvrview.tvridcalc =  nGrdWorkTvrIdCalc , Chg = .T. ;
	WHERE Frmparttvrview.PartTvrID = nPartTvrID
*-*replace Frmparttvrview.tvridcalc WITH nGrdWorkTvrIdCalc IN Frmparttvrview NEXT 1


*!*	UPDATE GrdWork ;
*!*				SET grdWork.tvrsumbuy = grdWork.tvrsumbuy + Frmparttvrview.tvrsumbuy ;
*!*				   WHERE GrdWork.tvridcalc = nGrdWorkTvrIdCalc

UPDATE GrdWork ;
			SET grdWork.tvrsumbuy = grdWork.tvrsumbuy + nTvrsumbuy ;
			   WHERE GrdWork.tvridcalc = nGrdWorkTvrIdCalc

GO nRecnoGrdWork IN GrdWork
GO nRecnoFrmparttvrview IN Frmparttvrview

INSERT INTO GrdInWork (tvridcalc,tvrid,tvrnm,tvrqnt,tvrprcbuy,tvrsumbuy) ;
		SELECT Frmparttvrview.tvridcalc, Frmparttvrview.tvrid,;
			   Frmparttvrview.tvrnm, Frmparttvrview.tvrqnt, Frmparttvrview.tvrprcbuy,;
			   Frmparttvrview.tvrsumbuy;
FROM FrmPartTvrView WHERE Frmparttvrview.PartTvrID = nPartTvrID

thisform.GrdInWork.Refresh()

ENDPROC
PROCEDURE _delrectogrdinwork
LOCAL lnTvrId,;
	  nRecnoGrdWork,;
	  nGrdWorkTvrIdCalc,;
	  nFrmparttvrviewTvrIdCalc,;
	  nTvrsumbuy ,;
	  nTvrsumbuy,;
	  nRecnoFrmparttvrview,;
	  nPartTvrID


nRecnoGrdWork = RECNO('GrdWork')
nRecnoFrmparttvrview = RECNO('Frmparttvrview')
nPartTvrID = GrdInWork.PartTvrID
nFrmparttvrviewTvrIdCalc = GrdInWork.tvridcalc
nTvrsumbuy  = GrdInWork.tvrsumbuy
UPDATE GrdWork ;
			SET grdWork.tvrsumbuy = grdWork.tvrsumbuy - nTvrsumbuy  ;
			   WHERE GrdWork.tvridcalc = nFrmparttvrviewTvrIdCalc
			
UPDATE GrdWork ;
			SET grdWork.tvrsumbuy = grdWork.tvrsumbuy + nTvrsumbuy  ;
			   WHERE GrdWork.tvridcalc Is null
			
UPDATE Frmparttvrview SET Frmparttvrview.tvridcalc =  NULL  , Chg = .T.  ;
	WHERE Frmparttvrview.PartTvrID = nPartTvrID

DELETE FROM GrdInWork WHERE GrdInWork.PartTvrID = nPartTvrID
SELECT Frmparttvrview
GO TOP
LOCATE FOR Frmparttvrview.PartTvrID = nPartTvrID
GO nRecnoGrdWork IN GrdWork
SELECT GrdInWork
thisform.GrdInWork.Refresh()


ENDPROC
PROCEDURE _handlecntcancelsaveevent
*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: frmTvrSetEditSet._HandleCntCancelSaveEvent
* Called by.......: &lt;cmdOk.Click();cmdCancel.Click()&gt;
* Parameters......: &lt;tcMessage&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Ñîõðàíåíèå/îòìåíà
*-------------------------------------------------------
LPARAMETERS	tcMessage

WITH This

*05.08.2005 16:40 -&gt;Ïðîèçâîäèì ñîõðàíåíèå
IF tcMessage = .cntCancelSaveHandled._OKMsg
	*05.08.2005 16:43 -&gt;Âûïîëíÿåì õðàíèìóþ ïðîöåäóðó äëÿ ñîõðàíåíèÿ äàííûõ
	.SmtSave()
**	spSmtWorkSave(.nFrmId)
	*------------------------------------------------------------------------------
	
ENDIF
*------------------------------------------------------------------------------

*04.08.2005 11:47 -&gt; Ñêðûâàåì ôîðìó
.Release()
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE addtogrdwork
*-* äîáàâëÿåì ïîìå÷åííûå çàïèñè
INSERT INTO GrdWork (tvridcalc,tvrsumbuy,worknm) ;
SELECT TvrId,0,TvrNm FROM TvrInSetEdit ;
WHERE Mark&gt;0 AND TvrId NOT IN (SELECT NVL(tvridcalc,0) FROM GrdWork) AND !TvrInSetEdit.TvrIsCnt

*-* óäàëÿåì çàïèñè, êîòîðûå íå ïîìå÷åíû


UPDATE FrmPartTvrView SET Frmparttvrview.tvridcalc = Null  WHERE tvridcalc in ;
(SELECT TvrId FROM TvrInSetEdit WHERE Mark=0)
**AND NVL(FrmPartTvrView.TvrAttr,0) &lt;&gt; 0

DELETE FROM GrdWork WHERE tvridcalc in ;
(SELECT TvrId FROM TvrInSetEdit WHERE Mark=0)





ENDPROC
PROCEDURE Init
*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: frmMakeSmt.Init
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;tnScrFrmID,tnFrmId&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Èíèöèàëèçàöèÿ ôîðìû
*-------------------------------------------------------
LPARAMETERS tnFrmID

*08.08.2005 18:07 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	_PARAM
*------------------------------------------------------------------------------

*26.07.2005 16:10 -&gt; Âûáèðàåì íàáîð äëÿ ðåäàêòèðîâàíèÿ ñîñòàâà íàáîðà
This.nFrmId = tnFrmID &amp;&amp; oApp.DoModalFormRetValObj([frmtvrsetselect;tovar_v1.vcx;tovar.app])
***
IF VARTYPE(This.nFrmId)#[N]
	NODEFAULT
ENDIF
*------------------------------------------------------------------------------

*02.08.2005 16:10 -&gt;Ïîëó÷àåì è ñîõðàíÿåì â ñâîéñòâå îáúåêòà èíôîðìàöèþ î òèïå ñïèñêà
USE IN IIF(USED([lvTvrSetByID]),[lvTvrSetByID],0)
***
_PARAM = This.nFrmId
USE lvTvrSetByID IN 0
***



*04.08.2005 11:46 -&gt; Âûïîëíèì õðàíèìóþ ïðîöåäóðó
spSmetaWorkPrepare(This.nFrmId)
*------------------------------------------------------------------------------
*04.08.2005 11:46 -&gt; Îòêðîåì ïîäãîòîâëåííûé íàáîð
USE TvrInSetEdit IN 0
*04.08.2011 12:09 -&gt;Çàãðóçèì äàííûå â äåðåâî
ThisForm.OleSelTreeView.Init(.T.)
*------------------------------------------------------------------------------

*05.08.2005 15:23 -&gt;Îáíîâèì Grid

ThisForm.GrDPARTTVR._RSRequery(This.nFrmId)
DELETE FROM FrmPartTvrView WHERE NVL(TvrAttr,0) = 0

ThisForm.GrdWork._RSRequery()
***ThisForm.GrdInWork._RSRequery()
*------------------------------------------------------------------------------
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************

ENDPROC
PROCEDURE Load
*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: frmTvrSetEditSet.Load
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Çàãðóçêà ôîðìû
*-------------------------------------------------------

*04.08.2005 10:45 -&gt; Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*----------------------------------------------------------------------------

*04.08.2005 10:45 -&gt; Îòêðîåì ÁÄ
IF !DBUSED([BASIS])
	OPEN DATABASE BASIS
ENDIF
SET DATABASE TO BASIS	
*------------------------------------------------------------------------------

*04.08.2005 10:50 -&gt; Îòêðûâàåì Local View ñ êàðòèíêàìè
USE lvTvrSetBmps IN 0
*------------------------------------------------------------------------------

*05.08.2011 15:20 -&gt;Ñîçäàåì âðåìåííóþ òàáëèöó äëÿ Grid-à Ðàáîòû
CREATE TABLE tmp\tmpWork FREE (TKey I, TvrNM C(100), Price Y, Qnt Y, tmpSum Y)
*------------------------------------------------------------------------------
*05.08.2011 15:20 -&gt;Ñîçäàåì âðåìåííóþ òàáëèöó äëÿ Grid-à Ðàáîòû
CREATE CURS grdWork ( WorkNM C(100), tvrSumBuy Y, FrmParID I, TvrIdCalc I)
*------------------------------------------------------------------------------
*21.04.2004 14:05 -&gt;Âûïîëíèì õðàíèìóþ ïðîöåäóðó äëÿ ïîëó÷åíèÿ ïóñòîé òàáëèöû
lcUniqueName = spFrmPartTvrView([NODATA])
*------------------------------------------------------------------------------
*21.04.2011 14:08 -&gt;Òåïåðü îòêðîåì äàííûé Alias
USE (lcUniqueName) IN 0 ALIAS FrmPartTvrView
DO smtinwork.qpr
CURSORSETPROP([BUFFERING],3,[FrmPartTvrView])
*------------------------------------------------------------------------------

************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE showtluinfo
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: frmTvrSetEditSet.ShowTLUInfo
* Called by.......: &lt;ThisForm.OleSelTreeView.RightClick()-&gt;ContextMenu&gt;
* Parameters......: &lt;lnTLUID&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Îòîáðàæåíèå èíôîðìàöèè îá èäåíòèôèêàòîðå
*------------------------------------------------------------------------------
LPARAMETERS	lnTLUID

*01.04.2004 18:49 -&gt;Ñêðîåì äåðåâî, èíà÷å îíî áóäåò ôóíêöèîíèðîâàòü íåêîððåêòíî
ThisForm.OleSelTreeView.Enabled = .F.
*------------------------------------------------------------------------------

*01.04.2004 18:49 -&gt;Âûïîëíèì îïåðàöèþ ïðîñìîòðà èäåíòèôèêàòîðà òîâàðà
oMgrTovar.Do([TLU],[INFO],lnTLUID)
*------------------------------------------------------------------------------

*01.04.2004 18:49 -&gt;Âåðíåì äåðåâî
ThisForm.OleSelTreeView.Enabled = .T.
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE showtvrinfo
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: frmTvrSetEditSet.ShowTvrInfo
* Called by.......: &lt;ThisForm.OleSelTreeView.RightClick()-&gt;ContextMenu&gt;
* Parameters......: &lt;lnTvrID&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Îòîáðàæåíèå èíôîðìàöèè î òîâàðå
*------------------------------------------------------------------------------
LPARAMETERS	lnTvrID

*01.04.2004 18:49 -&gt;Ñêðîåì äåðåâî, èíà÷å îíî áóäåò ôóíêöèîíèðîâàòü íåêîððåêòíî
ThisForm.OleSelTreeView.Enabled = .F.
*------------------------------------------------------------------------------

*01.04.2004 18:49 -&gt;Âûïîëíèì îïåðàöèþ ïðîñìîòðà òîâàðà
oMgrTovar.Do([TVR],[INFO],lnTvrID)
*------------------------------------------------------------------------------

*01.04.2004 18:49 -&gt;Âåðíåì äåðåâî
ThisForm.OleSelTreeView.Enabled = .T.
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE smtsave
LOCAL lRes
WAIT WINDOW NOWAIT "Ñîõðàíÿåì âíåñåííûå èçìåíåíèÿ ..."
USE lvFrmPartTvrEdit IN 0 NODATA
SELECT Frmparttvrview
SCAN ALL FOR Frmparttvrview.Chg
		_PARAM = Frmparttvrview.PartTvrID
		REQUERY([lvFrmPartTvrEdit])
		SELECT lvFrmPartTvrEdit
		REPLACE lvFrmPartTvrEdit.tvridcalc WITH Frmparttvrview.tvridcalc IN lvFrmPartTvrEdit
		lres =TABLEUPDATE(.t.)
		SELECT Frmparttvrview
ENDSCAN
USE IN SELECT([lvFrmPartTvrEdit])
WAIT CLEAR



ENDPROC
PROCEDURE Unload
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: FRMTVRSETEDITSET.UNLOAD
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........:
*------------------------------------------------------------------------------

*05.08.2005 16:09 -&gt;Óäàëèì âðåìåííóþ òàáëèöó äëÿ Grid-à
USE IN IIF(USED([FrmWorkEdit]),[FrmWorkEdit],0)
IF FILE([tmp\FrmWorkEdit.dbf])
	ERASE tmp\FrmWorkEdit.dbf
ENDIF
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>24</reserved2>
		<reserved3>nfrmid &lt;public/runtime&gt; Èäåíòèôèêàòîð ôîðìû,  ñ êîòîðîé èäåò ðàáîòà
*_handlecntcancelsaveevent 
*showtvrinfo 
*showtluinfo 
*addtogrdwork Äîáâëÿåì â GrdWork ïîçèöèè ðàáîò , êîòîðûõ åùå íåò
*_addrectogrdinwork Äîáàâëÿåì çàïèñü ñìåòû â ðàáîòó
*_delrectogrdinwork Óäàëÿåì ïîçèöèþ èç ðàáîòû
*smtsave ñîõðàíåíèå èçìåíåíèå ñìåòû 
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7>Ðåäàêòèðîâàíèå âòÿíóòîé ñìåòû ïëîñêîå TvrCalcId</reserved7>
		<reserved8>..\include\comselctl_v1_oleseltreeview.h</reserved8>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1KZ0NH5QD</uniqueid>
		<timestamp>1056728197</timestamp>
		<class>oleimagelist</class>
		<classloc>comctl_v1.vcx</classloc>
		<baseclass>olecontrol</baseclass>
		<objname>OleImageList</objname>
		<parent>frmmakesmt_pls</parent>
		<properties>Top = 24
Left = 12
Height = 100
Width = 100
ZOrderSet = 3
Name = "OleImageList"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole>0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7////+/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAxo0uPVswBAwAAAEABAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAXAAAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAABPAAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAQAAAAAAAAABAAAAAIAAAD+/////v////7///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+PjdpYap0bEK/AQhAQKo2nIUM0EggAAADtAwAA7QMAAIB+4eYCAAUAIAAAAAAAAADAwMAA//8AAAHvzasAAAUATwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABcAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgcWhqIFp0dVFoYTtqZGZuW2lhZXRyIADmjgAAAAAAAGyOAAAAAAAA6I8AAAAAAABojwAAAAAAAOqQAAAAAAAAcJAAAAAAAAABAACAAAAAAHqSAAAAAAAADJQAAAAAAACElAAAAAAAAAKVAAAAAAAAjJUAAAAAAAAElwAAAAAAAASWAAAAAAAAQBJ6BwYAAAD/////BQAAgEASegcAAAAAAAAAAAAAAAAImgAAAAAAAIiZAAAAAAAAjJoAAAAAAACyNQAAAAAAAJacAAAAAAAATIMAAAAAAAAEmwAAAAAAABCdAAAAAAAAkFgAAAAAAACYPQAAAAAAAI6dAAAAAAAAGp4AAAAAAABYiwAAAAAAAPCLAAAAAAAAHDcAAAAAAACkNgAAAAAAAOYdAAAAAAAA3jgAAAAAAABqOQAAAAAAAAo6AAAAAAAAtjoAAAAAAACAjQAAAAAAAF47AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==</ole>
		<ole2>OLEObject = C:\Windows\system32\comctl32.ocx
</ole2>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1KX0XW9DF</uniqueid>
		<timestamp>1056728197</timestamp>
		<class>oleseltreeview</class>
		<classloc>comselctl_v1.vcx</classloc>
		<baseclass>olecontrol</baseclass>
		<objname>OleSelTreeView</objname>
		<parent>frmmakesmt_pls</parent>
		<properties>Top = 372
Left = 0
Height = 369
Width = 499
ZOrderSet = 4
_imgalias = lvTvrSetBmps
_imgfieldnamefilename = BmpFileNM
_imgfieldnameindex = BmpID
_rsaliasname = TvrInSetEdit
_rsfieldnameid = TKey
_rsfieldnameimageindex = BmpID
_rsfieldnameimageselectedindex = SBmpID
_rsfieldnamemark = Mark
_rsfieldnamemarkimageindex = BmpMID
_rsfieldnamemarkimageselectedindex = SBmpMID
_rsfieldnameparentflag = TvrIsCnt
_rsfieldnameparentid = TvrParID
_rsfieldnamepartmarkimageindex = BmpPMID
_rsfieldnamepartmarkimageselectedindex = SBmpPMID
_rsfieldnametext = TvrNM
_imagelistobject = .parent.Oleimagelist.object
_parentonly = .F.
Name = "OleSelTreeView"
</properties>
		<protected/>
		<methods>PROCEDURE _handlemarkchange
ThisForm.AddToGrdWork()
ThisForm.GrdWork.Refresh()

ENDPROC
PROCEDURE Init
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: OLESELTREEVIEW.INIT
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;tlInitAllowed&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Çàãðóçêà äåðåâà ïî ñîáûòèþ
*------------------------------------------------------------------------------
LPARAMETERS	tlInitAllowed

*04.08.2005 12:08 -&gt;Çàãðóæàåì äåðåâî ïî ñîáûòèþ
IF tlInitAllowed
	DODEFAULT()
ENDIF
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE rightclick
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: oleSelTreeView.RightClick
* Called by.......: &lt;.MouseDown()&gt;
* Parameters......: &lt;toNode&gt;
* Returns.........: &lt;none&gt;
* Notes...........:
*------------------------------------------------------------------------------
LPARAMETERS	toNode

WITH This

*16.05.2005 11:24 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcOldAlias, ;
		lnNodeID, ;
		lcRSAliasName, ;
		lcRSFieldNameID, ;
		lcRSFieldNameParentFlag, ;
		llParentFlag, ;
		lnTvrID, ;
		lnTluID
***
lcOldAlias 				= ALIAS()
***
lnNodeID                = .ConvertID(cnDIR_TREE2ID,toNode.Key)
***
lcRSAliasName			= ._RSAliasName
lcRSFieldNameID			= ._RSFieldNameID
lcRSFieldNameParentFlag	= ._RSFieldNameParentFlag
*------------------------------------------------------------------------------

*18.05.2005 10:32 -&gt; Íàéäåì ïîìå÷àåìûé ýëìåíò â èñòî÷íèêå äàííûõ
SELECT (lcRSAliasName)
***
LOCATE FOR &amp;lcRSFieldNameID = lnNodeID
***
IF !FOUND()
	RETURN
ENDIF
***
llParentFlag = &amp;lcRSFieldNameParentFlag
lnTvrID      = TvrID
lnTluID      = TLUID
*-----------------------------------------------------------------------------

*05.08.2005 12:50 -&gt;Âûâîäèì ìåíþ, òîëüêî åñëè ýëåìåíò íå ÿâëÿåòñÿ êîíòåéíåðîì
IF !llParentFlag
	
	*05.08.2005 12:50 -&gt;Ñîçäàåì ìåíþ
	DEFINE POPUP treeshortcut SHORTCUT RELATIVE FROM MROW(),MCOL()
	*------------------------------------------------------------------------------
	
	*05.08.2005 14:01 -&gt;Ñîçäàåì ïóíêò ìåíþ "Ïðîñìîòð èíôîðìàöèè î òîâàðå"
	lcActionMacro = [_screen.ActiveForm.ShowTvrInfo(]+ALLTRIM(STR(lnTvrID))+[)]
	DEFINE BAR 1 OF treeshortcut PROMPT [Ïðîñìîòð èíôîðìàöèè î òîâàðå]
	ON SELECTION BAR 1 OF treeshortcut &amp;lcActionMacro
	*------------------------------------------------------------------------------
	
	*05.08.2005 14:01 -&gt;Ñîçäàåì ïóíêò ìåíþ "Ïðîñìîòð èíôîðìàöèè î èäåíòèôèêàòîðå"
	IF ThisForm.lTvrSetBindTLU	
		lcActionMacro = [_screen.ActiveForm.ShowTLUInfo(]+ALLTRIM(STR(lnTLUID))+[)]
		DEFINE BAR 2 OF treeshortcut PROMPT [Ïðîñìîòð èíôîðìàöèè î èäåíòèôèêàòîðå]
		ON SELECTION BAR 2 OF treeshortcut &amp;lcActionMacro
	ENDIF
	*------------------------------------------------------------------------------
	
	*05.08.2005 14:11 -&gt;Îòîáðàæàåì ìåíþ
	ACTIVATE POPUP treeshortcut
	*------------------------------------------------------------------------------
	
ENDIF
*------------------------------------------------------------------------------

*05.08.2005 14:12 -&gt;Âîññòàíîâèì òåêóùèé Alias
IF !EMPTY(lcOldAlias) AND USED(lcOldAlias) AND lcOldAlias#ALIAS()
	SELECT(lcOldAlias)
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
</methods>
		<objcode/>
		<ole>0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7///8EAAAA/v///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADDsp0uPVswBAwAAAEACAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAZgAAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAABPAAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAACUBAAAAAAAABAAAAAIAAAD+////BQAAAP7///8GAAAABwAAAAgAAAD+//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+i6BMHCoUbEK/AQhAQKo2nIUM0EggAAACTMwAAIyYAAI5+4eYCAAUAIgAAAH0gaWaNAQAAAQAAAAHvzasAAAUATwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABcAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgcWhqIFp0dVFoYTtqZGZuW2lhZXRyIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAACADgAAAEhpZGVTZWxlY3Rpb24ABQAAAEwAAAAADAAAAEluZGVudGF0aW9uABEAAABODQAAAAcAAAAAAAAAHLQSAAYAAAAAAAAABQAAgCC0EgABAAAAXAAf3uy9AQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALkAKAAAATGFiZWxFZGl0AAkAAABJCgAAAAEAAAAKAAAATGluZVN0eWxlAAkAAABJCgAAAAEAAAANAAAATW91c2VQb2ludGVyAAkAAABJCgAAAAAAAAAOAAAAUGF0aFNlcGFyYXRvcgAKAAAASAAAAAABAAAAXAYAAABTdHlsZQAJAAAASQoAAAAHAAAADAAAAE9MRURyYWdNb2RlAAkAAABJCgAAAAAAAAAMAAAAT0xFRHJvcE1vZGUACQAAAEkKAAAAAAAAAAsAAABBcHBlYXJhbmNlAAkAAABJCgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</ole>
		<ole2>OLEObject = C:\Windows\system32\comctl32.ocx
</ole2>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1KZ0P8OCD</uniqueid>
		<timestamp>1056728197</timestamp>
		<class>cntcancelsavehandled</class>
		<classloc>baseform_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntCancelSaveHandled</objname>
		<parent>frmmakesmt_pls</parent>
		<properties>Top = 743
Left = 819
Name = "cntCancelSaveHandled"
cmdCancel.Name = "cmdCancel"
cmdOk.Name = "cmdOk"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1A610IJYB</uniqueid>
		<timestamp>1055220390</timestamp>
		<class>grd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>grid</baseclass>
		<objname>GrdInWork</objname>
		<parent>frmmakesmt_pls</parent>
		<properties>ColumnCount = 4
Height = 369
Left = 523
Panel = 1
RecordSource = "GrdInWork"
Top = 0
Width = 500
BackColor = 255,255,255
Name = "GrdInWork"
Column1.ControlSource = "GrdInWork.TvrNM"
Column1.Width = 239
Column1.BackColor = 255,255,255
Column1.Name = "ColSmWk"
Column2.ControlSource = "GrdInWork.tvrprcbuy"
Column2.BackColor = 255,255,255
Column2.Name = "ColPrc"
Column3.ControlSource = "GrdInWork.TvrQnt"
Column3.BackColor = 255,255,255
Column3.Name = "ColQnt"
Column4.ControlSource = "GrdInWork.tvrsumbuy"
Column4.BackColor = 255,255,255
Column4.Name = "ColSum"
</properties>
		<protected/>
		<methods>PROCEDURE _prnrep
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: GRDTVRINSET._PRNREP
* Called by.......: &lt;&lt;ToolBar or Context Menu Action -&gt; .HandleMsg() -&gt; ._PrnRep()&gt;&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Âûçîâ ôîðìû äëÿ ïå÷àòè îò÷¸òà
*------------------------------------------------------------------------------

*08.08.2005 15:00 -&gt;Âûçîâåì ìåòîä ìåíåäæåðà äëÿ ïå÷àòè îò÷¸òà
oApp.ExecuteScrFormReportByID(ThisForm.nScrFrmID,[TvrSetID],ThisForm.nFrmId,.T.)
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************

ENDPROC
PROCEDURE _rsrequery
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: grdTvrInSet._RSRequery
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Îáíîâëåíèå ñïèñêà âûáðàííûõ òîâàðîâ
*------------------------------------------------------------------------------
WITH This

*11.01.2004 17:44 -&gt;Ñîõðàíèì äàííûå î RecordSource
.SourceKeep()
*------------------------------------------------------------------------------
*11.01.2004 17:46 -&gt;Îòêëþ÷èì RecordSource
.SourceReset()
*------------------------------------------------------------------------------
*11.01.2004 17:46 -&gt;Ïåðå÷èòàåì Local View
USE IN SELECT('GrdInWork')
DO smtInwork.qpr
*------------------------------------------------------------------------------

*11.01.2004 17:46 -&gt;Âîññòàíàâëèâàåì RecordSource
.SourceRecall()
*------------------------------------------------------------------------------

*22.07.2005 14:31 -&gt;Âîññòàíîâèì ïîçèöèþ â Grid-å
.PositionRecall()
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18I0M4ORT</uniqueid>
		<timestamp>1055220390</timestamp>
		<class>header</class>
		<classloc/>
		<baseclass>header</baseclass>
		<objname>Header1</objname>
		<parent>frmmakesmt_pls.GrdInWork.ColSmWk</parent>
		<properties>Alignment = 2
Caption = "Ïîçèöèÿ ñìåòû ê ðàáîòå"
Name = "Header1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
This.Parent.Parent.Sort(This.Parent.Name)
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1MV0RE0B8</uniqueid>
		<timestamp>1055220390</timestamp>
		<class>textbox</class>
		<classloc/>
		<baseclass>textbox</baseclass>
		<objname>Text1</objname>
		<parent>frmmakesmt_pls.GrdInWork.ColSmWk</parent>
		<properties>BorderStyle = 0
ControlSource = "GrdInWork.TvrNM"
Margin = 0
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "Text1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
ThisForm._DelRecToGrdInWork()
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25O11OEHM</uniqueid>
		<timestamp>1055220390</timestamp>
		<class>header</class>
		<classloc/>
		<baseclass>header</baseclass>
		<objname>Header1</objname>
		<parent>frmmakesmt_pls.GrdInWork.ColPrc</parent>
		<properties>Alignment = 2
Caption = "Öåíà"
Name = "Header1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
This.Parent.Parent.Sort(This.Parent.Name)
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1MV0RE0B7</uniqueid>
		<timestamp>1055220390</timestamp>
		<class>textbox</class>
		<classloc/>
		<baseclass>textbox</baseclass>
		<objname>Text1</objname>
		<parent>frmmakesmt_pls.GrdInWork.ColPrc</parent>
		<properties>BorderStyle = 0
ControlSource = "GrdInWork.tvrprcbuy"
Margin = 0
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "Text1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
ThisForm._DelRecToGrdInWork()
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2760QT4T3</uniqueid>
		<timestamp>1025986895</timestamp>
		<class>header</class>
		<classloc/>
		<baseclass>header</baseclass>
		<objname>Header1</objname>
		<parent>frmmakesmt_pls.GrdInWork.ColQnt</parent>
		<properties>Caption = "Êîëè÷åñòâî"
Name = "Header1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18A02DMUV</uniqueid>
		<timestamp>1055220390</timestamp>
		<class>textbox</class>
		<classloc/>
		<baseclass>textbox</baseclass>
		<objname>Text1</objname>
		<parent>frmmakesmt_pls.GrdInWork.ColQnt</parent>
		<properties>BorderStyle = 0
ControlSource = "GrdInWork.TvrQnt"
Margin = 0
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "Text1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
ThisForm._DelRecToGrdInWork()
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25P0Y3LJR</uniqueid>
		<timestamp>1025986895</timestamp>
		<class>header</class>
		<classloc/>
		<baseclass>header</baseclass>
		<objname>Header1</objname>
		<parent>frmmakesmt_pls.GrdInWork.ColSum</parent>
		<properties>Caption = "Ñóììà"
Name = "Header1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18I0M4ORT</uniqueid>
		<timestamp>1055220390</timestamp>
		<class>textbox</class>
		<classloc/>
		<baseclass>textbox</baseclass>
		<objname>Text1</objname>
		<parent>frmmakesmt_pls.GrdInWork.ColSum</parent>
		<properties>BorderStyle = 0
ControlSource = "GrdInWork.tvrsumbuy"
Margin = 0
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "Text1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
ThisForm._DelRecToGrdInWork()
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1A610IJYB</uniqueid>
		<timestamp>1056728197</timestamp>
		<class>grdparttvr</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>grid</baseclass>
		<objname>Grdparttvr</objname>
		<parent>frmmakesmt_pls</parent>
		<properties>Height = 369
Left = 0
Panel = 1
Top = 0
Width = 500
Name = "Grdparttvr"
Column1.Header1.Caption = "Ïîçèöèÿ ñìåòû"
Column1.Header1.Name = "Header1"
Column1.Text1.Visible = .T.
Column1.Text1.Name = "Text1"
Column1.Width = 151
Column1.Visible = .T.
Column1.Name = "Column1"
Column2.Header1.Caption = "Êîëè÷åñòâî"
Column2.Header1.Name = "Header1"
Column2.Text1.Name = "Text1"
Column2.ColumnOrder = 2
Column2.Width = 89
Column2.Name = "Column2"
COLUMN3.Header1.Name = "Header1"
COLUMN3.Text1.Name = "Text1"
COLUMN3.ColumnOrder = 3
COLUMN3.Width = 65
COLUMN3.Name = "COLUMN3"
COLUMN4.Header1.Caption = "Öåíà"
COLUMN4.Header1.Name = "Header1"
COLUMN4.Text1.Name = "Text1"
COLUMN4.Width = 65
COLUMN4.Name = "COLUMN4"
COLUMN5.Header1.Name = "Header1"
COLUMN5.Text1.Visible = .T.
COLUMN5.Text1.Name = "Text1"
COLUMN5.Visible = .T.
COLUMN5.Name = "COLUMN5"
COLUMN6.Header1.Caption = "Ñóììà"
COLUMN6.Header1.Name = "Header1"
COLUMN6.Text1.Visible = .T.
COLUMN6.Text1.Name = "Text1"
COLUMN6.Name = "COLUMN6"
COLUMN7.Header1.Name = "Header1"
COLUMN7.Text1.Visible = .T.
COLUMN7.Text1.Name = "Text1"
COLUMN7.Name = "COLUMN7"
COLUMN8.Header1.Name = "Header1"
COLUMN8.Text1.Visible = .T.
COLUMN8.Text1.Name = "Text1"
COLUMN8.Name = "COLUMN8"
COLUMN9.Header1.Name = "Header1"
COLUMN9.Text1.Visible = .T.
COLUMN9.Text1.Name = "Text1"
COLUMN9.Name = "COLUMN9"
COLUMN10.Header1.Name = "Header1"
COLUMN10.Text1.Visible = .T.
COLUMN10.Text1.Name = "Text1"
COLUMN10.Name = "COLUMN10"
COLUMN11.Header1.Name = "Header1"
COLUMN11.Text1.Visible = .T.
COLUMN11.Text1.Name = "Text1"
COLUMN11.Name = "COLUMN11"
</properties>
		<protected/>
		<methods>PROCEDURE Column1.Text1.DblClick
ThisForm._AddRecToGrdInWork()
ENDPROC
PROCEDURE COLUMN10.Text1.DblClick
ThisForm._AddRecToGrdInWork()
ENDPROC
PROCEDURE COLUMN11.Text1.DblClick
ThisForm._AddRecToGrdInWork()
ENDPROC
PROCEDURE Column2.Text1.DblClick
ThisForm._AddRecToGrdInWork()
ENDPROC
PROCEDURE COLUMN3.Text1.DblClick
ThisForm._AddRecToGrdInWork()
ENDPROC
PROCEDURE COLUMN4.Text1.DblClick
ThisForm._AddRecToGrdInWork()
ENDPROC
PROCEDURE COLUMN5.Text1.DblClick
ThisForm._AddRecToGrdInWork()
ENDPROC
PROCEDURE COLUMN6.Text1.DblClick
ThisForm._AddRecToGrdInWork()
ENDPROC
PROCEDURE COLUMN7.Text1.DblClick
ThisForm._AddRecToGrdInWork()
ENDPROC
PROCEDURE COLUMN8.Text1.DblClick
ThisForm._AddRecToGrdInWork()
ENDPROC
PROCEDURE COLUMN9.Text1.DblClick
ThisForm._AddRecToGrdInWork()
ENDPROC
PROCEDURE Init
DODEFAULT()
*!*	this.column1.DynamicBackColor = [IIF(ISNULL(FrmPartTvrView.tvridcalc),RGB(252,174,12) ,IIF(RECNO()%2 = 0,RGB(230,255,244), RGB(255,255,255)))] &amp;&amp; ïîçèöèÿ ïðèñîåäèíèíà ê ðàáîòå
*!*	this.column4.DynamicBackColor = [IIF(ISNULL(FrmPartTvrView.tvridcalc),RGB(252,174,12) ,IIF(RECNO()%2 = 0,RGB(230,255,244), RGB(255,255,255)))] &amp;&amp; ïîçèöèÿ ïðèñîåäèíèíà ê ðàáîòå

this.SetAll("dynamicbackcolor", ;
				[IIF(ISNULL(FrmPartTvrView.tvridcalc) or FrmPartTvrView.tvridcalc = 0 ,RGB(252,174,12) ,IIF(RECNO()%2 = 0,RGB(230,255,244), RGB(255,255,255)))], "Column")



this.colUMN5.Visible = .F.
this.colUMN7.Visible = .F.
this.colUMN9.Visible = .F.
this.colUMN8.Visible = .F.
this.colUMN10.Visible = .F.
this.colUMN11.Visible = .F.
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3920PXZE7</uniqueid>
		<timestamp>1055220390</timestamp>
		<class>grd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>grid</baseclass>
		<objname>GrdWork</objname>
		<parent>frmmakesmt_pls</parent>
		<properties>ColumnCount = 2
Height = 369
Left = 523
Panel = 1
RecordSource = "grdWork"
RecordSourceType = 1
Top = 372
Width = 500
BackColor = 255,255,255
Name = "GrdWork"
Column1.ControlSource = "grdWork.WorkNM"
Column1.Width = 342
Column1.ReadOnly = .T.
Column1.BackColor = 255,255,255
Column1.Name = "ColWk"
Column2.ControlSource = "grdWork.tvrsumbuy"
Column2.Width = 126
Column2.ReadOnly = .T.
Column2.Format = "999,999,999.99"
Column2.InputMask = "999 999 999 999.99"
Column2.BackColor = 255,255,255
Column2.Name = "ColSum"
</properties>
		<protected/>
		<methods>PROCEDURE _prnrep
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: GRDTVRINSET._PRNREP
* Called by.......: &lt;&lt;ToolBar or Context Menu Action -&gt; .HandleMsg() -&gt; ._PrnRep()&gt;&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Âûçîâ ôîðìû äëÿ ïå÷àòè îò÷¸òà
*------------------------------------------------------------------------------

*08.08.2005 15:00 -&gt;Âûçîâåì ìåòîä ìåíåäæåðà äëÿ ïå÷àòè îò÷¸òà
oApp.ExecuteScrFormReportByID(ThisForm.nScrFrmID,[TvrSetID],ThisForm.nFrmId,.T.)
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************

ENDPROC
PROCEDURE _refreshrelatedobjects
ThisForm.GrdInWork._RSRequery()

ENDPROC
PROCEDURE _rsrequery
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: grdTvrInSet._RSRequery
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Îáíîâëåíèå ñïèñêà âûáðàííûõ òîâàðîâ
*------------------------------------------------------------------------------
WITH This

*11.01.2004 17:44 -&gt;Ñîõðàíèì äàííûå î RecordSource
.SourceKeep()
*------------------------------------------------------------------------------

*11.01.2004 17:46 -&gt;Îòêëþ÷èì RecordSource
.SourceReset()
*------------------------------------------------------------------------------

*11.01.2004 17:46 -&gt;Ïåðå÷èòàåì Local View
USE IN SELECT('GrdWork')
DO smtwork.qpr
*------------------------------------------------------------------------------

*11.01.2004 17:46 -&gt;Âîññòàíàâëèâàåì RecordSource
.SourceRecall()
*------------------------------------------------------------------------------

*22.07.2005 14:31 -&gt;Âîññòàíîâèì ïîçèöèþ â Grid-å
.PositionRecall()
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3920PXZFA</uniqueid>
		<timestamp>1055220390</timestamp>
		<class>header</class>
		<classloc/>
		<baseclass>header</baseclass>
		<objname>Header1</objname>
		<parent>frmmakesmt_pls.GrdWork.ColWk</parent>
		<properties>Alignment = 2
Caption = "Ðàáîòû"
Name = "Header1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
This.Parent.Parent.Sort(This.Parent.Name)
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3920PXZFG</uniqueid>
		<timestamp>1054502977</timestamp>
		<class>textbox</class>
		<classloc/>
		<baseclass>textbox</baseclass>
		<objname>Text1</objname>
		<parent>frmmakesmt_pls.GrdWork.ColWk</parent>
		<properties>BorderStyle = 0
ControlSource = "grdWork.WorkNM"
Margin = 0
ReadOnly = .T.
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "Text1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3920PXZFK</uniqueid>
		<timestamp>1054499073</timestamp>
		<class>header</class>
		<classloc/>
		<baseclass>header</baseclass>
		<objname>Header1</objname>
		<parent>frmmakesmt_pls.GrdWork.ColSum</parent>
		<properties>Caption = "Ñóììà"
Name = "Header1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3920PXZFO</uniqueid>
		<timestamp>1054502977</timestamp>
		<class>textbox</class>
		<classloc/>
		<baseclass>textbox</baseclass>
		<objname>Text1</objname>
		<parent>frmmakesmt_pls.GrdWork.ColSum</parent>
		<properties>BorderStyle = 0
ControlSource = "grdWork.tvrsumbuy"
Margin = 0
ReadOnly = .T.
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "Text1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1A610IJYB</uniqueid>
		<timestamp>1055220390</timestamp>
		<class>cmd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>commandbutton</baseclass>
		<objname>CmdAdd</objname>
		<parent>frmmakesmt_pls</parent>
		<properties>Top = 51
Left = 500
Height = 31
Width = 23
FontSize = 14
Caption = "&gt;"
Name = "CmdAdd"
</properties>
		<protected/>
		<methods>PROCEDURE Click
ThisForm._AddRecToGrdInWork()
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18I0M4ORT</uniqueid>
		<timestamp>1055220390</timestamp>
		<class>cmd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>commandbutton</baseclass>
		<objname>CmdDele</objname>
		<parent>frmmakesmt_pls</parent>
		<properties>Top = 82
Left = 500
Height = 31
Width = 23
FontSize = 14
Caption = "&lt;"
Name = "CmdDele"
</properties>
		<protected/>
		<methods>PROCEDURE Click
IF RECCOUNT('GrdInWork')=0
RETURN
ENDIF

ThisForm._DelRecToGrdInWork()
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3920R93YY</uniqueid>
		<timestamp>1055220390</timestamp>
		<class>cmd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>commandbutton</baseclass>
		<objname>CmdAddAll</objname>
		<parent>frmmakesmt_pls</parent>
		<properties>Top = 20
Left = 500
Height = 31
Width = 23
FontBold = .T.
FontSize = 12
Caption = "&gt;&gt;"
Name = "CmdAddAll"
</properties>
		<protected/>
		<methods>PROCEDURE Click
IF ISNULL(grdWork.TvrIdCalc)
RETURN
ENDIF
IF MESSAGEBOX('Ïåðåíåñòè Âñå íåðàñïðåäåëåííûå '+CHR(13)+ 'ñòðîêè ñìåòû?',4+64+256,'Ðàáîòà ñ íåñêîëüêèìè çàïèñÿìè ...')=7
	RETURN
ENDIF
LOCAL lnTvrId,;
	  nRecnoGrdWork,;
	  nGrdWorkTvrIdCalc,;
	  nFrmparttvrviewTvrIdCalc,;
	  nPartTvrID,;
	  nTvrsumbuy ,;
	  nTvrsumbuy,;
	  nRecnoFrmparttvrview
nRecnoFrmparttvrview = RECNO('Frmparttvrview')

SELECT Frmparttvrview
SCAN ALL FOR (ISNULL(Frmparttvrview.tvridcalc) OR Frmparttvrview.tvridcalc = 0)
	WAIT WINDOW 'Äîáàâëÿåì ïîçèöèþ ...' + CHR(13)+ALLTRIM(Frmparttvrview.TvrNm) NOWAIT
	ThisForm._AddRecToGrdInWork()
ENDSCAN
WAIT CLEAR
GO nRecnoFrmparttvrview IN Frmparttvrview

thisform.GrdInWork.Refresh()

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3920R93Z3</uniqueid>
		<timestamp>1055220390</timestamp>
		<class>cmd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>commandbutton</baseclass>
		<objname>CmdDeleAll</objname>
		<parent>frmmakesmt_pls</parent>
		<properties>Top = 113
Left = 500
Height = 31
Width = 23
FontBold = .T.
FontSize = 12
Caption = "&lt;&lt;"
Name = "CmdDeleAll"
</properties>
		<protected/>
		<methods>PROCEDURE Click
IF RECCOUNT('GrdInWork')=0
RETURN
ENDIF
IF MESSAGEBOX('Óáðàòü ñ ýòîé ðàáîòû '+CHR(13)+ 'âñå ñòðîêè ñìåòû?',4+64+256,'Ðàáîòà ñ íåñêîëüêèìè çàïèñÿìè ...')=7
	RETURN
ENDIF
LOCAL lnTvrId,;
	  nRecnoGrdWork,;
	  nGrdWorkTvrIdCalc,;
	  nFrmparttvrviewTvrIdCalc,;
	  nPartTvrID,;
	  nTvrsumbuy ,;
	  nTvrsumbuy,;
	  nRecnoFrmparttvrview
	
thisform.grdInWork._rsrequery()

SELECT GrdInWork
GO TOP
SCAN ALL
	nRecnoGrdWork = RECNO('GrdInWork')
	WAIT WINDOW 'Îòìåíÿåì ïîçèöèþ ...' + CHR(13)+ALLTRIM(GrdInWork.TvrNm) NOWAIT
	ThisForm._DelRecToGrdInWork()
	SELECT GrdInWork
	GO nRecnoGrdWork
ENDSCAN
WAIT CLEAR

GO TOP IN GrdInWork

thisform.GrdInWork.Refresh()

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_39513Z864</uniqueid>
		<timestamp>1056728197</timestamp>
		<class>splitter2</class>
		<classloc>splitter.vcx</classloc>
		<baseclass>shape</baseclass>
		<objname>Splitter2</objname>
		<parent>frmmakesmt_pls</parent>
		<properties>Top = 369
Left = 0
Height = 2
Width = 1024
Name = "Splitter2"
</properties>
		<protected/>
		<methods>PROCEDURE split
LOCAL nTop, nHeight
WITH ThisForm
		* up down resize/reposition
		.Grdparttvr.Height = .Splitter2.Top-1
		.GrdInWork.Height  = .Splitter2.Top-1
		nHeight=.Height- .Splitter2.Top-28
		nTop=.Splitter2.Top+.Splitter2.Height+1

		.GrdWork.Height  = nHeight
		.GrdWork.Top= nTop
		.OleSelTreeView.Height  = nHeight
		.OleSelTreeView.Top= nTop
ENDWITH

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>frmmakesmt_pls</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
Arial, 0, 14, 8, 23, 18, 51, 4, 1
Arial, 1, 12, 8, 20, 15, 42, 4, 1
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1></reserved1>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18I0M4ORT</uniqueid>
		<timestamp>1058819700</timestamp>
		<class>frmedit</class>
		<classloc>baseform_v1.vcx</classloc>
		<baseclass>form</baseclass>
		<objname>frmparttimeedit</objname>
		<parent/>
		<properties>Height = 297
Width = 590
DoCreate = .T.
WindowState = 0
cmode = 
cmeasureunitlist = 
frmprctype = 1
nouid = 0
frmdirection = 1
withbarcode = 0
Name = "frmparttimeedit"
cstmsghandler.Name = "cstmsghandler"
cstresizable.Name = "cstresizable"
Img1.ZOrderSet = 7
Img1.Name = "Img1"
cstdatawork.Name = "cstdatawork"
</properties>
		<protected/>
		<methods>PROCEDURE _handlecntcancelsaveevent
*------------------------------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRIMARYDOC_V1.VCX
* Class.Module....: FRMPRIMARYDOCPARTTVREDIT._HANDLECNTCANCELSAVEEVENT
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;tcMessage&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;~&gt;
*------------------------------------------------------------------------------
LPARAMETERS	tcMessage

LOCAL	llResSave

WITH This

*17.05.2004 02:07 -&gt;Ïðîèçâîäèì ñîõðàíåíèÿ/îòìåíÿåì èçìåíåíèÿ
IF tcMessage == [OK]
	
	*13.06.2006 18:01 -&gt; Ñîõðàíÿåì öåíó ïðîäàæè
	.SavePriceSale()
	*------------------------------------------------------------------------------
	.uRetVal = .T.
	
	IF .cMode = [DELE]
		DELETE IN lvFrmPartTvrEdit
	ENDIF

	llResSave = .cstDataWork.Save([lvFrmPartTvrEdit])
	*21.01.2004 20:01 -&gt;Îáðàáàòûâàåì ðåçóëüòàòû ñîõðàíåíèÿ
	IF llResSave
	
		*12.05.2004 03:18 -&gt;Çàïèñûâàåì â .uRetVal èäåíòèôèêàòîð äîáàâëåííîãî äîêóìåíòà
		IF .cMode = [ADD]
			.uRetVal = .cstDataWork.GetLastID([lvFrmPartTvrEdit])
			_PARAM = .uRetVal
			REQUERY([lvJrnUsageEditPart])
		ELSE
			.cstDataWork.Save([lvJrnUsageEditPart])
			.uRetVal = .T.
		ENDIF
		***	
		.Hide()
		*------------------------------------------------------------------------------
		
	ELSE
	
		*01.04.2004 18:42 -&gt;Ïîïûòàåìñÿ îáðàáîòàòü îøèáêó ñîõðàíåíèÿ
		IF .cstDataWork.HandleSaveFail() &amp;&amp;åñëè îøèáêà îáðàáîòàíà
			RETURN .T.	&amp;&amp;âîçâðàùàåìñÿ ê ðåäàêòèðîâàíèþ
		ELSE
			
			*01.04.2004 18:40 -&gt;Ñîîáùàåì îá îøèáêå
			MESSAGEBOX([Â ïðîöåññå ñîõðàíåíèÿ ïðîèçîøëà îøèáêà. Èçìåíåíèÿ ñîõðàíåíû íå áóäóò.],16,[Îøèáêà...])
			*------------------------------------------------------------------------------
			
			*01.04.2004 18:40 -&gt;Îòìåíÿåì èçìåíåíèÿ
			.cstDataWork.Restore([lvFrmPartTvrEdit])
			.cstDataWork.Restore([lvJrnUsageEditPart])
			.uRetVal = .F.
			.Hide()	
			*------------------------------------------------------------------------------
			
		ENDIF	
		*------------------------------------------------------------------------------
		
	ENDIF
	*------------------------------------------------------------------------------

ELSE

	*12.05.2004 00:36 -&gt;Îòìåíèì èçìåíåíèÿ
	.cstDataWork.Restore([lvPriceEdit])
	.cstDataWork.Restore([lvJrnUsageEditPart])
	.cstDataWork.Restore([lvFrmPartTvrEdit])
	.uRetVal = .F.
	.Hide()
	*------------------------------------------------------------------------------
	
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatepricemsu
WITH THIS

*15.06.2006 16:56 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL   lnOldMsuID, ;
		lnNewMsuID, ;
		lnCfMsu
*** lnOldMsuID = OLDVAL([MsuId],[lvFrmPartTvrEdit])
lnOldMsuID  = pnOldMsuID
lnNewMsuID = EVAL([lvFrmPartTvrEdit.MsuId])
*------------------------------------------------------------------------------

*15.06.2006 16:59 -&gt; Åäèíèöà èçìåðåíèÿ íå èçìåíèëàñü
IF lnOldMsuID = lnNewMsuID
	RETURN
ENDIF
*------------------------------------------------------------------------------

*15.06.2006 16:59 -&gt; Îïðåäåëÿåì êîýôôèöèåíò äëÿ íîâîé ÅÈ ïî îòíîøåíèþ ê ñòàðîé
lnCfMsu = spGetCfMsu(lnOldMsuID, lnNewMsuID)
lnCfMsu = IIF(lnCfMsu = 0, 1, lnCfMsu)
*------------------------------------------------------------------------------

*15.06.2006 17:01 -&gt; Ïåðåñ÷èòûâàåì öåíû è êîëè÷åñòâî â ñîîòâåòñòâèè ñ êîýôôèöèåíòîì
.cntTvrBuy.txtTvrPrcBuy.Value = ROUND(.cntTvrBuy.txtTvrPrcBuy.Value * lnCfMsu, 4)
.cntTvrSale.txtTvrPrcSale.Value = ROUND(.cntTvrSale.txtTvrPrcSale.Value * lnCfMsu, 4)
.txtQnt.Value = ROUND(.txtQnt.Value / lnCfMsu, 3)
***
IF TYPE([.txtQntNetto]) == [O] AND !ISNULL(.txtQntNetto)
.txtQntNetto.Value = ROUND(.txtQntNetto.Value / lnCfMsu, 3)
ENDIF
*------------------------------------------------------------------------------
pnOldMsuID = lnNewMsuID
ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatesum
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateSum
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàññ÷åò ñóìì
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:25 -&gt; Ðàñ÷¸ò ñóììû ïîñòóïëåíèÿ
.CalculateSumBuy()
*------------------------------------------------------------------------------

*23.09.2005 12:25 -&gt; Ðàñ÷¸ò ñóììû ïðîäàæè
.CalculateSumSale()
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatesumbuy
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateSumBuy
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàñ÷¸ò ñóììû ïîñòóïëåíèÿ
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:25 -&gt; Ðàñ÷¸ò ñóììû ïîñòóïëåíèÿ
IF TYPE([.cntTvrBuy]) == [O] AND !ISNULL(.cntTvrBuy)
	.cntTvrBuy.txtTvrPrcSumBuy.Value = ROUND(.cntTvrBuy.txtTvrPrcBuy.Value * .txtQnt.Value,2)
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatesumsale
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateSumSale
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàñ÷¸ò ñóììû ïðîäàæè
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:25 -&gt; Ðàñ÷¸ò ñóììû ïðîäàæè
IF TYPE([.cntTvrSale]) == [O] AND !ISNULL(.cntTvrSale)
	.cntTvrSale.txtTvrPrcSumSale.Value = ROUND(.cntTvrSale.txtTvrPrcSale.Value * .txtQnt.Value,2)
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatevatsum
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateVatSum
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàññ÷åò ñóììû ÍÄÑ
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:18 -&gt; Ðàññ÷åò ÍÄÑ ïîñòóïëåíèÿ
.CalculateVatSumBuy()
*------------------------------------------------------------------------------

*23.09.2005 12:19 -&gt; Ðàññ÷åò ÍÄÑ ïðîäàæè
.CalculateVatSumSale()
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatevatsumbuy
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateVatSumBuy
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàññ÷åò ÍÄÑ ïîñòóïëåíèÿ
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:16 -&gt; Ðàññ÷åò ÍÄÑ ïîñòóïëåíèÿ
IF TYPE([.cntTvrBuy])==[O] AND !ISNULL(.cntTvrBuy)
	IF .cntTvrVat.txtTvrVATRate.Value # 0
		.cntTvrBuy.txtTvrVATSumBuy.Value = ROUND(.cntTvrBuy.txtTvrPrcSumBuy.Value * .cntTvrVat.txtTvrVATRate.Value / (100 + .cntTvrVat.txtTvrVATRate.Value),2)
	ELSE
		.cntTvrBuy.txtTvrVATSumBuy.Value = 0
	ENDIF
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatevatsumsale
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateVatSumSale
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàññ÷åò ÍÄÑ ïðîäàæè
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:17 -&gt; Ðàññ÷åò ÍÄÑ ïðîäàæè
IF TYPE([.cntTvrSale])==[O] AND !ISNULL(.cntTvrSale)
	IF .cntTvrVat.txtTvrVATRate.Value # 0
		.cntTvrSale.txtTvrVATSumSale.Value = ROUND(.cntTvrSale.txtTvrPrcSumSale.Value * .cntTvrVat.txtTvrVATRate.Value / (100 + .cntTvrVat.txtTvrVATRate.Value),2)
	ELSE
		.cntTvrSale.txtTvrVATSumSale.Value = 0
	ENDIF
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE cntenable
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.cntEnable
* Called by.......: &lt;frmPrimaryDocPartTvrEdit.Init&gt;
* Parameters......: &lt;tcObjectName - èìÿ îáúåêòà-êîíòåéíåðà,
*					 tnTop - âûñîòà îáúåêòà-êîíòåéíåðà&gt;
* Returns.........: &lt;lnNewTop&gt;
* Notes...........: Ðàçìåùåíèå íà ôîðìå êîíòåéíåðîâ ñîäåðæàùèõ öåíû, ñóììû, ÍÄÑ
*------------------------------------------------------------------------------
LPARAMETERS tcObjectName, tnTop

WITH This

*01.09.2005 12:23 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL lnNewTop
*------------------------------------------------------------------------------

*01.09.2005 12:00 -&gt; Íàñòðîèì âíåøíèé âèä îáúåêòà
.&amp;tcObjectName..Visible = .T.
***
*!*	.&amp;tcObjectName..Left = 5
*!*	.&amp;tcObjectName..Top = tnTop
*!*	***
*!*	lnNewTop = .&amp;tcObjectName..Top + .&amp;tcObjectName..Height + 5
*!*	*------------------------------------------------------------------------------

*01.09.2005 12:23 -&gt; Âîçâðàùàåì ðåçóëüòàò
RETURN lnNewTop
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE Destroy
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.Destroy
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........:
*------------------------------------------------------------------------------
WITH This

*12.01.2006 11:48 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL   lcIndependetFNM, ;
		lcDependetFNM
***
lcIndependetFNM = LEFT(.cMeasureUnitList,AT([;],.cMeasureUnitList)-1)
lcDependetFNM	= RIGHT(.cMeasureUnitList,LEN(.cMeasureUnitList)-AT([;],.cMeasureUnitList))
*------------------------------------------------------------------------------

*11.01.2006 17:05 -&gt;Çàêðîåì ñïðàâî÷íèê áàçîâûõ ÅÈ
USE IN SELECT([lvTvrMsuList])
*------------------------------------------------------------------------------

*12.01.2006 11:53 -&gt;Óäàëèì ñïðàâî÷íèêè
IF FILE([tmp\]+lcIndependetFNM+[.dbf])
ERASE ([tmp\]+lcIndependetFNM+[.dbf])
ENDIF
***
IF FILE([tmp\]+lcDependetFNM+[.dbf])
ERASE ([tmp\]+lcDependetFNM+[.dbf])
ENDIF
*------------------------------------------------------------------------------

*11.01.2006 17:05 -&gt;Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------
RELEASE pnOldMsuID
ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE Init
*------------------------------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRIMARYDOC_V1.VCX
* Class.Module....: FRMPRIMARYDOCPARTTVREDIT.INIT
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;tcCommand,tuParam1&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;~&gt;
*------------------------------------------------------------------------------
LPARAMETERS	tcCommand,tuParam1

*17.05.2004 01:26 -&gt;Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------

WITH This

*12.05.2004 03:12 -&gt;Ñîõðàíèì êîìàíäó (ðåæèì ðàáîòû ñ äàííûìè)
.cMode = UPPER(ALLTRIM(tcCommand))
*------------------------------------------------------------------------------
*12.05.2004 00:33 -&gt;Çàãðóçèì äàííûå â Alias äëÿ ðåäàêòèðîâàíèÿ
DO CASE

	CASE .cMode==[ADD]
		
		*12.05.2004 00:32 -&gt;Äîáàâèì ïóñòóþ çàïèñü
		APPEND BLANK IN lvFrmPartTvrEdit
		*------------------------------------------------------------------------------

		*12.05.2004 02:39 -&gt;Çàïèøåì èäåíòèôèêàòîð ðîäèòåëüñêîãî äîêóìåíòà
		REPLACE FrmID WITH tuParam1 IN lvFrmPartTvrEdit
		*------------------------------------------------------------------------------
		.cntTvrVat.txtTvrVATRate.Value = oApp.nNds
	CASE INLIST(.cMode,[EDIT],[INFO],[DELE])
		
		*12.05.2004 00:31 -&gt;Çàãðóçèì äàííûå ñóùåñòâóþùåé çàïèñè
		_PARAM = tuParam1
		***
		REQUERY([lvFrmPartTvrEdit])
		REQUERY([lvJrnUsageEditPart])
		*------------------------------------------------------------------------------
		
ENDCASE
*------------------------------------------------------------------------------
PUBLIC pnOldMsuID
pnOldMsuID  = lvFrmPartTvrEdit.MsuId
*01.09.2005 15:28 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnTop, ;
		lnOldTop
***
lnTop = 0
lnOldTop = lnTop
*------------------------------------------------------------------------------

*19.08.2005 12:16 -&gt; Çàêðîåì Alias
USE IN IIF(USED([lvFrmTypeInfoByFrm]),[lvFrmTypeInfoByFrm],0)
*------------------------------------------------------------------------------

*19.08.2005 12:12 -&gt; Îòêðîåì Alias ñ èíôîðìàöèåé î òèïå äîêóìåíòà
_PARAM = lvFrmPartTvrEdit.FrmID
***
USE lvFrmTypeInfoByFrm IN 0
*------------------------------------------------------------------------------

*07.08.2006 10:09 -&gt;Îïðåäåëèì OU ïî ID ôîðìû
USE lvFrmEdit IN 0
***
DO CASE
	CASE lvFrmTypeInfoByFrm.FrmTypeDirection = 2
		.nOUID = lvFrmEdit.PointIspOUID
	CASE INLIST(lvFrmTypeInfoByFrm.FrmTypeDirection,1,3)
		.nOUID = lvFrmEdit.PointEmiOUID
ENDCASE
.frmdirection = lvFrmTypeInfoByFrm.FrmTypeDirection
*------------------------------------------------------------------------------

*15.06.2006 15:45 -&gt; Ñîõðàíÿåì òèï ïðàéñà äëÿ äîêóìåíòà
.FrmPrcType = IIF(ISNULL(lvFrmTypeInfoByFrm.FrmPrcTypeID),1,lvFrmTypeInfoByFrm.FrmPrcTypeID)
*------------------------------------------------------------------------------

*01.09.2005 15:24 -&gt; Äîáàâëÿåì êîíòåéíåð ñ öåíîé ïîñòóïëåíèÿ
IF lvFrmTypeInfoByFrm.ContainPriceBuy
	*lnTop =
	.CntEnable([cntTvrBuy],lnTop)
ENDIF
*------------------------------------------------------------------------------
*01.09.2005 15:25 -&gt; Äîáàâëÿåì êîíòåéíåð ñ öåíîé ïðîäàæè
IF lvFrmTypeInfoByFrm.ContainPriceSale
	*lnTop =
	.CntEnable([cntTvrSale],lnTop)
ENDIF
*------------------------------------------------------------------------------
.CntEnable([cntTvrVat],lnTop)
*01.09.2005 15:29 -&gt; Íà ôîðìå ïðîèçîøëè èçìåíåíèÿ
IF lnTop # lnOldTop
	*{
	lnTop = .CntEnable([cntTvrVat],lnTop)
	***
	.cntCancelSaveHandled.Top = lnTop
	.cmdPrice.Top = lnTop
	.Height = .cntCancelSaveHandled.Top + .cntCancelSaveHandled.Height + 5
	*}
ENDIF
*------------------------------------------------------------------------------

*01.09.2005 16:11 -&gt; Ïðîñ÷èòàåì ñóììû è ÍÄÑ
.CalculateSum()
.CalculateVatSum()
*------------------------------------------------------------------------------

*19.08.2005 12:15 -&gt; Íàñòðîèì âíåøíèé âèä ôîðìû
DO CASE
	CASE .cMode = [ADD]
		.Caption = [Äîáàâëåíèå]
		.Icon = FULLPATH([frmprimarydocadd.ico])
		** ïðîâåðêà íà ïðåäïî÷òåíèå ðàáîòàòü ñî øòðèõ-êîäîì
		.withBarCode = VAL(oRes.GetParam([SET],[WITHBAR]))
		IF  .withBarCode = 0
			.cntIdCtlGridTvr.SetFocus()
			KEYBOARD '{ALT+DNARROW}'
		ENDIF
		*.cntcdCtlGridTvr.cmdShow.Click()
	CASE .cMode = [EDIT]
		.Caption = [Ðåäàêòèðîâàíèå]
		.Icon = FULLPATH([frmprimarydocedit.ico])
	CASE .cMode = [INFO]
		.Caption = [Ïðîñìîòð]
		.Icon = FULLPATH([frmprimarydocinfo.ico])
		ThisForm.cntCancelSaveHandled.cmdOk.Enabled = .F.
	CASE .cMode = [DELE]
		.Caption = [Óäàëåíèå]
		.Icon = FULLPATH([frmprimarydocdele.ico])
		ThisForm.cntCancelSaveHandled.cmdOk.Caption = [Óäàëèòü]
ENDCASE
***
.Caption = .Caption + [ òîâàðíîé ïîçèöèè äîêóìåíòà]
*------------------------------------------------------------------------------
ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE Load
*------------------------------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRIMARYDOC_V1.VCX
* Class.Module....: FRMPRIMARYDOCPARTTVREDIT.LOAD
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;~&gt;
*------------------------------------------------------------------------------

*17.05.2004 01:32 -&gt;Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------

*17.05.2004 01:32 -&gt;Îòêðîåì ÁÄ è óñòàíîâèì å¸ â êà÷åñòâå òåêóùåé
IF !DBUSED([BASIS])
	OPEN DATABASE BASIS
ENDIF
***
SET DATABASE TO BASIS
*------------------------------------------------------------------------------

*17.05.2004 01:32 -&gt;Îòêðîåì Alias äëÿ ðåäàêòèðîâàíèÿ áåç äàííûõ
USE lvFrmPartTvrEdit IN 0 NODATA
USE lvJrnUsageEditPart IN 0 NODATA
*------------------------------------------------------------------------------

*17.05.2004 01:34 -&gt; Îòêðûâàåì ñïðàâî÷íèêè
USE lvTovarList IN 0 ALIAS TovarList
USE lvTovarList IN 0 ALIAS TovarListOnly
SELECT TovarListOnly
SET FILTER TO INLIST(TovarListOnly.TvrTypeId,1,7)

*SELECT * FROM TovarList WHERE TovarList.TvrTypeId NOT IN (1,7) INTO CURSOR TovarListOnly

USE lvCurTypeList IN 0
USE lvtvrsetbmps IN 0
***
This.cMeasureUnitList = spGetBaseMsuList(0)
USE (LEFT(This.cMeasureUnitList,AT([;],This.cMeasureUnitList)-1)) IN 0 ALIAS lvTvrMsuList
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE Refresh
DODEFAULT()
*!*		IF this.cMode = [ADD]
*!*			this.cntIdCtlGridTvr.SetFocus()
*!*			this.cntcdCtlGridTvr.cmdShow.Click()
*!*		ENDIF

ENDPROC
PROCEDURE Resize
NODEFAULT
ENDPROC
PROCEDURE savepricesale
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.SavePriceSale
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Ñîõðàíåíèå öåíû ïðîäàæè
*------------------------------------------------------------------------------
WITH This
*08.06.2006 10:06 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	llDataWasChanged, ;
		llResSave
***
llResSave = .F.
*------------------------------------------------------------------------------

*07.06.2006 17:10 -&gt; Êîëè÷åñòâî çàïèñåé î öåíàõ îòëè÷íî îò íóëÿ
IF .cntTvrSale.Visible AND RECCOUNT([lvPriceEdit]) # 0

	*07.06.2006 16:26 -&gt; Ïðîèçâåäåì ñîõðàíåíèå öåíû ïðîäàæè
	IF .cMode # [DELE]

		*07.06.2006 16:27 -&gt; Ïðîâåðèì èçìåíèëèñü ëè äàííûå
		llDataWasChanged = .cstDataWork.DataChanged([lvPriceEdit],.T.)
		*------------------------------------------------------------------------------

		*07.06.2006 16:29 -&gt; Âûïîëíÿåì ñîõðàíåíèå åñëè ïîëüçîâàòåëü ðàçðåøèò ñîõðàíåíèå
		IF llDataWasChanged AND MESSAGEBOX([Ñîõðàíèòü öåíó ïðîäàæè â ïðàéñå?],4+32,[Ñîõðàíåíèå])=6

			*07.06.2006 16:47 -&gt; Ïîïûòàåìñÿ ñîõðàíèòü öåíó
			llResSave = .cstDataWork.Save([lvPriceEdit])
			*------------------------------------------------------------------------------

		ENDIF	
		*------------------------------------------------------------------------------

	ENDIF
	*------------------------------------------------------------------------------
	
	*02.04.2004 17:00 -&gt; Îêàòèì èçìåíåíèÿ
	IF !llResSave
		.cstDataWork.Restore([lvPriceEdit])
	ENDIF
	*------------------------------------------------------------------------------

	*07.06.2006 16:48 -&gt; Çàêðîåì Alias äëÿ ðåäàêòèðîâàíèÿ öåí è îòêðîåì ñíîâà áåç äàííûõ
	USE IN SELECT([lvPriceEdit])
	***
	USE lvPriceEdit IN 0 NODATA
	*------------------------------------------------------------------------------

ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>28</reserved2>
		<reserved3>cmode
cmeasureunitlist
frmprctype Íîìåð ïðàéñà äëÿ ýòîãî äîêóìåíòà
nouid èäåíòèôèêàòîð ïîäðàçäåëåíèÿ, ïî êîòîðîìó áóäåò ïðîèñõîäèòü äâèæåíèå òîâàðà
frmdirection Íàïðàâëåíèå äîêóìåíòà
withbarcode Ïðåäïî÷òåíèå â ðàáîòå ñî øòðèõ-êîäîì
*cntenable 
*calculatesum &lt;public&gt; Ðàññ÷åò ñóìì
*calculatevatsumbuy &lt;public&gt; Ðàññ÷åò ÍÄÑ ïîñòóïëåíèÿ
*calculatevatsumsale &lt;public&gt; Ðàññ÷åò ÍÄÑ ïðîäàæè
*calculatevatsum &lt;public&gt; Ðàññ÷åò ñóììû ÍÄÑ
*calculatesumbuy &lt;public&gt; Ðàññ÷åò ñóììû ïîñòóïëåíèÿ
*calculatesumsale &lt;public&gt; Ðàññ÷åò ñóììû ïðîäàæè
*calculatepricemsu ðàññ÷åò öåíû åäèíèöû èçìåðåíèÿ
*savepricesale 
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7>Ðåäàêòèðóåì ÷àñòü ôîðìû - òîâàð</reserved7>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1MV0RE0B8</uniqueid>
		<timestamp>1058819700</timestamp>
		<class>cnttvrsale</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>CntTvrSale</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 127
Left = 0
Width = 587
Height = 33
Visible = .F.
TabIndex = 6
ZOrderSet = 0
Name = "CntTvrSale"
ShpSale.Top = 0
ShpSale.Left = 0
ShpSale.Height = 33
ShpSale.Width = 587
ShpSale.Name = "ShpSale"
lblTvrPrcSale.Caption = "Öåíà îòãðóçêè:"
lblTvrPrcSale.Name = "lblTvrPrcSale"
txtTvrPrcSale.Left = 124
txtTvrPrcSale.Top = 5
txtTvrPrcSale.Name = "txtTvrPrcSale"
txtTvrPrcSumSale.Left = 282
txtTvrPrcSumSale.Top = 5
txtTvrPrcSumSale.Name = "txtTvrPrcSumSale"
txtTvrVATSumSale.Left = 484
txtTvrVATSumSale.Top = 5
txtTvrVATSumSale.Name = "txtTvrVATSumSale"
lblTvrPrcSumSale.Name = "lblTvrPrcSumSale"
lblTvrVATSumSale.Left = 414
lblTvrVATSumSale.Top = 8
lblTvrVATSumSale.Name = "lblTvrVATSumSale"
</properties>
		<protected/>
		<methods>PROCEDURE setprice
LPARAMETERS tnTvrID, tnPrcTypeID
RETURN
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1MV0RE0B7</uniqueid>
		<timestamp>1058819700</timestamp>
		<class>cnttvrvat</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>CntTvrVat</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 213
Left = 1
Width = 187
Height = 33
Visible = .F.
TabIndex = 11
ZOrderSet = 1
Name = "CntTvrVat"
shpVat.Top = 0
shpVat.Left = 0
shpVat.Height = 33
shpVat.Width = 188
shpVat.Name = "shpVat"
lblTvrVATRate.Name = "lblTvrVATRate"
txtTvrVATRate.Left = 81
txtTvrVATRate.Top = 5
txtTvrVATRate.Name = "txtTvrVATRate"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1MV0RE0BB</uniqueid>
		<timestamp>1058819700</timestamp>
		<class>cnttvrbuy</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>CntTvrBuy</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 97
Left = 0
Width = 588
Height = 33
Visible = .F.
TabIndex = 5
ZOrderSet = 3
Name = "CntTvrBuy"
ShpBuy.Top = 0
ShpBuy.Left = 0
ShpBuy.Height = 33
ShpBuy.Width = 588
ShpBuy.Name = "ShpBuy"
lblTvrPrcBuy.Caption = "Ñåáåñòîèìîñòü:"
lblTvrPrcBuy.Name = "lblTvrPrcBuy"
txtTvrPrcBuy.Left = 124
txtTvrPrcBuy.Top = 5
txtTvrPrcBuy.Name = "txtTvrPrcBuy"
lblTvrPrcSumBuy.Name = "lblTvrPrcSumBuy"
txtTvrPrcSumBuy.Left = 282
txtTvrPrcSumBuy.Top = 5
txtTvrPrcSumBuy.Name = "txtTvrPrcSumBuy"
lblTvrVATSumBuy.Left = 414
lblTvrVATSumBuy.Top = 7
lblTvrVATSumBuy.Name = "lblTvrVATSumBuy"
txtTvrVATSumBuy.Left = 484
txtTvrVATSumBuy.Top = 4
txtTvrVATSumBuy.Name = "txtTvrVATSumBuy"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18A02DMUV</uniqueid>
		<timestamp>1058819700</timestamp>
		<class>shp</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>shape</baseclass>
		<objname>shpTvr</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 5
Left = 0
Height = 61
Width = 589
SpecialEffect = 0
ZOrderSet = 8
Name = "shpTvr"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1058819700</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblTLU</objname>
		<parent>frmparttimeedit</parent>
		<properties>FontBold = .T.
Caption = "Øòðèõ-êîä:"
Left = 99
Top = 13
TabIndex = 22
ZOrderSet = 9
Name = "lblTLU"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1LE0P5JD7</uniqueid>
		<timestamp>1058819700</timestamp>
		<class>comtxtctlcalclentluidbytlu</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>comTxtCtlCalcLenTLUIDByTLU</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 10
Left = 170
Width = 286
Height = 23
TabIndex = 1
ZOrderSet = 10
Name = "comTxtCtlCalcLenTLUIDByTLU"
txtText.Height = 23
txtText.Left = 0
txtText.Top = 0
txtText.Width = 171
txtText.NullDisplay = "Øòðèõêîä íåîïðåäåëåííûé"
txtText.Name = "txtText"
lblLen.Left = 171
lblLen.Top = 3
lblLen.Name = "lblLen"
cmdFind.Top = 0
cmdFind.Left = 197
cmdFind.Name = "cmdFind"
cmdClear.Top = 0
cmdClear.Left = 220
cmdClear.Name = "cmdClear"
</properties>
		<protected/>
		<methods>PROCEDURE _handleanychange
*15.06.2006 16:50 -&gt; Îáíîâèì òîâàð è ïåðåéäåì â ïîëå ðåäàêòèðîâàíèÿ êîëè÷åñòâà
WITH Thisform
	.cntIdCtlGridTvr.SetValue(This.nTvrID)
	CLEAR TYPEAHEAD
	.txtQnt.SetFocus()
ENDWITH
*------------------------------------------------------------------------------
ENDPROC
PROCEDURE Refresh
PARAMETERS tnTvrID
IF this.ntvrid=0 AND (PCOUNT()=0 OR tnTvrID = -3 )
		This.txtText.Value = lvFrmPartTvrEdit.FrmPartTvrNote
ENDIF

IF PCOUNT()&gt;0 &amp;&amp; AND tnTvrID &lt;&gt; -3

	*15.06.2006 16:47 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
	PRIVATE	_PARAM
	***
	_PARAM = IIF(this.ntvrid=0,tnTvrID,this.ntvrid)
	*------------------------------------------------------------------------------

	*19.08.2005 11:37 -&gt; Íàéä¸ì ØÊ ïî èäåíòèôèêàòîðó òîâàðà
	IF USED([lvTovarLookUpByID])
		REQUERY([lvTovarLookUpByID])
	ELSE
		USE lvTovarLookUpByID IN 0
	ENDIF
	***
	IF RECCOUNT([lvTovarLookUpByID]) &gt; 0
		This.txtText.Value = lvTovarLookUpByID.TLU
	ELSE
		This.txtText.Value = .NULL.
	ENDIF
	*------------------------------------------------------------------------------
	
ENDIF

*15.06.2006 16:49 -&gt; Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_37M0MXJV8</uniqueid>
		<timestamp>1058819700</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblJrnUseStartF</objname>
		<parent>frmparttimeedit</parent>
		<properties>FontBold = .T.
Caption = "Íà÷àëî:"
Enabled = .F.
Left = 7
Top = 191
Visible = .F.
TabIndex = 17
ZOrderSet = 10
Name = "lblJrnUseStartF"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_37M0MXJVD</uniqueid>
		<timestamp>1058819700</timestamp>
		<class>comtxtctlcalendar</class>
		<classloc>comtxtctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntTxtCtlJrnUseStartF</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 188
Left = 58
Width = 176
Height = 23
Enabled = .F.
Visible = .F.
TabIndex = 9
ZOrderSet = 11
_allowresize = .T.
_allowresizecontent = .T.
Name = "cntTxtCtlJrnUseStartF"
txtText.ControlSource = "lvJrnUsageEditPart.UseStartF"
txtText.Height = 23
txtText.Left = 0
txtText.Top = 0
txtText.Width = 149
txtText._highlightobject = .parent.parent.lblJrnUseStartF
txtText.Name = "txtText"
cmdShow.Top = 0
cmdShow.Left = 153
cmdShow.Name = "cmdShow"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_37M0MXJVM</uniqueid>
		<timestamp>1058819700</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblJrnUseEndF</objname>
		<parent>frmparttimeedit</parent>
		<properties>FontBold = .T.
Caption = "Îêîí÷àíèå:"
Enabled = .F.
Left = 341
Top = 191
Visible = .F.
TabIndex = 20
ZOrderSet = 12
Name = "lblJrnUseEndF"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_37M0MXJVR</uniqueid>
		<timestamp>1058819700</timestamp>
		<class>comtxtctlcalendar</class>
		<classloc>comtxtctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntTxtCtlJrnUseEndF</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 188
Left = 410
Width = 176
Height = 23
Enabled = .F.
Visible = .F.
TabIndex = 10
ZOrderSet = 13
_allowresize = .T.
_allowresizecontent = .T.
Name = "cntTxtCtlJrnUseEndF"
txtText.ControlSource = "lvJrnUsageEditPart.UseEndF"
txtText.Height = 23
txtText.Left = 0
txtText.Top = 0
txtText.Width = 148
txtText._highlightobject = .parent.parent.lblJrnUseEndF
txtText.Name = "txtText"
cmdShow.Top = 0
cmdShow.Left = 152
cmdShow.Name = "cmdShow"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1A610IJYB</uniqueid>
		<timestamp>1058819700</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblJrnUseStart</objname>
		<parent>frmparttimeedit</parent>
		<properties>FontBold = .T.
Caption = "Íà÷àëî:"
Left = 7
Top = 165
TabIndex = 18
ZOrderSet = 10
Name = "lblJrnUseStart"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18I0M4ORT</uniqueid>
		<timestamp>1058819700</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblTvr</objname>
		<parent>frmparttimeedit</parent>
		<properties>FontBold = .T.
Caption = "Òîâàð, ðàáîòà:"
Left = 10
Top = 41
TabIndex = 24
ZOrderSet = 11
Name = "lblTvr"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1058819700</timestamp>
		<class>cntidctlgrid</class>
		<classloc>comidctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntIdCtlGridTvr</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 38
Left = 96
Width = 487
Height = 23
TabIndex = 2
ZOrderSet = 12
_controlsource = lvFrmPartTvrEdit.TvrId
_controlsourcetype = 1
_rsaliasname = TovarList
_rsfieldnameid = TvrID
_rsfieldnametext = TvrNM
_grdinfoparams = oMgrTovar;TVR;INFO
_grdaddparams = oMgrTovar;TVR;FASTADD;0;lvTvrInCntViewRepl
_selectobjectt = frmidctltreetvr;primarydoc_v1;primarydoc.app
Name = "cntIdCtlGridTvr"
txtText.Height = 22
txtText.Left = 0
txtText.Top = 0
txtText.Width = 415
txtText._highlightobject = .parent.parent.lblTvr
txtText.Name = "txtText"
cmdShow.Top = 0
cmdShow.Left = 441
cmdShow.Name = "cmdShow"
cmdClear.Top = 0
cmdClear.Left = 464
cmdClear.Name = "cmdClear"
CmdTree.Top = 0
CmdTree.Left = 417
CmdTree.Enabled = .T.
CmdTree.Visible = .T.
CmdTree.Name = "CmdTree"
Olecommprox1.Top = 0
Olecommprox1.Left = 36
Olecommprox1.Height = 16
Olecommprox1.Width = 38
Olecommprox1.Name = "Olecommprox1"
</properties>
		<protected/>
		<methods>PROCEDURE _refreshrelatedobjects
*------------------------------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRINARYDOC_V1.VCX
* Class.Module....: CNTIDCTLGRIDTVR._RefreshRelatedObjects
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Îáðàáîòêà èçìåíåíèÿ çíà÷åíèÿ ýëåìåíòà.
*------------------------------------------------------------------------------

*19.08.2005 12:31 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnTvrID, ;
		lcMsuTNM, ;
		lcIndependetFNM, ;
		lcDependetFNM, ;
		_PARAM, ;
		_PARAM_PRCTYPE
		
***
lnTvrID = This.Value
*------------------------------------------------------------------------------

WITH ThisForm

*06.09.2005 17:18 -&gt; Çàïèñûâàåì èäåíòèôèêàòîð òîâàðà
.comTxtCtlCalcLenTLUIDByTLU.nTvrID = lnTvrID
.comTxtCtlCalcLenTLUIDByTLU.Refresh(lnTvrID)
.LblTvrId.Caption = ALLTRIM(STR(lnTvrID,10,0))
*------------------------------------------------------------------------------

*17.04.2004 14:52 -&gt;Ïîëó÷èì èíôîðìàöèþ î âûáðàííîì òîâàðå
USE IN IIF(USED([lvTovarInfo]),[lvTovarInfo],0)
***
_PARAM = lnTvrID
_PARAM_PRCTYPE = .FrmPrcType
USE lvTovarInfo IN 0
*------------------------------------------------------------------------------

*11.01.2006 17:05 -&gt;Çàêðîåì ñïðàâî÷íèê áàçîâûõ ÅÈ
USE IN SELECT([lvTvrMsuList])

*16.01.2006 14:38 -&gt;Îïðåäåëèì íàçâàíèÿ òàáëèö ñî ñïðàâî÷íèêàìè
lcIndependetFNM = LEFT(.cMeasureUnitList,AT([;],.cMeasureUnitList)-1)
lcDependetFNM	= RIGHT(.cMeasureUnitList,LEN(.cMeasureUnitList)-AT([;],.cMeasureUnitList))
*------------------------------------------------------------------------------

*12.01.2006 11:53 -&gt;Óäàëèì ñïðàâî÷íèêè
IF FILE([tmp\]+lcIndependetFNM+[.dbf])
ERASE ([tmp\]+lcIndependetFNM+[.dbf])
ENDIF
***
IF FILE([tmp\]+lcDependetFNM+[.dbf])
ERASE ([tmp\]+lcDependetFNM+[.dbf])
ENDIF
*------------------------------------------------------------------------------

.cMeasureUnitList = spGetBaseMsuList(lvTovarInfo.MsuID)
lcMsuTNM = RIGHT(.cMeasureUnitList,LEN(.cMeasureUnitList)-AT([;],.cMeasureUnitList))
USE (lcMsuTNM) IN 0 ALIAS [lvTvrMsuList]
*------------------------------------------------------------------------------

*17.04.2004 14:53 -&gt;Óñòàíàâëèâàåì åäèíèöó èçìåðåíèÿ ïî óìîë÷àíèþ
IF .cMode==[ADD] AND lvTovarInfo.MsuID # 0 &amp;&amp; AND .cntIdCtlGridMsu.Value = 0
	.cntIdCtlGridMsu.SetValue(lvTovarInfo.MsuID)
ENDIF	
*------------------------------------------------------------------------------

*17.04.2004 15:06 -&gt; Óñòàíîâèì âåëè÷èíó ÍÄÑ ïî óìîë÷àíèþ
IF .cMode==[ADD] OR .cntTvrVat.txtTvrVATRate.Value =0
		***IF .cntTvrVat.txtTvrVATRate.Value # lvTovarInfo.tvrVATRate
	.cntTvrVat.txtTvrVATRate.Value = lvTovarInfo.tvrVATRate
ENDIF	
*------------------------------------------------------------------------------

*01.09.2005 17:26 -&gt; Óñòàíàâëèâàåì öåíû
IF TYPE([ThisForm.cntTvrBuy]) == [O] AND !ISNULL(.cntTvrBuy)
	.cntTvrBuy.SetPrice(.nOUID,lnTvrID)
ENDIF
***
IF TYPE([ThisForm.cntTvrSale]) == [O] AND !ISNULL(.cntTvrSale) AND TYPE([.FrmPrcType]) == [N]
	IF .FrmPrcType = 0 OR EMPTY(.FrmPrcType) OR ISNULL(.FrmPrcType)
		MESSAGEBOX([Ïðàéñ äëÿ äàííîãî äîêóìåíòà íå íàéäåí.],48,[Ïðåäóïðåæäåíèå])
	ELSE
		.cntTvrSale.SetPrice(lnTvrID,.FrmPrcType)
	ENDIF
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE cmdShow.Click
*!*	this.Parent._rsaliasname = 'TovarListOnly'
*!*	SELECT TovarListOnly
*!*	LOCATE ALL FOR TovarListOnly.TvrId = lvFrmPartTvrEdit.TvrId
DODEFAULT()
*!*	this.Parent._rsaliasname = 'TovarList'

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18I0M4ORT</uniqueid>
		<timestamp>1058819700</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblQnt</objname>
		<parent>frmparttimeedit</parent>
		<properties>FontBold = .T.
Caption = "Êîëè÷åñòâî:"
Left = 412
Top = 73
TabIndex = 26
ZOrderSet = 13
Name = "lblQnt"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_R020K4VL1</uniqueid>
		<timestamp>1051022653</timestamp>
		<class>txt</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>textbox</baseclass>
		<objname>txtQnt</objname>
		<parent>frmparttimeedit</parent>
		<properties>ControlSource = "lvFrmPartTvrEdit.TvrQnt"
Left = 486
TabIndex = 4
Top = 70
ZOrderSet = 14
_highlightobject = .parent.lblQnt
_convertcommatopoint = .T.
_usedbfieldproperty = .T.
Name = "txtQnt"
</properties>
		<protected/>
		<methods>PROCEDURE _handleanychange
*17.01.2006 09:52 -&gt;Ðàññ÷èòàåì ñóììû
ThisForm.CalculateSum()
*------------------------------------------------------------------------------
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18A02PAKD</uniqueid>
		<timestamp>1058819700</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblMsu</objname>
		<parent>frmparttimeedit</parent>
		<properties>FontBold = .T.
Caption = "Åäèíèöà èçìåðåíèÿ:"
Left = 4
Top = 72
TabIndex = 25
ZOrderSet = 15
Name = "lblMsu"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_30W0PUMX0</uniqueid>
		<timestamp>1058819700</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblNote</objname>
		<parent>frmparttimeedit</parent>
		<properties>FontBold = .T.
Caption = "Ïðèìå÷àíèå:"
Left = 5
Top = 252
TabIndex = 23
ZOrderSet = 16
Name = "lblNote"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18A02DMUV</uniqueid>
		<timestamp>1058819700</timestamp>
		<class>cntidctlgrid</class>
		<classloc>comidctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntIdCtlGridMsu</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 69
Left = 125
Width = 252
Height = 24
TabIndex = 3
ZOrderSet = 16
_controlsource = lvFrmPartTvrEdit.MsuId
_controlsourcetype = 1
_rsaliasname = lvTvrMsuList
_rsfieldnameid = MsuID
_rsfieldnametext = MsuNM
Name = "cntIdCtlGridMsu"
txtText._highlightobject = .parent.parent.lblMsu
txtText.Name = "txtText"
cmdShow.Name = "cmdShow"
cmdClear.Name = "cmdClear"
CmdTree.Name = "CmdTree"
Olecommprox1.Top = 0
Olecommprox1.Left = 36
Olecommprox1.Height = 16
Olecommprox1.Width = 38
Olecommprox1.Name = "Olecommprox1"
</properties>
		<protected/>
		<methods>PROCEDURE _refreshrelatedobjects
*30.09.2005 12:25 -&gt; Ðàñ÷¸ò öåíû åäèíèöû èçìåðåíèÿ
ThisForm.CalculatePriceMsu()
ThisForm.CalculateSum()
*------------------------------------------------------------------------------
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_30W0PUMWW</uniqueid>
		<timestamp>1051022653</timestamp>
		<class>edt</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>editbox</baseclass>
		<objname>edtNote</objname>
		<parent>frmparttimeedit</parent>
		<properties>Height = 47
Left = 83
TabIndex = 16
Top = 247
Width = 504
ZOrderSet = 17
ControlSource = "lvFrmPartTvrEdit.FrmPartTvrNote"
_highlightobject = .parent.lblNote
Name = "edtNote"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18M0216E7</uniqueid>
		<timestamp>1058819700</timestamp>
		<class>cntcancelsavehandled</class>
		<classloc>baseform_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntCancelSaveHandled</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 217
Left = 379
TabIndex = 13
ZOrderSet = 17
Name = "cntCancelSaveHandled"
cmdCancel.Name = "cmdCancel"
cmdOk.Name = "cmdOk"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_26Q0OOOIP</uniqueid>
		<timestamp>1058819700</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>LblTvrId</objname>
		<parent>frmparttimeedit</parent>
		<properties>FontBold = .T.
Caption = "Êîä òîâàðà"
Left = 10
Top = 13
TabIndex = 21
ZOrderSet = 18
Name = "LblTvrId"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18I0M4ORT</uniqueid>
		<timestamp>1058819700</timestamp>
		<class>comtxtctlcalendar</class>
		<classloc>comtxtctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntTxtCtlJrnUseStart</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 162
Left = 58
Width = 176
Height = 23
TabIndex = 7
ZOrderSet = 11
_allowresize = .T.
_allowresizecontent = .T.
Name = "cntTxtCtlJrnUseStart"
txtText.ControlSource = "lvJrnUsageEditPart.UseStart"
txtText.Height = 23
txtText.Left = 0
txtText.Top = 0
txtText.Width = 149
txtText._highlightobject = .parent.parent.lblJrnUseStart
txtText.Name = "txtText"
cmdShow.Top = 0
cmdShow.Left = 153
cmdShow.Name = "cmdShow"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1VG0YR07S</uniqueid>
		<timestamp>1051022653</timestamp>
		<class>cmd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>commandbutton</baseclass>
		<objname>cmdPrice</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 217
Left = 275
Caption = "Ïîëó÷èòü öåíó"
TabIndex = 12
ToolTipText = "Îïðåäåëÿåì ïîñëåäíþþ öåíó ïîñòóïëåíèÿ"
ZOrderSet = 20
Name = "cmdPrice"
</properties>
		<protected/>
		<methods>PROCEDURE Click
WITH This.Parent
	.cntTvrBuy.SetPrice(.nOUID,.comTxtCtlCalcLenTLUIDByTLU.nTvrID,.T.)
ENDWITH

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1MV0RE0B8</uniqueid>
		<timestamp>1058819700</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblJrnUseEnd</objname>
		<parent>frmparttimeedit</parent>
		<properties>FontBold = .T.
Caption = "Îêîí÷àíèå:"
Left = 341
Top = 165
TabIndex = 19
ZOrderSet = 12
Name = "lblJrnUseEnd"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25O11OEHM</uniqueid>
		<timestamp>1058819700</timestamp>
		<class>comtxtctlcalendar</class>
		<classloc>comtxtctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntTxtCtlJrnUseEnd</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 162
Left = 410
Width = 176
Height = 23
TabIndex = 8
ZOrderSet = 13
_allowresize = .T.
_allowresizecontent = .T.
Name = "cntTxtCtlJrnUseEnd"
txtText.ControlSource = "lvJrnUsageEditPart.UseEnd"
txtText.Height = 23
txtText.Left = 0
txtText.Top = 0
txtText.Width = 148
txtText._highlightobject = .parent.parent.lblJrnUseEnd
txtText.Name = "txtText"
cmdShow.Top = 0
cmdShow.Left = 152
cmdShow.Name = "cmdShow"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1MV0RE0B7</uniqueid>
		<timestamp>1051022653</timestamp>
		<class>cmd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>commandbutton</baseclass>
		<objname>cmdToday</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 161
Left = 270
Height = 25
Width = 48
Caption = "\&lt;Ñåé÷àñ"
TabIndex = 14
Name = "cmdToday"
</properties>
		<protected/>
		<methods>PROCEDURE Click
This.Parent.cntTxtCtlJrnUseStart.txtText.Value= DATETIME()
This.Parent.cntTxtCtlJrnUseEnd.txtText.Value= DATETIME()

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_37M0MXJW0</uniqueid>
		<timestamp>1058817895</timestamp>
		<class>cmd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>commandbutton</baseclass>
		<objname>Cmd1</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 187
Left = 270
Height = 25
Width = 48
Caption = "\&lt;Ñåé÷àñ"
Enabled = .F.
TabIndex = 15
Visible = .F.
Name = "Cmd1"
</properties>
		<protected/>
		<methods>PROCEDURE Click
This.Parent.cntTxtCtlJrnUseStart.txtText.Value= DATETIME()
This.Parent.cntTxtCtlJrnUseEnd.txtText.Value= DATETIME()

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>frmparttimeedit</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18I0M4ORT</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>frmedit</class>
		<classloc>baseform_v1.vcx</classloc>
		<baseclass>form</baseclass>
		<objname>frmpartresuedit</objname>
		<parent/>
		<properties>Height = 305
Width = 740
DoCreate = .T.
WindowState = 0
cmode = 
cmeasureunitlist = 
frmprctype = 1
nouid = 0
frmdirection = 1
withbarcode = 0
cflparentsmt_ = 
_memberdata =      155&lt;VFPData&gt;&lt;memberdata name="nfrmid" type="property" display="nFrmId"/&gt;&lt;memberdata name="cflparentsmt_" type="property" display="cFlParentSmt_"/&gt;&lt;/VFPData&gt;

Name = "frmpartresuedit"
cstmsghandler.Top = -3
cstmsghandler.Left = 0
cstmsghandler.Name = "cstmsghandler"
cstresizable.Top = -3
cstresizable.Left = 22
cstresizable.Name = "cstresizable"
Img1.Left = -122
Img1.Top = -3
Img1.ZOrderSet = 7
Img1.Name = "Img1"
cstdatawork.Top = -3
cstdatawork.Left = 44
cstdatawork.Name = "cstdatawork"
</properties>
		<protected/>
		<methods>PROCEDURE _handlecntcancelsaveevent
*------------------------------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRIMARYDOC_V1.VCX
* Class.Module....: FRMPRIMARYDOCPARTTVREDIT._HANDLECNTCANCELSAVEEVENT
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;tcMessage&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;~&gt;
*------------------------------------------------------------------------------
LPARAMETERS	tcMessage

LOCAL	llResSave

WITH This

*17.05.2004 02:07 -&gt;Ïðîèçâîäèì ñîõðàíåíèÿ/îòìåíÿåì èçìåíåíèÿ
IF tcMessage == [OK]
	
	*13.06.2006 18:01 -&gt; Ñîõðàíÿåì öåíó ïðîäàæè
	.SavePriceSale()
	*------------------------------------------------------------------------------
	.uRetVal = .T.
	
	IF .cMode = [DELE]
		DELETE IN lvFrmPartTvrEdit
	ENDIF

	llResSave = .cstDataWork.Save([lvFrmPartTvrEdit])
	*21.01.2004 20:01 -&gt;Îáðàáàòûâàåì ðåçóëüòàòû ñîõðàíåíèÿ
	IF llResSave
	
		*12.05.2004 03:18 -&gt;Çàïèñûâàåì â .uRetVal èäåíòèôèêàòîð äîáàâëåííîãî äîêóìåíòà
		IF .cMode = [ADD]
			.uRetVal = .cstDataWork.GetLastID([lvFrmPartTvrEdit])
			_PARAM = .uRetVal
			REQUERY([lvJrnUsageEditPart])
		ELSE
			.cstDataWork.Save([lvJrnUsageEditPart])
			.uRetVal = .T.
		ENDIF
		***	
		.Hide()
		*------------------------------------------------------------------------------
		
	ELSE
	
		*01.04.2004 18:42 -&gt;Ïîïûòàåìñÿ îáðàáîòàòü îøèáêó ñîõðàíåíèÿ
		IF .cstDataWork.HandleSaveFail() &amp;&amp;åñëè îøèáêà îáðàáîòàíà
			RETURN .T.	&amp;&amp;âîçâðàùàåìñÿ ê ðåäàêòèðîâàíèþ
		ELSE
			
			*01.04.2004 18:40 -&gt;Ñîîáùàåì îá îøèáêå
			MESSAGEBOX([Â ïðîöåññå ñîõðàíåíèÿ ïðîèçîøëà îøèáêà. Èçìåíåíèÿ ñîõðàíåíû íå áóäóò.],16,[Îøèáêà...])
			*------------------------------------------------------------------------------
			
			*01.04.2004 18:40 -&gt;Îòìåíÿåì èçìåíåíèÿ
			.cstDataWork.Restore([lvFrmPartTvrEdit])
			.cstDataWork.Restore([lvJrnUsageEditPart])
			.uRetVal = .F.
			.Hide()	
			*------------------------------------------------------------------------------
			
		ENDIF	
		*------------------------------------------------------------------------------
		
	ENDIF
	*------------------------------------------------------------------------------

ELSE

	*12.05.2004 00:36 -&gt;Îòìåíèì èçìåíåíèÿ
	.cstDataWork.Restore([lvPriceEdit])
	.cstDataWork.Restore([lvJrnUsageEditPart])
	.cstDataWork.Restore([lvFrmPartTvrEdit])
	.uRetVal = .F.
	.Hide()
	*------------------------------------------------------------------------------
	
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatepricemsu
WITH THIS

*15.06.2006 16:56 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL   lnOldMsuID, ;
		lnNewMsuID, ;
		lnCfMsu
*** lnOldMsuID = OLDVAL([MsuId],[lvFrmPartTvrEdit])
lnOldMsuID  = pnOldMsuID
lnNewMsuID = EVAL([lvFrmPartTvrEdit.MsuId])
*------------------------------------------------------------------------------

*15.06.2006 16:59 -&gt; Åäèíèöà èçìåðåíèÿ íå èçìåíèëàñü
IF lnOldMsuID = lnNewMsuID
	RETURN
ENDIF
*------------------------------------------------------------------------------

*15.06.2006 16:59 -&gt; Îïðåäåëÿåì êîýôôèöèåíò äëÿ íîâîé ÅÈ ïî îòíîøåíèþ ê ñòàðîé
lnCfMsu = spGetCfMsu(lnOldMsuID, lnNewMsuID)
lnCfMsu = IIF(lnCfMsu = 0, 1, lnCfMsu)
*------------------------------------------------------------------------------

*15.06.2006 17:01 -&gt; Ïåðåñ÷èòûâàåì öåíû è êîëè÷åñòâî â ñîîòâåòñòâèè ñ êîýôôèöèåíòîì
.cntTvrBuy.txtTvrPrcBuy.Value = ROUND(.cntTvrBuy.txtTvrPrcBuy.Value * lnCfMsu, 4)
.cntTvrSale.txtTvrPrcSale.Value = ROUND(.cntTvrSale.txtTvrPrcSale.Value * lnCfMsu, 4)
.txtQnt.Value = ROUND(.txtQnt.Value / lnCfMsu, 3)
***
IF TYPE([.txtQntNetto]) == [O] AND !ISNULL(.txtQntNetto)
.txtQntNetto.Value = ROUND(.txtQntNetto.Value / lnCfMsu, 3)
ENDIF
*------------------------------------------------------------------------------
pnOldMsuID = lnNewMsuID
ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatesum
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateSum
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàññ÷åò ñóìì
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:25 -&gt; Ðàñ÷¸ò ñóììû ïîñòóïëåíèÿ
.CalculateSumBuy()
*------------------------------------------------------------------------------

*23.09.2005 12:25 -&gt; Ðàñ÷¸ò ñóììû ïðîäàæè
.CalculateSumSale()
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatesumbuy
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateSumBuy
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàñ÷¸ò ñóììû ïîñòóïëåíèÿ
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:25 -&gt; Ðàñ÷¸ò ñóììû ïîñòóïëåíèÿ
IF TYPE([.cntTvrBuy]) == [O] AND !ISNULL(.cntTvrBuy)
	.cntTvrBuy.txtTvrPrcSumBuy.Value = ROUND(.cntTvrBuy.txtTvrPrcBuy.Value * .txtQnt.Value,2)
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatesumsale
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateSumSale
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàñ÷¸ò ñóììû ïðîäàæè
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:25 -&gt; Ðàñ÷¸ò ñóììû ïðîäàæè
IF TYPE([.cntTvrSale]) == [O] AND !ISNULL(.cntTvrSale)
	.cntTvrSale.txtTvrPrcSumSale.Value = ROUND(.cntTvrSale.txtTvrPrcSale.Value * .txtQnt.Value,2)
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatevatsum
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateVatSum
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàññ÷åò ñóììû ÍÄÑ
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:18 -&gt; Ðàññ÷åò ÍÄÑ ïîñòóïëåíèÿ
.CalculateVatSumBuy()
*------------------------------------------------------------------------------

*23.09.2005 12:19 -&gt; Ðàññ÷åò ÍÄÑ ïðîäàæè
.CalculateVatSumSale()
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatevatsumbuy
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateVatSumBuy
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàññ÷åò ÍÄÑ ïîñòóïëåíèÿ
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:16 -&gt; Ðàññ÷åò ÍÄÑ ïîñòóïëåíèÿ
IF TYPE([.cntTvrBuy])==[O] AND !ISNULL(.cntTvrBuy)
	IF .cntTvrVat.txtTvrVATRate.Value # 0
		.cntTvrBuy.txtTvrVATSumBuy.Value = ROUND(.cntTvrBuy.txtTvrPrcSumBuy.Value * .cntTvrVat.txtTvrVATRate.Value / (100 + .cntTvrVat.txtTvrVATRate.Value),2)
	ELSE
		.cntTvrBuy.txtTvrVATSumBuy.Value = 0
	ENDIF
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatevatsumsale
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateVatSumSale
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàññ÷åò ÍÄÑ ïðîäàæè
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:17 -&gt; Ðàññ÷åò ÍÄÑ ïðîäàæè
IF TYPE([.cntTvrSale])==[O] AND !ISNULL(.cntTvrSale)
	IF .cntTvrVat.txtTvrVATRate.Value # 0
		.cntTvrSale.txtTvrVATSumSale.Value = ROUND(.cntTvrSale.txtTvrPrcSumSale.Value * .cntTvrVat.txtTvrVATRate.Value / (100 + .cntTvrVat.txtTvrVATRate.Value),2)
	ELSE
		.cntTvrSale.txtTvrVATSumSale.Value = 0
	ENDIF
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE cntenable
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.cntEnable
* Called by.......: &lt;frmPrimaryDocPartTvrEdit.Init&gt;
* Parameters......: &lt;tcObjectName - èìÿ îáúåêòà-êîíòåéíåðà,
*					 tnTop - âûñîòà îáúåêòà-êîíòåéíåðà&gt;
* Returns.........: &lt;lnNewTop&gt;
* Notes...........: Ðàçìåùåíèå íà ôîðìå êîíòåéíåðîâ ñîäåðæàùèõ öåíû, ñóììû, ÍÄÑ
*------------------------------------------------------------------------------
LPARAMETERS tcObjectName, tnTop

WITH This

*01.09.2005 12:23 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL lnNewTop
*------------------------------------------------------------------------------

*01.09.2005 12:00 -&gt; Íàñòðîèì âíåøíèé âèä îáúåêòà
.&amp;tcObjectName..Visible = .T.
***
*!*	.&amp;tcObjectName..Left = 5
*!*	.&amp;tcObjectName..Top = tnTop
*!*	***
*!*	lnNewTop = .&amp;tcObjectName..Top + .&amp;tcObjectName..Height + 5
*!*	*------------------------------------------------------------------------------

*01.09.2005 12:23 -&gt; Âîçâðàùàåì ðåçóëüòàò
RETURN lnNewTop
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE Destroy
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.Destroy
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........:
*------------------------------------------------------------------------------
WITH This

*12.01.2006 11:48 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL   lcIndependetFNM, ;
		lcDependetFNM
***
lcIndependetFNM = LEFT(.cMeasureUnitList,AT([;],.cMeasureUnitList)-1)
lcDependetFNM	= RIGHT(.cMeasureUnitList,LEN(.cMeasureUnitList)-AT([;],.cMeasureUnitList))
*------------------------------------------------------------------------------

*11.01.2006 17:05 -&gt;Çàêðîåì ñïðàâî÷íèê áàçîâûõ ÅÈ
USE IN SELECT([lvTvrMsuList])
*------------------------------------------------------------------------------

*12.01.2006 11:53 -&gt;Óäàëèì ñïðàâî÷íèêè
IF FILE([tmp\]+lcIndependetFNM+[.dbf])
ERASE ([tmp\]+lcIndependetFNM+[.dbf])
ENDIF
***
IF FILE([tmp\]+lcDependetFNM+[.dbf])
ERASE ([tmp\]+lcDependetFNM+[.dbf])
ENDIF
*------------------------------------------------------------------------------

*11.01.2006 17:05 -&gt;Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------
RELEASE pnOldMsuID
ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE Init
*------------------------------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRIMARYDOC_V1.VCX
* Class.Module....: FRMPRIMARYDOCPARTTVREDIT.INIT
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;tcCommand,tuParam1&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;~&gt;
*------------------------------------------------------------------------------
LPARAMETERS	tcCommand,tuParam1,cFlParentSmt

*17.05.2004 01:26 -&gt;Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------
WITH This
.cFlParentSmt_ = cFlParentSmt
*12.05.2004 03:12 -&gt;Ñîõðàíèì êîìàíäó (ðåæèì ðàáîòû ñ äàííûìè)
.cMode = UPPER(ALLTRIM(tcCommand))
*------------------------------------------------------------------------------
*12.05.2004 00:33 -&gt;Çàãðóçèì äàííûå â Alias äëÿ ðåäàêòèðîâàíèÿ
DO CASE

	CASE .cMode==[ADD]
		
		*12.05.2004 00:32 -&gt;Äîáàâèì ïóñòóþ çàïèñü
		APPEND BLANK IN lvFrmPartTvrEdit
		*------------------------------------------------------------------------------

		*12.05.2004 02:39 -&gt;Çàïèøåì èäåíòèôèêàòîð ðîäèòåëüñêîãî äîêóìåíòà
		REPLACE FrmID WITH tuParam1 IN lvFrmPartTvrEdit
		*------------------------------------------------------------------------------
		.cntTvrVat.txtTvrVATRate.Value = oApp.nNds
	CASE INLIST(.cMode,[EDIT],[INFO],[DELE])
		
		*12.05.2004 00:31 -&gt;Çàãðóçèì äàííûå ñóùåñòâóþùåé çàïèñè
		_PARAM = tuParam1
		***
		REQUERY([lvFrmPartTvrEdit])
		REQUERY([lvJrnUsageEditPart])
		*------------------------------------------------------------------------------
		
ENDCASE
*------------------------------------------------------------------------------
PUBLIC pnOldMsuID
pnOldMsuID  = lvFrmPartTvrEdit.MsuId
*01.09.2005 15:28 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnTop, ;
		lnOldTop
***
lnTop = 0
lnOldTop = lnTop
*------------------------------------------------------------------------------

*19.08.2005 12:16 -&gt; Çàêðîåì Alias
USE IN IIF(USED([lvFrmTypeInfoByFrm]),[lvFrmTypeInfoByFrm],0)
*------------------------------------------------------------------------------

*19.08.2005 12:12 -&gt; Îòêðîåì Alias ñ èíôîðìàöèåé î òèïå äîêóìåíòà
_PARAM = lvFrmPartTvrEdit.FrmID
***
USE lvFrmTypeInfoByFrm IN 0
*------------------------------------------------------------------------------

*07.08.2006 10:09 -&gt;Îïðåäåëèì OU ïî ID ôîðìû
USE lvFrmEdit IN 0
***
DO CASE
	CASE lvFrmTypeInfoByFrm.FrmTypeDirection = 2
		.nOUID = lvFrmEdit.PointIspOUID
	CASE INLIST(lvFrmTypeInfoByFrm.FrmTypeDirection,1,3)
		.nOUID = lvFrmEdit.PointEmiOUID
ENDCASE
.frmdirection = lvFrmTypeInfoByFrm.FrmTypeDirection
*------------------------------------------------------------------------------

*15.06.2006 15:45 -&gt; Ñîõðàíÿåì òèï ïðàéñà äëÿ äîêóìåíòà
.FrmPrcType = IIF(ISNULL(lvFrmTypeInfoByFrm.FrmPrcTypeID),1,lvFrmTypeInfoByFrm.FrmPrcTypeID)
*------------------------------------------------------------------------------

*01.09.2005 15:24 -&gt; Äîáàâëÿåì êîíòåéíåð ñ öåíîé ïîñòóïëåíèÿ
IF lvFrmTypeInfoByFrm.ContainPriceBuy
	*lnTop =
	.CntEnable([cntTvrBuy],lnTop)
ENDIF
*------------------------------------------------------------------------------
*01.09.2005 15:25 -&gt; Äîáàâëÿåì êîíòåéíåð ñ öåíîé ïðîäàæè
IF lvFrmTypeInfoByFrm.ContainPriceSale
	*lnTop =
	.CntEnable([cntTvrSale],lnTop)
ENDIF
*------------------------------------------------------------------------------
.CntEnable([cntTvrVat],lnTop)
*01.09.2005 15:29 -&gt; Íà ôîðìå ïðîèçîøëè èçìåíåíèÿ
IF lnTop # lnOldTop
	*{
	lnTop = .CntEnable([cntTvrVat],lnTop)
	***
	.cntCancelSaveHandled.Top = lnTop
	.cmdPrice.Top = lnTop
	.Height = .cntCancelSaveHandled.Top + .cntCancelSaveHandled.Height + 5
	*}
ENDIF
*------------------------------------------------------------------------------

*01.09.2005 16:11 -&gt; Ïðîñ÷èòàåì ñóììû è ÍÄÑ
.CalculateSum()
.CalculateVatSum()
*------------------------------------------------------------------------------

*19.08.2005 12:15 -&gt; Íàñòðîèì âíåøíèé âèä ôîðìû
DO CASE
	CASE .cMode = [ADD]
		.Caption = [Äîáàâëåíèå]
		.Icon = FULLPATH([frmprimarydocadd.ico])
		** ïðîâåðêà íà ïðåäïî÷òåíèå ðàáîòàòü ñî øòðèõ-êîäîì
		.withBarCode = VAL(oRes.GetParam([SET],[WITHBAR]))
		IF  .withBarCode = 0
			.cntIdCtlGridTvr.SetFocus()
			KEYBOARD '{ALT+DNARROW}'
		ENDIF
		*.cntcdCtlGridTvr.cmdShow.Click()
	CASE .cMode = [EDIT]
		.Caption = [Ðåäàêòèðîâàíèå]
		.Icon = FULLPATH([frmprimarydocedit.ico])
	CASE .cMode = [INFO]
		.Caption = [Ïðîñìîòð]
		.Icon = FULLPATH([frmprimarydocinfo.ico])
		ThisForm.cntCancelSaveHandled.cmdOk.Enabled = .F.
	CASE .cMode = [DELE]
		.Caption = [Óäàëåíèå]
		.Icon = FULLPATH([frmprimarydocdele.ico])
		ThisForm.cntCancelSaveHandled.cmdOk.Caption = [Óäàëèòü]
ENDCASE
***
.Caption = .Caption + [ òîâàðíîé ïîçèöèè äîêóìåíòà]
*------------------------------------------------------------------------------
*!*	USE (this.cFlParentSmt_) IN 0 ALIAS ParentSmt
*!*	.BitgrdTvr._RSRequery()

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE Load
*------------------------------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRIMARYDOC_V1.VCX
* Class.Module....: FRMPRIMARYDOCPARTTVREDIT.LOAD
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;~&gt;
*------------------------------------------------------------------------------

*17.05.2004 01:32 -&gt;Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------

*17.05.2004 01:32 -&gt;Îòêðîåì ÁÄ è óñòàíîâèì å¸ â êà÷åñòâå òåêóùåé
IF !DBUSED([BASIS])
	OPEN DATABASE BASIS
ENDIF
***
SET DATABASE TO BASIS
*------------------------------------------------------------------------------

*17.05.2004 01:32 -&gt;Îòêðîåì Alias äëÿ ðåäàêòèðîâàíèÿ áåç äàííûõ
USE lvFrmPartTvrEdit IN 0 NODATA
USE lvJrnUsageEditPart IN 0 NODATA
*------------------------------------------------------------------------------
LOCAL _PARAM
*17.05.2004 01:34 -&gt; Îòêðûâàåì ñïðàâî÷íèêè
_PARAM = '3'
USE lvTovarListType IN 0 ALIAS TovarList
*USE lvTovarList IN 0 ALIAS TovarListOnly
_PARAM = '8'
USE IN SELECT([lvTovarListType])
USE lvTovarListType IN 0 ALIAS ResuListOnly

USE lvCurTypeList IN 0
USE lvtvrsetbmps IN 0
USE lvTvrAttribList IN 0
***
This.cMeasureUnitList = spGetBaseMsuList(0)
USE (LEFT(This.cMeasureUnitList,AT([;],This.cMeasureUnitList)-1)) IN 0 ALIAS lvTvrMsuList
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE Refresh
DODEFAULT()
*!*		IF this.cMode = [ADD]
*!*			this.cntIdCtlGridTvr.SetFocus()
*!*			this.cntcdCtlGridTvr.cmdShow.Click()
*!*		ENDIF

ENDPROC
PROCEDURE Resize
NODEFAULT
ENDPROC
PROCEDURE savepricesale
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.SavePriceSale
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Ñîõðàíåíèå öåíû ïðîäàæè
*------------------------------------------------------------------------------
WITH This
*08.06.2006 10:06 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	llDataWasChanged, ;
		llResSave
***
llResSave = .F.
*------------------------------------------------------------------------------

*07.06.2006 17:10 -&gt; Êîëè÷åñòâî çàïèñåé î öåíàõ îòëè÷íî îò íóëÿ
IF .cntTvrSale.Visible AND RECCOUNT([lvPriceEdit]) # 0

	*07.06.2006 16:26 -&gt; Ïðîèçâåäåì ñîõðàíåíèå öåíû ïðîäàæè
	IF .cMode # [DELE]

		*07.06.2006 16:27 -&gt; Ïðîâåðèì èçìåíèëèñü ëè äàííûå
		llDataWasChanged = .cstDataWork.DataChanged([lvPriceEdit],.T.)
		*------------------------------------------------------------------------------

		*07.06.2006 16:29 -&gt; Âûïîëíÿåì ñîõðàíåíèå åñëè ïîëüçîâàòåëü ðàçðåøèò ñîõðàíåíèå
		IF llDataWasChanged AND MESSAGEBOX([Ñîõðàíèòü öåíó ïðîäàæè â ïðàéñå?],4+32,[Ñîõðàíåíèå])=6

			*07.06.2006 16:47 -&gt; Ïîïûòàåìñÿ ñîõðàíèòü öåíó
			llResSave = .cstDataWork.Save([lvPriceEdit])
			*------------------------------------------------------------------------------

		ENDIF	
		*------------------------------------------------------------------------------

	ENDIF
	*------------------------------------------------------------------------------
	
	*02.04.2004 17:00 -&gt; Îêàòèì èçìåíåíèÿ
	IF !llResSave
		.cstDataWork.Restore([lvPriceEdit])
	ENDIF
	*------------------------------------------------------------------------------

	*07.06.2006 16:48 -&gt; Çàêðîåì Alias äëÿ ðåäàêòèðîâàíèÿ öåí è îòêðîåì ñíîâà áåç äàííûõ
	USE IN SELECT([lvPriceEdit])
	***
	USE lvPriceEdit IN 0 NODATA
	*------------------------------------------------------------------------------

ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>31</reserved2>
		<reserved3>cmode
cmeasureunitlist
frmprctype Íîìåð ïðàéñà äëÿ ýòîãî äîêóìåíòà
nouid èäåíòèôèêàòîð ïîäðàçäåëåíèÿ, ïî êîòîðîìó áóäåò ïðîèñõîäèòü äâèæåíèå òîâàðà
frmdirection Íàïðàâëåíèå äîêóìåíòà
withbarcode Ïðåäïî÷òåíèå â ðàáîòå ñî øòðèõ-êîäîì
cflparentsmt_ òàáëèöà ñ íàçâàíèÿìè ðîäèòåëüñêèõ ïîçèöèé
*cntenable 
*calculatesum &lt;public&gt; Ðàññ÷åò ñóìì
*calculatevatsumbuy &lt;public&gt; Ðàññ÷åò ÍÄÑ ïîñòóïëåíèÿ
*calculatevatsumsale &lt;public&gt; Ðàññ÷åò ÍÄÑ ïðîäàæè
*calculatevatsum &lt;public&gt; Ðàññ÷åò ñóììû ÍÄÑ
*calculatesumbuy &lt;public&gt; Ðàññ÷åò ñóììû ïîñòóïëåíèÿ
*calculatesumsale &lt;public&gt; Ðàññ÷åò ñóììû ïðîäàæè
*calculatepricemsu ðàññ÷åò öåíû åäèíèöû èçìåðåíèÿ
*savepricesale 
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7>Ðåäàêòèðóåì ïîçèöèþ óñëóãà-ðóñóðñ</reserved7>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18A02PAKD</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblMsu</objname>
		<parent>frmpartresuedit</parent>
		<properties>AutoSize = .F.
FontBold = .T.
WordWrap = .T.
Caption = "Åäèíèöà èçìåðåíèÿ:"
Height = 30
Left = 4
Top = 60
Width = 80
TabIndex = 27
ZOrderSet = 0
Name = "lblMsu"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1MV0RE0B8</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>cnttvrsale</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>CntTvrSale</objname>
		<parent>frmpartresuedit</parent>
		<properties>Top = 143
Left = 0
Width = 587
Height = 33
Visible = .F.
TabIndex = 7
ZOrderSet = 1
Name = "CntTvrSale"
ShpSale.Top = 0
ShpSale.Left = 0
ShpSale.Height = 33
ShpSale.Width = 587
ShpSale.Name = "ShpSale"
lblTvrPrcSale.Caption = "Öåíà îòãðóçêè:"
lblTvrPrcSale.Name = "lblTvrPrcSale"
txtTvrPrcSale.Left = 124
txtTvrPrcSale.Top = 5
txtTvrPrcSale.Name = "txtTvrPrcSale"
txtTvrPrcSumSale.Left = 282
txtTvrPrcSumSale.Top = 5
txtTvrPrcSumSale.Name = "txtTvrPrcSumSale"
txtTvrVATSumSale.Left = 484
txtTvrVATSumSale.Top = 5
txtTvrVATSumSale.Name = "txtTvrVATSumSale"
lblTvrPrcSumSale.Name = "lblTvrPrcSumSale"
lblTvrVATSumSale.Left = 414
lblTvrVATSumSale.Top = 8
lblTvrVATSumSale.Name = "lblTvrVATSumSale"
</properties>
		<protected/>
		<methods>PROCEDURE setprice
LPARAMETERS tnTvrID, tnPrcTypeID
RETURN
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1MV0RE0B7</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>cnttvrvat</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>CntTvrVat</objname>
		<parent>frmpartresuedit</parent>
		<properties>Top = 229
Left = 1
Width = 187
Height = 33
Visible = .F.
TabIndex = 14
ZOrderSet = 2
Name = "CntTvrVat"
shpVat.Top = 0
shpVat.Left = 0
shpVat.Height = 33
shpVat.Width = 188
shpVat.Name = "shpVat"
lblTvrVATRate.Name = "lblTvrVATRate"
txtTvrVATRate.Left = 81
txtTvrVATRate.Top = 5
txtTvrVATRate.Name = "txtTvrVATRate"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1MV0RE0BB</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>cnttvrbuy</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>CntTvrBuy</objname>
		<parent>frmpartresuedit</parent>
		<properties>Top = 113
Left = 0
Width = 588
Height = 33
Visible = .F.
TabIndex = 6
ZOrderSet = 4
Name = "CntTvrBuy"
ShpBuy.Top = 0
ShpBuy.Left = 0
ShpBuy.Height = 33
ShpBuy.Width = 588
ShpBuy.Name = "ShpBuy"
lblTvrPrcBuy.Caption = "Ñåáåñòîèìîñòü:"
lblTvrPrcBuy.Name = "lblTvrPrcBuy"
txtTvrPrcBuy.Left = 124
txtTvrPrcBuy.Top = 5
txtTvrPrcBuy.Name = "txtTvrPrcBuy"
lblTvrPrcSumBuy.Name = "lblTvrPrcSumBuy"
txtTvrPrcSumBuy.Left = 282
txtTvrPrcSumBuy.Top = 5
txtTvrPrcSumBuy.Name = "txtTvrPrcSumBuy"
lblTvrVATSumBuy.Left = 414
lblTvrVATSumBuy.Top = 7
lblTvrVATSumBuy.Name = "lblTvrVATSumBuy"
txtTvrVATSumBuy.Left = 484
txtTvrVATSumBuy.Top = 4
txtTvrVATSumBuy.Name = "txtTvrVATSumBuy"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18A02DMUV</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>shp</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>shape</baseclass>
		<objname>shpTvr</objname>
		<parent>frmpartresuedit</parent>
		<properties>Top = 2
Left = 0
Height = 61
Width = 589
SpecialEffect = 0
ZOrderSet = 8
Name = "shpTvr"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblTLU</objname>
		<parent>frmpartresuedit</parent>
		<properties>FontBold = .T.
Caption = "Øòðèõ-êîä:"
Left = 99
Top = 10
TabIndex = 23
ZOrderSet = 9
Name = "lblTLU"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1LE0P5JD7</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>comtxtctlcalclentluidbytlu</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>comTxtCtlCalcLenTLUIDByTLU</objname>
		<parent>frmpartresuedit</parent>
		<properties>Top = 7
Left = 170
Width = 286
Height = 23
TabIndex = 1
ZOrderSet = 10
Name = "comTxtCtlCalcLenTLUIDByTLU"
txtText.Height = 23
txtText.Left = 0
txtText.Top = 0
txtText.Width = 171
txtText.NullDisplay = "Øòðèõêîä íåîïðåäåëåííûé"
txtText.Name = "txtText"
lblLen.Left = 171
lblLen.Top = 3
lblLen.Name = "lblLen"
cmdFind.Top = 0
cmdFind.Left = 197
cmdFind.Name = "cmdFind"
cmdClear.Top = 0
cmdClear.Left = 220
cmdClear.Name = "cmdClear"
</properties>
		<protected/>
		<methods>PROCEDURE _handleanychange
*15.06.2006 16:50 -&gt; Îáíîâèì òîâàð è ïåðåéäåì â ïîëå ðåäàêòèðîâàíèÿ êîëè÷åñòâà
WITH Thisform
	.cntIdCtlGridTvr.SetValue(This.nTvrID)
	CLEAR TYPEAHEAD
	.txtQnt.SetFocus()
ENDWITH
*------------------------------------------------------------------------------
ENDPROC
PROCEDURE Refresh
PARAMETERS tnTvrID
IF this.ntvrid=0 AND (PCOUNT()=0 OR tnTvrID = -3 )
		This.txtText.Value = lvFrmPartTvrEdit.FrmPartTvrNote
ENDIF

IF PCOUNT()&gt;0 &amp;&amp; AND tnTvrID &lt;&gt; -3

	*15.06.2006 16:47 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
	PRIVATE	_PARAM
	***
	_PARAM = IIF(this.ntvrid=0,tnTvrID,this.ntvrid)
	*------------------------------------------------------------------------------

	*19.08.2005 11:37 -&gt; Íàéä¸ì ØÊ ïî èäåíòèôèêàòîðó òîâàðà
	IF USED([lvTovarLookUpByID])
		REQUERY([lvTovarLookUpByID])
	ELSE
		USE lvTovarLookUpByID IN 0
	ENDIF
	***
	IF RECCOUNT([lvTovarLookUpByID]) &gt; 0
		This.txtText.Value = lvTovarLookUpByID.TLU
	ELSE
		This.txtText.Value = .NULL.
	ENDIF
	*------------------------------------------------------------------------------
	
ENDIF

*15.06.2006 16:49 -&gt; Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1A610IJYB</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblJrnUseStart</objname>
		<parent>frmpartresuedit</parent>
		<properties>FontBold = .T.
Caption = "Íà÷àëî:"
Left = 7
Top = 181
TabIndex = 19
ZOrderSet = 11
Name = "lblJrnUseStart"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_38R134FI8</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>Lbl1</objname>
		<parent>frmpartresuedit</parent>
		<properties>FontBold = .T.
Caption = "Ðåñóðñ:"
Left = 4
Top = 91
TabIndex = 26
ZOrderSet = 12
Name = "Lbl1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_38R134FIC</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>cntidctlgrid</class>
		<classloc>comidctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>Cntidctlgrid1</objname>
		<parent>frmpartresuedit</parent>
		<properties>Top = 88
Left = 96
Width = 487
Height = 23
TabIndex = 5
ZOrderSet = 13
_controlsource = lvFrmPartTvrEdit.TvrIdCalc
_controlsourcetype = 1
_rsaliasname = ResuListOnly
_rsfieldnameid = TvrId
_rsfieldnametext = TvrNM
_grdinfoparams = oMgrTovar;TVR;INFO
_grdaddparams = oMgrTovar;TVR;FASTADD;0;lvTvrInCntViewRepl
_selectobjectt = frmidctltreetvr;primarydoc_v1;primarydoc.app
Name = "Cntidctlgrid1"
txtText.Height = 22
txtText.Left = 0
txtText.Top = 0
txtText.Width = 415
txtText._highlightobject = .parent.parent.lblTvr
txtText.Name = "txtText"
cmdShow.Top = 0
cmdShow.Left = 441
cmdShow.Name = "cmdShow"
cmdClear.Top = 0
cmdClear.Left = 464
cmdClear.Name = "cmdClear"
CmdTree.Top = 0
CmdTree.Left = 417
CmdTree.Enabled = .T.
CmdTree.Visible = .T.
CmdTree.Name = "CmdTree"
Olecommprox1.Top = 0
Olecommprox1.Left = 36
Olecommprox1.Height = 16
Olecommprox1.Width = 38
Olecommprox1.Name = "Olecommprox1"
</properties>
		<protected/>
		<methods>PROCEDURE _refreshrelatedobjects
*------------------------------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRINARYDOC_V1.VCX
* Class.Module....: CNTIDCTLGRIDTVR._RefreshRelatedObjects
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Îáðàáîòêà èçìåíåíèÿ çíà÷åíèÿ ýëåìåíòà.
*------------------------------------------------------------------------------
RETURN
*19.08.2005 12:31 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnTvrID, ;
		lcMsuTNM, ;
		lcIndependetFNM, ;
		lcDependetFNM, ;
		_PARAM, ;
		_PARAM_PRCTYPE
		
***
lnTvrID = This.Value
*------------------------------------------------------------------------------

WITH ThisForm

*06.09.2005 17:18 -&gt; Çàïèñûâàåì èäåíòèôèêàòîð òîâàðà
.comTxtCtlCalcLenTLUIDByTLU.nTvrID = lnTvrID
.comTxtCtlCalcLenTLUIDByTLU.Refresh(lnTvrID)
.LblTvrId.Caption = ALLTRIM(STR(NVL(lnTvrID,0),10,0))
*------------------------------------------------------------------------------

*17.04.2004 14:52 -&gt;Ïîëó÷èì èíôîðìàöèþ î âûáðàííîì òîâàðå
USE IN IIF(USED([lvTovarInfo]),[lvTovarInfo],0)
***
_PARAM = lnTvrID
_PARAM_PRCTYPE = .FrmPrcType
USE lvTovarInfo IN 0
*------------------------------------------------------------------------------

*11.01.2006 17:05 -&gt;Çàêðîåì ñïðàâî÷íèê áàçîâûõ ÅÈ
USE IN SELECT([lvTvrMsuList])

*16.01.2006 14:38 -&gt;Îïðåäåëèì íàçâàíèÿ òàáëèö ñî ñïðàâî÷íèêàìè
lcIndependetFNM = LEFT(.cMeasureUnitList,AT([;],.cMeasureUnitList)-1)
lcDependetFNM	= RIGHT(.cMeasureUnitList,LEN(.cMeasureUnitList)-AT([;],.cMeasureUnitList))
*------------------------------------------------------------------------------

*12.01.2006 11:53 -&gt;Óäàëèì ñïðàâî÷íèêè
IF FILE([tmp\]+lcIndependetFNM+[.dbf])
ERASE ([tmp\]+lcIndependetFNM+[.dbf])
ENDIF
***
IF FILE([tmp\]+lcDependetFNM+[.dbf])
ERASE ([tmp\]+lcDependetFNM+[.dbf])
ENDIF
*------------------------------------------------------------------------------

.cMeasureUnitList = spGetBaseMsuList(lvTovarInfo.MsuID)
lcMsuTNM = RIGHT(.cMeasureUnitList,LEN(.cMeasureUnitList)-AT([;],.cMeasureUnitList))
USE (lcMsuTNM) IN 0 ALIAS [lvTvrMsuList]
*------------------------------------------------------------------------------

*17.04.2004 14:53 -&gt;Óñòàíàâëèâàåì åäèíèöó èçìåðåíèÿ ïî óìîë÷àíèþ
IF .cMode==[ADD] AND lvTovarInfo.MsuID # 0 &amp;&amp; AND .cntIdCtlGridMsu.Value = 0
	.cntIdCtlGridMsu.SetValue(lvTovarInfo.MsuID)
ENDIF	
*------------------------------------------------------------------------------

*17.04.2004 15:06 -&gt; Óñòàíîâèì âåëè÷èíó ÍÄÑ ïî óìîë÷àíèþ
IF .cMode==[ADD] OR .cntTvrVat.txtTvrVATRate.Value =0
		***IF .cntTvrVat.txtTvrVATRate.Value # lvTovarInfo.tvrVATRate
	.cntTvrVat.txtTvrVATRate.Value = lvTovarInfo.tvrVATRate
ENDIF	
*------------------------------------------------------------------------------

*01.09.2005 17:26 -&gt; Óñòàíàâëèâàåì öåíû
IF TYPE([ThisForm.cntTvrBuy]) == [O] AND !ISNULL(.cntTvrBuy)
	.cntTvrBuy.SetPrice(.nOUID,lnTvrID)
ENDIF
***
IF TYPE([ThisForm.cntTvrSale]) == [O] AND !ISNULL(.cntTvrSale) AND TYPE([.FrmPrcType]) == [N]
	IF .FrmPrcType = 0 OR EMPTY(.FrmPrcType) OR ISNULL(.FrmPrcType)
		MESSAGEBOX([Ïðàéñ äëÿ äàííîãî äîêóìåíòà íå íàéäåí.],48,[Ïðåäóïðåæäåíèå])
	ELSE
		.cntTvrSale.SetPrice(lnTvrID,.FrmPrcType)
	ENDIF
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE cmdShow.Click
*!*	this.Parent._rsaliasname = 'TovarListOnly'
*!*	SELECT TovarListOnly
*!*	LOCATE ALL FOR TovarListOnly.TvrId = lvFrmPartTvrEdit.TvrId
DODEFAULT()
*!*	this.Parent._rsaliasname = 'TovarList'

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18I0M4ORT</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>comtxtctlcalendar</class>
		<classloc>comtxtctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntTxtCtlJrnUseStart</objname>
		<parent>frmpartresuedit</parent>
		<properties>Top = 178
Left = 58
Width = 176
Height = 23
TabIndex = 8
ZOrderSet = 14
_allowresize = .T.
_allowresizecontent = .T.
Name = "cntTxtCtlJrnUseStart"
txtText.ControlSource = "lvJrnUsageEditPart.UseStart"
txtText.Height = 23
txtText.Left = 0
txtText.Top = 0
txtText.Width = 149
txtText._highlightobject = .parent.parent.lblJrnUseStart
txtText.Name = "txtText"
cmdShow.Top = 0
cmdShow.Left = 153
cmdShow.Name = "cmdShow"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1MV0RE0B8</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblJrnUseEnd</objname>
		<parent>frmpartresuedit</parent>
		<properties>FontBold = .T.
Caption = "Îêîí÷àíèå:"
Left = 341
Top = 181
TabIndex = 20
ZOrderSet = 15
Name = "lblJrnUseEnd"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25O11OEHM</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>comtxtctlcalendar</class>
		<classloc>comtxtctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntTxtCtlJrnUseEnd</objname>
		<parent>frmpartresuedit</parent>
		<properties>Top = 178
Left = 410
Width = 176
Height = 23
TabIndex = 9
ZOrderSet = 16
_allowresize = .T.
_allowresizecontent = .T.
Name = "cntTxtCtlJrnUseEnd"
txtText.ControlSource = "lvJrnUsageEditPart.UseEnd"
txtText.Height = 23
txtText.Left = 0
txtText.Top = 0
txtText.Width = 148
txtText._highlightobject = .parent.parent.lblJrnUseEnd
txtText.Name = "txtText"
cmdShow.Top = 0
cmdShow.Left = 152
cmdShow.Name = "cmdShow"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1A610IJYB</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblTvr</objname>
		<parent>frmpartresuedit</parent>
		<properties>FontBold = .T.
Caption = "Óñëóãà:"
Left = 3
Top = 38
TabIndex = 25
ZOrderSet = 17
Name = "lblTvr"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18I0M4ORT</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>cntidctlgrid</class>
		<classloc>comidctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntIdCtlGridTvr</objname>
		<parent>frmpartresuedit</parent>
		<properties>Top = 35
Left = 96
Width = 487
Height = 23
TabIndex = 2
ZOrderSet = 18
_controlsource = lvFrmPartTvrEdit.TvrId
_controlsourcetype = 1
_rsaliasname = TovarList
_rsfieldnameid = TvrID
_rsfieldnametext = TvrNM
_grdinfoparams = oMgrTovar;TVR;INFO
_grdaddparams = oMgrTovar;TVR;FASTADD;0;lvTvrInCntViewRepl
_selectobjectt = frmidctltreetvr;primarydoc_v1;primarydoc.app
Name = "cntIdCtlGridTvr"
txtText.Height = 22
txtText.Left = 0
txtText.Top = 0
txtText.Width = 415
txtText._highlightobject = .parent.parent.lblTvr
txtText.Name = "txtText"
cmdShow.Top = 0
cmdShow.Left = 441
cmdShow.Name = "cmdShow"
cmdClear.Top = 0
cmdClear.Left = 464
cmdClear.Name = "cmdClear"
CmdTree.Top = 0
CmdTree.Left = 417
CmdTree.Enabled = .T.
CmdTree.Visible = .T.
CmdTree.Name = "CmdTree"
Olecommprox1.Top = 0
Olecommprox1.Left = 36
Olecommprox1.Height = 16
Olecommprox1.Width = 38
Olecommprox1.Name = "Olecommprox1"
</properties>
		<protected/>
		<methods>PROCEDURE _refreshrelatedobjects
*------------------------------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRINARYDOC_V1.VCX
* Class.Module....: CNTIDCTLGRIDTVR._RefreshRelatedObjects
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Îáðàáîòêà èçìåíåíèÿ çíà÷åíèÿ ýëåìåíòà.
*------------------------------------------------------------------------------

*19.08.2005 12:31 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnTvrID, ;
		lcMsuTNM, ;
		lcIndependetFNM, ;
		lcDependetFNM, ;
		_PARAM, ;
		_PARAM_PRCTYPE
		
***
lnTvrID = This.Value
*------------------------------------------------------------------------------

WITH ThisForm

*06.09.2005 17:18 -&gt; Çàïèñûâàåì èäåíòèôèêàòîð òîâàðà
.comTxtCtlCalcLenTLUIDByTLU.nTvrID = lnTvrID
.comTxtCtlCalcLenTLUIDByTLU.Refresh(lnTvrID)
.LblTvrId.Caption = ALLTRIM(STR(lnTvrID,10,0))
*------------------------------------------------------------------------------

*17.04.2004 14:52 -&gt;Ïîëó÷èì èíôîðìàöèþ î âûáðàííîì òîâàðå
USE IN IIF(USED([lvTovarInfo]),[lvTovarInfo],0)
***
_PARAM = lnTvrID
_PARAM_PRCTYPE = .FrmPrcType
USE lvTovarInfo IN 0
*------------------------------------------------------------------------------

*11.01.2006 17:05 -&gt;Çàêðîåì ñïðàâî÷íèê áàçîâûõ ÅÈ
USE IN SELECT([lvTvrMsuList])

*16.01.2006 14:38 -&gt;Îïðåäåëèì íàçâàíèÿ òàáëèö ñî ñïðàâî÷íèêàìè
lcIndependetFNM = LEFT(.cMeasureUnitList,AT([;],.cMeasureUnitList)-1)
lcDependetFNM	= RIGHT(.cMeasureUnitList,LEN(.cMeasureUnitList)-AT([;],.cMeasureUnitList))
*------------------------------------------------------------------------------

*12.01.2006 11:53 -&gt;Óäàëèì ñïðàâî÷íèêè
IF FILE([tmp\]+lcIndependetFNM+[.dbf])
ERASE ([tmp\]+lcIndependetFNM+[.dbf])
ENDIF
***
IF FILE([tmp\]+lcDependetFNM+[.dbf])
ERASE ([tmp\]+lcDependetFNM+[.dbf])
ENDIF
*------------------------------------------------------------------------------

.cMeasureUnitList = spGetBaseMsuList(lvTovarInfo.MsuID)
lcMsuTNM = RIGHT(.cMeasureUnitList,LEN(.cMeasureUnitList)-AT([;],.cMeasureUnitList))
USE (lcMsuTNM) IN 0 ALIAS [lvTvrMsuList]
*------------------------------------------------------------------------------

*17.04.2004 14:53 -&gt;Óñòàíàâëèâàåì åäèíèöó èçìåðåíèÿ ïî óìîë÷àíèþ
IF .cMode==[ADD] AND lvTovarInfo.MsuID # 0 &amp;&amp; AND .cntIdCtlGridMsu.Value = 0
	.cntIdCtlGridMsu.SetValue(lvTovarInfo.MsuID)
ENDIF	
*------------------------------------------------------------------------------

*17.04.2004 15:06 -&gt; Óñòàíîâèì âåëè÷èíó ÍÄÑ ïî óìîë÷àíèþ
IF .cMode==[ADD] OR .cntTvrVat.txtTvrVATRate.Value =0
		***IF .cntTvrVat.txtTvrVATRate.Value # lvTovarInfo.tvrVATRate
	.cntTvrVat.txtTvrVATRate.Value = lvTovarInfo.tvrVATRate
ENDIF	
*------------------------------------------------------------------------------

*01.09.2005 17:26 -&gt; Óñòàíàâëèâàåì öåíû
IF TYPE([ThisForm.cntTvrBuy]) == [O] AND !ISNULL(.cntTvrBuy)
	.cntTvrBuy.SetPrice(.nOUID,lnTvrID)
ENDIF
***
IF TYPE([ThisForm.cntTvrSale]) == [O] AND !ISNULL(.cntTvrSale) AND TYPE([.FrmPrcType]) == [N]
	IF .FrmPrcType = 0 OR EMPTY(.FrmPrcType) OR ISNULL(.FrmPrcType)
		MESSAGEBOX([Ïðàéñ äëÿ äàííîãî äîêóìåíòà íå íàéäåí.],48,[Ïðåäóïðåæäåíèå])
	ELSE
		.cntTvrSale.SetPrice(lnTvrID,.FrmPrcType)
	ENDIF
ENDIF
*------------------------------------------------------------------------------
SELECT ResuListOnly
SET FILTER TO ResuListOnly.ServId = lnTvrID

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE cmdShow.Click
*!*	this.Parent._rsaliasname = 'TovarListOnly'
*!*	SELECT TovarListOnly
*!*	LOCATE ALL FOR TovarListOnly.TvrId = lvFrmPartTvrEdit.TvrId
DODEFAULT()
*!*	this.Parent._rsaliasname = 'TovarList'

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18I0M4ORT</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblQnt</objname>
		<parent>frmpartresuedit</parent>
		<properties>FontBold = .T.
Caption = "Êîëè÷åñòâî:"
Left = 412
Top = 67
TabIndex = 28
ZOrderSet = 19
Name = "lblQnt"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_R020K4VL1</uniqueid>
		<timestamp>1059621690</timestamp>
		<class>txt</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>textbox</baseclass>
		<objname>txtQnt</objname>
		<parent>frmpartresuedit</parent>
		<properties>ControlSource = "lvFrmPartTvrEdit.TvrQnt"
Left = 486
TabIndex = 4
Top = 64
ZOrderSet = 20
_highlightobject = .parent.lblQnt
_convertcommatopoint = .T.
_usedbfieldproperty = .T.
Name = "txtQnt"
</properties>
		<protected/>
		<methods>PROCEDURE _handleanychange
*17.01.2006 09:52 -&gt;Ðàññ÷èòàåì ñóììû
ThisForm.CalculateSum()
*------------------------------------------------------------------------------
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18A02DMUV</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>cntidctlgrid</class>
		<classloc>comidctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntIdCtlGridMsu</objname>
		<parent>frmpartresuedit</parent>
		<properties>Top = 63
Left = 96
Width = 252
Height = 24
TabIndex = 3
ZOrderSet = 21
_controlsource = lvFrmPartTvrEdit.MsuId
_controlsourcetype = 1
_rsaliasname = lvTvrMsuList
_rsfieldnameid = MsuID
_rsfieldnametext = MsuNM
Name = "cntIdCtlGridMsu"
txtText._highlightobject = .parent.parent.lblMsu
txtText.Name = "txtText"
cmdShow.Name = "cmdShow"
cmdClear.Name = "cmdClear"
CmdTree.Name = "CmdTree"
Olecommprox1.Top = 0
Olecommprox1.Left = 36
Olecommprox1.Height = 16
Olecommprox1.Width = 38
Olecommprox1.Name = "Olecommprox1"
</properties>
		<protected/>
		<methods>PROCEDURE _refreshrelatedobjects
*30.09.2005 12:25 -&gt; Ðàñ÷¸ò öåíû åäèíèöû èçìåðåíèÿ
ThisForm.CalculatePriceMsu()
ThisForm.CalculateSum()
*------------------------------------------------------------------------------
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18M0216E7</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>cntcancelsavehandled</class>
		<classloc>baseform_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntCancelSaveHandled</objname>
		<parent>frmpartresuedit</parent>
		<properties>Top = 233
Left = 379
TabIndex = 16
ZOrderSet = 22
Name = "cntCancelSaveHandled"
cmdCancel.Name = "cmdCancel"
cmdOk.Name = "cmdOk"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_26Q0OOOIP</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>LblTvrId</objname>
		<parent>frmpartresuedit</parent>
		<properties>FontBold = .T.
Caption = "Êîä òîâàðà"
Left = 10
Top = 10
TabIndex = 22
ZOrderSet = 23
Name = "LblTvrId"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1VG0YR07S</uniqueid>
		<timestamp>1059621690</timestamp>
		<class>cmd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>commandbutton</baseclass>
		<objname>cmdPrice</objname>
		<parent>frmpartresuedit</parent>
		<properties>Top = 233
Left = 275
Caption = "Ïîëó÷èòü öåíó"
TabIndex = 15
ToolTipText = "Îïðåäåëÿåì ïîñëåäíþþ öåíó ïîñòóïëåíèÿ"
ZOrderSet = 24
Name = "cmdPrice"
</properties>
		<protected/>
		<methods>PROCEDURE Click
WITH This.Parent
	.cntTvrBuy.SetPrice(.nOUID,.comTxtCtlCalcLenTLUIDByTLU.nTvrID,.T.)
ENDWITH

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_30W0PUMWW</uniqueid>
		<timestamp>1059621690</timestamp>
		<class>edt</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>editbox</baseclass>
		<objname>edtNote</objname>
		<parent>frmpartresuedit</parent>
		<properties>Height = 37
Left = 83
TabIndex = 17
Top = 263
Width = 504
ZOrderSet = 25
ControlSource = "lvFrmPartTvrEdit.FrmPartTvrNote"
_highlightobject = .parent.lblNote
Name = "edtNote"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_30W0PUMX0</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblNote</objname>
		<parent>frmpartresuedit</parent>
		<properties>FontBold = .T.
Caption = "Ïðèìå÷àíèå:"
Left = 5
Top = 268
TabIndex = 24
ZOrderSet = 26
Name = "lblNote"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_37M0MXJV8</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblJrnUseStartF</objname>
		<parent>frmpartresuedit</parent>
		<properties>FontBold = .T.
Caption = "Íà÷àëî:"
Enabled = .F.
Left = 7
Top = 207
Visible = .F.
TabIndex = 18
ZOrderSet = 27
Name = "lblJrnUseStartF"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_37M0MXJVD</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>comtxtctlcalendar</class>
		<classloc>comtxtctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntTxtCtlJrnUseStartF</objname>
		<parent>frmpartresuedit</parent>
		<properties>Top = 204
Left = 58
Width = 176
Height = 23
Enabled = .F.
Visible = .F.
TabIndex = 11
ZOrderSet = 28
_allowresize = .T.
_allowresizecontent = .T.
Name = "cntTxtCtlJrnUseStartF"
txtText.ControlSource = "lvJrnUsageEditPart.UseStartF"
txtText.Height = 23
txtText.Left = 0
txtText.Top = 0
txtText.Width = 149
txtText._highlightobject = .parent.parent.lblJrnUseStartF
txtText.Name = "txtText"
cmdShow.Top = 0
cmdShow.Left = 153
cmdShow.Name = "cmdShow"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_37M0MXJVM</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblJrnUseEndF</objname>
		<parent>frmpartresuedit</parent>
		<properties>FontBold = .T.
Caption = "Îêîí÷àíèå:"
Enabled = .F.
Left = 341
Top = 207
Visible = .F.
TabIndex = 21
ZOrderSet = 29
Name = "lblJrnUseEndF"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_37M0MXJVR</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>comtxtctlcalendar</class>
		<classloc>comtxtctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntTxtCtlJrnUseEndF</objname>
		<parent>frmpartresuedit</parent>
		<properties>Top = 204
Left = 410
Width = 176
Height = 23
Enabled = .F.
Visible = .F.
TabIndex = 12
ZOrderSet = 30
_allowresize = .T.
_allowresizecontent = .T.
Name = "cntTxtCtlJrnUseEndF"
txtText.ControlSource = "lvJrnUsageEditPart.UseEndF"
txtText.Height = 23
txtText.Left = 0
txtText.Top = 0
txtText.Width = 148
txtText._highlightobject = .parent.parent.lblJrnUseEndF
txtText.Name = "txtText"
cmdShow.Top = 0
cmdShow.Left = 152
cmdShow.Name = "cmdShow"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1MV0RE0B7</uniqueid>
		<timestamp>1059621690</timestamp>
		<class>cmd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>commandbutton</baseclass>
		<objname>cmdToday</objname>
		<parent>frmpartresuedit</parent>
		<properties>Top = 177
Left = 270
Height = 25
Width = 48
Caption = "\&lt;Ñåé÷àñ"
TabIndex = 10
ZOrderSet = 31
Name = "cmdToday"
</properties>
		<protected/>
		<methods>PROCEDURE Click
This.Parent.cntTxtCtlJrnUseStart.txtText.Value= DATETIME()
This.Parent.cntTxtCtlJrnUseEnd.txtText.Value= DATETIME()

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_37M0MXJW0</uniqueid>
		<timestamp>1059621690</timestamp>
		<class>cmd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>commandbutton</baseclass>
		<objname>Cmd1</objname>
		<parent>frmpartresuedit</parent>
		<properties>Top = 203
Left = 270
Height = 25
Width = 48
Caption = "\&lt;Ñåé÷àñ"
Enabled = .F.
TabIndex = 13
Visible = .F.
ZOrderSet = 32
Name = "Cmd1"
</properties>
		<protected/>
		<methods>PROCEDURE Click
This.Parent.cntTxtCtlJrnUseStart.txtText.Value= DATETIME()
This.Parent.cntTxtCtlJrnUseEnd.txtText.Value= DATETIME()

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3AW0Z7I9T</uniqueid>
		<timestamp>1059622704</timestamp>
		<class>bitgrd</class>
		<classloc>bits_v1.vcx</classloc>
		<baseclass>grid</baseclass>
		<objname>BitgrdTvr</objname>
		<parent>frmpartresuedit</parent>
		<properties>Height = 297
Left = 593
Top = 3
Width = 144
ZOrderSet = 33
_controlsource = lvFrmPartTvrEdit.TvrAttr
_rsaliasname = lvTvrAttribList
_rsfieldnamebit = TvrAttBit
_rsfieldnametext = TvrAttNM
_controlsourcetype = 1
Name = "BitgrdTvr"
COLUMN1.Header1.Name = "Header1"
COLUMN1.CHK1.Alignment = 0
COLUMN1.CHK1.Name = "CHK1"
COLUMN1.Name = "COLUMN1"
COLUMN2.Header1.Name = "Header1"
COLUMN2.Txtgrd1.Name = "Txtgrd1"
COLUMN2.Name = "COLUMN2"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>frmpartresuedit</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18I0M4ORT</uniqueid>
		<timestamp>1060856335</timestamp>
		<class>frmedit</class>
		<classloc>baseform_v1.vcx</classloc>
		<baseclass>form</baseclass>
		<objname>frmpartsmetedit</objname>
		<parent/>
		<properties>Height = 305
Width = 740
DoCreate = .T.
WindowState = 0
cmode = 
cmeasureunitlist = 
frmprctype = 1
nouid = 0
frmdirection = 1
withbarcode = 0
cflparentsmt_ = 
_memberdata =      155&lt;VFPData&gt;&lt;memberdata name="nfrmid" type="property" display="nFrmId"/&gt;&lt;memberdata name="cflparentsmt_" type="property" display="cFlParentSmt_"/&gt;&lt;/VFPData&gt;

Name = "frmpartsmetedit"
cstmsghandler.Top = -3
cstmsghandler.Left = 0
cstmsghandler.Name = "cstmsghandler"
cstresizable.Top = -3
cstresizable.Left = 22
cstresizable.Name = "cstresizable"
Img1.Left = -122
Img1.Top = -3
Img1.ZOrderSet = 7
Img1.Name = "Img1"
cstdatawork.Top = -3
cstdatawork.Left = 44
cstdatawork.Name = "cstdatawork"
</properties>
		<protected/>
		<methods>PROCEDURE _handlecntcancelsaveevent
*------------------------------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRIMARYDOC_V1.VCX
* Class.Module....: FRMPRIMARYDOCPARTTVREDIT._HANDLECNTCANCELSAVEEVENT
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;tcMessage&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;~&gt;
*------------------------------------------------------------------------------
LPARAMETERS	tcMessage

LOCAL	llResSave

WITH This

*17.05.2004 02:07 -&gt;Ïðîèçâîäèì ñîõðàíåíèÿ/îòìåíÿåì èçìåíåíèÿ
IF tcMessage == [OK]
	
	*13.06.2006 18:01 -&gt; Ñîõðàíÿåì öåíó ïðîäàæè
	.SavePriceSale()
	*------------------------------------------------------------------------------
	.uRetVal = .T.
	
	IF .cMode = [DELE]
		DELETE IN lvFrmPartTvrEdit
	ENDIF

	llResSave = .cstDataWork.Save([lvFrmPartTvrEdit])
	*21.01.2004 20:01 -&gt;Îáðàáàòûâàåì ðåçóëüòàòû ñîõðàíåíèÿ
	IF llResSave
	
		*12.05.2004 03:18 -&gt;Çàïèñûâàåì â .uRetVal èäåíòèôèêàòîð äîáàâëåííîãî äîêóìåíòà
		IF .cMode = [ADD]
			.uRetVal = .cstDataWork.GetLastID([lvFrmPartTvrEdit])
			_PARAM = .uRetVal
			REQUERY([lvJrnUsageEditPart])
		ELSE
			.cstDataWork.Save([lvJrnUsageEditPart])
			.uRetVal = .T.
		ENDIF
		***	
		.Hide()
		*------------------------------------------------------------------------------
		
	ELSE
	
		*01.04.2004 18:42 -&gt;Ïîïûòàåìñÿ îáðàáîòàòü îøèáêó ñîõðàíåíèÿ
		IF .cstDataWork.HandleSaveFail() &amp;&amp;åñëè îøèáêà îáðàáîòàíà
			RETURN .T.	&amp;&amp;âîçâðàùàåìñÿ ê ðåäàêòèðîâàíèþ
		ELSE
			
			*01.04.2004 18:40 -&gt;Ñîîáùàåì îá îøèáêå
			MESSAGEBOX([Â ïðîöåññå ñîõðàíåíèÿ ïðîèçîøëà îøèáêà. Èçìåíåíèÿ ñîõðàíåíû íå áóäóò.],16,[Îøèáêà...])
			*------------------------------------------------------------------------------
			
			*01.04.2004 18:40 -&gt;Îòìåíÿåì èçìåíåíèÿ
			.cstDataWork.Restore([lvFrmPartTvrEdit])
			.cstDataWork.Restore([lvJrnUsageEditPart])
			.uRetVal = .F.
			.Hide()	
			*------------------------------------------------------------------------------
			
		ENDIF	
		*------------------------------------------------------------------------------
		
	ENDIF
	*------------------------------------------------------------------------------

ELSE

	*12.05.2004 00:36 -&gt;Îòìåíèì èçìåíåíèÿ
	.cstDataWork.Restore([lvPriceEdit])
	.cstDataWork.Restore([lvJrnUsageEditPart])
	.cstDataWork.Restore([lvFrmPartTvrEdit])
	.uRetVal = .F.
	.Hide()
	*------------------------------------------------------------------------------
	
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatepricemsu
WITH THIS

*15.06.2006 16:56 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL   lnOldMsuID, ;
		lnNewMsuID, ;
		lnCfMsu
*** lnOldMsuID = OLDVAL([MsuId],[lvFrmPartTvrEdit])
lnOldMsuID  = pnOldMsuID
lnNewMsuID = EVAL([lvFrmPartTvrEdit.MsuId])
*------------------------------------------------------------------------------

*15.06.2006 16:59 -&gt; Åäèíèöà èçìåðåíèÿ íå èçìåíèëàñü
IF lnOldMsuID = lnNewMsuID
	RETURN
ENDIF
*------------------------------------------------------------------------------

*15.06.2006 16:59 -&gt; Îïðåäåëÿåì êîýôôèöèåíò äëÿ íîâîé ÅÈ ïî îòíîøåíèþ ê ñòàðîé
lnCfMsu = spGetCfMsu(lnOldMsuID, lnNewMsuID)
lnCfMsu = IIF(lnCfMsu = 0, 1, lnCfMsu)
*------------------------------------------------------------------------------

*15.06.2006 17:01 -&gt; Ïåðåñ÷èòûâàåì öåíû è êîëè÷åñòâî â ñîîòâåòñòâèè ñ êîýôôèöèåíòîì
.cntTvrBuy.txtTvrPrcBuy.Value = ROUND(.cntTvrBuy.txtTvrPrcBuy.Value * lnCfMsu, 4)
.cntTvrSale.txtTvrPrcSale.Value = ROUND(.cntTvrSale.txtTvrPrcSale.Value * lnCfMsu, 4)
.txtQnt.Value = ROUND(.txtQnt.Value / lnCfMsu, 3)
***
IF TYPE([.txtQntNetto]) == [O] AND !ISNULL(.txtQntNetto)
.txtQntNetto.Value = ROUND(.txtQntNetto.Value / lnCfMsu, 3)
ENDIF
*------------------------------------------------------------------------------
pnOldMsuID = lnNewMsuID
ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatesum
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateSum
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàññ÷åò ñóìì
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:25 -&gt; Ðàñ÷¸ò ñóììû ïîñòóïëåíèÿ
.CalculateSumBuy()
*------------------------------------------------------------------------------

*23.09.2005 12:25 -&gt; Ðàñ÷¸ò ñóììû ïðîäàæè
.CalculateSumSale()
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatesumbuy
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateSumBuy
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàñ÷¸ò ñóììû ïîñòóïëåíèÿ
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:25 -&gt; Ðàñ÷¸ò ñóììû ïîñòóïëåíèÿ
IF TYPE([.cntTvrBuy]) == [O] AND !ISNULL(.cntTvrBuy)
	.cntTvrBuy.txtTvrPrcSumBuy.Value = ROUND(.cntTvrBuy.txtTvrPrcBuy.Value * .txtQnt.Value,2)
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatesumsale
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateSumSale
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàñ÷¸ò ñóììû ïðîäàæè
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:25 -&gt; Ðàñ÷¸ò ñóììû ïðîäàæè
IF TYPE([.cntTvrSale]) == [O] AND !ISNULL(.cntTvrSale)
	.cntTvrSale.txtTvrPrcSumSale.Value = ROUND(.cntTvrSale.txtTvrPrcSale.Value * .txtQnt.Value,2)
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatevatsum
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateVatSum
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàññ÷åò ñóììû ÍÄÑ
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:18 -&gt; Ðàññ÷åò ÍÄÑ ïîñòóïëåíèÿ
.CalculateVatSumBuy()
*------------------------------------------------------------------------------

*23.09.2005 12:19 -&gt; Ðàññ÷åò ÍÄÑ ïðîäàæè
.CalculateVatSumSale()
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatevatsumbuy
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateVatSumBuy
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàññ÷åò ÍÄÑ ïîñòóïëåíèÿ
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:16 -&gt; Ðàññ÷åò ÍÄÑ ïîñòóïëåíèÿ
IF TYPE([.cntTvrBuy])==[O] AND !ISNULL(.cntTvrBuy)
	IF .cntTvrVat.txtTvrVATRate.Value # 0
		.cntTvrBuy.txtTvrVATSumBuy.Value = ROUND(.cntTvrBuy.txtTvrPrcSumBuy.Value * .cntTvrVat.txtTvrVATRate.Value / (100 + .cntTvrVat.txtTvrVATRate.Value),2)
	ELSE
		.cntTvrBuy.txtTvrVATSumBuy.Value = 0
	ENDIF
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatevatsumsale
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateVatSumSale
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàññ÷åò ÍÄÑ ïðîäàæè
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:17 -&gt; Ðàññ÷åò ÍÄÑ ïðîäàæè
IF TYPE([.cntTvrSale])==[O] AND !ISNULL(.cntTvrSale)
	IF .cntTvrVat.txtTvrVATRate.Value # 0
		.cntTvrSale.txtTvrVATSumSale.Value = ROUND(.cntTvrSale.txtTvrPrcSumSale.Value * .cntTvrVat.txtTvrVATRate.Value / (100 + .cntTvrVat.txtTvrVATRate.Value),2)
	ELSE
		.cntTvrSale.txtTvrVATSumSale.Value = 0
	ENDIF
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE cntenable
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.cntEnable
* Called by.......: &lt;frmPrimaryDocPartTvrEdit.Init&gt;
* Parameters......: &lt;tcObjectName - èìÿ îáúåêòà-êîíòåéíåðà,
*					 tnTop - âûñîòà îáúåêòà-êîíòåéíåðà&gt;
* Returns.........: &lt;lnNewTop&gt;
* Notes...........: Ðàçìåùåíèå íà ôîðìå êîíòåéíåðîâ ñîäåðæàùèõ öåíû, ñóììû, ÍÄÑ
*------------------------------------------------------------------------------
LPARAMETERS tcObjectName, tnTop

WITH This

*01.09.2005 12:23 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL lnNewTop
*------------------------------------------------------------------------------

*01.09.2005 12:00 -&gt; Íàñòðîèì âíåøíèé âèä îáúåêòà
.&amp;tcObjectName..Visible = .T.
***
*!*	.&amp;tcObjectName..Left = 5
*!*	.&amp;tcObjectName..Top = tnTop
*!*	***
*!*	lnNewTop = .&amp;tcObjectName..Top + .&amp;tcObjectName..Height + 5
*!*	*------------------------------------------------------------------------------

*01.09.2005 12:23 -&gt; Âîçâðàùàåì ðåçóëüòàò
RETURN lnNewTop
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE Destroy
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.Destroy
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........:
*------------------------------------------------------------------------------
WITH This

*12.01.2006 11:48 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL   lcIndependetFNM, ;
		lcDependetFNM
***
lcIndependetFNM = LEFT(.cMeasureUnitList,AT([;],.cMeasureUnitList)-1)
lcDependetFNM	= RIGHT(.cMeasureUnitList,LEN(.cMeasureUnitList)-AT([;],.cMeasureUnitList))
*------------------------------------------------------------------------------

*11.01.2006 17:05 -&gt;Çàêðîåì ñïðàâî÷íèê áàçîâûõ ÅÈ
USE IN SELECT([lvTvrMsuList])
*------------------------------------------------------------------------------

*12.01.2006 11:53 -&gt;Óäàëèì ñïðàâî÷íèêè
IF FILE([tmp\]+lcIndependetFNM+[.dbf])
ERASE ([tmp\]+lcIndependetFNM+[.dbf])
ENDIF
***
IF FILE([tmp\]+lcDependetFNM+[.dbf])
ERASE ([tmp\]+lcDependetFNM+[.dbf])
ENDIF
*------------------------------------------------------------------------------

*11.01.2006 17:05 -&gt;Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------
RELEASE pnOldMsuID
ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE Init
*------------------------------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRIMARYDOC_V1.VCX
* Class.Module....: FRMPRIMARYDOCPARTTVREDIT.INIT
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;tcCommand,tuParam1&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;~&gt;
*------------------------------------------------------------------------------
LPARAMETERS	tcCommand,tuParam1,cFlParentSmt
IF PCOUNT()&lt;3
	cFlParentSmt = .f.
ENDIF

*17.05.2004 01:26 -&gt;Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------
WITH This
.cFlParentSmt_ = cFlParentSmt
*12.05.2004 03:12 -&gt;Ñîõðàíèì êîìàíäó (ðåæèì ðàáîòû ñ äàííûìè)
.cMode = UPPER(ALLTRIM(tcCommand))
*------------------------------------------------------------------------------
*12.05.2004 00:33 -&gt;Çàãðóçèì äàííûå â Alias äëÿ ðåäàêòèðîâàíèÿ
DO CASE

	CASE .cMode==[ADD]
		
		*12.05.2004 00:32 -&gt;Äîáàâèì ïóñòóþ çàïèñü
		APPEND BLANK IN lvFrmPartTvrEdit
		*------------------------------------------------------------------------------

		*12.05.2004 02:39 -&gt;Çàïèøåì èäåíòèôèêàòîð ðîäèòåëüñêîãî äîêóìåíòà
		REPLACE FrmID WITH tuParam1 IN lvFrmPartTvrEdit
		IF !VARTYPE(.cFlParentSmt_)='C'
				REPLACE TvrAttr WITH 512 IN lvFrmPartTvrEdit
		ENDIF
		*------------------------------------------------------------------------------
		.cntTvrVat.txtTvrVATRate.Value = oApp.nNds
	CASE INLIST(.cMode,[EDIT],[INFO],[DELE])
		
		*12.05.2004 00:31 -&gt;Çàãðóçèì äàííûå ñóùåñòâóþùåé çàïèñè
		_PARAM = tuParam1
		***
		REQUERY([lvFrmPartTvrEdit])
		REQUERY([lvJrnUsageEditPart])
		*------------------------------------------------------------------------------
		
ENDCASE
*------------------------------------------------------------------------------
PUBLIC pnOldMsuID
pnOldMsuID  = lvFrmPartTvrEdit.MsuId
*01.09.2005 15:28 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnTop, ;
		lnOldTop
***
lnTop = 0
lnOldTop = lnTop
*------------------------------------------------------------------------------

*19.08.2005 12:16 -&gt; Çàêðîåì Alias
USE IN IIF(USED([lvFrmTypeInfoByFrm]),[lvFrmTypeInfoByFrm],0)
*------------------------------------------------------------------------------

*19.08.2005 12:12 -&gt; Îòêðîåì Alias ñ èíôîðìàöèåé î òèïå äîêóìåíòà
_PARAM = lvFrmPartTvrEdit.FrmID
***
USE lvFrmTypeInfoByFrm IN 0
*------------------------------------------------------------------------------

*07.08.2006 10:09 -&gt;Îïðåäåëèì OU ïî ID ôîðìû
USE lvFrmEdit IN 0
***
DO CASE
	CASE lvFrmTypeInfoByFrm.FrmTypeDirection = 2
		.nOUID = lvFrmEdit.PointIspOUID
	CASE INLIST(lvFrmTypeInfoByFrm.FrmTypeDirection,1,3)
		.nOUID = lvFrmEdit.PointEmiOUID
ENDCASE
.frmdirection = lvFrmTypeInfoByFrm.FrmTypeDirection
*------------------------------------------------------------------------------

*15.06.2006 15:45 -&gt; Ñîõðàíÿåì òèï ïðàéñà äëÿ äîêóìåíòà
.FrmPrcType = IIF(ISNULL(lvFrmTypeInfoByFrm.FrmPrcTypeID),1,lvFrmTypeInfoByFrm.FrmPrcTypeID)
*------------------------------------------------------------------------------

*01.09.2005 15:24 -&gt; Äîáàâëÿåì êîíòåéíåð ñ öåíîé ïîñòóïëåíèÿ
IF lvFrmTypeInfoByFrm.ContainPriceBuy
	*lnTop =
	.CntEnable([cntTvrBuy],lnTop)
ENDIF
*------------------------------------------------------------------------------
*01.09.2005 15:25 -&gt; Äîáàâëÿåì êîíòåéíåð ñ öåíîé ïðîäàæè
IF lvFrmTypeInfoByFrm.ContainPriceSale
	*lnTop =
	.CntEnable([cntTvrSale],lnTop)
ENDIF
*------------------------------------------------------------------------------
.CntEnable([cntTvrVat],lnTop)
*01.09.2005 15:29 -&gt; Íà ôîðìå ïðîèçîøëè èçìåíåíèÿ
IF lnTop # lnOldTop
	*{
	lnTop = .CntEnable([cntTvrVat],lnTop)
	***
	.cntCancelSaveHandled.Top = lnTop
	.cmdPrice.Top = lnTop
	.Height = .cntCancelSaveHandled.Top + .cntCancelSaveHandled.Height + 5
	*}
ENDIF
*------------------------------------------------------------------------------

*01.09.2005 16:11 -&gt; Ïðîñ÷èòàåì ñóììû è ÍÄÑ
.CalculateSum()
.CalculateVatSum()
*------------------------------------------------------------------------------

*19.08.2005 12:15 -&gt; Íàñòðîèì âíåøíèé âèä ôîðìû
DO CASE
	CASE .cMode = [ADD]
		.Caption = [Äîáàâëåíèå]
		.Icon = FULLPATH([frmprimarydocadd.ico])
		** ïðîâåðêà íà ïðåäïî÷òåíèå ðàáîòàòü ñî øòðèõ-êîäîì
		.withBarCode = VAL(oRes.GetParam([SET],[WITHBAR]))
		IF  .withBarCode = 0
			.cntIdCtlGridTvr.SetFocus()
			KEYBOARD '{ALT+DNARROW}'
		ENDIF
		*.cntcdCtlGridTvr.cmdShow.Click()
	CASE .cMode = [EDIT]
		.Caption = [Ðåäàêòèðîâàíèå]
		.Icon = FULLPATH([frmprimarydocedit.ico])
	CASE .cMode = [INFO]
		.Caption = [Ïðîñìîòð]
		.Icon = FULLPATH([frmprimarydocinfo.ico])
		ThisForm.cntCancelSaveHandled.cmdOk.Enabled = .F.
	CASE .cMode = [DELE]
		.Caption = [Óäàëåíèå]
		.Icon = FULLPATH([frmprimarydocdele.ico])
		ThisForm.cntCancelSaveHandled.cmdOk.Caption = [Óäàëèòü]
ENDCASE
***
.Caption = .Caption + [ òîâàðíîé ïîçèöèè äîêóìåíòà]
*------------------------------------------------------------------------------
.BitgrdTvr._RSRequery()
IF VARTYPE(.cFlParentSmt_)='C'
		USE (this.cFlParentSmt_) IN 0 ALIAS ParentSmt
ENDIF
*!*			.Cntidctlgrid1.Enabled = .F.
*!*			SELECT lvTvrAttribList
*!*			LOCATE ALL FOR lvTvrAttribList.TvrAttBit= 9
*!*			.bitgrdTvr.Refresh()
*!*			.bitgrdTvr.SetFocus()
*!*			*.BitgrdTvr.SetValue(1)
*!*			.BitgrdTvr.CoLUMN1.Chk1.Value = 1
*!*	ENDIF
*SET STEP ON
ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE Load
*------------------------------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRIMARYDOC_V1.VCX
* Class.Module....: FRMPRIMARYDOCPARTTVREDIT.LOAD
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;~&gt;
*------------------------------------------------------------------------------

*17.05.2004 01:32 -&gt;Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------

*17.05.2004 01:32 -&gt;Îòêðîåì ÁÄ è óñòàíîâèì å¸ â êà÷åñòâå òåêóùåé
IF !DBUSED([BASIS])
	OPEN DATABASE BASIS
ENDIF
***
SET DATABASE TO BASIS
*------------------------------------------------------------------------------

*17.05.2004 01:32 -&gt;Îòêðîåì Alias äëÿ ðåäàêòèðîâàíèÿ áåç äàííûõ
USE lvFrmPartTvrEdit IN 0 NODATA
USE lvJrnUsageEditPart IN 0 NODATA
*------------------------------------------------------------------------------

*17.05.2004 01:34 -&gt; Îòêðûâàåì ñïðàâî÷íèêè
USE lvTovarList IN 0 ALIAS TovarList
USE lvTovarList IN 0 ALIAS TovarListOnly
SELECT TovarListOnly
SET FILTER TO INLIST(TovarListOnly.TvrTypeId,1,7)

*SELECT * FROM TovarList WHERE TovarList.TvrTypeId NOT IN (1,7) INTO CURSOR TovarListOnly

USE lvCurTypeList IN 0
USE lvtvrsetbmps IN 0
USE lvTvrAttribList IN 0
***
This.cMeasureUnitList = spGetBaseMsuList(0)
USE (LEFT(This.cMeasureUnitList,AT([;],This.cMeasureUnitList)-1)) IN 0 ALIAS lvTvrMsuList
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE Refresh
DODEFAULT()
*!*		IF this.cMode = [ADD]
*!*			this.cntIdCtlGridTvr.SetFocus()
*!*			this.cntcdCtlGridTvr.cmdShow.Click()
*!*		ENDIF

ENDPROC
PROCEDURE Resize
NODEFAULT
ENDPROC
PROCEDURE savepricesale
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.SavePriceSale
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Ñîõðàíåíèå öåíû ïðîäàæè
*------------------------------------------------------------------------------
WITH This
*08.06.2006 10:06 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	llDataWasChanged, ;
		llResSave
***
llResSave = .F.
*------------------------------------------------------------------------------

*07.06.2006 17:10 -&gt; Êîëè÷åñòâî çàïèñåé î öåíàõ îòëè÷íî îò íóëÿ
IF .cntTvrSale.Visible AND RECCOUNT([lvPriceEdit]) # 0

	*07.06.2006 16:26 -&gt; Ïðîèçâåäåì ñîõðàíåíèå öåíû ïðîäàæè
	IF .cMode # [DELE]

		*07.06.2006 16:27 -&gt; Ïðîâåðèì èçìåíèëèñü ëè äàííûå
		llDataWasChanged = .cstDataWork.DataChanged([lvPriceEdit],.T.)
		*------------------------------------------------------------------------------

		*07.06.2006 16:29 -&gt; Âûïîëíÿåì ñîõðàíåíèå åñëè ïîëüçîâàòåëü ðàçðåøèò ñîõðàíåíèå
		IF llDataWasChanged AND MESSAGEBOX([Ñîõðàíèòü öåíó ïðîäàæè â ïðàéñå?],4+32,[Ñîõðàíåíèå])=6

			*07.06.2006 16:47 -&gt; Ïîïûòàåìñÿ ñîõðàíèòü öåíó
			llResSave = .cstDataWork.Save([lvPriceEdit])
			*------------------------------------------------------------------------------

		ENDIF	
		*------------------------------------------------------------------------------

	ENDIF
	*------------------------------------------------------------------------------
	
	*02.04.2004 17:00 -&gt; Îêàòèì èçìåíåíèÿ
	IF !llResSave
		.cstDataWork.Restore([lvPriceEdit])
	ENDIF
	*------------------------------------------------------------------------------

	*07.06.2006 16:48 -&gt; Çàêðîåì Alias äëÿ ðåäàêòèðîâàíèÿ öåí è îòêðîåì ñíîâà áåç äàííûõ
	USE IN SELECT([lvPriceEdit])
	***
	USE lvPriceEdit IN 0 NODATA
	*------------------------------------------------------------------------------

ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>31</reserved2>
		<reserved3>cmode
cmeasureunitlist
frmprctype Íîìåð ïðàéñà äëÿ ýòîãî äîêóìåíòà
nouid èäåíòèôèêàòîð ïîäðàçäåëåíèÿ, ïî êîòîðîìó áóäåò ïðîèñõîäèòü äâèæåíèå òîâàðà
frmdirection Íàïðàâëåíèå äîêóìåíòà
withbarcode Ïðåäïî÷òåíèå â ðàáîòå ñî øòðèõ-êîäîì
cflparentsmt_ òàáëèöà ñ íàçâàíèÿìè ðîäèòåëüñêèõ ïîçèöèé
*cntenable 
*calculatesum &lt;public&gt; Ðàññ÷åò ñóìì
*calculatevatsumbuy &lt;public&gt; Ðàññ÷åò ÍÄÑ ïîñòóïëåíèÿ
*calculatevatsumsale &lt;public&gt; Ðàññ÷åò ÍÄÑ ïðîäàæè
*calculatevatsum &lt;public&gt; Ðàññ÷åò ñóììû ÍÄÑ
*calculatesumbuy &lt;public&gt; Ðàññ÷åò ñóììû ïîñòóïëåíèÿ
*calculatesumsale &lt;public&gt; Ðàññ÷åò ñóììû ïðîäàæè
*calculatepricemsu ðàññ÷åò öåíû åäèíèöû èçìåðåíèÿ
*savepricesale 
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7>Ðåäàêòèðóåì ýëåìåíò ñìåòû</reserved7>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1MV0RE0B8</uniqueid>
		<timestamp>1060856335</timestamp>
		<class>cnttvrsale</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>CntTvrSale</objname>
		<parent>frmpartsmetedit</parent>
		<properties>Top = 143
Left = 0
Width = 587
Height = 33
Visible = .F.
TabIndex = 7
ZOrderSet = 0
Name = "CntTvrSale"
ShpSale.Top = 0
ShpSale.Left = 0
ShpSale.Height = 33
ShpSale.Width = 587
ShpSale.Name = "ShpSale"
lblTvrPrcSale.Caption = "Öåíà îòãðóçêè:"
lblTvrPrcSale.Name = "lblTvrPrcSale"
txtTvrPrcSale.Left = 124
txtTvrPrcSale.Top = 5
txtTvrPrcSale.Name = "txtTvrPrcSale"
txtTvrPrcSumSale.Left = 282
txtTvrPrcSumSale.Top = 5
txtTvrPrcSumSale.Name = "txtTvrPrcSumSale"
txtTvrVATSumSale.Left = 484
txtTvrVATSumSale.Top = 5
txtTvrVATSumSale.Name = "txtTvrVATSumSale"
lblTvrPrcSumSale.Name = "lblTvrPrcSumSale"
lblTvrVATSumSale.Left = 414
lblTvrVATSumSale.Top = 8
lblTvrVATSumSale.Name = "lblTvrVATSumSale"
</properties>
		<protected/>
		<methods>PROCEDURE setprice
LPARAMETERS tnTvrID, tnPrcTypeID
RETURN
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1MV0RE0B7</uniqueid>
		<timestamp>1060856335</timestamp>
		<class>cnttvrvat</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>CntTvrVat</objname>
		<parent>frmpartsmetedit</parent>
		<properties>Top = 229
Left = 1
Width = 187
Height = 33
Visible = .F.
TabIndex = 14
ZOrderSet = 1
Name = "CntTvrVat"
shpVat.Top = 0
shpVat.Left = 0
shpVat.Height = 33
shpVat.Width = 188
shpVat.Name = "shpVat"
lblTvrVATRate.Name = "lblTvrVATRate"
txtTvrVATRate.Left = 81
txtTvrVATRate.Top = 5
txtTvrVATRate.Name = "txtTvrVATRate"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1MV0RE0BB</uniqueid>
		<timestamp>1060856336</timestamp>
		<class>cnttvrbuy</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>CntTvrBuy</objname>
		<parent>frmpartsmetedit</parent>
		<properties>Top = 113
Left = 0
Width = 588
Height = 33
Visible = .F.
TabIndex = 6
ZOrderSet = 3
Name = "CntTvrBuy"
ShpBuy.Top = 0
ShpBuy.Left = 0
ShpBuy.Height = 33
ShpBuy.Width = 588
ShpBuy.Name = "ShpBuy"
lblTvrPrcBuy.Caption = "Ñåáåñòîèìîñòü:"
lblTvrPrcBuy.Name = "lblTvrPrcBuy"
txtTvrPrcBuy.Left = 124
txtTvrPrcBuy.Top = 5
txtTvrPrcBuy.Name = "txtTvrPrcBuy"
lblTvrPrcSumBuy.Name = "lblTvrPrcSumBuy"
txtTvrPrcSumBuy.Left = 282
txtTvrPrcSumBuy.Top = 5
txtTvrPrcSumBuy.Name = "txtTvrPrcSumBuy"
lblTvrVATSumBuy.Left = 414
lblTvrVATSumBuy.Top = 7
lblTvrVATSumBuy.Name = "lblTvrVATSumBuy"
txtTvrVATSumBuy.Left = 484
txtTvrVATSumBuy.Top = 4
txtTvrVATSumBuy.Name = "txtTvrVATSumBuy"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18A02DMUV</uniqueid>
		<timestamp>1060856336</timestamp>
		<class>shp</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>shape</baseclass>
		<objname>shpTvr</objname>
		<parent>frmpartsmetedit</parent>
		<properties>Top = 2
Left = 0
Height = 61
Width = 589
SpecialEffect = 0
ZOrderSet = 8
Name = "shpTvr"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1060856336</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblTLU</objname>
		<parent>frmpartsmetedit</parent>
		<properties>FontBold = .T.
Caption = "Øòðèõ-êîä:"
Left = 99
Top = 10
TabIndex = 23
ZOrderSet = 9
Name = "lblTLU"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1LE0P5JD7</uniqueid>
		<timestamp>1060856336</timestamp>
		<class>comtxtctlcalclentluidbytlu</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>comTxtCtlCalcLenTLUIDByTLU</objname>
		<parent>frmpartsmetedit</parent>
		<properties>Top = 7
Left = 170
Width = 286
Height = 23
TabIndex = 1
ZOrderSet = 10
Name = "comTxtCtlCalcLenTLUIDByTLU"
txtText.Height = 23
txtText.Left = 0
txtText.Top = 0
txtText.Width = 171
txtText.NullDisplay = "Øòðèõêîä íåîïðåäåëåííûé"
txtText.Name = "txtText"
lblLen.Left = 171
lblLen.Top = 3
lblLen.Name = "lblLen"
cmdFind.Top = 0
cmdFind.Left = 197
cmdFind.Name = "cmdFind"
cmdClear.Top = 0
cmdClear.Left = 220
cmdClear.Name = "cmdClear"
</properties>
		<protected/>
		<methods>PROCEDURE _handleanychange
*15.06.2006 16:50 -&gt; Îáíîâèì òîâàð è ïåðåéäåì â ïîëå ðåäàêòèðîâàíèÿ êîëè÷åñòâà
WITH Thisform
	.cntIdCtlGridTvr.SetValue(This.nTvrID)
	CLEAR TYPEAHEAD
	.txtQnt.SetFocus()
ENDWITH
*------------------------------------------------------------------------------
ENDPROC
PROCEDURE Refresh
PARAMETERS tnTvrID
IF this.ntvrid=0 AND (PCOUNT()=0 OR tnTvrID = -3 )
		This.txtText.Value = lvFrmPartTvrEdit.FrmPartTvrNote
ENDIF

IF PCOUNT()&gt;0 &amp;&amp; AND tnTvrID &lt;&gt; -3

	*15.06.2006 16:47 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
	PRIVATE	_PARAM
	***
	_PARAM = IIF(this.ntvrid=0,tnTvrID,this.ntvrid)
	*------------------------------------------------------------------------------

	*19.08.2005 11:37 -&gt; Íàéä¸ì ØÊ ïî èäåíòèôèêàòîðó òîâàðà
	IF USED([lvTovarLookUpByID])
		REQUERY([lvTovarLookUpByID])
	ELSE
		USE lvTovarLookUpByID IN 0
	ENDIF
	***
	IF RECCOUNT([lvTovarLookUpByID]) &gt; 0
		This.txtText.Value = lvTovarLookUpByID.TLU
	ELSE
		This.txtText.Value = .NULL.
	ENDIF
	*------------------------------------------------------------------------------
	
ENDIF

*15.06.2006 16:49 -&gt; Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1A610IJYB</uniqueid>
		<timestamp>1060856336</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblJrnUseStart</objname>
		<parent>frmpartsmetedit</parent>
		<properties>FontBold = .T.
Caption = "Íà÷àëî:"
Left = 7
Top = 181
TabIndex = 19
ZOrderSet = 10
Name = "lblJrnUseStart"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_38R134FI8</uniqueid>
		<timestamp>1060856336</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>Lbl1</objname>
		<parent>frmpartsmetedit</parent>
		<properties>FontBold = .T.
Caption = "Ðàáîòà:"
Left = 52
Top = 91
TabIndex = 26
ZOrderSet = 11
Name = "Lbl1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_38R134FIC</uniqueid>
		<timestamp>1060856336</timestamp>
		<class>cntidctlgrid</class>
		<classloc>comidctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>Cntidctlgrid1</objname>
		<parent>frmpartsmetedit</parent>
		<properties>Top = 88
Left = 96
Width = 487
Height = 23
TabIndex = 5
ZOrderSet = 12
_controlsource = lvFrmPartTvrEdit.FrmParID
_controlsourcetype = 1
_rsaliasname = ParentSmt
_rsfieldnameid = FrmPartTvr
_rsfieldnametext = TvrNM
_grdinfoparams = oMgrTovar;TVR;INFO
_grdaddparams = oMgrTovar;TVR;FASTADD;0;lvTvrInCntViewRepl
_selectobjectt = frmidctltreetvr;primarydoc_v1;primarydoc.app
Name = "Cntidctlgrid1"
txtText.Height = 22
txtText.Left = 0
txtText.Top = 0
txtText.Width = 415
txtText._highlightobject = .parent.parent.lblTvr
txtText.Name = "txtText"
cmdShow.Top = 0
cmdShow.Left = 441
cmdShow.Name = "cmdShow"
cmdClear.Top = 0
cmdClear.Left = 464
cmdClear.Name = "cmdClear"
CmdTree.Top = 0
CmdTree.Left = 417
CmdTree.Enabled = .T.
CmdTree.Visible = .T.
CmdTree.Name = "CmdTree"
Olecommprox1.Top = 0
Olecommprox1.Left = 36
Olecommprox1.Height = 16
Olecommprox1.Width = 38
Olecommprox1.Name = "Olecommprox1"
</properties>
		<protected/>
		<methods>PROCEDURE _refreshrelatedobjects
*------------------------------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRINARYDOC_V1.VCX
* Class.Module....: CNTIDCTLGRIDTVR._RefreshRelatedObjects
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Îáðàáîòêà èçìåíåíèÿ çíà÷åíèÿ ýëåìåíòà.
*------------------------------------------------------------------------------

*19.08.2005 12:31 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnTvrID, ;
		lcMsuTNM, ;
		lcIndependetFNM, ;
		lcDependetFNM, ;
		_PARAM, ;
		_PARAM_PRCTYPE
		
***
lnTvrID = This.Value
*------------------------------------------------------------------------------

WITH ThisForm

*06.09.2005 17:18 -&gt; Çàïèñûâàåì èäåíòèôèêàòîð òîâàðà
.comTxtCtlCalcLenTLUIDByTLU.nTvrID = lnTvrID
.comTxtCtlCalcLenTLUIDByTLU.Refresh(lnTvrID)
.LblTvrId.Caption = ALLTRIM(STR(NVL(lnTvrID,0),10,0))
*------------------------------------------------------------------------------

*17.04.2004 14:52 -&gt;Ïîëó÷èì èíôîðìàöèþ î âûáðàííîì òîâàðå
USE IN IIF(USED([lvTovarInfo]),[lvTovarInfo],0)
***
_PARAM = lnTvrID
_PARAM_PRCTYPE = .FrmPrcType
USE lvTovarInfo IN 0
*------------------------------------------------------------------------------

*11.01.2006 17:05 -&gt;Çàêðîåì ñïðàâî÷íèê áàçîâûõ ÅÈ
USE IN SELECT([lvTvrMsuList])

*16.01.2006 14:38 -&gt;Îïðåäåëèì íàçâàíèÿ òàáëèö ñî ñïðàâî÷íèêàìè
lcIndependetFNM = LEFT(.cMeasureUnitList,AT([;],.cMeasureUnitList)-1)
lcDependetFNM	= RIGHT(.cMeasureUnitList,LEN(.cMeasureUnitList)-AT([;],.cMeasureUnitList))
*------------------------------------------------------------------------------

*12.01.2006 11:53 -&gt;Óäàëèì ñïðàâî÷íèêè
IF FILE([tmp\]+lcIndependetFNM+[.dbf])
ERASE ([tmp\]+lcIndependetFNM+[.dbf])
ENDIF
***
IF FILE([tmp\]+lcDependetFNM+[.dbf])
ERASE ([tmp\]+lcDependetFNM+[.dbf])
ENDIF
*------------------------------------------------------------------------------

.cMeasureUnitList = spGetBaseMsuList(lvTovarInfo.MsuID)
lcMsuTNM = RIGHT(.cMeasureUnitList,LEN(.cMeasureUnitList)-AT([;],.cMeasureUnitList))
USE (lcMsuTNM) IN 0 ALIAS [lvTvrMsuList]
*------------------------------------------------------------------------------

*17.04.2004 14:53 -&gt;Óñòàíàâëèâàåì åäèíèöó èçìåðåíèÿ ïî óìîë÷àíèþ
IF .cMode==[ADD] AND lvTovarInfo.MsuID # 0 &amp;&amp; AND .cntIdCtlGridMsu.Value = 0
	.cntIdCtlGridMsu.SetValue(lvTovarInfo.MsuID)
ENDIF	
*------------------------------------------------------------------------------

*17.04.2004 15:06 -&gt; Óñòàíîâèì âåëè÷èíó ÍÄÑ ïî óìîë÷àíèþ
IF .cMode==[ADD] OR .cntTvrVat.txtTvrVATRate.Value =0
		***IF .cntTvrVat.txtTvrVATRate.Value # lvTovarInfo.tvrVATRate
	.cntTvrVat.txtTvrVATRate.Value = lvTovarInfo.tvrVATRate
ENDIF	
*------------------------------------------------------------------------------

*01.09.2005 17:26 -&gt; Óñòàíàâëèâàåì öåíû
IF TYPE([ThisForm.cntTvrBuy]) == [O] AND !ISNULL(.cntTvrBuy)
	.cntTvrBuy.SetPrice(.nOUID,lnTvrID)
ENDIF
***
IF TYPE([ThisForm.cntTvrSale]) == [O] AND !ISNULL(.cntTvrSale) AND TYPE([.FrmPrcType]) == [N]
	IF .FrmPrcType = 0 OR EMPTY(.FrmPrcType) OR ISNULL(.FrmPrcType)
		MESSAGEBOX([Ïðàéñ äëÿ äàííîãî äîêóìåíòà íå íàéäåí.],48,[Ïðåäóïðåæäåíèå])
	ELSE
		.cntTvrSale.SetPrice(lnTvrID,.FrmPrcType)
	ENDIF
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE cmdShow.Click
*!*	this.Parent._rsaliasname = 'TovarListOnly'
*!*	SELECT TovarListOnly
*!*	LOCATE ALL FOR TovarListOnly.TvrId = lvFrmPartTvrEdit.TvrId
DODEFAULT()
*!*	this.Parent._rsaliasname = 'TovarList'

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18I0M4ORT</uniqueid>
		<timestamp>1060856336</timestamp>
		<class>comtxtctlcalendar</class>
		<classloc>comtxtctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntTxtCtlJrnUseStart</objname>
		<parent>frmpartsmetedit</parent>
		<properties>Top = 178
Left = 58
Width = 176
Height = 23
TabIndex = 8
ZOrderSet = 11
_allowresize = .T.
_allowresizecontent = .T.
Name = "cntTxtCtlJrnUseStart"
txtText.ControlSource = "lvJrnUsageEditPart.UseStart"
txtText.Height = 23
txtText.Left = 0
txtText.Top = 0
txtText.Width = 149
txtText._highlightobject = .parent.parent.lblJrnUseStart
txtText.Name = "txtText"
cmdShow.Top = 0
cmdShow.Left = 153
cmdShow.Name = "cmdShow"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1MV0RE0B8</uniqueid>
		<timestamp>1060856336</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblJrnUseEnd</objname>
		<parent>frmpartsmetedit</parent>
		<properties>FontBold = .T.
Caption = "Îêîí÷àíèå:"
Left = 341
Top = 181
TabIndex = 20
ZOrderSet = 12
Name = "lblJrnUseEnd"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25O11OEHM</uniqueid>
		<timestamp>1060856336</timestamp>
		<class>comtxtctlcalendar</class>
		<classloc>comtxtctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntTxtCtlJrnUseEnd</objname>
		<parent>frmpartsmetedit</parent>
		<properties>Top = 178
Left = 410
Width = 176
Height = 23
TabIndex = 9
ZOrderSet = 13
_allowresize = .T.
_allowresizecontent = .T.
Name = "cntTxtCtlJrnUseEnd"
txtText.ControlSource = "lvJrnUsageEditPart.UseEnd"
txtText.Height = 23
txtText.Left = 0
txtText.Top = 0
txtText.Width = 148
txtText._highlightobject = .parent.parent.lblJrnUseEnd
txtText.Name = "txtText"
cmdShow.Top = 0
cmdShow.Left = 152
cmdShow.Name = "cmdShow"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1A610IJYB</uniqueid>
		<timestamp>1060856336</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblTvr</objname>
		<parent>frmpartsmetedit</parent>
		<properties>FontBold = .T.
Caption = "Ïîçèöèÿ ñìåòû:"
Left = 3
Top = 38
TabIndex = 25
ZOrderSet = 11
Name = "lblTvr"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18I0M4ORT</uniqueid>
		<timestamp>1060856336</timestamp>
		<class>cntidctlgrid</class>
		<classloc>comidctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntIdCtlGridTvr</objname>
		<parent>frmpartsmetedit</parent>
		<properties>Top = 35
Left = 96
Width = 487
Height = 23
TabIndex = 2
ZOrderSet = 12
_controlsource = lvFrmPartTvrEdit.TvrId
_controlsourcetype = 1
_rsaliasname = TovarList
_rsfieldnameid = TvrID
_rsfieldnametext = TvrNM
_grdinfoparams = oMgrTovar;TVR;INFO
_grdaddparams = oMgrTovar;TVR;FASTADD;0;lvTvrInCntViewRepl
_selectobjectt = frmidctltreetvr;primarydoc_v1;primarydoc.app
Name = "cntIdCtlGridTvr"
txtText.Height = 22
txtText.Left = 0
txtText.Top = 0
txtText.Width = 415
txtText._highlightobject = .parent.parent.lblTvr
txtText.Name = "txtText"
cmdShow.Top = 0
cmdShow.Left = 441
cmdShow.Name = "cmdShow"
cmdClear.Top = 0
cmdClear.Left = 464
cmdClear.Name = "cmdClear"
CmdTree.Top = 0
CmdTree.Left = 417
CmdTree.Enabled = .T.
CmdTree.Visible = .T.
CmdTree.Name = "CmdTree"
Olecommprox1.Top = 0
Olecommprox1.Left = 36
Olecommprox1.Height = 16
Olecommprox1.Width = 38
Olecommprox1.Name = "Olecommprox1"
</properties>
		<protected/>
		<methods>PROCEDURE _refreshrelatedobjects
*------------------------------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRINARYDOC_V1.VCX
* Class.Module....: CNTIDCTLGRIDTVR._RefreshRelatedObjects
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Îáðàáîòêà èçìåíåíèÿ çíà÷åíèÿ ýëåìåíòà.
*------------------------------------------------------------------------------

*19.08.2005 12:31 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnTvrID, ;
		lcMsuTNM, ;
		lcIndependetFNM, ;
		lcDependetFNM, ;
		_PARAM, ;
		_PARAM_PRCTYPE
		
***
lnTvrID = This.Value
*------------------------------------------------------------------------------

WITH ThisForm

*06.09.2005 17:18 -&gt; Çàïèñûâàåì èäåíòèôèêàòîð òîâàðà
.comTxtCtlCalcLenTLUIDByTLU.nTvrID = lnTvrID
.comTxtCtlCalcLenTLUIDByTLU.Refresh(lnTvrID)
.LblTvrId.Caption = ALLTRIM(STR(lnTvrID,10,0))
*------------------------------------------------------------------------------

*17.04.2004 14:52 -&gt;Ïîëó÷èì èíôîðìàöèþ î âûáðàííîì òîâàðå
USE IN IIF(USED([lvTovarInfo]),[lvTovarInfo],0)
***
_PARAM = lnTvrID
_PARAM_PRCTYPE = .FrmPrcType
USE lvTovarInfo IN 0
*------------------------------------------------------------------------------

*11.01.2006 17:05 -&gt;Çàêðîåì ñïðàâî÷íèê áàçîâûõ ÅÈ
USE IN SELECT([lvTvrMsuList])

*16.01.2006 14:38 -&gt;Îïðåäåëèì íàçâàíèÿ òàáëèö ñî ñïðàâî÷íèêàìè
lcIndependetFNM = LEFT(.cMeasureUnitList,AT([;],.cMeasureUnitList)-1)
lcDependetFNM	= RIGHT(.cMeasureUnitList,LEN(.cMeasureUnitList)-AT([;],.cMeasureUnitList))
*------------------------------------------------------------------------------

*12.01.2006 11:53 -&gt;Óäàëèì ñïðàâî÷íèêè
IF FILE([tmp\]+lcIndependetFNM+[.dbf])
ERASE ([tmp\]+lcIndependetFNM+[.dbf])
ENDIF
***
IF FILE([tmp\]+lcDependetFNM+[.dbf])
ERASE ([tmp\]+lcDependetFNM+[.dbf])
ENDIF
*------------------------------------------------------------------------------

.cMeasureUnitList = spGetBaseMsuList(lvTovarInfo.MsuID)
lcMsuTNM = RIGHT(.cMeasureUnitList,LEN(.cMeasureUnitList)-AT([;],.cMeasureUnitList))
USE (lcMsuTNM) IN 0 ALIAS [lvTvrMsuList]
*------------------------------------------------------------------------------

*17.04.2004 14:53 -&gt;Óñòàíàâëèâàåì åäèíèöó èçìåðåíèÿ ïî óìîë÷àíèþ
IF .cMode==[ADD] AND lvTovarInfo.MsuID # 0 &amp;&amp; AND .cntIdCtlGridMsu.Value = 0
	.cntIdCtlGridMsu.SetValue(lvTovarInfo.MsuID)
ENDIF	
*------------------------------------------------------------------------------

*17.04.2004 15:06 -&gt; Óñòàíîâèì âåëè÷èíó ÍÄÑ ïî óìîë÷àíèþ
IF .cMode==[ADD] OR .cntTvrVat.txtTvrVATRate.Value =0
		***IF .cntTvrVat.txtTvrVATRate.Value # lvTovarInfo.tvrVATRate
	.cntTvrVat.txtTvrVATRate.Value = lvTovarInfo.tvrVATRate
ENDIF	
*------------------------------------------------------------------------------

*01.09.2005 17:26 -&gt; Óñòàíàâëèâàåì öåíû
IF TYPE([ThisForm.cntTvrBuy]) == [O] AND !ISNULL(.cntTvrBuy)
	.cntTvrBuy.SetPrice(.nOUID,lnTvrID)
ENDIF
***
IF TYPE([ThisForm.cntTvrSale]) == [O] AND !ISNULL(.cntTvrSale) AND TYPE([.FrmPrcType]) == [N]
	IF .FrmPrcType = 0 OR EMPTY(.FrmPrcType) OR ISNULL(.FrmPrcType)
		MESSAGEBOX([Ïðàéñ äëÿ äàííîãî äîêóìåíòà íå íàéäåí.],48,[Ïðåäóïðåæäåíèå])
	ELSE
		.cntTvrSale.SetPrice(lnTvrID,.FrmPrcType)
	ENDIF
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE cmdShow.Click
*!*	this.Parent._rsaliasname = 'TovarListOnly'
*!*	SELECT TovarListOnly
*!*	LOCATE ALL FOR TovarListOnly.TvrId = lvFrmPartTvrEdit.TvrId
DODEFAULT()
*!*	this.Parent._rsaliasname = 'TovarList'

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18I0M4ORT</uniqueid>
		<timestamp>1060856336</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblQnt</objname>
		<parent>frmpartsmetedit</parent>
		<properties>FontBold = .T.
Caption = "Êîëè÷åñòâî:"
Left = 412
Top = 67
TabIndex = 28
ZOrderSet = 13
Name = "lblQnt"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_R020K4VL1</uniqueid>
		<timestamp>1053791425</timestamp>
		<class>txt</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>textbox</baseclass>
		<objname>txtQnt</objname>
		<parent>frmpartsmetedit</parent>
		<properties>ControlSource = "lvFrmPartTvrEdit.TvrQnt"
Left = 486
TabIndex = 4
Top = 64
ZOrderSet = 14
_highlightobject = .parent.lblQnt
_convertcommatopoint = .T.
_usedbfieldproperty = .T.
Name = "txtQnt"
</properties>
		<protected/>
		<methods>PROCEDURE _handleanychange
*17.01.2006 09:52 -&gt;Ðàññ÷èòàåì ñóììû
ThisForm.CalculateSum()
*------------------------------------------------------------------------------
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18A02PAKD</uniqueid>
		<timestamp>1060856336</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblMsu</objname>
		<parent>frmpartsmetedit</parent>
		<properties>FontBold = .T.
Caption = "Åäèíèöà èçìåðåíèÿ:"
Left = 4
Top = 66
TabIndex = 27
ZOrderSet = 15
Name = "lblMsu"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18A02DMUV</uniqueid>
		<timestamp>1060856336</timestamp>
		<class>cntidctlgrid</class>
		<classloc>comidctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntIdCtlGridMsu</objname>
		<parent>frmpartsmetedit</parent>
		<properties>Top = 63
Left = 125
Width = 252
Height = 24
TabIndex = 3
ZOrderSet = 16
_controlsource = lvFrmPartTvrEdit.MsuId
_controlsourcetype = 1
_rsaliasname = lvTvrMsuList
_rsfieldnameid = MsuID
_rsfieldnametext = MsuNM
Name = "cntIdCtlGridMsu"
txtText._highlightobject = .parent.parent.lblMsu
txtText.Name = "txtText"
cmdShow.Name = "cmdShow"
cmdClear.Name = "cmdClear"
CmdTree.Name = "CmdTree"
Olecommprox1.Top = 0
Olecommprox1.Left = 36
Olecommprox1.Height = 16
Olecommprox1.Width = 38
Olecommprox1.Name = "Olecommprox1"
</properties>
		<protected/>
		<methods>PROCEDURE _refreshrelatedobjects
*30.09.2005 12:25 -&gt; Ðàñ÷¸ò öåíû åäèíèöû èçìåðåíèÿ
ThisForm.CalculatePriceMsu()
ThisForm.CalculateSum()
*------------------------------------------------------------------------------
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18M0216E7</uniqueid>
		<timestamp>1060856336</timestamp>
		<class>cntcancelsavehandled</class>
		<classloc>baseform_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntCancelSaveHandled</objname>
		<parent>frmpartsmetedit</parent>
		<properties>Top = 233
Left = 379
TabIndex = 16
ZOrderSet = 17
Name = "cntCancelSaveHandled"
cmdCancel.Name = "cmdCancel"
cmdOk.Name = "cmdOk"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_26Q0OOOIP</uniqueid>
		<timestamp>1060856336</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>LblTvrId</objname>
		<parent>frmpartsmetedit</parent>
		<properties>FontBold = .T.
Caption = "Êîä òîâàðà"
Left = 10
Top = 10
TabIndex = 22
ZOrderSet = 18
Name = "LblTvrId"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1VG0YR07S</uniqueid>
		<timestamp>1053791425</timestamp>
		<class>cmd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>commandbutton</baseclass>
		<objname>cmdPrice</objname>
		<parent>frmpartsmetedit</parent>
		<properties>Top = 233
Left = 275
Caption = "Ïîëó÷èòü öåíó"
TabIndex = 15
ToolTipText = "Îïðåäåëÿåì ïîñëåäíþþ öåíó ïîñòóïëåíèÿ"
ZOrderSet = 20
Name = "cmdPrice"
</properties>
		<protected/>
		<methods>PROCEDURE Click
WITH This.Parent
	.cntTvrBuy.SetPrice(.nOUID,.comTxtCtlCalcLenTLUIDByTLU.nTvrID,.T.)
ENDWITH

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_30W0PUMWW</uniqueid>
		<timestamp>1059030144</timestamp>
		<class>edt</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>editbox</baseclass>
		<objname>edtNote</objname>
		<parent>frmpartsmetedit</parent>
		<properties>Height = 37
Left = 83
TabIndex = 17
Top = 263
Width = 504
ZOrderSet = 17
ControlSource = "lvFrmPartTvrEdit.FrmPartTvrNote"
_highlightobject = .parent.lblNote
Name = "edtNote"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_30W0PUMX0</uniqueid>
		<timestamp>1060856336</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblNote</objname>
		<parent>frmpartsmetedit</parent>
		<properties>FontBold = .T.
Caption = "Ïðèìå÷àíèå:"
Left = 5
Top = 268
TabIndex = 24
ZOrderSet = 16
Name = "lblNote"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_37M0MXJV8</uniqueid>
		<timestamp>1060856336</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblJrnUseStartF</objname>
		<parent>frmpartsmetedit</parent>
		<properties>FontBold = .T.
Caption = "Íà÷àëî:"
Enabled = .F.
Left = 7
Top = 207
Visible = .F.
TabIndex = 18
ZOrderSet = 10
Name = "lblJrnUseStartF"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_37M0MXJVD</uniqueid>
		<timestamp>1060856336</timestamp>
		<class>comtxtctlcalendar</class>
		<classloc>comtxtctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntTxtCtlJrnUseStartF</objname>
		<parent>frmpartsmetedit</parent>
		<properties>Top = 204
Left = 58
Width = 176
Height = 23
Enabled = .F.
Visible = .F.
TabIndex = 11
ZOrderSet = 11
_allowresize = .T.
_allowresizecontent = .T.
Name = "cntTxtCtlJrnUseStartF"
txtText.ControlSource = "lvJrnUsageEditPart.UseStartF"
txtText.Height = 23
txtText.Left = 0
txtText.Top = 0
txtText.Width = 149
txtText._highlightobject = .parent.parent.lblJrnUseStartF
txtText.Name = "txtText"
cmdShow.Top = 0
cmdShow.Left = 153
cmdShow.Name = "cmdShow"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_37M0MXJVM</uniqueid>
		<timestamp>1060856336</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblJrnUseEndF</objname>
		<parent>frmpartsmetedit</parent>
		<properties>FontBold = .T.
Caption = "Îêîí÷àíèå:"
Enabled = .F.
Left = 341
Top = 207
Visible = .F.
TabIndex = 21
ZOrderSet = 12
Name = "lblJrnUseEndF"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_37M0MXJVR</uniqueid>
		<timestamp>1060856336</timestamp>
		<class>comtxtctlcalendar</class>
		<classloc>comtxtctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntTxtCtlJrnUseEndF</objname>
		<parent>frmpartsmetedit</parent>
		<properties>Top = 204
Left = 410
Width = 176
Height = 23
Enabled = .F.
Visible = .F.
TabIndex = 12
ZOrderSet = 13
_allowresize = .T.
_allowresizecontent = .T.
Name = "cntTxtCtlJrnUseEndF"
txtText.ControlSource = "lvJrnUsageEditPart.UseEndF"
txtText.Height = 23
txtText.Left = 0
txtText.Top = 0
txtText.Width = 148
txtText._highlightobject = .parent.parent.lblJrnUseEndF
txtText.Name = "txtText"
cmdShow.Top = 0
cmdShow.Left = 152
cmdShow.Name = "cmdShow"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1MV0RE0B7</uniqueid>
		<timestamp>1053791425</timestamp>
		<class>cmd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>commandbutton</baseclass>
		<objname>cmdToday</objname>
		<parent>frmpartsmetedit</parent>
		<properties>Top = 177
Left = 270
Height = 25
Width = 48
Caption = "\&lt;Ñåé÷àñ"
TabIndex = 10
Name = "cmdToday"
</properties>
		<protected/>
		<methods>PROCEDURE Click
This.Parent.cntTxtCtlJrnUseStart.txtText.Value= DATETIME()
This.Parent.cntTxtCtlJrnUseEnd.txtText.Value= DATETIME()

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_37M0MXJW0</uniqueid>
		<timestamp>1058818137</timestamp>
		<class>cmd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>commandbutton</baseclass>
		<objname>Cmd1</objname>
		<parent>frmpartsmetedit</parent>
		<properties>Top = 203
Left = 270
Height = 25
Width = 48
Caption = "\&lt;Ñåé÷àñ"
Enabled = .F.
TabIndex = 13
Visible = .F.
Name = "Cmd1"
</properties>
		<protected/>
		<methods>PROCEDURE Click
This.Parent.cntTxtCtlJrnUseStart.txtText.Value= DATETIME()
This.Parent.cntTxtCtlJrnUseEnd.txtText.Value= DATETIME()

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3AW0Z7I9T</uniqueid>
		<timestamp>1059030251</timestamp>
		<class>bitgrd</class>
		<classloc>bits_v1.vcx</classloc>
		<baseclass>grid</baseclass>
		<objname>BitgrdTvr</objname>
		<parent>frmpartsmetedit</parent>
		<properties>Height = 297
Left = 593
Top = 3
Width = 144
_controlsource = lvFrmPartTvrEdit.TvrAttr
_rsaliasname = lvTvrAttribList
_rsfieldnamebit = TvrAttBit
_rsfieldnametext = TvrAttNM
_controlsourcetype = 1
Name = "BitgrdTvr"
COLUMN1.Header1.Name = "Header1"
COLUMN1.CHK1.Alignment = 0
COLUMN1.CHK1.Name = "CHK1"
COLUMN1.Name = "COLUMN1"
COLUMN2.Header1.Name = "Header1"
COLUMN2.Txtgrd1.Name = "Txtgrd1"
COLUMN2.Name = "COLUMN2"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>frmpartsmetedit</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2KA15DMRY</uniqueid>
		<timestamp>1061061921</timestamp>
		<class>frm</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>form</baseclass>
		<objname>frmmakedayly</objname>
		<parent/>
		<properties>Height = 700
Width = 1020
Desktop = .T.
ShowWindow = 1
DoCreate = .T.
AutoCenter = .T.
BorderStyle = 1
Caption = "Åæåäíåâíàÿ çàÿâêà íà ïèòàíèå"
ControlBox = .F.
Closable = .F.
HalfHeightCaption = .T.
MaxButton = .F.
MinButton = .F.
Movable = .T.
TitleBar = 0
WindowType = 1
AlwaysOnTop = .T.
uretval = .F.
noldvalue = 0
_memberdata =      275&lt;VFPData&gt;&lt;memberdata name="noldvalue" type="property" display="nOldValue"/&gt;&lt;memberdata name="nfrmid" type="property" display="nFrmId"/&gt;&lt;memberdata name="lfrmispayed" type="property" display="lFrmIsPayed"/&gt;&lt;memberdata name="ccapt" type="property" display="cCapt"/&gt;&lt;/VFPData&gt;

nfrmid = 0
lfrmispayed = .F.
ccapt = 
nseets = 0
Name = "frmmakedayly"
cstmsghandler.Name = "cstmsghandler"
cstresizable.Name = "cstresizable"
Img1.Enabled = .F.
Img1.ZOrderSet = 1
Img1.Name = "Img1"
</properties>
		<protected/>
		<methods>PROCEDURE _handlecntcancelsaveevent
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: RST_V1.VCX
* Class.Module....: FRMORDERADD._HANDLECNTCANCELSAVEEVENT
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;tcMessage&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;~&gt;
*-------------------------------------------------------
LPARAMETERS tcMessage
WITH This

	*--ñîõðàíèì/îòìåíèì èçìåíåíèÿ
	IF tcMessage = [OK]
			*.uRetVal = .cntNpad.txtCalc.Value
			
		ELSE
			.uRetVal = .nOldValue
	ENDIF
	USE IN SELECT('tmpDayly')
	DO	spDaylyMenuOrder WITH this.nFrmId,0,.t.
	USE IN SELECT('tmpDayly')

	.Hide()
	.Release()

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************

ENDPROC
PROCEDURE Init
LPARAMETERS nFrmId,nFrmStatusId,nOuParId
this.cntcancelsavehandled.cmdOk.Enabled = (nFrmStatusId &lt;&gt; 2)
this.lFrmIsPayed = !this.cntcancelsavehandled.cmdOk.Enabled
this.nFrmId = nFrmId
WITH this.GrdPlus
	.BeginUpdate()
	.linload = .t.
	.LoadRs(nFrmId,nFrmStatusId,nOuParId)
	.linload = .f.
	.ReadOnly = IIF((nFrmStatusId &lt;&gt; 2),0,-1)
**	.CauseValidateValue = .t. &amp;&amp; ðàçðåøàòü îáðàáóòêó ïðîâåðêè çàïîëíåíèÿ
	.EndUpdate()
	.SetFocus()
ENDWITH


ENDPROC
PROCEDURE test
with thisform.GrdPlus
	.MarkSearchColumn = .F.
	.DrawGridLines = -1
	.DefaultItemHeight = 53
	.Columns.Add("EmployeeID").Visible = .F.
	.Columns.Add("LastName").Visible = .F.
	.Columns.Add("FirstName").Visible = .F.
	.Columns.Add("Handler").Visible = .F.
	var_Column = .Columns.Add("Title")
	with var_Column
		.Visible = .F.
		.DisplayFilterButton = -1
	endwith
	var_Column1 = .Columns.Add("TitleOfCourtesy")
	with var_Column1
		.Visible = .F.
		.DisplayFilterButton = -1
	endwith
	.Columns.Add("BirthDate").Visible = .F.
	.Columns.Add("HideDate").Visible = .F.
	.Columns.Add("Address").Visible = .F.
	.Columns.Add("City").Visible = .F.
	.Columns.Add("Region").Visible = .F.    &amp;&amp;10
	.Columns.Add("PostCode").Visible = .F.  &amp;&amp;11
	.Columns.Add("Country").Visible = .F.   &amp;&amp;12
	.Columns.Add("HomePage").Visible = .F.  &amp;&amp;13
	.Columns.Add("Extension").Visible = .F.
	var_Column2 = .Columns.Add("Photo")
	with var_Column2
		.Visible = .F.
		with .Editor
			.DropDownVisible = 0
			.EditType = 11
			.Option(52) = 0
		endwith
	endwith
	.Columns.Add("Notes").Visible = .F.
	.Columns.Add("ReportsTo").Visible = .F.
	with .Columns.Add("Personal Info")
		.Def(32) = "15:54,(2/1/4)"
		.FormatLevel = "18;18/(15:54,(2/1/4))"
		.Width = 196
	endwith
	with .Columns.Add("General Info")
		.Def(32) = "(8/18;5):128,((((13/11/12),(6/7/10)),16))"
		.FormatLevel = "18;19/((8/18;5):128,((((13/11/12),(6/7/10)),16)))"
		.Width = 512
	endwith
	with .Items
		h0 = .AddItem(1)
		.CellValue(h0,1) = "Davolio"
		.CellValue(h0,2) = "Nancy"
		.CellValue(h0,3) = 0
		.CellValue(h0,4) = "Sales Representative"
		.CellValue(h0,5) = "Ms."
		.CellValue(h0,6) = "12/8/1948"
		.CellValue(h0,7) = "5/1/1992"
		.CellValue(h0,8) = "507-20th Ave. \r\nE.Apt.  2A"
		.CellValue(h0,9) = "Seattle"
		.CellValue(h0,10) = "WA"
		.CellValue(h0,11) = "98122"
		.CellValue(h0,12) = "USA"
		.CellValue(h0,13) = "(206) 555-9857"
		.CellValue(h0,14) = "5467"
		.CellValue(h0,15) = 0
		var_s = "Education includes a BA in psychology from Colorado State University in 1970.  She also complete"
		var_s = var_s + "d "+chr(34)+"The Art of the Cold Call."+chr(34)+"  Nancy is a member of ToastmastersInternational."
		.CellValue(h0,16) = var_s
		.CellValue(h0,17) = 2
	endwith
	.PutItems(.GetItems(0))
	with .Items
		.CellFormatLevel(.FocusItem,"General Info") = "15,10,4"
		.CellFormatLevel(.FocusItem,"Personal Info") = "1/2"
	endwith
endwith

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>3</reserved2>
		<reserved3>uretval Âîçâðàùûåìîå çíà÷åíèå
noldvalue Ñòàðîå çíà÷åíèå
_memberdata XML Metadata for customizable properties
nfrmid ID Form
lfrmispayed Ôëàã îïëàòû äîêóìåíòà
ccapt Çàãëîâîê 1 êîëîíêè
nseets ÷èñëî ïîñàäî÷íûõ ìåñò
*_handlecntcancelsaveevent 
*test 
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7>ôîðìèðîâàíèå åæåäíåâíîé çàÿâêè íà ïèòàíèå</reserved7>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2NL0KM4WL</uniqueid>
		<timestamp>1061061921</timestamp>
		<class>cntcancelsavehandled</class>
		<classloc>baseform_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>Cntcancelsavehandled</objname>
		<parent>frmmakedayly</parent>
		<properties>Top = 674
Left = 808
TabIndex = 42
ZOrderSet = 3
Name = "Cntcancelsavehandled"
cmdCancel.Name = "cmdCancel"
cmdOk.Name = "cmdOk"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3BP0UZDAS</uniqueid>
		<timestamp>1061061921</timestamp>
		<class>exgrid</class>
		<classloc>gannt.vcx</classloc>
		<baseclass>olecontrol</baseclass>
		<objname>GrdPlus</objname>
		<parent>frmmakedayly</parent>
		<properties>Top = 0
Left = 0
Height = 670
Width = 1019
ZOrderSet = 11
_handledstandartmsglist = FIRST;PREV;NEXT;LAST;;ADD;EDIT;INFO;DELE
_handledstandartmsgpromptlist = ;;;;;Äîáàâèòü;Ðåäàêòèðîâàòü;Ïðîñìîòð;Óäàëèòü
_handledcustommsgpromptlist = 
_handledcustommsglist = 
Name = "GrdPlus"
</properties>
		<protected/>
		<methods>PROCEDURE _add
*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: grdPartTvr._Add
* Called by.......: &lt;ToolBar or Context Menu Action -&gt; .HandleMsg() -&gt; .Add()&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Äîáàâëåíèå ñîäåðæàíèÿ òîâàðíîãî äîêóìåíòà
*-------------------------------------------------------
LOCAL cFlParentSmt, lcUniqueFilePath
cFlParentSmt = [_d] + SYS(2015)
lcUniqueFilePath = [tmp\] + cFlParentSmt + [.DBF]

SELECT ALLTRIM(NVL(tmpSmet.Tvrnm,''))+' ' +ALLTRIM(NVL(tmpSmet.FrmNote,'')) as TvrNm , tmpSmet.FrmPartTvr;
FROM tmpSmet ;
order by 1 ;
INTO TABLE (lcUniqueFilePath)

USE IN SELECT(cFlParentSmt)

*15.07.2004 02:57 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	luResultAdding
*------------------------------------------------------------------------------


USE IN SELECT([lvFrmTypeObjDescInfoByFrm])
***
_PARAM = This.nFrmID
USE Basis!lvFrmTypeObjDescInfoByFrm IN 0
***
*!*	IF RECCOUNT([lvFrmTypeObjDescInfoByFrm]) # 1
*!*		ASSERT .F. MESSAGE [MGRPRIMARYDOC.FORM_EDIT: íåâîçìîæíî îïðåäåëèòü èìÿ îáúåêòà, èñïîëüçóåìîãî äëÿ ðåäàêòèðîâàíèÿ]
*!*		RETURN .F.
*!*	ENDIF	
*15.07.2004 02:57 -&gt;Âûïîëíÿåì îïåðàöèþ äîáàâëåíèÿ
DO CASE
CASE !ISNULL(lvFrmTypeObjDescInfoByFrm.FrmTypeEditObjDescDet) AND ALLTRIM(lvFrmTypeObjDescInfoByFrm.FrmTypeEditObjDescDet) &lt;&gt; []
		*09.03.2008 08:57 -&gt;Âûïîëíÿåì îïåðàöèþ äîáàâëåíèÿ ïî ïîëþ - äåñêðèïòîðó
	  luResultAdding = oApp.DoModalFormRetValObj(lvFrmTypeObjDescInfoByFrm.FrmTypeEditObjDescDet,[ADD],This.nFrmID,cFlParentSmt)
CASE PrimaryDocView.FrmTypeId = 21
luResultAdding = oMgrPD.Operate([PARTMNU],[ADD],This.nFrmID,cFlParentSmt)
CASE PrimaryDocView.FrmTypeId = 19
luResultAdding = oMgrPD.Operate([PARTCLC],[ADD],This.nFrmID,cFlParentSmt)
CASE PrimaryDocView.FrmTypeId = 0
luResultAdding = oMgrPD.Operate([PARTTVR],[ADD],This.nFrmID,cFlParentSmt)
OTHERWISE
luResultAdding = oMgrPD.Operate([PARTTVR],[ADD],This.nFrmID,cFlParentSmt)
ENDCASE
*------------------------------------------------------------------------------
USE IN SELECT([lvFrmTypeObjDescInfoByFrm])

*24.09.2004 16:17 -&gt;Åñëè çàïèñü äîáàâëåíà
IF TYPE([luResultAdding])==[N] AND !EMPTY(luResultAdding)
	*24.09.2004 16:15 -&gt;Ïåðå÷èòûâàåì Alias äëÿ ïðîñìîòðà
	This._RSRequeryOne(luResultAdding)
	*------------------------------------------------------------------------------
ENDIF
*------------------------------------------------------------------------------

****************************************************************************************************************
***********************************************  END OF METHOD *************************************************
****************************************************************************************************************
ENDPROC
PROCEDURE _addchild
LPARAMETERS nDefItem
	** äîáàâëÿåì äî÷åðíèå çàïèñè
	with this.Items
	 .DefaultItem = .InsertItem( nDefItem,ALLTRIM(STR(tmpDayly.FrmPartId,12,0)),ALLTRIM(tmpDayly.OuNM)) &amp;&amp; ñòàâèì íàçâàíèå ñòîëà
		 .CellForeColor(.DefaultItem,0) = this.backColor
	     .CellValue(.DefaultItem , 1) = ALLTRIM(tmpDayly.TvrNm)			&amp;&amp; Áëþäî
	     .CellValue(.DefaultItem , 2) = ALLTRIM(tmpDayly.MsuShortNM)			&amp;&amp; åä èçìåð
	     .CellValue(.DefaultItem , 3) = TRANSFORM(NVL(tmpDayly.TvrQnt,0),[99999999]) 	&amp;&amp; êîëè÷åñòâî
	     .CellValue(.DefaultItem , 4) = TRANSFORM(NVL(tmpDayly.TvrPrcSale,0),[99999999.99])			&amp;&amp; Öåíà
	     .CellValue(.DefaultItem , 5) = TRANSFORM(NVL(tmpDayly.TvrQnt,0),[99999999])		&amp;&amp; ÷èñëî ïîñàäî÷íûõ ìåñò
	     .CellValue(.DefaultItem , 6) = 3 	&amp;&amp; òèï áëþäî
		 .CellBold(.DefaultItem ,1) = .t.
		 .CellBold(.DefaultItem ,2) = .t.
		 .CellBold(.DefaultItem ,3) = .t.
	     this.lFirst = .f.
		 .CellValue(.ItemParent(.DefaultItem) , 3) = TRANSFORM(NVL(VAL(.CellValue(.ItemParent(.DefaultItem) , 3)),0)+ tmpDayly.TvrQnt,[99999999])
	     RETURN
	ENDWITH


ENDPROC
PROCEDURE _addparent
LPARAMETERS pnDefItem
LOCAL cMnuNm, nOuId,mChItem
cMnuNm  = tmpDayly.MnuNm
nOuId = tmpDayly.OuId
WITH this.Items
	.DefaultItem = .InsertItem( pnDefItem ,"",ALLTRIM(tmpDayly.OuNM)) &amp;&amp; ñòàâèì íàçâàíèå ñòîëà
		.CellForeColor(.DefaultItem,0) = this.backColor
	    .CellValue(.DefaultItem , 1)   = ALLTRIM(tmpDayly.MnuNm)			&amp;&amp; Ïóíê ìåíþ
	    .CellValue(.DefaultItem , 5)   = thisform.Nseets			&amp;&amp; ÷èñëî ïîñàäî÷íûõ ìåñò
	    .CellValue(.DefaultItem , 6)   = 2 	&amp;&amp; òèï ãðóïïà ìåíþ
	    .CellEditorVisible(.DefaultItem , 3)=.f.
	mChItem = .DefaultItem
	SCAN WHILE tmpDayly.MnuNm = cMnuNm AND tmpDayly.OuId = nOuId
		this._addChild(mChItem)
	ENDSCAN
ENDWITH
ENDPROC
PROCEDURE _dele
*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: grdPartFrm._Dele
* Called by.......: &lt;ToolBar or Context Menu Action -&gt; .HandleMsg() -&gt; .Dele()&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Óäàëåíèå ñîäåðæàíèÿ òîâàðíîãî äîêóìåíòà
*-------------------------------------------------------

*15.07.2004 02:57 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnFrmPartTvrID, ;
		luDeleRes
***
lnFrmPartTvrID = this.nPartID
*------------------------------------------------------------------------------
LOCAL cFlParentSmt, lcUniqueFilePath
cFlParentSmt = [_d] + SYS(2015)
lcUniqueFilePath = [tmp\] + cFlParentSmt + [.DBF]

SELECT ALLTRIM(NVL(tmpSmet.Tvrnm,''))+' ' +ALLTRIM(NVL(tmpSmet.FrmNote,'')) as TvrNm , tmpSmet.FrmPartTvr;
FROM tmpSmet ;
order by 1 ;
INTO TABLE (lcUniqueFilePath)

USE IN SELECT(cFlParentSmt)

USE IN SELECT([lvFrmTypeObjDescInfoByFrm])
***
_PARAM = This.nFrmID
USE Basis!lvFrmTypeObjDescInfoByFrm IN 0
***
IF RECCOUNT([lvFrmTypeObjDescInfoByFrm]) # 1
	ASSERT .F. MESSAGE [MGRPRIMARYDOC.FORM_EDIT: íåâîçìîæíî îïðåäåëèòü èìÿ îáúåêòà, èñïîëüçóåìîãî äëÿ ðåäàêòèðîâàíèÿ]
	RETURN .F.
ENDIF	

*15.07.2004 02:57 -&gt;Âûïîëíÿåì îïåðàöèþ äîáàâëåíèÿ
DO CASE
CASE !ISNULL(lvFrmTypeObjDescInfoByFrm.FrmTypeEditObjDescDet) AND ALLTRIM(lvFrmTypeObjDescInfoByFrm.FrmTypeEditObjDescDet) &lt;&gt; []
		*09.03.2008 08:57 -&gt;Âûïîëíÿåì îïåðàöèþ óäàëåíèÿ ïî ïîëþ - äåñêðèïòîðó
	luDeleRes = oApp.DoModalFormRetValObj(lvFrmTypeObjDescInfoByFrm.FrmTypeEditObjDescDet,[DELE],lnFrmPartTvrID,cFlParentSmt)
	OTHERWISE
		*15.07.2004 02:57 -&gt;Âûïîëíÿåì îïåðàöèþ óäàëåíèÿ
		luDeleRes = oMgrPD.Operate([PARTTVR],[DELE],lnFrmPartTvrID)
ENDCASE luDeleRes
*------------------------------------------------------------------------------
USE IN SELECT([lvFrmTypeObjDescInfoByFrm])

*24.09.2004 16:17 -&gt;Åñëè çàïèñü óäàëåíà
IF TYPE([luDeleRes])==[L] AND luDeleRes

	*24.09.2004 16:15 -&gt;Ïåðå÷èòûâàåì Alias äëÿ ïðîñìîòðà
	This._RSRequeryOne(lnFrmPartTvrID)
	*------------------------------------------------------------------------------

ENDIF
*------------------------------------------------------------------------------

****************************************************************************************************************
***********************************************  END OF METHOD *************************************************
****************************************************************************************************************
ENDPROC
PROCEDURE _edit
*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: grdPartTvr._Edit
* Called by.......: &lt;ToolBar or Context Menu Action -&gt; .HandleMsg() -&gt; .Edit()&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Ðåäàêòèðîâàíèå ñîäåðæàíèÿ òîâàðíîãî äîêóìåíòà
*-------------------------------------------------------
LOCAL cFlParentSmt, lcUniqueFilePath
cFlParentSmt = [_d] + SYS(2015)
lcUniqueFilePath = [tmp\] + cFlParentSmt + [.DBF]

SELECT ALLTRIM(NVL(tmpSmet.Tvrnm,''))+' ' +ALLTRIM(NVL(tmpSmet.FrmNote,'')) as TvrNm , tmpSmet.FrmPartTvr;
FROM tmpSmet ;
order by 1 ;
INTO TABLE (lcUniqueFilePath)

USE IN SELECT(cFlParentSmt)

*19.10.2004 13:44 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnFrmPartTvrID, ;
		luEditRes
***
lnFrmPartTvrID = this.nPartID
*------------------------------------------------------------------------------
USE IN SELECT([lvFrmTypeObjDescInfoByFrm])
***
_PARAM = This.nFrmID
USE Basis!lvFrmTypeObjDescInfoByFrm IN 0
***
IF RECCOUNT([lvFrmTypeObjDescInfoByFrm]) # 1
	ASSERT .F. MESSAGE [MGRPRIMARYDOC.FORM_EDIT: íåâîçìîæíî îïðåäåëèòü èìÿ îáúåêòà, èñïîëüçóåìîãî äëÿ ðåäàêòèðîâàíèÿ]
	RETURN .F.
ENDIF	
*15.07.2004 02:57 -&gt;Âûïîëíÿåì îïåðàöèþ ðåàäêòèðîâàíèÿ
DO CASE
CASE !ISNULL(lvFrmTypeObjDescInfoByFrm.FrmTypeEditObjDescDet) AND ALLTRIM(lvFrmTypeObjDescInfoByFrm.FrmTypeEditObjDescDet) &lt;&gt; []
		*09.03.2008 08:57 -&gt;Âûïîëíÿåì îïåðàöèþ ðåàäêòèðîâàíèÿ ïî ïîëþ - äåñêðèïòîðó
	luEditRes = oApp.DoModalFormRetValObj(lvFrmTypeObjDescInfoByFrm.FrmTypeEditObjDescDet,[EDIT],lnFrmPartTvrID,cFlParentSmt)
CASE PrimaryDocView.FrmTypeId = 21
luEditRes = oMgrPD.Operate([PARTMNU],[EDIT],lnFrmPartTvrID,cFlParentSmt)
CASE PrimaryDocView.FrmTypeId = 19
luEditRes = oMgrPD.Operate([PARTCLC],[EDIT],lnFrmPartTvrID,cFlParentSmt)
CASE PrimaryDocView.FrmTypeId = 0
luEditRes = oMgrPD.Operate([PARTTVR],[EDIT],lnFrmPartTvrID,cFlParentSmt)
OTHERWISE
luEditRes = oMgrPD.Operate([PARTTVR],[EDIT],lnFrmPartTvrID,cFlParentSmt)
ENDCASE
*------------------------------------------------------------------------------
USE IN SELECT([lvFrmTypeObjDescInfoByFrm])

*19.10.2004 13:45 -&gt;Åñëè çàïèñü îòðåäàêòèðîâàëè
IF TYPE([luEditRes])==[L] AND luEditRes

	*24.09.2004 16:15 -&gt;Ïåðå÷èòûâàåì Alias äëÿ ïðîñìîòðà
	This._RSRequeryOne(lnFrmPartTvrID)
	*------------------------------------------------------------------------------
	
ENDIF
*------------------------------------------------------------------------------

****************************************************************************************************************
***********************************************  END OF METHOD *************************************************
****************************************************************************************************************
ENDPROC
PROCEDURE _rsrequeryone
LPARAMETERS lnPartTvrId
LOCAL lFileSmt,lnItem
lFileSmt = spFrmPartTvrJrnView([BYFRMPARTTVRID],lnPartTvrId)
*SET STEP ON
SELECT tmpSmet
LOCATE ALL FOR tmpSmet.FrmPartTvr = lnPartTvrId
IF FOUND()
	lnItem = tmpSmet._idTmp
	DELETE FROM tmpSmet WHERE tmpSmet.FrmPartTvr = lnPartTvrId
	this.Items.RemoveItem(lnItem)
ENDIF
APPEND FROM (lFileSmt)
SELECT tmpSmet
LOCATE ALL FOR tmpSmet.FrmPartTvr = lnPartTvrId
IF FOUND()
	this._addParent()
ENDIF
USE IN SELECT('insSmt')
lFileSmt = 'tmp\'+lFileSmt +'.dbf'
IF FILE(lFileSmt)
	ERASE (lFileSmt)
ENDIF
this.SetFocus()
this.Items.SelectItem(this.Items.DefaultItem)


ENDPROC
PROCEDURE Change
*** ActiveX Control Event ***
LPARAMETERS item, colindex, newvalue
*** - 18.05.2009 17:37:51 Ãëóõîâ Â.Þ. (C) - &gt;
IF thisform.lFrmIsPayed AND !this.linload
= MESSAGEBOX('Äîêóìåíò óæå îïëà÷åí.'+CHR(13)+;
			 'Âñå èçìåíåíèÿ áóäóò îòìåíåíû',0+64,'Ïðåäóïðåæäåíèå.Äîêóìåíò îïëà÷åí.')
RETURN
ENDIF
**DODEFAULT(item, colindex, newvalue)
WITH This.Items
IF this.linload OR VAL(.ItemData(item))=0
RETURN
ENDIF
**this.CauseValidateValue = .f. &amp;&amp; çàïðåùàåì îáðàáîòêó ïðîâåðêè çàïîëíåíèÿ

USE IN SELECT('lvFrmTvrOU')

LOCAL nOldVal,nNewVal
nNewVal = IIF(VARTYPE(.CellValue(item, 3))='C',VAL(.CellValue(item, 3)),.CellValue(item, 3))
nOldVal = IIF(VARTYPE(.CellValue(.ItemParent(item), 3))='C',VAL(.CellValue(.ItemParent(item), 3)),.CellValue(.ItemParent(item), 3)) -  nNewVal

*SET STEP ON



IF 	INLIST(.CellValue(item , 6),1,2) 	&amp;&amp; îòìåíÿåì èçìåíåíèÿ
		.CellValue(item , 3) = nNewVal
	RETURN .f.
ENDIF


LOCAL _Param,nnewvalue,nTotal
_Param = VAL(.ItemData(item))
SET DATABASE TO BASIS
USE lvFrmTvrOU IN 0
nnewvalue = IIF(VARTYPE(newvalue)= 'N',newvalue,VAL(newvalue))
REPLACE TvrQnt WITH nnewvalue NEXT 1 IN lvFrmTvrOU

=TABLEUPDATE(1,.T.,'lvFrmTvrOU')
.CellBold(item,3) = .t.
nTotal = nOldVal + nnewvalue
.CellValue(.ItemParent(item) , 3) = nTotal

.CellValue(item , 5) = nnewvalue

ENDWITH


USE IN SELECT('lvFrmTvrOU')
**this.CauseValidateValue = .t. &amp;&amp; ðàçðåøàòü îáðàáîòêó ïðîâåðêè çàïîëíåíèÿ

ENDPROC
PROCEDURE colshow

FOR nCol= 0 TO (This.Object.Columns.Count -1)
	This.Object.Columns.Item(nCol).Visible = .F.
ENDFOR

*!*	This.Object.Columns.Item(1).Visible = .F.
*!*	This.Object.Columns.Item(2).Visible = .F.
	This.Object.Columns.Item('resnm').Visible = .t.
	This.Object.Columns.Item('resnm').Caption = 'Ðàáîòà'
	*This.Object.Columns.Item('resnm').Width = 75

	This.Object.Columns.Item('tvrnm').Visible = .t.
	This.Object.Columns.Item('tvrnm').Caption = 'Ïîçèöèÿ ñìåòû'
	*This.Object.Columns.Item('tvrnm').Width = 75

	This.Object.Columns.Item('msushortnm').Visible = .t.
	This.Object.Columns.Item('msushortnm').Caption = 'Åä. èçì.'
	*This.Object.Columns.Item('msushortnm').Width = 75

	This.Object.Columns.Item('tvrprcbuy').Visible = .t.
	This.Object.Columns.Item('tvrprcbuy').Caption = 'Ö. ñìåò.'
	*This.Object.Columns.Item('tvrprcbuy').Width = 75

	This.Object.Columns.Item('tvrsumbuy').Visible = .t.
	This.Object.Columns.Item('tvrsumbuy').Caption = 'Ñóììà ñìåò.'
	*This.Object.Columns.Item('tvrsumbuy').Width = 75
*!*	this.SetAll("dynamicbackcolor", ;
*!*				"IIF(RECNO()%2 = 0,RGB(255,255,0), RGB(255,255,255))", "Column")
	*!*	 	with .Columns
	*!*	*!*			.Item("Start").LevelKey = "L1"
	*!*	*!*			.Item("End").LevelKey = "L1"
	*!*	*!*			.Item("Start").Caption = "Hà÷àëî"
	*!*	*!*			.Item("End").Visible = .f.
	*!*			.Item("start").LevelKey = "L1"
	*!*			.Item("end").LevelKey = "L1"
	*!*			.Item("start").Caption = "Hà÷àëî"
	*!*			*.Item("end").Visible = .f.
	*!*		endwith

ENDPROC
PROCEDURE FilterChange
*** ActiveX Control Event ***
DODEFAULT()
this.ExpandAllFiltred()
ENDPROC
PROCEDURE Init
DODEFAULT()
WITH this
	.BeginUpdate()
*!*		with .ConditionalFormats.Add("%3&gt;0")
*!*			.Bold = .t.
*!*			.foreColor=RGB(0,0,200)
*!*			.ApplyTo = -1
*!*		endwith
	.rClickSelect = .T.
	.DefaultItemHeight = 21
	.Font.Size = 10
	.BackColor = RGB(255,244,222)
	.SelBackColor = RGB(126,126,248)
*	SET STEP ON
	*.Font.Weigh
	WITH .Columns.Add('Ñòîë')
		.Alignment = 0
		.Width  = 100
		.DisplayFilterButton = .T.
		.FilterType = 0
	ENDWITH

	WITH .Columns.Add('Ìåíþ\Áëþäî')
		.Alignment = 0
		.Width  = 250
		.DisplayFilterButton = .T.
		.FilterType = 0
	ENDWITH

*!*		WITH .Columns.Add('Áëþäî')
*!*			.Alignment = 0
*!*			.Width  = 250
*!*		ENDWITH

	WITH .Columns.Add("Åä.èçìåð")
		.Width  = 30
		.Alignment = 0
	ENDWITH

	WITH .Columns.Add("Êîëè÷")  &amp;&amp;3
		.Width  = 60
		.Alignment = 2
		.DisplayFilterButton = .T.
		.FilterType = 5
		.Editor.EditType = 4  &amp;&amp; Ñïèíåð
	*	.Editor.EditType = 21 &amp;&amp; êàëüêóëÿòîð
	ENDWITH
	WITH .Columns.Add("Öåíà") &amp;&amp;4
		.Width  = 60
		.Alignment = 0
		.Visible = .f.
	ENDWITH
	WITH .Columns.Add("×èñëî ìåñò") &amp;&amp; 5
		.Width  = 0
		.Visible = .f.
	ENDWITH
	WITH .Columns.Add("Òèï") &amp;&amp;6
		.Width  = 0
		.Visible = .F.
	ENDWITH
	WITH .Columns.Add("Total") &amp;&amp;7
		.Width  = 0
		.Visible = .F.
	ENDWITH
*!*		with .Columns.Item(3).Editor
*!*		*	.EditType = 4  &amp;&amp; Ñïèíåð
*!*		*	.EditType = 21 &amp;&amp; êàëüêóëÿòîð
*!*			.EditType = 8
*!*			.Mask = "#######.###"
*!*			*.Option(46) = 46
*!*		endwith	
*!*		WITH .Columns.Add("Ñóììà")
*!*			.Width  = 70
*!*			.Alignment = 2
*!*			*.ComputedField = "%2 * %3"
*!*		ENDWITH
	***this.Items.CellValueFormat(4) = 0
*!*		.Columns.Add("Ïðèìå÷åíèå").Width  = 60
*!*		.Font.Size = 10
	with this.ConditionalFormats.Add("%3&gt;%5")
		.BackColor = RGB(241,152,152) &amp;&amp; êðàñíûé
		.ApplyTo = -1
	endwith

	with this.ConditionalFormats.Add("%3&lt;0")
		.BackColor = RGB(152,152,241) &amp;&amp; ñèíèé
		.ApplyTo = 3
	endwith

	with this.ConditionalFormats.Add("%3&lt;%5")
		.BackColor = RGB(152,241,152)
		.ApplyTo = 3
	endwith

	.FilterBarHeight =0
	.expandOnSearch = .t.
	.Indent = 55
	.HasButtons = 1
	.HasLines = 0
	.SingleSel = .f.
	.EndUpdate()
ENDWITH
ENDPROC
PROCEDURE loadrs
LPARAMETERS nFrmId,nFrmStatusId,nOuParId
this.BeginUpdate()
with this.Items
	.RemoveAllItems()
** ôîðìèðóåì òàáëèöó ñî ñòîëàìè	
USE IN SELECT('tmpDayly')
DO	spDaylyMenuOrder WITH nFrmId,nOuParId,.f.
LOCAL cNewItem
cNewItem = ''
SELECT tmpDayly

SCAN ALL &amp;&amp;FOR tmpDayly.Seets &gt;0
	   IF !(cNewItem == ALLTRIM(tmpDayly.OuNM))
		   cNewItem = ALLTRIM(tmpDayly.OuNM)
		   .DefaultItem = .AddItem(ALLTRIM(tmpDayly.OuNM)) &amp;&amp; ñòàâèì íàçâàíèå ñòîëà
		   .CellValue(.DefaultItem , 3) = TRANSFORM(NVL(tmpDayly.Seets,0),[99999999]) 	&amp;&amp; êîëè÷åñòâî
		   .CellValue(.DefaultItem , 5) = NVL(tmpDayly.Seets,0)	&amp;&amp; êîëè÷åñòâî
		   .CellValue(.DefaultItem , 6) = 1 	&amp;&amp; òèï ñòîë
		   .CellEditorVisible(.DefaultItem , 3)=.f.
		   thisForm.nSeets = NVL(tmpDayly.Seets,0)
		   .CellBold(.DefaultItem ,0) = .t.
		   .CellBold(.DefaultItem ,3) = .t.
		   lnDefItem = .DefaultItem
	   ENDIF
	   this._addParent(lnDefItem) &amp;&amp; äîáàâëÿåì ðàçäåëû ìåíþ íà ýòîì ñòîëå
	   IF RECCOUNT('tmpDayly')&gt;2
	   		SKIP -1 IN tmpDayly
	   ENDIF
ENDSCAN
ENDWITH
this.ExpandAll(.t.)
This.EndUpdate()
SELECT tmpDayly
*BROWSE
USE IN SELECT('tmpDayly')

RETURN

ENDPROC
PROCEDURE RClick
*** ActiveX Control Event ***
LPARAMETERS button, shift, x, y
RETURN
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.RIGHTCLICK
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Ïðîãðàìíîå ñîçäàíèå êîíòåêñòíîãî ìåíþ.
*-------------------------------------------------------
local c, hit
c = 0
hit = 0
with this
	*n_idTmp = .ItemFromPoint( x, y, @c, @hit )
	n_idTmp = this.Items.SelectedItem
	if ( n_idTmp &lt;&gt; 0 ) or ( c &lt;&gt; 0 )
		SELECT tmpSmet
		LOCATE ALL for tmpSmet._idTmp = n_idTmp
		IF FOUND()
			.nPartID = tmpSmet.FrmPartTvr
			.nFrmId = tmpSmet.FrmID
		ENDIF
	endif
endwith



*05.04.2004 13:52 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnMsgCount, ;
		lnMsgCounter, ;
		lnStartPos, ;
		lnEndPos, ;
		lcPrompt, ;
		lcMsg, ;
		lnCurSRef, ;
		lcHandledCustomMsgList, ;
		lcHandledStandartMsgList, ;
		lnItemCountAfterSeparator, ;
		lcRelativeHierarchy, ;
		lcActionMacro, ;
		lnAddBarIndex
***		

#INCLUDE include\base_v1_grd.h

LOCAL ARRAY 	paStdContextActions[1], ;
				paCstContextActions[1]
***
paStdContextActions = .NULL.
paCstContextActions = .NULL.
*------------------------------------------------------------------------------
WITH This
*******************************************************************************
*1. ×èòàåì â ìàññèâ ñïèñîê ïóíêòîâ ìåíþ è ñïèñîê ñîîáùåíèé	  				  *
*******************************************************************************

*05.04.2004 14:01 -&gt;Ïðîâåðÿåì ðàçìåðíîñòè âñåõ ñïèñêîâ
IF OCCURS([;],._HandledStandartMsgList) # OCCURS([;],._HandledStandartMsgPromptList)
	ASSERT .F. MESSAGE [GRD.RIGHTCLICK: ðàçìåðíîñòü ñïèñêà ñòàíäàðòíûõ ñîîáùåíèé îòëè÷íà îò ðàçìåðíîñòè ñïèñêà ñòàíäàðòíûõ ïóíêòîâ ìåíþ.]
	RETURN .F.
ENDIF
***
IF OCCURS([;],._HandledCustomMsgList) # OCCURS([;],._HandledCustomMsgPromptList)
	ASSERT .F. MESSAGE [GRD.RIGHTCLICK: ðàçìåðíîñòü ñïèñêà ïîëüçîâàòåëüñêèõ ñîîáùåíèé îòëè÷íà îò ðàçìåðíîñòè ñïèñêà ïîëüçîâàòåëüñêèõ ïóíêòîâ ìåíþ.]
	RETURN .F.
ENDIF
*------------------------------------------------------------------------------
*05.04.2004 14:09 -&gt;×èòàåì â ìàññèâ ñòàíäàðòíûå ñîîáùåíèÿ
lnMsgCount = OCCURS([;],._HandledStandartMsgPromptList)+1
***
FOR lnMsgCounter = 1 TO lnMsgCount
	lnStartPos = IIF(lnMsgCounter = 1, 1, AT([;],._HandledStandartMsgPromptList,lnMsgCounter-1)+1)
	lnEndPos   = IIF(lnMsgCounter = lnMsgCount, LEN(._HandledStandartMsgPromptList), AT([;],._HandledStandartMsgPromptList,lnMsgCounter)-1)
	lcPrompt   = SUBSTR(._HandledStandartMsgPromptList,lnStartPos,lnEndPos-lnStartPos+1)
	***
	lnStartPos = IIF(lnMsgCounter = 1, 1, AT([;],._HandledStandartMsgList,lnMsgCounter-1)+1)
	lnEndPos   = IIF(lnMsgCounter = lnMsgCount, LEN(._HandledStandartMsgList), AT([;],._HandledStandartMsgList,lnMsgCounter)-1)
	lcMsg   = SUBSTR(._HandledStandartMsgList,lnStartPos,lnEndPos-lnStartPos+1)
	***
	IF !EMPTY(lcPrompt)
		IF ISNULL(paStdContextActions)
			lnCurSRef = 1
		ELSE
			lnCurSRef = ALEN(paStdContextActions,1)+1
		ENDIF
		***
		DIMENSION paStdContextActions(lnCurSRef,2)
		***
		paStdContextActions(lnCurSRef,cnCMA_PROMPT) = lcPrompt
		paStdContextActions(lnCurSRef,cnCMA_MSG) = lcMsg
	ENDIF	
	***
ENDFOR
*------------------------------------------------------------------------------

*05.04.2004 14:09 -&gt;×èòàåì â ìàññèâ ïîëüçîâàòåëüñêèå ñîîáùåíèÿ ñîîáùåíèÿ
lnMsgCount = OCCURS([;],._HandledCustomMsgPromptList)+1
***
FOR lnMsgCounter = 1 TO lnMsgCount
	lnStartPos = IIF(lnMsgCounter = 1, 1, AT([;],._HandledCustomMsgPromptList,lnMsgCounter-1)+1)
	lnEndPos   = IIF(lnMsgCounter = lnMsgCount, LEN(._HandledCustomMsgPromptList), AT([;],._HandledCustomMsgPromptList,lnMsgCounter)-1)
	lcPrompt   = SUBSTR(._HandledCustomMsgPromptList,lnStartPos,lnEndPos-lnStartPos+1)
	***
	lnStartPos = IIF(lnMsgCounter = 1, 1, AT([;],._HandledCustomMsgList,lnMsgCounter-1)+1)
	lnEndPos   = IIF(lnMsgCounter = lnMsgCount, LEN(._HandledCustomMsgList), AT([;],._HandledCustomMsgList,lnMsgCounter)-1)
	lcMsg   = SUBSTR(._HandledCustomMsgList,lnStartPos,lnEndPos-lnStartPos+1)
	***
	IF !EMPTY(lcPrompt)
		IF ISNULL(paCstContextActions)
			lnCurSRef = 1
		ELSE
			lnCurSRef = ALEN(paCstContextActions,1)+1
		ENDIF
		***
		DIMENSION paCstContextActions(lnCurSRef,2)
		***
		paCstContextActions(lnCurSRef,cnCMA_PROMPT) = lcPrompt
		paCstContextActions(lnCurSRef,cnCMA_MSG) = lcMsg
	ENDIF	
	***
ENDFOR
*------------------------------------------------------------------------------

*******************************************************************************
*2. Îïðåäåëÿåì ñïèñîê äîñòóïíûõ ñîîáùåíèé â êàæäîé ãðóïïå	  				  *
*******************************************************************************

*05.04.2004 15:32 -&gt;Îïðåäåëèì ñïèñîê ñîîáùåíèé
lcHandledStandartMsgList = [;]+._GetHandledStandartMsgList()+[;]
lcHandledCustomMsgList = [;]+._GetHandledCustomMsgList()+[;]
*------------------------------------------------------------------------------

*******************************************************************************
*3. Ñòðîèì êîíòåêñòíîå ìåíþ									  				  *
*******************************************************************************
*05.04.2004 15:33 -&gt;Îïðåäåëÿåì ìåíþ
DEFINE POPUP grdshortcut SHORTCUT RELATIVE FROM MROW(),MCOL()
*------------------------------------------------------------------------------
*05.04.2004 15:34 -&gt;Ïðîõîäèìñÿ ïî ìàññèâó ñòàíäàðòíûõ ñîîáùåíèé
lnItemCountAfterSeparator = 0
IF !ISNULL(paStdContextActions)
	FOR lnCurSRef = 1 TO ALEN(paStdContextActions,1)
		IF	paStdContextActions(lnCurSRef,cnCMA_PROMPT) == [\-]
			IF lnItemCountAfterSeparator &gt; 0
				DEFINE BAR lnCurSRef OF grdshortcut PROMPT [\-]
				lnItemCountAfterSeparator = 0
			ENDIF	
		ELSE
			IF ([;]+paStdContextActions(lnCurSRef,cnCMA_MSG)+[;])$lcHandledStandartMsgList
				lcRelativeHierarchy = SYS(1272,This)
				lcRelativeHierarchy = IIF([.]$lcRelativeHierarchy,SUBSTR(lcRelativeHierarchy,AT([.],lcRelativeHierarchy)+1),lcRelativeHierarchy)
				lcActionMacro = [_screen.ActiveForm.]+lcRelativeHierarchy+[.HandleMsg("]+paStdContextActions(lnCurSRef,cnCMA_MSG)+[")]
				***
				DEFINE BAR lnCurSRef OF grdshortcut PROMPT paStdContextActions(lnCurSRef,cnCMA_PROMPT)
				ON SELECTION BAR lnCurSRef OF grdshortcut &amp;lcActionMacro
			ELSE
				DEFINE BAR lnCurSRef OF grdshortcut PROMPT paStdContextActions(lnCurSRef,cnCMA_PROMPT) SKIP FOR .T.
			ENDIF
			***
			lnItemCountAfterSeparator = lnItemCountAfterSeparator + 1
		ENDIF
	ENDFOR
ENDIF	
*------------------------------------------------------------------------------

*14.05.2004 11:48 -&gt;Ñè÷òàåì íàðîùåíèå èíäåêñà äëÿ ñîîáùåíèé ïîëüçîâàòåëüñêîé ãðóïïû
IF !ISNULL(paStdContextActions)
	lnAddBarIndex = ALEN(paStdContextActions,1)
ELSE
	lnAddBarIndex = 0	
ENDIF
*------------------------------------------------------------------------------	

*14.05.2004 11:45 -&gt;Äîáàâëÿåì ðàçäåëèòåëü ì/ä ñòàíäàðòíûìè è ïîëüçîâàòåëüñêèìè
IF lnItemCountAfterSeparator &gt; 0 AND !ISNULL(paCstContextActions)
	DEFINE BAR lnAddBarIndex+1 OF grdshortcut PROMPT [\-]
	lnAddBarIndex = lnAddBarIndex+1
ENDIF
*------------------------------------------------------------------------------

*05.04.2004 15:34 -&gt;Ïðîõîäèìñÿ ïî ìàññèâó ïîëüçîâàòåëüñêèõ ñîîáùåíèé
lnItemCountAfterSeparator = 0
IF !ISNULL(paCstContextActions)
	FOR lnCurSRef = 1 TO ALEN(paCstContextActions,1)
		IF	paCstContextActions(lnCurSRef,cnCMA_PROMPT) == [\-]
			IF lnItemCountAfterSeparator &gt; 0
				DEFINE BAR lnAddBarIndex+lnCurSRef OF grdshortcut PROMPT [\-]
				lnItemCountAfterSeparator = 0
			ENDIF	
		ELSE
			IF ([;]+paCstContextActions(lnCurSRef,cnCMA_MSG)+[;])$lcHandledCustomMsgList
				lcRelativeHierarchy = SYS(1272,This)
				lcRelativeHierarchy = IIF([.]$lcRelativeHierarchy,SUBSTR(lcRelativeHierarchy,AT([.],lcRelativeHierarchy)+1),lcRelativeHierarchy)
				lcActionMacro = [_screen.ActiveForm.]+lcRelativeHierarchy+[.HandleMsg("]+paCstContextActions(lnCurSRef,cnCMA_MSG)+[")]
				***
				DEFINE BAR lnAddBarIndex+lnCurSRef OF grdshortcut PROMPT paCstContextActions(lnCurSRef,cnCMA_PROMPT)
				ON SELECTION BAR lnAddBarIndex+lnCurSRef OF grdshortcut &amp;lcActionMacro
			ELSE
				DEFINE BAR lnAddBarIndex+lnCurSRef OF grdshortcut PROMPT paCstContextActions(lnCurSRef,cnCMA_PROMPT) SKIP FOR .T.
			ENDIF
			***
			lnItemCountAfterSeparator = lnItemCountAfterSeparator + 1
		ENDIF
	ENDFOR
ENDIF	
*------------------------------------------------------------------------------

ENDWITH

*05.04.2004 15:57 -&gt;Àêòèâèðóåì ìåíþ
ACTIVATE POPUP grdshortcut
*------------------------------------------------------------------------------

************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
</methods>
		<objcode/>
		<ole>0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7////+////BQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAP7//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAICJsHJdf8wBAwAAAMAAAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAfBQAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABDAAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAQAAAAAAAAAAQAAAP7////+//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9DAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACwAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAC0xMjkzOTE3MTM5AAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAtMTI5MzkxNwEAAIBRAEQAZwBFAEEAQQBnAG8ARQBSAFEAawBJAEsAeABBAG4ARwBQAEIAaABHAEsAQQBaAHoAaABnAEoAdwAP5h4QB3uwSKE68yuufaFlSUwBAQAABAAEABAAEAD/////IQD//////////0JNNgAAAAAAAAA2AAAAKAAAAEAAAAAQAAAAAQAgAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAD0AAAAxAB0AJgEsADEAFQAnAU8ADAAgAhUAUJoZADg8E3ckPBN3ADwTdzAANAAsAC0AAQAAAPsaBdUAAAAAMAA1AAUAAAADAAAAhAAAAE8AAAAAAAAAAAAAAAAAAAAAAAAAZgAAAIgPGwAPAAAAAAAAACRWEXcAAAAAAAAAAFCFEXcAAAAATLogAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGAEIAAAAMALhcFwC4jhQABwA8AVQBCAAiAAAAUgBlAG0AbwB2AGUAUwBoAGEAcABlAEMAbwByAA/mHhAHe7BIoTrzK659oWVJTAEBAAAEAAQAEAAQAP////8hAP//////////Qk02AAAAAAAAADYAAAAoAAAAQAAAABAAAAABACAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEJNPgAAAAAAAAA+AAAAKAAAAEAAAAAQAAAAAQABAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAUWkAAD9FAAAJAANS4wuRj84RneMAqgBLuFEBzAAAkAFEQgEABUFyaWFsCwD//wsA//8DAAAAAAATAAUAAIATAAgAAIATAAUAAIATAAgAAIALAP//AwAAAAAAAwADAAAAAwASAAAAAwD/////AwAAAAAACwD//wsA//8DAAAAAAALAAAAAwD/////AwD/////AwAAAAAAAwD/////AwAWAAAAAwAAAAAACwAAAAsA//8TAA4AAIATAA0AAIADAAAAAAADAAAAAAADAAAAAAALAP//EwAxZf8AAwACAAAACwD//wsA//8LAAAACwAAAAsAAAAJAAAAAAAAAAAAAAAAAAAAAAADADAAAAALAAAAEwAxZf8AAwAAAAAAEwAPAACAEwAIAACAEwAAAAAAAwD/////EwAPAACAEwAIAACACQADUuMLkY/OEZ3jAKoAS7hRAcwAALwCREIBAAVBcmlhbAgAAgAAAAAAAwASAAAACABkAAAAYQBiAGMAZABlAGYAZwBoAGkAagBrAGwAbQBuAG8AcABxAHIAcwB0AHUAdgB3AHgAeQB6AEwEOQQyBDQEMAQ1BDcEOgQ7BDgEPwQ+BDwERARGBEIESwRJBDEEPQRDBEoEQQQAAAgAZAAAAEEAQgBDAEQARQBGAEcASABJAEoASwBMAE0ATgBPAFAAUQBSAFMAVABVAFYAVwBYAFkAWgAsBBkEEgQUBBAEFQQXBBoEGwQYBB8EHgQcBCQEJgQiBCsEKQQRBB0EIwQqBCEEAAALAP//CwD//wgAAgAAAAAAAwD0AQAAAwCIEwAAEwCsqJkAAwADAAAAAwDEAAAACwAAAAsAAAAFAAAAAAAAAOA/CwAAAAMAAAAAAAsA//8TAA8AAIAJAAAAAAAAAAAAAAAAAAAAAAADADAAAAALAP//AwAAAAAACwAAAAsAAAAIAAIAAAAAABMAEAAAgBMAEAAAgBMADwAAgAMAEgAAAAMAoP///wsA//8LAP//AwAAAAAACwAAAAMAAAAAAAsA//8IAAIAAAAAAAMAAAAAAAMA/////wMA/////wMA/////wMA/////wkAA1LjC5GPzhGd4wCqAEu4UQEBAACQAYA4AQAFQXJpYWwLAP//AwD///8ACwAAAA==</ole>
		<ole2>OLEObject = C:\Windows\SysWOW64\exgrid.dll
</ole2>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>frmmakedayly</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1></reserved1>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1KW12FP5V</uniqueid>
		<timestamp>1061450265</timestamp>
		<class>scrfrmview</class>
		<classloc>basis.vcx</classloc>
		<baseclass>form</baseclass>
		<objname>frmmakesmt</objname>
		<parent/>
		<properties>Top = 0
Left = 0
Height = 768
Width = 1024
DoCreate = .T.
Caption = "Êîìïîíîâêà àêòîâ ïî  ëîêàëüíîé ñìåòå"
WindowType = 0
BackColor = 212,208,200
nfrmid = 0
nscrfrmid = 0
_standarttoolbar = tlbstandart;basetoolbar_v1.vcx
_memberdata =      359&lt;VFPData&gt;&lt;memberdata name="nfrmid" display="nFrmId"/&gt;&lt;memberdata name="addtogrdwork" type="method" display="AddToGrdWork"/&gt;&lt;memberdata name="_addrectogrdinwork" type="method" display="_AddRecToGrdInWork"/&gt;&lt;memberdata name="_delrectogrdinwork" type="method" display="_DelRecToGrdInWork"/&gt;&lt;memberdata name="smtsave" type="method" display="SmtSave"/&gt;&lt;/VFPData&gt;

Name = "frmmakesmt"
cstmsghandler.Left = 0
cstmsghandler.Name = "cstmsghandler"
cstresizable.Name = "cstresizable"
Img1.Left = -122
Img1.ZOrderSet = 3
Img1.Name = "Img1"
</properties>
		<protected/>
		<methods>PROCEDURE _addrectogrdinwork
LOCAL lnTvrId,;
	  nRecnoGrdWork,;
	  nFrmparttvrviewFrmParId ,;
	  nPartTvrID,;
	  nTvrsumbuy ,;
	  nTvrsumbuyWork ,;
	  nRecnoFrmparttvrview,;
	  nRecnoGrdWork
nGrdWorkPartTvrID = grdWork.PartTvrID
nRecnoGrdWork = RECNO('GrdWork')
nRecnoFrmparttvrview = RECNO('Frmparttvrview')
nFrmparttvrviewFrmParId = Frmparttvrview.FrmParID
IF nFrmparttvrviewFrmParId = nGrdWorkPartTvrID OR ISNULL(nGrdWorkPartTvrID )
	RETURN
ENDIF
lnTvrId = Frmparttvrview.tvrid
nPartTvrID = Frmparttvrview.PartTvrID
nTvrsumbuy  = Frmparttvrview.tvrsumbuy
nTvrsumbuyWork = grdWork.tvrsumbuy
IF !(ISNULL(Frmparttvrview.FrmParID) OR Frmparttvrview.FrmParID = 0)
	IF MESSAGEBOX('Ïîçèöèÿ ñìåòû ïðèíàäëåæèò äðóãîé ðàáîòå.'+CHR(13)+ 'Ïðîäîëæèòü èçìåíåíèÿ?',4+64+256,'Ïîçèöèÿ çàíÿòà äðóãîé ðàáîòîé ...')=7
		RETURN
		ELSE
	ENDIF
ENDIF

IF ISNULL(nFrmparttvrviewFrmParId)
	UPDATE GrdWork ;
		SET grdWork.tvrsumbuy = grdWork.tvrsumbuy - nTvrsumbuy  ;
		   WHERE GrdWork.PartTvrID IS Null
	UPDATE Frmparttvrview SET Frmparttvrview.tvrsumbuy =  nTvrsumbuyWork + nTvrsumbuy , Chg = .T., TvrQnt = 1 ;
		WHERE Frmparttvrview.PartTvrID = nGrdWorkPartTvrID
ELSE
	UPDATE GrdWork ;
		SET grdWork.tvrsumbuy = grdWork.tvrsumbuy - nTvrsumbuy  ;
		   WHERE GrdWork.PartTvrID = nFrmparttvrviewFrmParId
	UPDATE Frmparttvrview SET Frmparttvrview.tvrsumbuy =  nTvrsumbuyWork - nTvrsumbuy , Chg = .T., TvrQnt = 1 ;
		WHERE Frmparttvrview.PartTvrID = nGrdWorkPartTvrID
ENDIF



UPDATE Frmparttvrview SET Frmparttvrview.FrmParID =  nGrdWorkPartTvrID , Chg = .T. ;
	WHERE Frmparttvrview.PartTvrID = nPartTvrID

UPDATE GrdWork ;
			SET grdWork.tvrsumbuy = grdWork.tvrsumbuy + nTvrsumbuy ;
			   WHERE GrdWork.PartTvrID = nGrdWorkPartTvrID

GO nRecnoGrdWork IN GrdWork
GO nRecnoFrmparttvrview IN Frmparttvrview

INSERT INTO GrdInWork (PartTvrID,tvrid,tvrnm,tvrqnt,tvrprcbuy,tvrsumbuy) ;
		SELECT Frmparttvrview.PartTvrID, Frmparttvrview.tvrid,;
			   Frmparttvrview.tvrnm, Frmparttvrview.tvrqnt, Frmparttvrview.tvrprcbuy,;
			   Frmparttvrview.tvrsumbuy;
FROM FrmPartTvrView WHERE Frmparttvrview.PartTvrID = nPartTvrID

thisform.GrdInWork.Refresh()

ENDPROC
PROCEDURE _delrectogrdinwork
LOCAL lnTvrId,;
	  nRecnoGrdWork,;
	  nGrdWorkTvrIdCalc,;
	  nFrmparttvrviewFrmParId ,;
	  nTvrsumbuy ,;
	  nTvrsumbuyWork ,;
	  nRecnoFrmparttvrview,;
	  nPartTvrID


nRecnoGrdWork = RECNO('GrdWork')
nRecnoFrmparttvrview = RECNO('Frmparttvrview')
nPartTvrID = GrdInWork.PartTvrID
nFrmparttvrviewFrmParId = GrdInWork.FrmParId
nTvrsumbuy  = GrdInWork.tvrsumbuy
nTvrsumbuyWork = grdWork.tvrsumbuy

UPDATE GrdWork ;
			SET grdWork.tvrsumbuy = grdWork.tvrsumbuy - nTvrsumbuy  ;
			   WHERE GrdWork.PartTvrID = nFrmparttvrviewFrmParId
UPDATE Frmparttvrview SET Frmparttvrview.tvrsumbuy =  nTvrsumbuyWork - nTvrsumbuy , Chg = .T., TvrQnt = IIF( nTvrsumbuyWork - nTvrsumbuy&lt;&gt;0,1,0) ;
		WHERE Frmparttvrview.PartTvrID = nPartTvrID


			
UPDATE GrdWork ;
			SET grdWork.tvrsumbuy = grdWork.tvrsumbuy + nTvrsumbuy  ;
			   WHERE GrdWork.PartTvrID Is null
			
UPDATE Frmparttvrview SET Frmparttvrview.FrmParId =  NULL  , Chg = .T.  ;
	WHERE Frmparttvrview.PartTvrID = nPartTvrID

DELETE FROM GrdInWork WHERE GrdInWork.PartTvrID = nPartTvrID
SELECT Frmparttvrview
GO TOP
LOCATE FOR Frmparttvrview.PartTvrID = nPartTvrID
GO nRecnoGrdWork IN GrdWork
SELECT GrdInWork
thisform.GrdInWork.Refresh()


ENDPROC
PROCEDURE _handlecntcancelsaveevent
*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: frmTvrSetEditSet._HandleCntCancelSaveEvent
* Called by.......: &lt;cmdOk.Click();cmdCancel.Click()&gt;
* Parameters......: &lt;tcMessage&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Ñîõðàíåíèå/îòìåíà
*-------------------------------------------------------
LPARAMETERS	tcMessage

WITH This

*05.08.2005 16:40 -&gt;Ïðîèçâîäèì ñîõðàíåíèå
IF tcMessage = .cntCancelSaveHandled._OKMsg
	*05.08.2005 16:43 -&gt;Âûïîëíÿåì õðàíèìóþ ïðîöåäóðó äëÿ ñîõðàíåíèÿ äàííûõ
	.SmtSave()
**	spSmtWorkSave(.nFrmId)
	*------------------------------------------------------------------------------
	
ENDIF
*------------------------------------------------------------------------------

*04.08.2005 11:47 -&gt; Ñêðûâàåì ôîðìó
.Release()
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE addtogrdwork
LOCAL llResult
USE IN SELECT([lvFrmPartTvrEdit])
USE lvFrmPartTvrEdit IN 0 NODATA
*-* äîáàâëÿåì ïîìå÷åííûå çàïèñè
INSERT INTO lvFrmPartTvrEdit (FrmID, TvrId, MsuId, TvrAttr  )  ;
SELECT This.nFrmId;
	,Tovar.TvrId;
	,Tovar.MsuId;
	,BITSET(0,9) ;
FROM TvrInSetEdit ;
left outer join Tovar on TvrInSetEdit.TvrId  = Tovar.TvrId ;
WHERE TvrInSetEdit.Mark&gt;0 AND TvrInSetEdit.TvrId NOT IN (SELECT NVL(tvrid,0) FROM GrdWork) AND !TvrInSetEdit.TvrIsCnt
llResult = TABLEUPDATE(1,.T.,[lvFrmPartTvrEdit])

** óäàëÿåì çàïèñè, ñ êîòîðûõ ïîìåòêó ñíÿëè
SELECT PartTvrId FROM GrdWork WHERE TvrId NOT in (SELECT TvrId FROM TvrInSetEdit WHERE Mark=1 ) INTO CURSOR GrdWorkToDele
SELECT GrdWorkToDele
SCAN
	_PARAM = GrdWorkToDele.PartTvrId
	REQUERY([lvFrmPartTvrEdit])
	DELETE FROM lvFrmPartTvrEdit
	llResult = TABLEUPDATE(1,.T.,[lvFrmPartTvrEdit])
	SELECT GrdWorkToDele
ENDSCAN

USE IN SELECT([lvFrmPartTvrEdit])
USE IN SELECT([GrdWorkToDele])
*------------------------------------------------------------------------------
this.GrdWork._Rsrequery()

*-* óäàëÿåì çàïèñè, êîòîðûå íå ïîìå÷åíû







ENDPROC
PROCEDURE Init
*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: frmMakeSmt.Init
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;tnScrFrmID,tnFrmId&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Èíèöèàëèçàöèÿ ôîðìû
*-------------------------------------------------------
LPARAMETERS tnFrmID
WAIT WINDOW NOWAIT "Ïîëó÷àåì äàííûå äëÿ ðàáîòû ..."
*08.08.2005 18:07 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	_PARAM
*------------------------------------------------------------------------------

*26.07.2005 16:10 -&gt; Âûáèðàåì íàáîð äëÿ ðåäàêòèðîâàíèÿ ñîñòàâà íàáîðà
This.nFrmId = tnFrmID &amp;&amp; oApp.DoModalFormRetValObj([frmtvrsetselect;tovar_v1.vcx;tovar.app])
***
IF VARTYPE(This.nFrmId)#[N]
	NODEFAULT
ENDIF
*------------------------------------------------------------------------------

*02.08.2005 16:10 -&gt;Ïîëó÷àåì è ñîõðàíÿåì â ñâîéñòâå îáúåêòà èíôîðìàöèþ î òèïå ñïèñêà
USE IN IIF(USED([lvTvrSetByID]),[lvTvrSetByID],0)
***
_PARAM = This.nFrmId
USE lvTvrSetByID IN 0
***
*04.08.2005 11:46 -&gt; Âûïîëíèì õðàíèìóþ ïðîöåäóðó
spSmetaWorkPrepare(This.nFrmId)
*------------------------------------------------------------------------------
*04.08.2005 11:46 -&gt; Îòêðîåì ïîäãîòîâëåííûé íàáîð
USE TvrInSetEdit IN 0
*04.08.2011 12:09 -&gt;Çàãðóçèì äàííûå â äåðåâî
ThisForm.OleSelTreeView.Init(.T.)
*------------------------------------------------------------------------------

*05.08.2005 15:23 -&gt;Îáíîâèì Grid

ThisForm.GrDPARTTVR._RSRequery(This.nFrmId)
This.Grdparttvr.Filterexternalset('BITTEST(FrmPartTvrView.TvrAttr,5)')
*!*	SELECT FrmPartTvrView
*!*	SET FILTER TO BITTEST(FrmPartTvrView.TvrAttr,5)

*DELETE FROM FrmPartTvrView WHERE NVL(TvrAttr,0) = 0

ThisForm.GrdWork._RSRequery()
WAIT CLEAR
***ThisForm.GrdInWork._RSRequery()
*------------------------------------------------------------------------------
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************

ENDPROC
PROCEDURE Load
*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: frmTvrSetEditSet.Load
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Çàãðóçêà ôîðìû
*-------------------------------------------------------
WAIT WINDOW NOWAIT "Ïîëó÷àåì äàííûå äëÿ ðàáîòû ..."
*04.08.2005 10:45 -&gt; Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*----------------------------------------------------------------------------
WAIT WINDOW NOWAIT "Ïîëó÷àåì äàííûå äëÿ ðàáîòû ..."

*04.08.2005 10:45 -&gt; Îòêðîåì ÁÄ
IF !DBUSED([BASIS])
	OPEN DATABASE BASIS
ENDIF
SET DATABASE TO BASIS	
*------------------------------------------------------------------------------

*04.08.2005 10:50 -&gt; Îòêðûâàåì Local View ñ êàðòèíêàìè
USE lvTvrSetBmps IN 0
*------------------------------------------------------------------------------

*05.08.2011 15:20 -&gt;Ñîçäàåì âðåìåííóþ òàáëèöó äëÿ Grid-à Ðàáîòû
CREATE TABLE tmp\tmpWork FREE (TKey I, TvrNM C(100), Price Y, Qnt Y, tmpSum Y)
*------------------------------------------------------------------------------
*05.08.2011 15:20 -&gt;Ñîçäàåì âðåìåííóþ òàáëèöó äëÿ Grid-à Ðàáîòû
CREATE CURS grdWork ( WorkNM C(100), tvrSumBuy Y, FrmParID I, PartTvrId I, TvrId I)
*------------------------------------------------------------------------------
*21.04.2004 14:05 -&gt;Âûïîëíèì õðàíèìóþ ïðîöåäóðó äëÿ ïîëó÷åíèÿ ïóñòîé òàáëèöû
lcUniqueName = spFrmPartTvrView([NODATA])
*------------------------------------------------------------------------------
*21.04.2011 14:08 -&gt;Òåïåðü îòêðîåì äàííûé Alias
USE (lcUniqueName) IN 0 ALIAS FrmPartTvrView
DO smtinwork_par.qpr
CURSORSETPROP([BUFFERING],3,[FrmPartTvrView])
*------------------------------------------------------------------------------

************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE showtluinfo
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: frmTvrSetEditSet.ShowTLUInfo
* Called by.......: &lt;ThisForm.OleSelTreeView.RightClick()-&gt;ContextMenu&gt;
* Parameters......: &lt;lnTLUID&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Îòîáðàæåíèå èíôîðìàöèè îá èäåíòèôèêàòîðå
*------------------------------------------------------------------------------
LPARAMETERS	lnTLUID

*01.04.2004 18:49 -&gt;Ñêðîåì äåðåâî, èíà÷å îíî áóäåò ôóíêöèîíèðîâàòü íåêîððåêòíî
ThisForm.OleSelTreeView.Enabled = .F.
*------------------------------------------------------------------------------

*01.04.2004 18:49 -&gt;Âûïîëíèì îïåðàöèþ ïðîñìîòðà èäåíòèôèêàòîðà òîâàðà
oMgrTovar.Do([TLU],[INFO],lnTLUID)
*------------------------------------------------------------------------------

*01.04.2004 18:49 -&gt;Âåðíåì äåðåâî
ThisForm.OleSelTreeView.Enabled = .T.
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE showtvrinfo
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: frmTvrSetEditSet.ShowTvrInfo
* Called by.......: &lt;ThisForm.OleSelTreeView.RightClick()-&gt;ContextMenu&gt;
* Parameters......: &lt;lnTvrID&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Îòîáðàæåíèå èíôîðìàöèè î òîâàðå
*------------------------------------------------------------------------------
LPARAMETERS	lnTvrID

*01.04.2004 18:49 -&gt;Ñêðîåì äåðåâî, èíà÷å îíî áóäåò ôóíêöèîíèðîâàòü íåêîððåêòíî
ThisForm.OleSelTreeView.Enabled = .F.
*------------------------------------------------------------------------------

*01.04.2004 18:49 -&gt;Âûïîëíèì îïåðàöèþ ïðîñìîòðà òîâàðà
oMgrTovar.Do([TVR],[INFO],lnTvrID)
*------------------------------------------------------------------------------

*01.04.2004 18:49 -&gt;Âåðíåì äåðåâî
ThisForm.OleSelTreeView.Enabled = .T.
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE smtsave
LOCAL lRes
WAIT WINDOW NOWAIT "Ñîõðàíÿåì âíåñåííûå èçìåíåíèÿ ..."
USE IN SELECT([lvFrmPartTvrEdit])
USE lvFrmPartTvrEdit IN 0 NODATA
SELECT Frmparttvrview
SET FILTER TO
SCAN ALL FOR Frmparttvrview.Chg
		_PARAM = Frmparttvrview.PartTvrID
		REQUERY([lvFrmPartTvrEdit])
		SELECT lvFrmPartTvrEdit
		REPLACE lvFrmPartTvrEdit.FrmParId WITH Frmparttvrview.FrmParId,;
				lvFrmPartTvrEdit.TvrQnt WITH Frmparttvrview.TvrQnt ,;
				lvFrmPartTvrEdit.TvrPrcBuy WITH IIF(INLIST(Frmparttvrview.TvrQnt,0,1),Frmparttvrview.tvrsumbuy,Frmparttvrview.TvrPrcBuy ) IN lvFrmPartTvrEdit
		lres = TABLEUPDATE(.t.)
		lres = spParentDates(Frmparttvrview.FrmParId)
		SELECT Frmparttvrview
ENDSCAN
USE IN SELECT([lvFrmPartTvrEdit])
WAIT CLEAR



ENDPROC
PROCEDURE Unload
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: FRMTVRSETEDITSET.UNLOAD
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........:
*------------------------------------------------------------------------------

*05.08.2005 16:09 -&gt;Óäàëèì âðåìåííóþ òàáëèöó äëÿ Grid-à
LOCAL lfilename
lfilename = DBF([GrdWork])
USE IN SELECT([GrdWork])
ERASE (lfilename)

USE IN SELECT([FrmWorkEdit])
IF FILE([tmp\FrmWorkEdit.dbf])
	ERASE tmp\FrmWorkEdit.dbf
ENDIF
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>25</reserved2>
		<reserved3>nfrmid &lt;public/runtime&gt; Èäåíòèôèêàòîð ôîðìû,  ñ êîòîðîé èäåò ðàáîòà
*_handlecntcancelsaveevent 
*showtvrinfo 
*showtluinfo 
*addtogrdwork Äîáâëÿåì â GrdWork ïîçèöèè ðàáîò , êîòîðûõ åùå íåò
*_addrectogrdinwork Äîáàâëÿåì çàïèñü ñìåòû â ðàáîòó
*_delrectogrdinwork Óäàëÿåì ïîçèöèþ èç ðàáîòû
*smtsave ñîõðàíåíèå èçìåíåíèå ñìåòû 
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7>Ðåäàêòèðîâàíèå âòÿíóòîé ñìåòû</reserved7>
		<reserved8>..\include\comselctl_v1_oleseltreeview.h</reserved8>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3AS0QZHQS</uniqueid>
		<timestamp>1061450265</timestamp>
		<class>splitter</class>
		<classloc>splitter.vcx</classloc>
		<baseclass>shape</baseclass>
		<objname>Splitter1</objname>
		<parent>frmmakesmt</parent>
		<properties>Top = 1
Left = 510
Height = 742
Width = 3
ZOrderSet = 0
Name = "Splitter1"
</properties>
		<protected/>
		<methods>PROCEDURE split
LOCAL nWith, nLeft
WITH thisform
		* left- right resize/reposition
		.Grdparttvr.Width = .splitter1.Left - 11
		.Grdparttvr.Left = 0

		.OleSelTreeView.Width = .splitter1.Left - 11
		.OleSelTreeView.Left = 0


		
		nWith=.Width - .Splitter1.Left -11
		nLeft=.Splitter1.Left + 11
		IF VARTYPE(.GrdInWork) = 'O'
			.GrdInWork.Width = nWith
			.GrdInWork.Left = nLeft
		ENDIF
		IF VARTYPE(.GrdWork) = 'O'
			.GrdWork.Width = nWith
			.GrdWork.Left = nLeft
		ENDIF
		.cntCancelSaveHandled.Left = thisform.Width  - thisform.cntCancelSaveHandled.Width

		nLeft=.Splitter1.Left-11

		IF VARTYPE(.CmdAdd) = 'O'
			.CmdAdd.Left = nLeft
		ENDIF
		IF VARTYPE(.CmdAddAll) = 'O'
			.CmdAddAll.Left = nLeft
		ENDIF
		IF VARTYPE(.cmdDele) = 'O'
			.cmdDele.Left = nLeft
		ENDIF
		IF VARTYPE(.cmdDeleAll) = 'O'
			.cmdDeleAll.Left = nLeft
		ENDIF
		IF VARTYPE(.CmdOpenAll) = 'O'
			.CmdOpenAll.Left = nLeft
		ENDIF
		*.grdpartres.SetFocus()
ENDWITH


ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1KZ0NH5QD</uniqueid>
		<timestamp>1061450265</timestamp>
		<class>oleimagelist</class>
		<classloc>comctl_v1.vcx</classloc>
		<baseclass>olecontrol</baseclass>
		<objname>OleImageList</objname>
		<parent>frmmakesmt</parent>
		<properties>Top = 24
Left = 12
Height = 100
Width = 100
ZOrderSet = 4
Name = "OleImageList"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole>0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7////+/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAECE7/ZtgswBAwAAAEABAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAXAAAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAABPAAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAQAAAAAAAAABAAAAAIAAAD+/////v////7///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+PjdpYap0bEK/AQhAQKo2nIUM0EggAAADtAwAA7QMAAIB+4eYCAAUAIAAAAAAAAADAwMAA//8AAAHvzasAAAUATwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABcAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgcWhqIFp0dVFoYTtqZGZuW2lhZXRyIADmjgAAAAAAAGyOAAAAAAAA6I8AAAAAAABojwAAAAAAAOqQAAAAAAAAcJAAAAAAAAABAACAAAAAAHqSAAAAAAAADJQAAAAAAACElAAAAAAAAAKVAAAAAAAAjJUAAAAAAAAElwAAAAAAAASWAAAAAAAA6OZpBwYAAAD/////BQAAgOjmaQcAAAAAAAAAAAAAAAAImgAAAAAAAIiZAAAAAAAAjJoAAAAAAACyNQAAAAAAAJacAAAAAAAATIMAAAAAAAAEmwAAAAAAABCdAAAAAAAAkFgAAAAAAACYPQAAAAAAAI6dAAAAAAAAGp4AAAAAAABYiwAAAAAAAPCLAAAAAAAAHDcAAAAAAACkNgAAAAAAAOYdAAAAAAAA3jgAAAAAAABqOQAAAAAAAAo6AAAAAAAAtjoAAAAAAACAjQAAAAAAAF47AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==</ole>
		<ole2>OLEObject = C:\Windows\SysWOW64\comctl32.ocx
</ole2>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1KX0XW9DF</uniqueid>
		<timestamp>1061450265</timestamp>
		<class>oleseltreeview</class>
		<classloc>comselctl_v1.vcx</classloc>
		<baseclass>olecontrol</baseclass>
		<objname>OleSelTreeView</objname>
		<parent>frmmakesmt</parent>
		<properties>Top = 372
Left = 0
Height = 369
Width = 499
ZOrderSet = 5
_imgalias = lvTvrSetBmps
_imgfieldnamefilename = BmpFileNM
_imgfieldnameindex = BmpID
_rsaliasname = TvrInSetEdit
_rsfieldnameid = TKey
_rsfieldnameimageindex = BmpID
_rsfieldnameimageselectedindex = SBmpID
_rsfieldnamemark = Mark
_rsfieldnamemarkimageindex = BmpMID
_rsfieldnamemarkimageselectedindex = SBmpMID
_rsfieldnameparentflag = TvrIsCnt
_rsfieldnameparentid = TvrParID
_rsfieldnamepartmarkimageindex = BmpPMID
_rsfieldnamepartmarkimageselectedindex = SBmpPMID
_rsfieldnametext = TvrNM
_imagelistobject = .parent.Oleimagelist.object
_parentonly = .F.
Name = "OleSelTreeView"
</properties>
		<protected/>
		<methods>PROCEDURE _handlemarkchange
ThisForm.AddToGrdWork()
ThisForm.GrdWork.Refresh()

ENDPROC
PROCEDURE Init
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: OLESELTREEVIEW.INIT
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;tlInitAllowed&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Çàãðóçêà äåðåâà ïî ñîáûòèþ
*------------------------------------------------------------------------------
LPARAMETERS	tlInitAllowed

*04.08.2005 12:08 -&gt;Çàãðóæàåì äåðåâî ïî ñîáûòèþ
IF tlInitAllowed
	DODEFAULT()
ENDIF
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE rightclick
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: oleSelTreeView.RightClick
* Called by.......: &lt;.MouseDown()&gt;
* Parameters......: &lt;toNode&gt;
* Returns.........: &lt;none&gt;
* Notes...........:
*------------------------------------------------------------------------------
LPARAMETERS	toNode

WITH This

*16.05.2005 11:24 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcOldAlias, ;
		lnNodeID, ;
		lcRSAliasName, ;
		lcRSFieldNameID, ;
		lcRSFieldNameParentFlag, ;
		llParentFlag, ;
		lnTvrID, ;
		lnTluID
***
lcOldAlias 				= ALIAS()
***
lnNodeID                = .ConvertID(cnDIR_TREE2ID,toNode.Key)
***
lcRSAliasName			= ._RSAliasName
lcRSFieldNameID			= ._RSFieldNameID
lcRSFieldNameParentFlag	= ._RSFieldNameParentFlag
*------------------------------------------------------------------------------

*18.05.2005 10:32 -&gt; Íàéäåì ïîìå÷àåìûé ýëìåíò â èñòî÷íèêå äàííûõ
SELECT (lcRSAliasName)
***
LOCATE FOR &amp;lcRSFieldNameID = lnNodeID
***
IF !FOUND()
	RETURN
ENDIF
***
llParentFlag = &amp;lcRSFieldNameParentFlag
lnTvrID      = TvrID
lnTluID      = TLUID
*-----------------------------------------------------------------------------

*05.08.2005 12:50 -&gt;Âûâîäèì ìåíþ, òîëüêî åñëè ýëåìåíò íå ÿâëÿåòñÿ êîíòåéíåðîì
IF !llParentFlag
	
	*05.08.2005 12:50 -&gt;Ñîçäàåì ìåíþ
	DEFINE POPUP treeshortcut SHORTCUT RELATIVE FROM MROW(),MCOL()
	*------------------------------------------------------------------------------
	
	*05.08.2005 14:01 -&gt;Ñîçäàåì ïóíêò ìåíþ "Ïðîñìîòð èíôîðìàöèè î òîâàðå"
	lcActionMacro = [_screen.ActiveForm.ShowTvrInfo(]+ALLTRIM(STR(lnTvrID))+[)]
	DEFINE BAR 1 OF treeshortcut PROMPT [Ïðîñìîòð èíôîðìàöèè î òîâàðå]
	ON SELECTION BAR 1 OF treeshortcut &amp;lcActionMacro
	*------------------------------------------------------------------------------
	
	*05.08.2005 14:01 -&gt;Ñîçäàåì ïóíêò ìåíþ "Ïðîñìîòð èíôîðìàöèè î èäåíòèôèêàòîðå"
	IF ThisForm.lTvrSetBindTLU	
		lcActionMacro = [_screen.ActiveForm.ShowTLUInfo(]+ALLTRIM(STR(lnTLUID))+[)]
		DEFINE BAR 2 OF treeshortcut PROMPT [Ïðîñìîòð èíôîðìàöèè î èäåíòèôèêàòîðå]
		ON SELECTION BAR 2 OF treeshortcut &amp;lcActionMacro
	ENDIF
	*------------------------------------------------------------------------------
	
	*05.08.2005 14:11 -&gt;Îòîáðàæàåì ìåíþ
	ACTIVATE POPUP treeshortcut
	*------------------------------------------------------------------------------
	
ENDIF
*------------------------------------------------------------------------------

*05.08.2005 14:12 -&gt;Âîññòàíîâèì òåêóùèé Alias
IF !EMPTY(lcOldAlias) AND USED(lcOldAlias) AND lcOldAlias#ALIAS()
	SELECT(lcOldAlias)
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
</methods>
		<objcode/>
		<ole>0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7///8EAAAA/v///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGBD8vZtgswBAwAAAEACAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAZgAAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAABPAAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAACUBAAAAAAAABAAAAAIAAAD+////BQAAAP7///8GAAAABwAAAAgAAAD+//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+i6BMHCoUbEK/AQhAQKo2nIUM0EggAAACTMwAAIyYAAI5+4eYCAAUAIgAAAH0gaWaNAQAAAQAAAAHvzasAAAUATwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABcAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgcWhqIFp0dVFoYTtqZGZuW2lhZXRyIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAACADgAAAEhpZGVTZWxlY3Rpb24ABQAAAEwAAAAADAAAAEluZGVudGF0aW9uABEAAABODQAAAAcAAAAAAAAAYOkYAAYAAAAAAAAABQAAgGTpGAABAAAAXAAf3uy9AQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALkAKAAAATGFiZWxFZGl0AAkAAABJCgAAAAEAAAAKAAAATGluZVN0eWxlAAkAAABJCgAAAAEAAAANAAAATW91c2VQb2ludGVyAAkAAABJCgAAAAAAAAAOAAAAUGF0aFNlcGFyYXRvcgAKAAAASAAAAAABAAAAXAYAAABTdHlsZQAJAAAASQoAAAAHAAAADAAAAE9MRURyYWdNb2RlAAkAAABJCgAAAAAAAAAMAAAAT0xFRHJvcE1vZGUACQAAAEkKAAAAAAAAAAsAAABBcHBlYXJhbmNlAAkAAABJCgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</ole>
		<ole2>OLEObject = C:\Windows\SysWOW64\comctl32.ocx
</ole2>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1KZ0P8OCD</uniqueid>
		<timestamp>1061450265</timestamp>
		<class>cntcancelsavehandled</class>
		<classloc>baseform_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntCancelSaveHandled</objname>
		<parent>frmmakesmt</parent>
		<properties>Top = 743
Left = 819
ZOrderSet = 6
Name = "cntCancelSaveHandled"
cmdCancel.Name = "cmdCancel"
cmdOk.Name = "cmdOk"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1A610IJYB</uniqueid>
		<timestamp>1058761160</timestamp>
		<class>grd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>grid</baseclass>
		<objname>GrdInWork</objname>
		<parent>frmmakesmt</parent>
		<properties>ColumnCount = 4
Height = 369
Left = 523
Panel = 1
RecordSource = "GrdInWork"
Top = 0
Width = 500
BackColor = 255,255,255
ZOrderSet = 7
Name = "GrdInWork"
Column1.ControlSource = "GrdInWork.TvrNM"
Column1.Width = 239
Column1.BackColor = 255,255,255
Column1.Name = "ColSmWk"
Column2.ControlSource = "GrdInWork.tvrprcbuy"
Column2.BackColor = 255,255,255
Column2.Name = "ColPrc"
Column3.ControlSource = "GrdInWork.TvrQnt"
Column3.BackColor = 255,255,255
Column3.Name = "ColQnt"
Column4.ControlSource = "GrdInWork.tvrsumbuy"
Column4.BackColor = 255,255,255
Column4.Name = "ColSum"
</properties>
		<protected/>
		<methods>PROCEDURE _prnrep
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: GRDTVRINSET._PRNREP
* Called by.......: &lt;&lt;ToolBar or Context Menu Action -&gt; .HandleMsg() -&gt; ._PrnRep()&gt;&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Âûçîâ ôîðìû äëÿ ïå÷àòè îò÷¸òà
*------------------------------------------------------------------------------

*08.08.2005 15:00 -&gt;Âûçîâåì ìåòîä ìåíåäæåðà äëÿ ïå÷àòè îò÷¸òà
oApp.ExecuteScrFormReportByID(ThisForm.nScrFrmID,[TvrSetID],ThisForm.nFrmId,.T.)
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************

ENDPROC
PROCEDURE _rsrequery
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: grdTvrInSet._RSRequery
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Îáíîâëåíèå ñïèñêà âûáðàííûõ òîâàðîâ
*------------------------------------------------------------------------------
WAIT WINDOW NOWAIT "Ïîëó÷àåì äàííûå äëÿ ðàáîòû ..."
WITH This

*11.01.2004 17:44 -&gt;Ñîõðàíèì äàííûå î RecordSource
.SourceKeep()
*------------------------------------------------------------------------------
*11.01.2004 17:46 -&gt;Îòêëþ÷èì RecordSource
.SourceReset()
*------------------------------------------------------------------------------
*11.01.2004 17:46 -&gt;Ïåðå÷èòàåì Local View
USE IN SELECT('GrdInWork')
DO smtInwork_par.qpr
*------------------------------------------------------------------------------

*11.01.2004 17:46 -&gt;Âîññòàíàâëèâàåì RecordSource
.SourceRecall()
*------------------------------------------------------------------------------

*22.07.2005 14:31 -&gt;Âîññòàíîâèì ïîçèöèþ â Grid-å
.PositionRecall()
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18I0M4ORT</uniqueid>
		<timestamp>1058759236</timestamp>
		<class>header</class>
		<classloc/>
		<baseclass>header</baseclass>
		<objname>Header1</objname>
		<parent>frmmakesmt.GrdInWork.ColSmWk</parent>
		<properties>Alignment = 2
Caption = "Ïîçèöèÿ ñìåòû ê ðàáîòå"
Name = "Header1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
This.Parent.Parent.Sort(This.Parent.Name)
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1MV0RE0B8</uniqueid>
		<timestamp>1058759236</timestamp>
		<class>textbox</class>
		<classloc/>
		<baseclass>textbox</baseclass>
		<objname>Text1</objname>
		<parent>frmmakesmt.GrdInWork.ColSmWk</parent>
		<properties>BorderStyle = 0
ControlSource = "GrdInWork.TvrNM"
Margin = 0
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "Text1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
ThisForm._DelRecToGrdInWork()
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25O11OEHM</uniqueid>
		<timestamp>1058759236</timestamp>
		<class>header</class>
		<classloc/>
		<baseclass>header</baseclass>
		<objname>Header1</objname>
		<parent>frmmakesmt.GrdInWork.ColPrc</parent>
		<properties>Alignment = 2
Caption = "Öåíà"
Name = "Header1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
This.Parent.Parent.Sort(This.Parent.Name)
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1MV0RE0B7</uniqueid>
		<timestamp>1058759236</timestamp>
		<class>textbox</class>
		<classloc/>
		<baseclass>textbox</baseclass>
		<objname>Text1</objname>
		<parent>frmmakesmt.GrdInWork.ColPrc</parent>
		<properties>BorderStyle = 0
ControlSource = "GrdInWork.tvrprcbuy"
Margin = 0
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "Text1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
ThisForm._DelRecToGrdInWork()
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2760QT4T3</uniqueid>
		<timestamp>1025986895</timestamp>
		<class>header</class>
		<classloc/>
		<baseclass>header</baseclass>
		<objname>Header1</objname>
		<parent>frmmakesmt.GrdInWork.ColQnt</parent>
		<properties>Caption = "Êîëè÷åñòâî"
Name = "Header1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18A02DMUV</uniqueid>
		<timestamp>1058759236</timestamp>
		<class>textbox</class>
		<classloc/>
		<baseclass>textbox</baseclass>
		<objname>Text1</objname>
		<parent>frmmakesmt.GrdInWork.ColQnt</parent>
		<properties>BorderStyle = 0
ControlSource = "GrdInWork.TvrQnt"
Margin = 0
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "Text1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
ThisForm._DelRecToGrdInWork()
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25P0Y3LJR</uniqueid>
		<timestamp>1025986895</timestamp>
		<class>header</class>
		<classloc/>
		<baseclass>header</baseclass>
		<objname>Header1</objname>
		<parent>frmmakesmt.GrdInWork.ColSum</parent>
		<properties>Caption = "Ñóììà"
Name = "Header1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18I0M4ORT</uniqueid>
		<timestamp>1058759236</timestamp>
		<class>textbox</class>
		<classloc/>
		<baseclass>textbox</baseclass>
		<objname>Text1</objname>
		<parent>frmmakesmt.GrdInWork.ColSum</parent>
		<properties>BorderStyle = 0
ControlSource = "GrdInWork.tvrsumbuy"
Margin = 0
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "Text1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
ThisForm._DelRecToGrdInWork()
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1A610IJYB</uniqueid>
		<timestamp>1059031286</timestamp>
		<class>grdparttvr</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>grid</baseclass>
		<objname>Grdparttvr</objname>
		<parent>frmmakesmt</parent>
		<properties>AllowRowSizing = .T.
Height = 369
Left = 0
RecordSource = "FrmPartTvrView"
Top = 0
Width = 500
ZOrderSet = 8
_columndisalist = [colUMN5,colUMN7,colUMN9,colUMN8,colUMN11]
Name = "Grdparttvr"
Column1.Header1.Caption = "Ïîçèöèÿ ñìåòû"
Column1.Header1.Name = "Header1"
Column1.Text1.ControlSource = "FrmPartTvrView.TvrNM"
Column1.Text1.Visible = .T.
Column1.Text1.Name = "Text1"
Column1.Width = 151
Column1.Visible = .T.
Column1.Name = "Column1"
Column2.Header1.Caption = "Êîëè÷åñòâî"
Column2.Header1.Name = "Header1"
Column2.Text1.Name = "Text1"
Column2.ColumnOrder = 2
Column2.Width = 89
Column2.Name = "Column2"
COLUMN3.Header1.Name = "Header1"
COLUMN3.Text1.Name = "Text1"
COLUMN3.ColumnOrder = 3
COLUMN3.Width = 65
COLUMN3.Name = "COLUMN3"
COLUMN4.Header1.Caption = "Öåíà"
COLUMN4.Header1.Name = "Header1"
COLUMN4.Text1.Name = "Text1"
COLUMN4.Width = 65
COLUMN4.Name = "COLUMN4"
COLUMN5.Header1.Name = "Header1"
COLUMN5.Text1.Visible = .T.
COLUMN5.Text1.Name = "Text1"
COLUMN5.Visible = .T.
COLUMN5.Name = "COLUMN5"
COLUMN6.Header1.Caption = "Ñóììà"
COLUMN6.Header1.Name = "Header1"
COLUMN6.Text1.Visible = .T.
COLUMN6.Text1.Name = "Text1"
COLUMN6.Name = "COLUMN6"
COLUMN7.Header1.Name = "Header1"
COLUMN7.Text1.Visible = .T.
COLUMN7.Text1.Name = "Text1"
COLUMN7.Name = "COLUMN7"
COLUMN8.Header1.Name = "Header1"
COLUMN8.Text1.Visible = .T.
COLUMN8.Text1.Name = "Text1"
COLUMN8.Name = "COLUMN8"
COLUMN9.Header1.Name = "Header1"
COLUMN9.Text1.Visible = .T.
COLUMN9.Text1.Name = "Text1"
COLUMN9.Name = "COLUMN9"
COLUMN10.Header1.Name = "Header1"
COLUMN10.Text1.Name = "Text1"
COLUMN10.Name = "COLUMN10"
COLUMN11.Header1.Name = "Header1"
COLUMN11.Text1.Visible = .T.
COLUMN11.Text1.Name = "Text1"
COLUMN11.Name = "COLUMN11"
ColTvrCalc.Header1.Name = "Header1"
ColTvrCalc.Text1.Name = "Text1"
ColTvrCalc.Name = "ColTvrCalc"
</properties>
		<protected/>
		<methods>PROCEDURE _rsrequery
LPARAMETERS	tnFrmID
WAIT WINDOW NOWAIT "Ïîëó÷àåì äàííûå äëÿ ðàáîòû ..."
DODEFAULT(tnFrmId)

ENDPROC
PROCEDURE Column1.Text1.DblClick
ThisForm._AddRecToGrdInWork()
ENDPROC
PROCEDURE COLUMN10.Text1.DblClick
ThisForm._AddRecToGrdInWork()
ENDPROC
PROCEDURE COLUMN11.Text1.DblClick
ThisForm._AddRecToGrdInWork()
ENDPROC
PROCEDURE Column2.Text1.DblClick
ThisForm._AddRecToGrdInWork()
ENDPROC
PROCEDURE COLUMN3.Text1.DblClick
ThisForm._AddRecToGrdInWork()
ENDPROC
PROCEDURE COLUMN4.Text1.DblClick
ThisForm._AddRecToGrdInWork()
ENDPROC
PROCEDURE COLUMN5.Text1.DblClick
ThisForm._AddRecToGrdInWork()
ENDPROC
PROCEDURE COLUMN6.Text1.DblClick
ThisForm._AddRecToGrdInWork()
ENDPROC
PROCEDURE COLUMN7.Text1.DblClick
ThisForm._AddRecToGrdInWork()
ENDPROC
PROCEDURE COLUMN8.Text1.DblClick
ThisForm._AddRecToGrdInWork()
ENDPROC
PROCEDURE COLUMN9.Text1.DblClick
ThisForm._AddRecToGrdInWork()
ENDPROC
PROCEDURE Init
DODEFAULT()
*!*	this.column1.DynamicBackColor = [IIF(ISNULL(FrmPartTvrView.tvridcalc),RGB(252,174,12) ,IIF(RECNO()%2 = 0,RGB(230,255,244), RGB(255,255,255)))] &amp;&amp; ïîçèöèÿ ïðèñîåäèíèíà ê ðàáîòå
*!*	this.column4.DynamicBackColor = [IIF(ISNULL(FrmPartTvrView.tvridcalc),RGB(252,174,12) ,IIF(RECNO()%2 = 0,RGB(230,255,244), RGB(255,255,255)))] &amp;&amp; ïîçèöèÿ ïðèñîåäèíèíà ê ðàáîòå

this.SetAll("dynamicbackcolor", ;
				[IIF(ISNULL(FrmPartTvrView.FrmParId) or FrmPartTvrView.FrmParId = 0 ,RGB(252,174,12) ,IIF(RECNO()%2 = 0,RGB(230,255,244), RGB(255,255,255)))], "Column")



this.colUMN5.Visible = .F.
this.colUMN7.Visible = .F.
this.colUMN9.Visible = .F.
this.colUMN8.Visible = .F.
this.colUMN11.Visible = .F.
*colUMN5,colUMN7,colUMN9,colUMN8,colUMN11
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3920PXZE7</uniqueid>
		<timestamp>1060855439</timestamp>
		<class>grd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>grid</baseclass>
		<objname>GrdWork</objname>
		<parent>frmmakesmt</parent>
		<properties>ColumnCount = 2
Height = 369
Left = 523
Panel = 1
RecordSource = "grdWork"
RecordSourceType = 1
Top = 372
Width = 500
BackColor = 255,255,255
ZOrderSet = 9
Name = "GrdWork"
Column1.ControlSource = "grdWork.WorkNM"
Column1.Width = 342
Column1.ReadOnly = .T.
Column1.BackColor = 255,255,255
Column1.Name = "ColWk"
Column2.ControlSource = "grdWork.tvrsumbuy"
Column2.Width = 126
Column2.ReadOnly = .T.
Column2.Format = "999,999,999.99"
Column2.InputMask = "999 999 999 999.99"
Column2.BackColor = 255,255,255
Column2.Name = "ColSum"
</properties>
		<protected/>
		<methods>PROCEDURE _add
*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: grdPartTvr._Add
* Called by.......: &lt;ToolBar or Context Menu Action -&gt; .HandleMsg() -&gt; .Add()&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Äîáàâëåíèå ñîäåðæàíèÿ òîâàðíîãî äîêóìåíòà
*-------------------------------------------------------

*15.07.2004 02:57 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	luResultAdding
*------------------------------------------------------------------------------


USE IN IIF(USED([lvFrmTypeObjDescInfoByFrm]),[lvFrmTypeObjDescInfoByFrm],0)
***
_PARAM = ThisForm.nFrmID
USE Basis!lvFrmTypeObjDescInfoByFrm IN 0
***
*!*	IF RECCOUNT([lvFrmTypeObjDescInfoByFrm]) # 1
*!*		ASSERT .F. MESSAGE [MGRPRIMARYDOC.FORM_EDIT: íåâîçìîæíî îïðåäåëèòü èìÿ îáúåêòà, èñïîëüçóåìîãî äëÿ ðåäàêòèðîâàíèÿ]
*!*		RETURN .F.
*!*	ENDIF	
*15.07.2004 02:57 -&gt;Âûïîëíÿåì îïåðàöèþ äîáàâëåíèÿ
DO CASE
CASE !ISNULL(lvFrmTypeObjDescInfoByFrm.FrmTypeEditObjDescDet) AND ALLTRIM(lvFrmTypeObjDescInfoByFrm.FrmTypeEditObjDescDet) &lt;&gt; []
		*09.03.2008 08:57 -&gt;Âûïîëíÿåì îïåðàöèþ äîáàâëåíèÿ ïî ïîëþ - äåñêðèïòîðó
	  luResultAdding = oApp.DoModalFormRetValObj(lvFrmTypeObjDescInfoByFrm.FrmTypeEditObjDescDet,[ADD],ThisForm.nFrmID)
OTHERWISE
luResultAdding = oMgrPD.Operate([PARTTVR],[ADD],This.nFrmID)
ENDCASE
*------------------------------------------------------------------------------
USE IN IIF(USED([lvFrmTypeObjDescInfoByFrm]),[lvFrmTypeObjDescInfoByFrm],0)

*24.09.2004 16:17 -&gt;Åñëè çàïèñü äîáàâëåíà
IF TYPE([luResultAdding])==[N] AND !EMPTY(luResultAdding)

	*24.09.2004 16:15 -&gt;Ïåðå÷èòûâàåì Alias äëÿ ïðîñìîòðà
	This._Rsrequery()    &amp;&amp;._RSRequeryOne(luResultAdding)
	*------------------------------------------------------------------------------
	
ENDIF
*------------------------------------------------------------------------------

****************************************************************************************************************
***********************************************  END OF METHOD *************************************************
****************************************************************************************************************
ENDPROC
PROCEDURE _prnrep
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: GRDTVRINSET._PRNREP
* Called by.......: &lt;&lt;ToolBar or Context Menu Action -&gt; .HandleMsg() -&gt; ._PrnRep()&gt;&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Âûçîâ ôîðìû äëÿ ïå÷àòè îò÷¸òà
*------------------------------------------------------------------------------

*08.08.2005 15:00 -&gt;Âûçîâåì ìåòîä ìåíåäæåðà äëÿ ïå÷àòè îò÷¸òà
oApp.ExecuteScrFormReportByID(ThisForm.nScrFrmID,[TvrSetID],ThisForm.nFrmId,.T.)
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************

ENDPROC
PROCEDURE _refreshrelatedobjects
ThisForm.GrdInWork._RSRequery()

ENDPROC
PROCEDURE _rsrequery
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: grdTvrInSet._RSRequery
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Îáíîâëåíèå ñïèñêà âûáðàííûõ òîâàðîâ
*------------------------------------------------------------------------------
WITH This

*11.01.2004 17:44 -&gt;Ñîõðàíèì äàííûå î RecordSource
.SourceKeep()
*------------------------------------------------------------------------------

*11.01.2004 17:46 -&gt;Îòêëþ÷èì RecordSource
.SourceReset()
*------------------------------------------------------------------------------

*11.01.2004 17:46 -&gt;Ïåðå÷èòàåì Local View
USE IN SELECT('GrdWork')
LOCAL _PARAM,lcUniqueName,lcUniqueFilePath
lcUniqueName = [_d] + SYS(2015)
lcUniqueFilePath = [tmp\] + lcUniqueName + [.DBF]

USE IN SELECT("lvGrdWork")
USE IN SELECT("lvGrdWorkNull")


_PARAM = thisform.nFrmId
*USE lvGrdWork IN 0 ALIAS GrdWork

SELECT * FROM lvGrdWork;
union all;
SELECT * FROM lvGrdWorkNull;
order by 2 ;
into TABLE (lcUniqueFilePath)
USE IN SELECT(lcUniqueName)
USE (lcUniqueFilePath) IN 0 ALIAS GrdWork

*INSERT INTO GrdWork SELECT * FROM lvGrdWorkNull
*INSERT INTO GrdWork (WorkNM) VALUES ('... Ðàáîòà åùå íå îïðåäåëåíà ...')
*DO smtwork_par.qpr
*------------------------------------------------------------------------------

*11.01.2004 17:46 -&gt;Âîññòàíàâëèâàåì RecordSource
.SourceRecall()
*------------------------------------------------------------------------------

*22.07.2005 14:31 -&gt;Âîññòàíîâèì ïîçèöèþ â Grid-å
.PositionRecall()
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3920PXZFA</uniqueid>
		<timestamp>1058759236</timestamp>
		<class>header</class>
		<classloc/>
		<baseclass>header</baseclass>
		<objname>Header1</objname>
		<parent>frmmakesmt.GrdWork.ColWk</parent>
		<properties>Alignment = 2
Caption = "Ðàáîòû"
Name = "Header1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
This.Parent.Parent.Sort(This.Parent.Name)
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3920PXZFG</uniqueid>
		<timestamp>1054502977</timestamp>
		<class>textbox</class>
		<classloc/>
		<baseclass>textbox</baseclass>
		<objname>Text1</objname>
		<parent>frmmakesmt.GrdWork.ColWk</parent>
		<properties>BorderStyle = 0
ControlSource = "grdWork.WorkNM"
Margin = 0
ReadOnly = .T.
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "Text1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3920PXZFK</uniqueid>
		<timestamp>1054499073</timestamp>
		<class>header</class>
		<classloc/>
		<baseclass>header</baseclass>
		<objname>Header1</objname>
		<parent>frmmakesmt.GrdWork.ColSum</parent>
		<properties>Caption = "Ñóììà"
Name = "Header1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3920PXZFO</uniqueid>
		<timestamp>1054502977</timestamp>
		<class>textbox</class>
		<classloc/>
		<baseclass>textbox</baseclass>
		<objname>Text1</objname>
		<parent>frmmakesmt.GrdWork.ColSum</parent>
		<properties>BorderStyle = 0
ControlSource = "grdWork.tvrsumbuy"
Margin = 0
ReadOnly = .T.
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "Text1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1A610IJYB</uniqueid>
		<timestamp>1058759790</timestamp>
		<class>cmd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>commandbutton</baseclass>
		<objname>CmdAdd</objname>
		<parent>frmmakesmt</parent>
		<properties>Top = 51
Left = 500
Height = 31
Width = 23
FontSize = 14
Caption = "&gt;"
ZOrderSet = 10
Name = "CmdAdd"
</properties>
		<protected/>
		<methods>PROCEDURE Click
ThisForm._AddRecToGrdInWork()
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18I0M4ORT</uniqueid>
		<timestamp>1058759790</timestamp>
		<class>cmd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>commandbutton</baseclass>
		<objname>CmdDele</objname>
		<parent>frmmakesmt</parent>
		<properties>Top = 82
Left = 500
Height = 31
Width = 23
FontSize = 14
Caption = "&lt;"
ZOrderSet = 11
Name = "CmdDele"
</properties>
		<protected/>
		<methods>PROCEDURE Click
IF RECCOUNT('GrdInWork')=0
RETURN
ENDIF

ThisForm._DelRecToGrdInWork()
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3920R93YY</uniqueid>
		<timestamp>1060677309</timestamp>
		<class>cmd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>commandbutton</baseclass>
		<objname>CmdAddAll</objname>
		<parent>frmmakesmt</parent>
		<properties>Top = 20
Left = 500
Height = 31
Width = 23
FontBold = .T.
FontSize = 12
Caption = "&gt;&gt;"
ZOrderSet = 12
Name = "CmdAddAll"
</properties>
		<protected/>
		<methods>PROCEDURE Click
IF ISNULL(grdWork.PartTvrId)
RETURN
ENDIF
IF MESSAGEBOX('Ïåðåíåñòè Âñå íåðàñïðåäåëåííûå '+CHR(13)+ 'ñòðîêè ñìåòû?',4+64+256,'Ðàáîòà ñ íåñêîëüêèìè çàïèñÿìè ...')=7
	RETURN
ENDIF
LOCAL nRecnoFrmparttvrview
nRecnoFrmparttvrview = RECNO('Frmparttvrview')

SELECT Frmparttvrview
SCAN ALL FOR (ISNULL(Frmparttvrview.FrmParId) OR Frmparttvrview.FrmParId = 0)
	WAIT WINDOW 'Äîáàâëÿåì ïîçèöèþ ...' + CHR(13)+SUBSTR(ALLTRIM(Frmparttvrview.TvrNm),1,120) NOWAIT
	ThisForm._AddRecToGrdInWork()
ENDSCAN
WAIT CLEAR
GO nRecnoFrmparttvrview IN Frmparttvrview

thisform.GrdInWork.Refresh()

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3920R93Z3</uniqueid>
		<timestamp>1060678084</timestamp>
		<class>cmd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>commandbutton</baseclass>
		<objname>CmdDeleAll</objname>
		<parent>frmmakesmt</parent>
		<properties>Top = 113
Left = 500
Height = 31
Width = 23
FontBold = .T.
FontSize = 12
Caption = "&lt;&lt;"
ZOrderSet = 13
Name = "CmdDeleAll"
</properties>
		<protected/>
		<methods>PROCEDURE Click
IF RECCOUNT('GrdInWork')=0
	RETURN
ENDIF
IF MESSAGEBOX('Óáðàòü ñ ýòîé ðàáîòû '+CHR(13)+ 'âñå ñòðîêè ñìåòû?',4+64+256,'Ðàáîòà ñ íåñêîëüêèìè çàïèñÿìè ...')=7
	RETURN
ENDIF
LOCAL nRecnoGrdWork
	
thisform.grdInWork._rsrequery()

SELECT GrdInWork
GO TOP
SCAN ALL
	nRecnoGrdWork = RECNO('GrdInWork')
	WAIT WINDOW 'Îòìåíÿåì ïîçèöèþ ...' + CHR(13)+SUBSTR(ALLTRIM(GrdInWork.TvrNm),1,120) NOWAIT
	ThisForm._DelRecToGrdInWork()
	SELECT GrdInWork
	GO nRecnoGrdWork
ENDSCAN
WAIT CLEAR

GO TOP IN GrdInWork

thisform.GrdInWork.Refresh()

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_39513Z864</uniqueid>
		<timestamp>1061450265</timestamp>
		<class>splitter2</class>
		<classloc>splitter.vcx</classloc>
		<baseclass>shape</baseclass>
		<objname>Splitter2</objname>
		<parent>frmmakesmt</parent>
		<properties>Top = 369
Left = 0
Height = 3
Width = 1024
ZOrderSet = 14
Name = "Splitter2"
</properties>
		<protected/>
		<methods>PROCEDURE split
LOCAL nTop, nHeight
WITH ThisForm
		* up down resize/reposition
		.Grdparttvr.Height = .Splitter2.Top-1
		.GrdInWork.Height  = .Splitter2.Top-1
		nHeight=.Height- .Splitter2.Top-28
		nTop=.Splitter2.Top+.Splitter2.Height+1

		.GrdWork.Height  = nHeight
		.GrdWork.Top= nTop
		.OleSelTreeView.Height  = nHeight
		.OleSelTreeView.Top= nTop
		
*!*			.Splitter2.Top = 0
*!*			.Splitter2.Height = thisform.Height - 25
ENDWITH

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>frmmakesmt</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
Arial, 0, 14, 8, 23, 18, 51, 4, 1
Arial, 1, 12, 8, 20, 15, 42, 4, 1
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1></reserved1>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_17W0TTK68</uniqueid>
		<timestamp>1061729947</timestamp>
		<class>frmview</class>
		<classloc>baseform_v1.vcx</classloc>
		<baseclass>form</baseclass>
		<objname>frmdepend</objname>
		<parent/>
		<properties>DataSession = 1
Height = 757
Width = 1152
DoCreate = .T.
AutoCenter = .T.
Caption = "Èñòîðèÿ çàïèñè"
MinButton = .F.
uretval = 0
npartfrmid = 0
_allowsaveandrestorelayout = .T.
Name = "frmdepend"
cstmsghandler.Name = "cstmsghandler"
cstresizable.Name = "cstresizable"
Img1.ZOrderSet = 1
Img1.Name = "Img1"
</properties>
		<protected/>
		<methods>PROCEDURE Init
LPARAMETERS PartFrmId
DODEFAULT()
this.nPartfrmid = PartFrmId
this.grdpartres.LoadRs()
this.exOrgChart._loadRs()

ENDPROC
PROCEDURE Unload
LOCAL lfilename
lfilename = DBF([tmpHist])
USE IN SELECT([tmpHist])
ERASE (lfilename)

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>3</reserved2>
		<reserved3>uretval
npartfrmid êîä ñòðîêè ñ òîâàðîì ïî êîòîðîé íàäî ïîñòðîèòü èñòîðèþ
*_handlecntcancelsaveevent 
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7>ïîêàçûâàåò ñâÿçè äëÿ ñòðîêè èç FrmPartTvr</reserved7>
		<reserved8>..\include\qryparparobjtypes.h</reserved8>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3AX1020D8</uniqueid>
		<timestamp>1061729947</timestamp>
		<class>exgrid</class>
		<classloc>gannt.vcx</classloc>
		<baseclass>olecontrol</baseclass>
		<objname>Grdpartres</objname>
		<parent>frmdepend</parent>
		<properties>Top = 0
Left = 0
Height = 205
Width = 1152
ZOrderSet = 2
_handledstandartmsglist = FIRST;PREV;NEXT;LAST;;ADD;EDIT;INFO;DELE
_handledstandartmsgpromptlist = ;;;;;Äîáàâèòü;Ðåäàêòèðîâàòü;Ïðîñìîòð;Óäàëèòü
_handledcustommsgpromptlist = 
_handledcustommsglist = 
Name = "Grdpartres"
</properties>
		<protected/>
		<methods>PROCEDURE _add
*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: grdPartTvr._Add
* Called by.......: &lt;ToolBar or Context Menu Action -&gt; .HandleMsg() -&gt; .Add()&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Äîáàâëåíèå ñîäåðæàíèÿ òîâàðíîãî äîêóìåíòà
*-------------------------------------------------------
LOCAL cFlParentSmt, lcUniqueFilePath
cFlParentSmt = [_d] + SYS(2015)
lcUniqueFilePath = [tmp\] + cFlParentSmt + [.DBF]

SELECT ALLTRIM(NVL(tmpHist.Tvrnm,''))+' ' +ALLTRIM(NVL(tmpHist.FrmNote,'')) as TvrNm , tmpHist.FrmPartTvr;
FROM tmpHist ;
order by 1 ;
INTO TABLE (lcUniqueFilePath)

USE IN SELECT(cFlParentSmt)

*15.07.2004 02:57 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	luResultAdding
*------------------------------------------------------------------------------


USE IN SELECT([lvFrmTypeObjDescInfoByFrm])
***
_PARAM = This.nFrmID
USE Basis!lvFrmTypeObjDescInfoByFrm IN 0
***
*!*	IF RECCOUNT([lvFrmTypeObjDescInfoByFrm]) # 1
*!*		ASSERT .F. MESSAGE [MGRPRIMARYDOC.FORM_EDIT: íåâîçìîæíî îïðåäåëèòü èìÿ îáúåêòà, èñïîëüçóåìîãî äëÿ ðåäàêòèðîâàíèÿ]
*!*		RETURN .F.
*!*	ENDIF	
*15.07.2004 02:57 -&gt;Âûïîëíÿåì îïåðàöèþ äîáàâëåíèÿ
DO CASE
CASE !ISNULL(lvFrmTypeObjDescInfoByFrm.FrmTypeEditObjDescDet) AND ALLTRIM(lvFrmTypeObjDescInfoByFrm.FrmTypeEditObjDescDet) &lt;&gt; []
		*09.03.2008 08:57 -&gt;Âûïîëíÿåì îïåðàöèþ äîáàâëåíèÿ ïî ïîëþ - äåñêðèïòîðó
	  luResultAdding = oApp.DoModalFormRetValObj(lvFrmTypeObjDescInfoByFrm.FrmTypeEditObjDescDet,[ADD],This.nFrmID,cFlParentSmt)
CASE PrimaryDocView.FrmTypeId = 21
luResultAdding = oMgrPD.Operate([PARTMNU],[ADD],This.nFrmID,cFlParentSmt)
CASE PrimaryDocView.FrmTypeId = 19
luResultAdding = oMgrPD.Operate([PARTCLC],[ADD],This.nFrmID,cFlParentSmt)
CASE PrimaryDocView.FrmTypeId = 0
luResultAdding = oMgrPD.Operate([PARTTVR],[ADD],This.nFrmID,cFlParentSmt)
OTHERWISE
luResultAdding = oMgrPD.Operate([PARTTVR],[ADD],This.nFrmID,cFlParentSmt)
ENDCASE
*------------------------------------------------------------------------------
USE IN SELECT([lvFrmTypeObjDescInfoByFrm])

*24.09.2004 16:17 -&gt;Åñëè çàïèñü äîáàâëåíà
IF TYPE([luResultAdding])==[N] AND !EMPTY(luResultAdding)
	*24.09.2004 16:15 -&gt;Ïåðå÷èòûâàåì Alias äëÿ ïðîñìîòðà
	This._RSRequeryOne(luResultAdding)
	*------------------------------------------------------------------------------
ENDIF
*------------------------------------------------------------------------------

****************************************************************************************************************
***********************************************  END OF METHOD *************************************************
****************************************************************************************************************
ENDPROC
PROCEDURE _addchild
LPARAMETERS lnDefItem,mFrmPartTvrID
LOCAL lDefItem ,lFrmPartTvrID,lnRecNo

SCAN ALL FOR  tmpHist.FrmParId = mFrmPartTvrID
	** äîáàâëÿåì äî÷åðíèå çàïèñè
	with this.Items
	 .DefaultItem = .InsertItem( lnDefItem , "", ALLTRIM(tmpHist.Tvrnm))  &amp;&amp; Íàçâàíèå
	     .CellValue(.DefaultItem , 1) = ALLTRIM(tmpHist.MsuNM)			&amp;&amp; åä èçìåð
	     .CellValue(.DefaultItem , 2) = TRANSFORM(tmpHist.TvrPrcSale,[99999999.9999]) 	&amp;&amp; öåíà
	     .CellValue(.DefaultItem , 3) = TRANSFORM(tmpHist.TvrQnt,[99999999.9999])			&amp;&amp; êîëè÷
	     .CellValue(.DefaultItem , 4) = TRANSFORM(ROUND(tmpHist.TvrQnt*tmpHist.TvrPrcSale,4),[99999999.9999])	&amp;&amp; ñóììà
	     .CellValue(.DefaultItem , 6) = TTOD(tmpHist.UseStart)	&amp;&amp; íà÷àëî
	     .CellValue(.DefaultItem , 7) = TTOD(tmpHist.UseEnd)		&amp;&amp; êîíåö
	     .CellValue(.DefaultItem , 8) = ALLTRIM(tmpHist.ShortNM)	+ ' îò '+ DTOC(tmpHist.FrmDate)			&amp;&amp; äîêóìåíò
	     .CellValue(.DefaultItem , 9) = ALLTRIM(tmpHist.FrmNote)				&amp;&amp; îïèñàíèå
	     replace NEXT 1 _idTmp WITH .DefaultItem IN tmpHist
	     this.lFirst = .f.
	     lDefItem = .DefaultItem
	     lFrmPartTvrID = tmpHist.FrmPartTvr
		 ** äîáàâëÿåì äî÷åðíèå çàïèñè
		 lnRecNo = RECNO('tmpHist')
		 ** BITTEST(tmpHist.TypeRes,7) &amp;&amp;
		 DO case
		 	CASE tmpHist.TypeRes = 5 &amp;&amp; ïîçèöèÿ ñìåòû
			 	.CellValue(lnDefItem,2) = TRANSFORM(VAL(.CellValue(lnDefItem,4))+ROUND(tmpHist.TvrQnt*tmpHist.TvrPrcSale,4),[99999999.9999])
			 	.CellValue(lnDefItem,3) = TRANSFORM(1,[99999999.9999])
			 	.CellValue(lnDefItem,4) = TRANSFORM(VAL(.CellValue(lnDefItem,4))+ROUND(tmpHist.TvrQnt*tmpHist.TvrPrcSale,4),[99999999.9999])
	   		 	.CellBold(lnDefItem,1) = .t.
	   		 	.CellBold(lnDefItem,2) = .t.
	   		 	.CellBold(lnDefItem,3) = .t.
	   		 	.CellBold(lnDefItem,4) = .t.
	   		 	.CellBold(lnDefItem,5) = .t.
	   		 	.CellBold(lnDefItem,6) = .t.
	   		 	.CellBold(lnDefItem,7) = .t.
	   		 	.CellBold(lnDefItem,8) = .t.
	   		 	.CellBold(lnDefItem,9) = .t.
				.CellBackColor(lDefItem,0) = RGB(255,128,255)
				.CellBackColor(lDefItem,1) = RGB(255,128,255)
				.CellBackColor(lDefItem,02) = RGB(255,128,255)
				.CellBackColor(lDefItem,03) = RGB(255,128,255)
				.CellBackColor(lDefItem,04) = RGB(255,128,255)
				.CellBackColor(lDefItem,05) = RGB(255,128,255)
				.CellBackColor(lDefItem,06) = RGB(255,128,255)
				.CellBackColor(lDefItem,07) = RGB(255,128,255)
				.CellBackColor(lDefItem,08) = RGB(255,128,255)
				.CellBackColor(lDefItem,09) = RGB(255,128,255)
	   			.CellValue(lDefItem , 5) = 'ïîçèöèÿ ñìåòû'		
		 	CASE tmpHist.TypeRes = 6	&amp;&amp; òðóäîâûå ðåñóðñû çåëåíûé
		 		.CellBackColor(lDefItem,0) = RGB(128,255,0)
		 		.CellBackColor(lDefItem,1) = RGB(128,255,0)
		 		.CellBackColor(lDefItem,2) = RGB(128,255,0)
		 		.CellBackColor(lDefItem,3) = RGB(128,255,0)
		 		.CellBackColor(lDefItem,4) = RGB(128,255,0)
		 		.CellBackColor(lDefItem,5) = RGB(128,255,0)
		 		.CellBackColor(lDefItem,6) = RGB(128,255,0)
		 		.CellBackColor(lDefItem,7) = RGB(128,255,0)
		 		.CellBackColor(lDefItem,8) = RGB(128,255,0)
		 		.CellBackColor(lDefItem,9) = RGB(128,255,0)
	   			.CellValue(lDefItem , 5) = 'òðóä'		
		 	CASE tmpHist.TypeRes = 7	&amp;&amp; ìåõàíèçìû
		 		.CellBackColor(lDefItem,0) = RGB(255,128,0)
		 		.CellBackColor(lDefItem,1) = RGB(255,128,0)
		 		.CellBackColor(lDefItem,2) = RGB(255,128,0)
		 		.CellBackColor(lDefItem,3) = RGB(255,128,0)
		 		.CellBackColor(lDefItem,4) = RGB(255,128,0)
		 		.CellBackColor(lDefItem,5) = RGB(255,128,0)
		 		.CellBackColor(lDefItem,6) = RGB(255,128,0)
		 		.CellBackColor(lDefItem,7) = RGB(255,128,0)
		 		.CellBackColor(lDefItem,8) = RGB(255,128,0)
		 		.CellBackColor(lDefItem,9) = RGB(255,128,0)
	   			.CellValue(lDefItem , 5) = 'ìåõàíèçìû'		
		 	CASE tmpHist.TypeRes = 8	&amp;&amp; ìàòåðèàëû æåëòûé
		 		.CellBackColor(lDefItem,0) = RGB(255,255,128)
		 		.CellBackColor(lDefItem,1) = RGB(255,255,128)
		 		.CellBackColor(lDefItem,2) = RGB(255,255,128)
		 		.CellBackColor(lDefItem,3) = RGB(255,255,128)
		 		.CellBackColor(lDefItem,4) = RGB(255,255,128)
		 		.CellBackColor(lDefItem,5) = RGB(255,255,128)
		 		.CellBackColor(lDefItem,6) = RGB(255,255,128)
		 		.CellBackColor(lDefItem,7) = RGB(255,255,128)
		 		.CellBackColor(lDefItem,8) = RGB(255,255,128)
		 		.CellBackColor(lDefItem,9) = RGB(255,255,128)
	   			.CellValue(lDefItem , 5) = 'ìàòåðèàëû'		
		 	CASE tmpHist.TypeRes = 9	&amp;&amp; ðàáîòû óêðóïíåííî
*!*			 		.CellBackColor(lDefItem,0) = RGB(255,255,255)
*!*			 		.CellBackColor(lDefItem,1) = RGB(255,255,255)
*!*			 		.CellBackColor(lDefItem,2) = RGB(255,255,255)
*!*			 		.CellBackColor(lDefItem,3) = RGB(255,255,255)
*!*			 		.CellBackColor(lDefItem,4) = RGB(255,255,255)
*!*			 		.CellBackColor(lDefItem,5) = RGB(255,255,255)
*!*			 	OTHERWISE
*!*			 		.CellBackColor(lDefItem,0) = RGB(255,255,255)
*!*			 		.CellBackColor(lDefItem,1) = RGB(255,255,255)
*!*			 		.CellBackColor(lDefItem,2) = RGB(255,255,255)
*!*			 		.CellBackColor(lDefItem,3) = RGB(255,255,255)
*!*			 		.CellBackColor(lDefItem,4) = RGB(255,255,255)
*!*			 		.CellBackColor(lDefItem,5) = RGB(255,255,255)
		 ENDCASE
		 this._addChild(lDefItem,lFrmPartTvrID)
	 GO lnRecNo
	ENDWITH
ENDSCAN

ENDPROC
PROCEDURE _addparent
with this.Items
*	    .DefaultItem = .AddItem( IIF(BITTEST(tmpHist.TvrAttr,9),ALLTRIM(tmpHist.Tvrnm),'- '+ALLTRIM(tmpHist.Tvrnm)))
	    .DefaultItem = .AddItem( ALLTRIM(tmpHist.Tvrnm))
	.CellBold(.DefaultItem) = BITTEST(tmpHist.TvrAttr,9) &amp;&amp;this.lFirst
	  *  .CellValue(.DefaultItem , 1) = ALLTRIM(tmpHist.ResNM)			&amp;&amp; ðàáîòà
	    .CellValue(.DefaultItem , 1) = ALLTRIM(tmpHist.MsuNM)			&amp;&amp; åä èçìåð
	    .CellValue(.DefaultItem , 2) = TRANSFORM(tmpHist.TvrPrcSale,[99999999.9999]) 	&amp;&amp; öåíà   TRANSFORM(myCursor.col1,'9999.99' )
	    .CellValue(.DefaultItem , 3) = TRANSFORM(tmpHist.TvrQnt,[99999999.9999])			&amp;&amp; êîëè÷
	    .CellValue(.DefaultItem , 4) = TRANSFORM(ROUND(tmpHist.TvrQnt*tmpHist.TvrPrcSale,4),[99999999.9999])	&amp;&amp; ñóììà
	    .CellValue(.DefaultItem , 6) = TTOD(tmpHist.UseStart)	&amp;&amp; íà÷àëî
	    .CellValue(.DefaultItem , 7) = TTOD(tmpHist.UseEnd)		&amp;&amp; êîíåö
	    .CellValue(.DefaultItem , 8) = ALLTRIM(tmpHist.ShortNM)	+ ' îò '+ DTOC(tmpHist.FrmDate)			&amp;&amp; äîêóìåíò
	    .CellValue(.DefaultItem , 9) = ALLTRIM(tmpHist.FrmNote)				&amp;&amp; îïèñàíèå
	   * .CellValue(.DefaultItem , 6) = tmpHist.TypeRes				&amp;&amp; òèï çàïèñè
	    replace NEXT 1 _idTmp WITH .DefaultItem IN tmpHist
	    this.lFirst = .t.
ENDWITH
ENDPROC
PROCEDURE _dele
*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: grdPartFrm._Dele
* Called by.......: &lt;ToolBar or Context Menu Action -&gt; .HandleMsg() -&gt; .Dele()&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Óäàëåíèå ñîäåðæàíèÿ òîâàðíîãî äîêóìåíòà
*-------------------------------------------------------

*15.07.2004 02:57 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnFrmPartTvrID, ;
		luDeleRes
***
lnFrmPartTvrID = this.nPartID
*------------------------------------------------------------------------------
LOCAL cFlParentSmt, lcUniqueFilePath
cFlParentSmt = [_d] + SYS(2015)
lcUniqueFilePath = [tmp\] + cFlParentSmt + [.DBF]

SELECT ALLTRIM(NVL(tmpHist.Tvrnm,''))+' ' +ALLTRIM(NVL(tmpHist.FrmNote,'')) as TvrNm , tmpHist.FrmPartTvr;
FROM tmpHist ;
order by 1 ;
INTO TABLE (lcUniqueFilePath)

USE IN SELECT(cFlParentSmt)

USE IN SELECT([lvFrmTypeObjDescInfoByFrm])
***
_PARAM = This.nFrmID
USE Basis!lvFrmTypeObjDescInfoByFrm IN 0
***
IF RECCOUNT([lvFrmTypeObjDescInfoByFrm]) # 1
	ASSERT .F. MESSAGE [MGRPRIMARYDOC.FORM_EDIT: íåâîçìîæíî îïðåäåëèòü èìÿ îáúåêòà, èñïîëüçóåìîãî äëÿ ðåäàêòèðîâàíèÿ]
	RETURN .F.
ENDIF	

*15.07.2004 02:57 -&gt;Âûïîëíÿåì îïåðàöèþ äîáàâëåíèÿ
DO CASE
CASE !ISNULL(lvFrmTypeObjDescInfoByFrm.FrmTypeEditObjDescDet) AND ALLTRIM(lvFrmTypeObjDescInfoByFrm.FrmTypeEditObjDescDet) &lt;&gt; []
		*09.03.2008 08:57 -&gt;Âûïîëíÿåì îïåðàöèþ óäàëåíèÿ ïî ïîëþ - äåñêðèïòîðó
	luDeleRes = oApp.DoModalFormRetValObj(lvFrmTypeObjDescInfoByFrm.FrmTypeEditObjDescDet,[DELE],lnFrmPartTvrID,cFlParentSmt)
	OTHERWISE
		*15.07.2004 02:57 -&gt;Âûïîëíÿåì îïåðàöèþ óäàëåíèÿ
		luDeleRes = oMgrPD.Operate([PARTTVR],[DELE],lnFrmPartTvrID)
ENDCASE luDeleRes
*------------------------------------------------------------------------------
USE IN SELECT([lvFrmTypeObjDescInfoByFrm])

*24.09.2004 16:17 -&gt;Åñëè çàïèñü óäàëåíà
IF TYPE([luDeleRes])==[L] AND luDeleRes

	*24.09.2004 16:15 -&gt;Ïåðå÷èòûâàåì Alias äëÿ ïðîñìîòðà
	This._RSRequeryOne(lnFrmPartTvrID)
	*------------------------------------------------------------------------------

ENDIF
*------------------------------------------------------------------------------

****************************************************************************************************************
***********************************************  END OF METHOD *************************************************
****************************************************************************************************************
ENDPROC
PROCEDURE _edit
*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: grdPartTvr._Edit
* Called by.......: &lt;ToolBar or Context Menu Action -&gt; .HandleMsg() -&gt; .Edit()&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Ðåäàêòèðîâàíèå ñîäåðæàíèÿ òîâàðíîãî äîêóìåíòà
*-------------------------------------------------------
LOCAL cFlParentSmt, lcUniqueFilePath
cFlParentSmt = [_d] + SYS(2015)
lcUniqueFilePath = [tmp\] + cFlParentSmt + [.DBF]

SELECT ALLTRIM(NVL(tmpHist.Tvrnm,''))+' ' +ALLTRIM(NVL(tmpHist.FrmNote,'')) as TvrNm , tmpHist.FrmPartTvr;
FROM tmpHist ;
order by 1 ;
INTO TABLE (lcUniqueFilePath)

USE IN SELECT(cFlParentSmt)

*19.10.2004 13:44 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnFrmPartTvrID, ;
		luEditRes
***
lnFrmPartTvrID = this.nPartID
*------------------------------------------------------------------------------
USE IN SELECT([lvFrmTypeObjDescInfoByFrm])
***
_PARAM = This.nFrmID
USE Basis!lvFrmTypeObjDescInfoByFrm IN 0
***
IF RECCOUNT([lvFrmTypeObjDescInfoByFrm]) # 1
	ASSERT .F. MESSAGE [MGRPRIMARYDOC.FORM_EDIT: íåâîçìîæíî îïðåäåëèòü èìÿ îáúåêòà, èñïîëüçóåìîãî äëÿ ðåäàêòèðîâàíèÿ]
	RETURN .F.
ENDIF	
*15.07.2004 02:57 -&gt;Âûïîëíÿåì îïåðàöèþ ðåàäêòèðîâàíèÿ
DO CASE
CASE !ISNULL(lvFrmTypeObjDescInfoByFrm.FrmTypeEditObjDescDet) AND ALLTRIM(lvFrmTypeObjDescInfoByFrm.FrmTypeEditObjDescDet) &lt;&gt; []
		*09.03.2008 08:57 -&gt;Âûïîëíÿåì îïåðàöèþ ðåàäêòèðîâàíèÿ ïî ïîëþ - äåñêðèïòîðó
	luEditRes = oApp.DoModalFormRetValObj(lvFrmTypeObjDescInfoByFrm.FrmTypeEditObjDescDet,[EDIT],lnFrmPartTvrID,cFlParentSmt)
CASE PrimaryDocView.FrmTypeId = 21
luEditRes = oMgrPD.Operate([PARTMNU],[EDIT],lnFrmPartTvrID,cFlParentSmt)
CASE PrimaryDocView.FrmTypeId = 19
luEditRes = oMgrPD.Operate([PARTCLC],[EDIT],lnFrmPartTvrID,cFlParentSmt)
CASE PrimaryDocView.FrmTypeId = 0
luEditRes = oMgrPD.Operate([PARTTVR],[EDIT],lnFrmPartTvrID,cFlParentSmt)
OTHERWISE
luEditRes = oMgrPD.Operate([PARTTVR],[EDIT],lnFrmPartTvrID,cFlParentSmt)
ENDCASE
*------------------------------------------------------------------------------
USE IN SELECT([lvFrmTypeObjDescInfoByFrm])

*19.10.2004 13:45 -&gt;Åñëè çàïèñü îòðåäàêòèðîâàëè
IF TYPE([luEditRes])==[L] AND luEditRes

	*24.09.2004 16:15 -&gt;Ïåðå÷èòûâàåì Alias äëÿ ïðîñìîòðà
	This._RSRequeryOne(lnFrmPartTvrID)
	*------------------------------------------------------------------------------
	
ENDIF
*------------------------------------------------------------------------------

****************************************************************************************************************
***********************************************  END OF METHOD *************************************************
****************************************************************************************************************
ENDPROC
PROCEDURE _rsrequery
*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: grdPartTvr._RSRequery
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;tnFrmID&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Ïåðå÷èòûâàíèå ñîäåðæèìîãî äîêóìåíòà
*-------------------------------------------------------
LPARAMETERS	tnFrmID


USE IN SELECT('tmpHist')
*21.04.2004 14:34 -&gt;Çàêðîåì Alias è óäàëèì âðåìåííóþ òàáëèöó
lcUniqueFilePath = [tmp\]+thisform.cUniqueNameRes + [.dbf]
***
*this.ors.Close()   &amp;&amp;(lcUseTable,this.oConn,1,3,1)
*this.oRs = null
IF FILE(lcUniqueFilePath)
	ERASE (lcUniqueFilePath)
ENDIF
*------------------------------------------------------------------------------
WITH ThisForm
*05.05.2004 01:35 -&gt;Ïåðå÷èòàåì Alias
IF TYPE([tnFrmID])==[N] AND !EMPTY(tnFrmID)
	*02.12.2004 16:48 -&gt;Ñîõðàíèì èäåíòèôèêàòîð äîêóìåíòà â ñâîéñòâå Grid-à
*	thisform.nFrmID = tnFrmID
	*------------------------------------------------------------------------------
	*21.04.2004 14:05 -&gt;Âûïîëíèì õðàíèìóþ ïðîöåäóðó äëÿ ïîëó÷åíèÿ äàííûõ
	thisform.cUniqueNameRes = spFrmPartTvrJrnView([BYFRMID],tnFrmID)
	*------------------------------------------------------------------------------
ELSE
	*02.12.2004 16:48 -&gt;Ñîõðàíèì èäåíòèôèêàòîð äîêóìåíòà â ñâîéñòâå Grid-à
*	thisform.nFrmID = 0
	*------------------------------------------------------------------------------

	*21.04.2004 14:05 -&gt;Âûïîëíèì õðàíèìóþ ïðîöåäóðó äëÿ ïîëó÷åíèÿ òàáëèöû
	thisform.cUniqueNameRes = spFrmPartTvrJrnView([NODATA])
	*------------------------------------------------------------------------------
ENDIF	
*------------------------------------------------------------------------------
this.Visible = .f.
this.LoadRs(thisform.cUniqueNameRes)
this.Visible = .t.

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE _rsrequeryone
LPARAMETERS lnPartTvrId
LOCAL lFileSmt,lnItem
lFileSmt = spFrmPartTvrJrnView([BYFRMPARTTVRID],lnPartTvrId)
*SET STEP ON
SELECT tmpHist
LOCATE ALL FOR tmpHist.FrmPartTvr = lnPartTvrId
IF FOUND()
	lnItem = tmpHist._idTmp
	DELETE FROM tmpHist WHERE tmpHist.FrmPartTvr = lnPartTvrId
	this.Items.RemoveItem(lnItem)
ENDIF
APPEND FROM (lFileSmt)
SELECT tmpHist
LOCATE ALL FOR tmpHist.FrmPartTvr = lnPartTvrId
IF FOUND()
	this._addParent()
ENDIF
USE IN SELECT('insSmt')
lFileSmt = 'tmp\'+lFileSmt +'.dbf'
IF FILE(lFileSmt)
	ERASE (lFileSmt)
ENDIF
this.SetFocus()
this.Items.SelectItem(this.Items.DefaultItem)


ENDPROC
PROCEDURE colshow

FOR nCol= 0 TO (This.Object.Columns.Count -1)
	This.Object.Columns.Item(nCol).Visible = .F.
ENDFOR

*!*	This.Object.Columns.Item(1).Visible = .F.
*!*	This.Object.Columns.Item(2).Visible = .F.
	This.Object.Columns.Item('resnm').Visible = .t.
	This.Object.Columns.Item('resnm').Caption = 'Ðàáîòà'
	*This.Object.Columns.Item('resnm').Width = 75

	This.Object.Columns.Item('tvrnm').Visible = .t.
	This.Object.Columns.Item('tvrnm').Caption = 'Ïîçèöèÿ ñìåòû'
	*This.Object.Columns.Item('tvrnm').Width = 75

	This.Object.Columns.Item('msushortnm').Visible = .t.
	This.Object.Columns.Item('msushortnm').Caption = 'Åä. èçì.'
	*This.Object.Columns.Item('msushortnm').Width = 75

	This.Object.Columns.Item('tvrprcbuy').Visible = .t.
	This.Object.Columns.Item('tvrprcbuy').Caption = 'Ö. ñìåò.'
	*This.Object.Columns.Item('tvrprcbuy').Width = 75

	This.Object.Columns.Item('tvrsumbuy').Visible = .t.
	This.Object.Columns.Item('tvrsumbuy').Caption = 'Ñóììà ñìåò.'
	*This.Object.Columns.Item('tvrsumbuy').Width = 75
*!*	this.SetAll("dynamicbackcolor", ;
*!*				"IIF(RECNO()%2 = 0,RGB(255,255,0), RGB(255,255,255))", "Column")
	*!*	 	with .Columns
	*!*	*!*			.Item("Start").LevelKey = "L1"
	*!*	*!*			.Item("End").LevelKey = "L1"
	*!*	*!*			.Item("Start").Caption = "Hà÷àëî"
	*!*	*!*			.Item("End").Visible = .f.
	*!*			.Item("start").LevelKey = "L1"
	*!*			.Item("end").LevelKey = "L1"
	*!*			.Item("start").Caption = "Hà÷àëî"
	*!*			*.Item("end").Visible = .f.
	*!*		endwith

ENDPROC
PROCEDURE FilterChange
*** ActiveX Control Event ***
DODEFAULT()
this.ExpandAllFiltred()
ENDPROC
PROCEDURE Init
DODEFAULT()
WITH this
	.BeginUpdate()
*!*		with .ConditionalFormats.Add("%3&gt;0")
*!*			.Bold = .t.
*!*			.foreColor=RGB(0,0,200)
*!*			.ApplyTo = -1
*!*		endwith
	.rClickSelect = .T.
	WITH .Columns.Add('Ðàáîòà \- Ïîçèöèÿ ñìåòû \- ðåñóðñû')
		.Alignment = 0
		.Width  = 250
	ENDWITH

*!*		WITH .Columns.Add('Ðàáîòà')
*!*			.Alignment = 0
*!*			.Width  = 100
*!*		ENDWITH

	WITH .Columns.Add("Åä.èçìåð")
		.Width  = 30
		.Alignment = 0
	ENDWITH
	With .Columns.Add("Öåíà")
		.Width  = 60
		.Alignment = 2
	ENDWITH
	WITH .Columns.Add("Êîëè÷")
		.Width  = 60
		.Alignment = 2
	ENDWITH
*!*		with .Columns.Item(3).Editor
*!*		*	.EditType = 4  &amp;&amp; Ñïèíåð
*!*		*	.EditType = 21 &amp;&amp; êàëüêóëÿòîð
*!*			.EditType = 8
*!*			.Mask = "#######.###"
*!*			*.Option(46) = 46
*!*		endwith	
	WITH .Columns.Add("Ñóììà")
		.Width  = 70
		.Alignment = 2
		*.ComputedField = "%2 * %3"
	ENDWITH
	***this.Items.CellValueFormat(4) = 0
	WITH .Columns.Add("Òèï ðåñóðñà")
		.Width  = 50
		* ïî÷åìó - òî íå ðàáîòàåò" .FilterBarCaption = 'Îòìå÷àåì, ñ êàêèì òèïîì ðåñóðñîâ íàäî ðàáîòàòü'
		.DisplayFilterButton = .t.
		.FilterBarDropDownWidth = -150
		.FilterOnType = .f.
	ENDWITH
	WITH .Columns.Add("Íà÷àëî")
		.Width  = 45
		.SortType = 3
		.DisplayFilterButton = .T.
		.DisplayFilterDate = .T.
		.FilterBarDropDownWidth = -250
*!*			.FilterType = 2
	ENDWITH
	WITH .Columns.Add("Êîíåö")
		.Width  = 45
		.SortType = 3
		.DisplayFilterButton = .T.
		.DisplayFilterDate = .T.
		.FilterBarDropDownWidth = -250
*!*			.FilterType = 2
	ENDWITH
	.Columns.Add("Äîêóìåíò").Width  = 60
	.Columns.Add("Ïðèìå÷åíèå").Width  = 60
	.Font.Size = 10

	.EndUpdate()
	.FilterBarHeight =0
	.expandOnSearch = .t.
	.Indent = 25
	.HasButtons = 1
	.HasLines = 1
	.SingleSel = .f.
ENDWITH
ENDPROC
PROCEDURE loadrs
LOCAL lnDefItem ,mFrmPartTvrID,nRecNo
USE IN SELECT('tmpHist')
LOCAL lcUniqueName
lcUniqueName = spGetParentChild(thisform.npartfrmid)
*21.04.2011 14:08 -&gt;Òåïåðü îòêðîåì äàííûé Alias
USE (lcUniqueName) IN 0 ALIAS tmpHist
SELECT tmpHist
this.BeginUpdate()
with this.Items
	.RemoveAllItems()
	SELECT tmpHist
	STORE -99999 TO lnDefTvrId ,lnDefParId ,lnDefResursId ,lnBarId
	SCAN ALL FOR NVL(tmpHist.FrmParId,0) = 0
		** äîáàâëÿåì ðîäèòåëÿ
		nRecNo = RECNO('tmpHist')
		this._addParent()
	    lnDefItem = .DefaultItem
	    mFrmPartTvrID = tmpHist.FrmPartTvr
		** äîáàâëÿåì äî÷åðíèå çàïèñè
	this._addChild(lnDefItem,mFrmPartTvrID)
	    GO nRecNo
	ENDSCAN
*!*		for each h in this.Items
*!*			.DefaultItem = h
*!*			.ExpandItem(0) = .t.
*!*		next
this.ExpandAll(.t.)

	SELECT tmpHist
	LOCATE ALL FOR tmpHist.FrmPartTvr = thisform.npartfrmid
	IF FOUND()
		.UnselectAll()
		.SelectItem(tmpHist._idTmp )=.t.
		.EnsureVisibleItem(tmpHist._idTmp)
	ENDIF
ENDWITH

this.EndUpdate()
*USE IN tmpHist

ENDPROC
PROCEDURE RClick
*** ActiveX Control Event ***
LPARAMETERS button, shift, x, y
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.RIGHTCLICK
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Ïðîãðàìíîå ñîçäàíèå êîíòåêñòíîãî ìåíþ.
*-------------------------------------------------------
local c, hit
c = 0
hit = 0
with this
	*n_idTmp = .ItemFromPoint( x, y, @c, @hit )
	n_idTmp = this.Items.SelectedItem
	if ( n_idTmp &lt;&gt; 0 ) or ( c &lt;&gt; 0 )
		SELECT tmpHist
		LOCATE ALL for tmpHist._idTmp = n_idTmp
		IF FOUND()
			.nPartID = tmpHist.FrmPartTvr
			.nFrmId = tmpHist.FrmID
		ENDIF
	endif
endwith



*05.04.2004 13:52 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnMsgCount, ;
		lnMsgCounter, ;
		lnStartPos, ;
		lnEndPos, ;
		lcPrompt, ;
		lcMsg, ;
		lnCurSRef, ;
		lcHandledCustomMsgList, ;
		lcHandledStandartMsgList, ;
		lnItemCountAfterSeparator, ;
		lcRelativeHierarchy, ;
		lcActionMacro, ;
		lnAddBarIndex
***		

#INCLUDE include\base_v1_grd.h

LOCAL ARRAY 	paStdContextActions[1], ;
				paCstContextActions[1]
***
paStdContextActions = .NULL.
paCstContextActions = .NULL.
*------------------------------------------------------------------------------
WITH This
*******************************************************************************
*1. ×èòàåì â ìàññèâ ñïèñîê ïóíêòîâ ìåíþ è ñïèñîê ñîîáùåíèé	  				  *
*******************************************************************************

*05.04.2004 14:01 -&gt;Ïðîâåðÿåì ðàçìåðíîñòè âñåõ ñïèñêîâ
IF OCCURS([;],._HandledStandartMsgList) # OCCURS([;],._HandledStandartMsgPromptList)
	ASSERT .F. MESSAGE [GRD.RIGHTCLICK: ðàçìåðíîñòü ñïèñêà ñòàíäàðòíûõ ñîîáùåíèé îòëè÷íà îò ðàçìåðíîñòè ñïèñêà ñòàíäàðòíûõ ïóíêòîâ ìåíþ.]
	RETURN .F.
ENDIF
***
IF OCCURS([;],._HandledCustomMsgList) # OCCURS([;],._HandledCustomMsgPromptList)
	ASSERT .F. MESSAGE [GRD.RIGHTCLICK: ðàçìåðíîñòü ñïèñêà ïîëüçîâàòåëüñêèõ ñîîáùåíèé îòëè÷íà îò ðàçìåðíîñòè ñïèñêà ïîëüçîâàòåëüñêèõ ïóíêòîâ ìåíþ.]
	RETURN .F.
ENDIF
*------------------------------------------------------------------------------
*05.04.2004 14:09 -&gt;×èòàåì â ìàññèâ ñòàíäàðòíûå ñîîáùåíèÿ
lnMsgCount = OCCURS([;],._HandledStandartMsgPromptList)+1
***
FOR lnMsgCounter = 1 TO lnMsgCount
	lnStartPos = IIF(lnMsgCounter = 1, 1, AT([;],._HandledStandartMsgPromptList,lnMsgCounter-1)+1)
	lnEndPos   = IIF(lnMsgCounter = lnMsgCount, LEN(._HandledStandartMsgPromptList), AT([;],._HandledStandartMsgPromptList,lnMsgCounter)-1)
	lcPrompt   = SUBSTR(._HandledStandartMsgPromptList,lnStartPos,lnEndPos-lnStartPos+1)
	***
	lnStartPos = IIF(lnMsgCounter = 1, 1, AT([;],._HandledStandartMsgList,lnMsgCounter-1)+1)
	lnEndPos   = IIF(lnMsgCounter = lnMsgCount, LEN(._HandledStandartMsgList), AT([;],._HandledStandartMsgList,lnMsgCounter)-1)
	lcMsg   = SUBSTR(._HandledStandartMsgList,lnStartPos,lnEndPos-lnStartPos+1)
	***
	IF !EMPTY(lcPrompt)
		IF ISNULL(paStdContextActions)
			lnCurSRef = 1
		ELSE
			lnCurSRef = ALEN(paStdContextActions,1)+1
		ENDIF
		***
		DIMENSION paStdContextActions(lnCurSRef,2)
		***
		paStdContextActions(lnCurSRef,cnCMA_PROMPT) = lcPrompt
		paStdContextActions(lnCurSRef,cnCMA_MSG) = lcMsg
	ENDIF	
	***
ENDFOR
*------------------------------------------------------------------------------

*05.04.2004 14:09 -&gt;×èòàåì â ìàññèâ ïîëüçîâàòåëüñêèå ñîîáùåíèÿ ñîîáùåíèÿ
lnMsgCount = OCCURS([;],._HandledCustomMsgPromptList)+1
***
FOR lnMsgCounter = 1 TO lnMsgCount
	lnStartPos = IIF(lnMsgCounter = 1, 1, AT([;],._HandledCustomMsgPromptList,lnMsgCounter-1)+1)
	lnEndPos   = IIF(lnMsgCounter = lnMsgCount, LEN(._HandledCustomMsgPromptList), AT([;],._HandledCustomMsgPromptList,lnMsgCounter)-1)
	lcPrompt   = SUBSTR(._HandledCustomMsgPromptList,lnStartPos,lnEndPos-lnStartPos+1)
	***
	lnStartPos = IIF(lnMsgCounter = 1, 1, AT([;],._HandledCustomMsgList,lnMsgCounter-1)+1)
	lnEndPos   = IIF(lnMsgCounter = lnMsgCount, LEN(._HandledCustomMsgList), AT([;],._HandledCustomMsgList,lnMsgCounter)-1)
	lcMsg   = SUBSTR(._HandledCustomMsgList,lnStartPos,lnEndPos-lnStartPos+1)
	***
	IF !EMPTY(lcPrompt)
		IF ISNULL(paCstContextActions)
			lnCurSRef = 1
		ELSE
			lnCurSRef = ALEN(paCstContextActions,1)+1
		ENDIF
		***
		DIMENSION paCstContextActions(lnCurSRef,2)
		***
		paCstContextActions(lnCurSRef,cnCMA_PROMPT) = lcPrompt
		paCstContextActions(lnCurSRef,cnCMA_MSG) = lcMsg
	ENDIF	
	***
ENDFOR
*------------------------------------------------------------------------------

*******************************************************************************
*2. Îïðåäåëÿåì ñïèñîê äîñòóïíûõ ñîîáùåíèé â êàæäîé ãðóïïå	  				  *
*******************************************************************************

*05.04.2004 15:32 -&gt;Îïðåäåëèì ñïèñîê ñîîáùåíèé
lcHandledStandartMsgList = [;]+._GetHandledStandartMsgList()+[;]
lcHandledCustomMsgList = [;]+._GetHandledCustomMsgList()+[;]
*------------------------------------------------------------------------------

*******************************************************************************
*3. Ñòðîèì êîíòåêñòíîå ìåíþ									  				  *
*******************************************************************************
*05.04.2004 15:33 -&gt;Îïðåäåëÿåì ìåíþ
DEFINE POPUP grdshortcut SHORTCUT RELATIVE FROM MROW(),MCOL()
*------------------------------------------------------------------------------
*05.04.2004 15:34 -&gt;Ïðîõîäèìñÿ ïî ìàññèâó ñòàíäàðòíûõ ñîîáùåíèé
lnItemCountAfterSeparator = 0
IF !ISNULL(paStdContextActions)
	FOR lnCurSRef = 1 TO ALEN(paStdContextActions,1)
		IF	paStdContextActions(lnCurSRef,cnCMA_PROMPT) == [\-]
			IF lnItemCountAfterSeparator &gt; 0
				DEFINE BAR lnCurSRef OF grdshortcut PROMPT [\-]
				lnItemCountAfterSeparator = 0
			ENDIF	
		ELSE
			IF ([;]+paStdContextActions(lnCurSRef,cnCMA_MSG)+[;])$lcHandledStandartMsgList
				lcRelativeHierarchy = SYS(1272,This)
				lcRelativeHierarchy = IIF([.]$lcRelativeHierarchy,SUBSTR(lcRelativeHierarchy,AT([.],lcRelativeHierarchy)+1),lcRelativeHierarchy)
				lcActionMacro = [_screen.ActiveForm.]+lcRelativeHierarchy+[.HandleMsg("]+paStdContextActions(lnCurSRef,cnCMA_MSG)+[")]
				***
				DEFINE BAR lnCurSRef OF grdshortcut PROMPT paStdContextActions(lnCurSRef,cnCMA_PROMPT)
				ON SELECTION BAR lnCurSRef OF grdshortcut &amp;lcActionMacro
			ELSE
				DEFINE BAR lnCurSRef OF grdshortcut PROMPT paStdContextActions(lnCurSRef,cnCMA_PROMPT) SKIP FOR .T.
			ENDIF
			***
			lnItemCountAfterSeparator = lnItemCountAfterSeparator + 1
		ENDIF
	ENDFOR
ENDIF	
*------------------------------------------------------------------------------

*14.05.2004 11:48 -&gt;Ñè÷òàåì íàðîùåíèå èíäåêñà äëÿ ñîîáùåíèé ïîëüçîâàòåëüñêîé ãðóïïû
IF !ISNULL(paStdContextActions)
	lnAddBarIndex = ALEN(paStdContextActions,1)
ELSE
	lnAddBarIndex = 0	
ENDIF
*------------------------------------------------------------------------------	

*14.05.2004 11:45 -&gt;Äîáàâëÿåì ðàçäåëèòåëü ì/ä ñòàíäàðòíûìè è ïîëüçîâàòåëüñêèìè
IF lnItemCountAfterSeparator &gt; 0 AND !ISNULL(paCstContextActions)
	DEFINE BAR lnAddBarIndex+1 OF grdshortcut PROMPT [\-]
	lnAddBarIndex = lnAddBarIndex+1
ENDIF
*------------------------------------------------------------------------------

*05.04.2004 15:34 -&gt;Ïðîõîäèìñÿ ïî ìàññèâó ïîëüçîâàòåëüñêèõ ñîîáùåíèé
lnItemCountAfterSeparator = 0
IF !ISNULL(paCstContextActions)
	FOR lnCurSRef = 1 TO ALEN(paCstContextActions,1)
		IF	paCstContextActions(lnCurSRef,cnCMA_PROMPT) == [\-]
			IF lnItemCountAfterSeparator &gt; 0
				DEFINE BAR lnAddBarIndex+lnCurSRef OF grdshortcut PROMPT [\-]
				lnItemCountAfterSeparator = 0
			ENDIF	
		ELSE
			IF ([;]+paCstContextActions(lnCurSRef,cnCMA_MSG)+[;])$lcHandledCustomMsgList
				lcRelativeHierarchy = SYS(1272,This)
				lcRelativeHierarchy = IIF([.]$lcRelativeHierarchy,SUBSTR(lcRelativeHierarchy,AT([.],lcRelativeHierarchy)+1),lcRelativeHierarchy)
				lcActionMacro = [_screen.ActiveForm.]+lcRelativeHierarchy+[.HandleMsg("]+paCstContextActions(lnCurSRef,cnCMA_MSG)+[")]
				***
				DEFINE BAR lnAddBarIndex+lnCurSRef OF grdshortcut PROMPT paCstContextActions(lnCurSRef,cnCMA_PROMPT)
				ON SELECTION BAR lnAddBarIndex+lnCurSRef OF grdshortcut &amp;lcActionMacro
			ELSE
				DEFINE BAR lnAddBarIndex+lnCurSRef OF grdshortcut PROMPT paCstContextActions(lnCurSRef,cnCMA_PROMPT) SKIP FOR .T.
			ENDIF
			***
			lnItemCountAfterSeparator = lnItemCountAfterSeparator + 1
		ENDIF
	ENDFOR
ENDIF	
*------------------------------------------------------------------------------

ENDWITH

*05.04.2004 15:57 -&gt;Àêòèâèðóåì ìåíþ
ACTIVATE POPUP grdshortcut
*------------------------------------------------------------------------------

************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
</methods>
		<objcode/>
		<ole>0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7////+////BQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAP7//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANB/D7jahcwBAwAAAMAAAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAfBQAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABDAAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAQAAAAAAAAAAQAAAP7////+//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9DAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACwAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAC0xMjkzOTE3MTM5AAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAtMTI5MzkxNwEAAIBRAEQAZwBFAEEAQQBnAG8ARQBSAFEAawBJAEsAeABBAG4ARwBQAEIAaABHAEsAQQBaAHoAaABnAEoAdwAP5h4QB3uwSKE68yuufaFlSUwBAQAABAAEABAAEAD/////IQD//////////0JNNgAAAAAAAAA2AAAAKAAAAEAAAAAQAAAAAQAgAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAD0AAAAxAB0AJgEsADEAFQAnAU8ADAAgAhUAUJoZADg8E3ckPBN3ADwTdzAANAAsAC0AAQAAAPsaBdUAAAAAMAA1AAUAAAADAAAAhAAAAE8AAAAAAAAAAAAAAAAAAAAAAAAAZgAAAIgPGwAPAAAAAAAAACRWEXcAAAAAAAAAAFCFEXcAAAAATLogAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGAEIAAAAMALhcFwC4jhQABwA8AVQBCAAiAAAAUgBlAG0AbwB2AGUAUwBoAGEAcABlAEMAbwByAA/mHhAHe7BIoTrzK659oWVJTAEBAAAEAAQAEAAQAP////8hAP//////////Qk02AAAAAAAAADYAAAAoAAAAQAAAABAAAAABACAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEJNPgAAAAAAAAA+AAAAKAAAAEAAAAAQAAAAAQABAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAEHcAADAVAAAJAANS4wuRj84RneMAqgBLuFEBzAAAkAFEQgEABUFyaWFsCwD//wsA//8DAAAAAAATAAUAAIATAAgAAIATAAUAAIATAAgAAIALAP//AwAAAAAAAwADAAAAAwASAAAAAwD/////AwAAAAAACwD//wsA//8DAAAAAAALAAAAAwD/////AwD/////AwAAAAAAAwD/////AwAWAAAAAwAAAAAACwAAAAsA//8TAA4AAIATAA0AAIADAAAAAAADAAAAAAADAAAAAAALAP//EwAxZf8AAwACAAAACwD//wsA//8LAAAACwAAAAsAAAAJAAAAAAAAAAAAAAAAAAAAAAADADAAAAALAAAAEwAxZf8AAwAAAAAAEwAPAACAEwAIAACAEwAAAAAAAwD/////EwAPAACAEwAIAACACQADUuMLkY/OEZ3jAKoAS7hRAcwAALwCREIBAAVBcmlhbAgAAgAAAAAAAwASAAAACABkAAAAYQBiAGMAZABlAGYAZwBoAGkAagBrAGwAbQBuAG8AcABxAHIAcwB0AHUAdgB3AHgAeQB6AEwEOQQyBDQEMAQ1BDcEOgQ7BDgEPwQ+BDwERARGBEIESwRJBDEEPQRDBEoEQQQAAAgAZAAAAEEAQgBDAEQARQBGAEcASABJAEoASwBMAE0ATgBPAFAAUQBSAFMAVABVAFYAVwBYAFkAWgAsBBkEEgQUBBAEFQQXBBoEGwQYBB8EHgQcBCQEJgQiBCsEKQQRBB0EIwQqBCEEAAALAP//CwD//wgAAgAAAAAAAwD0AQAAAwCIEwAAEwCsqJkAAwADAAAAAwDEAAAACwAAAAsAAAAFAAAAAAAAAOA/CwAAAAMAAAAAAAsA//8TAA8AAIAJAAAAAAAAAAAAAAAAAAAAAAADADAAAAALAP//AwAAAAAACwAAAAsAAAAIAAIAAAAAABMAEAAAgBMAEAAAgBMADwAAgAMAEgAAAAMAoP///wsA//8LAP//AwAAAAAACwAAAAMAAAAAAAsA//8IAAIAAAAAAAMAAAAAAAMA/////wMA/////wMA/////wMA/////wkAA1LjC5GPzhGd4wCqAEu4UQEBAACQAYA4AQAFQXJpYWwLAP//AwD///8ACwAAAA==</ole>
		<ole2>OLEObject = C:\Windows\SysWOW64\exgrid.dll
</ole2>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3BW0WF9Z2</uniqueid>
		<timestamp>1061729947</timestamp>
		<class>exorgchart</class>
		<classloc>gannt.vcx</classloc>
		<baseclass>olecontrol</baseclass>
		<objname>Exorgchart</objname>
		<parent>frmdepend</parent>
		<properties>Top = 204
Left = 1
Height = 599
Width = 1150
ZOrderSet = 3
Name = "Exorgchart"
</properties>
		<protected/>
		<methods>PROCEDURE _addchild
LPARAMETERS mFrmPartTvrID
LOCAL lDefItem ,lFrmPartTvrID,lnRecNo ,lTitle, nChSumm, nrChSumm, nChCnt, nIndex
STORE 0 TO nChSumm, nChCnt, nrChSumm
SCAN ALL FOR  tmpHist.FrmParId = mFrmPartTvrID
	** äîáàâëÿåì äî÷åðíèå çàïèñè
	with this.Nodes
	 nChCnt = nChCnt + 1
	 nChSumm = nChSumm + ROUND(tmpHist.TvrQnt*tmpHist.TvrPrcSale,2)
	
	 lTitle = "&lt;r&gt;&lt;dotline&gt;&lt;b&gt;&lt;fgcolor=0000FF&gt;"+;
	 			ALLTRIM(tmpHist.Tvrnm) +; &amp;&amp; yfçâàíèå ïîçèöèè
	 			"&lt;/fgcolor&gt;&lt;/b&gt;&lt;br&gt;&lt;solidline&gt;&lt;b&gt;"+;
	 			"Äîêóìåíò:"+;
	 			"&lt;/b&gt;:&lt;r&gt;&lt;fgcolor=FF0000&gt;"+;
	 			ALLTRIM(tmpHist.ShortNM)	+ ' îò '+ DTOC(tmpHist.FrmDate)+; 			&amp;&amp; äîêóìåíò
	 			"&lt;/fgcolor&gt;&lt;br&gt;&lt;r&gt;"+;
	 			ALLTRIM(tmpHist.MsuNM) +;
	 			"&lt;br&gt;&lt;dotline&gt;&lt;upline&gt;&lt;b&gt;"+;
	 			"Ñóììà:"+;
	 			"&lt;/b&gt;&lt;r&gt;"+;
	 			ALLTRIM(STR(tmpHist.TvrQnt,12,3))+" x " +ALLTRIM(STR(tmpHist.TvrPrcSale,12,2)) +"ðóá. = "+ ALLTRIM(STR(ROUND(tmpHist.TvrQnt*tmpHist.TvrPrcSale,2),12,2))
	 cTvrnm = 	ALLTRIM(tmpHist.Tvrnm)
	 cTvrnm = SUBSTR(cTvrnm ,1,30);
	 +IIF(!EMPTY(SUBSTR(cTvrnm ,31,30)),'&lt;br&gt;'+SUBSTR(cTvrnm ,31,30),'')		;
	 +IIF(!EMPTY(SUBSTR(cTvrnm ,61,30)),'&lt;br&gt;'+SUBSTR(cTvrnm ,61,30),'')		;
	 +IIF(!EMPTY(SUBSTR(cTvrnm ,91,30)),'&lt;br&gt;'+SUBSTR(cTvrnm ,91,30),'')		;
	 +IIF(!EMPTY(SUBSTR(cTvrnm ,121,30)),'&lt;br&gt;'+SUBSTR(cTvrnm ,121,30),'')		
	 cTvrnm = 	ALLTRIM(tmpHist.Tvrnm)
	 lTitle = "&lt;r&gt;&lt;dotline&gt;&lt;b&gt;&lt;fgcolor=0000FF&gt;"+;
	 			cTvrnm  +; &amp;&amp; yfçâàíèå ïîçèöèè
	 			"&lt;/fgcolor&gt;&lt;/b&gt;&lt;br&gt;&lt;solidline&gt;&lt;b&gt;"+; &amp;&amp;    	 			"Äîêóìåíò:"+
	 			"&lt;r&gt;&lt;fgcolor=FF0000&gt;"+;
	 			ALLTRIM(tmpHist.ShortNM) + ' ¹ '+ALLTRIM(tmpHist.FrmNum)+' îò '+ DTOC(tmpHist.FrmDate)+; 			&amp;&amp; äîêóìåíò
	 			"&lt;/fgcolor&gt;&lt;br&gt;&lt;r&gt;"+;
	 			"&lt;br&gt;&lt;dotline&gt;&lt;upline&gt;&lt;b&gt;"+;	&amp;&amp;    	 			"Ñóììà:"+
	 			"&lt;/b&gt;&lt;r&gt;"+;
	 			ALLTRIM(STR(tmpHist.TvrQnt,12,3))+ ALLTRIM(tmpHist.MsuNM)+ " x " +ALLTRIM(STR(tmpHist.TvrPrcSale,12,2)) +"ðóá. = "+ ALLTRIM(STR(ROUND(tmpHist.TvrQnt*tmpHist.TvrPrcSale,2),12,2))
	 			
	* .Add( ALLTRIM(tmpHist.Tvrnm),IIF(this.lFirst,'root',ALLTRIM(STR(mFrmPartTvrID))),ALLTRIM(STR(tmpHist.FrmPartTvr,12,0)))
	 WITH .Add( lTitle ,IIF(this.lFirst,'root',ALLTRIM(STR(mFrmPartTvrID))),ALLTRIM(STR(tmpHist.FrmPartTvr,12,0)))
	 	.Width = 128
	 	.ToolTip = ALLTRIM(tmpHist.Tvrnm)
	 	nIndex = .Index
	 ENDWITH
		this.lFirst = .f.
	     this.cDefaultKey  = ALLTRIM(STR(tmpHist.FrmPartTvr,12,0))
	     lFrmPartTvrID = tmpHist.FrmPartTvr
		 ** äîáàâëÿåì äî÷åðíèå çàïèñè
		 lnRecNo = RECNO('tmpHist')
		
		 nrChSumm = this._addChild(lFrmPartTvrID)
	 GO lnRecNo
		 IF nrChSumm &lt;&gt; nChSumm AND this.Nodes(nIndex).NodeCount&gt;0
	    	 cTvrnm = 	ALLTRIM(tmpHist.Tvrnm)
	    	 lTitle = "&lt;r&gt;&lt;dotline&gt;&lt;b&gt;&lt;fgcolor=0000FF&gt;"+;
	    	 			cTvrnm  +; &amp;&amp; yfçâàíèå ïîçèöèè
	    	 			"&lt;/fgcolor&gt;&lt;/b&gt;&lt;br&gt;&lt;solidline&gt;&lt;b&gt;"+; &amp;&amp;    	 			"Äîêóìåíò:"+
	    	 			"&lt;r&gt;&lt;fgcolor=FF0000&gt;"+;
	    	 			ALLTRIM(tmpHist.ShortNM) + ' ¹ '+ALLTRIM(tmpHist.FrmNum)+' îò '+ DTOC(tmpHist.FrmDate)+; 			&amp;&amp; äîêóìåíò
	    	 			"&lt;/fgcolor&gt;&lt;br&gt;&lt;r&gt;"+;
	    	 			"&lt;br&gt;&lt;dotline&gt;&lt;upline&gt;&lt;b&gt;"+;	&amp;&amp;    	 			"Ñóììà:"+
	    	 			"&lt;/b&gt;&lt;r&gt;"+;
	    	 			ALLTRIM(STR(tmpHist.TvrQnt,12,3))+ ALLTRIM(tmpHist.MsuNM)+ " x " +ALLTRIM(STR(tmpHist.TvrPrcSale,12,2)) +"ðóá. = "+ ALLTRIM(STR(ROUND(tmpHist.TvrQnt*tmpHist.TvrPrcSale,2),12,2))+;
	    	 			"&lt;/fgcolor&gt;&lt;/b&gt;&lt;br&gt;&lt;solidline&gt;&lt;b&gt;"+; &amp;&amp;    	 			"Ñóììà :"+
	    	 			"&lt;r&gt;&lt;fgcolor=FF0000&gt;"+;
	    	 			ALLTRIM(STR(nrChSumm ,12,2))
			 this.Nodes(nIndex).Caption = lTitle
		 ENDIF

	ENDWITH
ENDSCAN
RETURN nChSumm
ENDPROC
PROCEDURE _addparent



lTitle = "&lt;r&gt;&lt;dotline&gt;&lt;b&gt;&lt;fgcolor=0000FF&gt;"+;
			ALLTRIM(tmpHist.Tvrnm) +; &amp;&amp; yfçâàíèå ïîçèöèè
			"&lt;/fgcolor&gt;&lt;/b&gt;&lt;br&gt;&lt;solidline&gt;&lt;b&gt;"+;
			"Äîêóìåíò:"+;
			"&lt;/b&gt;:&lt;r&gt;&lt;fgcolor=FF0000&gt;"+;
			ALLTRIM(tmpHist.ShortNM)	+ ' îò '+ DTOC(tmpHist.FrmDate)+; 			&amp;&amp; äîêóìåíò
			"&lt;/fgcolor&gt;&lt;br&gt;"+;
			ALLTRIM(tmpHist.MsuNM) +;
			"&lt;br&gt;&lt;dotline&gt;&lt;upline&gt;&lt;b&gt;"+;
			"Ñóììà:"+;
			"&lt;/b&gt;&lt;r&gt;"+;
			ALLTRIM(STR(tmpHist.TvrQnt,12,3))+" x " +ALLTRIM(STR(tmpHist.TvrPrcSale,12,2)) +"ðóá. = "+ ALLTRIM(STR(ROUND(tmpHist.TvrQnt*tmpHist.TvrPrcSale,2),12,2))
this.Root.Caption = ALLTRIM(lTitle)		&amp;&amp;tmpHist.Tvrnm)
this.Root.ToolTip = ALLTRIM(tmpHist.Tvrnm)
this.cDefaultKey  = ALLTRIM(STR(tmpHist.FrmPartTvr,12,0))
this.lFirst = .t.
*!*	with this.Nodes
*!*	*	    .DefaultItem = .AddItem( IIF(BITTEST(tmpHist.TvrAttr,9),ALLTRIM(tmpHist.Tvrnm),'- '+ALLTRIM(tmpHist.Tvrnm)))
*!*		     .Add( ALLTRIM(tmpHist.Tvrnm),'',ALLTRIM(STR(tmpHist.FrmPartTvr,12,0)))
*!*	 	     this.cDefaultKey  = ALLTRIM(STR(tmpHist.FrmPartTvr,12,0))
*!*	*!*	    	.CellBold(.DefaultItem) = BITTEST(tmpHist.TvrAttr,9) &amp;&amp;this.lFirst
*!*	*!*		  *  .CellValue(.DefaultItem , 1) = ALLTRIM(tmpHist.ResNM)			&amp;&amp; ðàáîòà
*!*	*!*		    .CellValue(.DefaultItem , 1) = ALLTRIM(tmpHist.MsuNM)			&amp;&amp; åä èçìåð
*!*	*!*		    .CellValue(.DefaultItem , 2) = TRANSFORM(tmpHist.TvrPrcSale,[99999999.9999]) 	&amp;&amp; öåíà   TRANSFORM(myCursor.col1,'9999.99' )
*!*	*!*		    .CellValue(.DefaultItem , 3) = TRANSFORM(tmpHist.TvrQnt,[99999999.9999])			&amp;&amp; êîëè÷
*!*	*!*		    .CellValue(.DefaultItem , 4) = TRANSFORM(ROUND(tmpHist.TvrQnt*tmpHist.TvrPrcSale,4),[99999999.9999])	&amp;&amp; ñóììà
*!*	*!*		    .CellValue(.DefaultItem , 6) = TTOD(tmpHist.UseStart)	&amp;&amp; íà÷àëî
*!*	*!*		    .CellValue(.DefaultItem , 7) = TTOD(tmpHist.UseEnd)		&amp;&amp; êîíåö
*!*	*!*		    .CellValue(.DefaultItem , 8) = ALLTRIM(tmpHist.ShortNM)	+ ' îò '+ DTOC(tmpHist.FrmDate)			&amp;&amp; äîêóìåíò
*!*	*!*		    .CellValue(.DefaultItem , 9) = ALLTRIM(tmpHist.FrmNote)				&amp;&amp; îïèñàíèå
*!*	*!*		   * .CellValue(.DefaultItem , 6) = tmpHist.TypeRes				&amp;&amp; òèï çàïèñè
*!*	*!*		    replace NEXT 1 _idTmp WITH .DefaultItem IN tmpHist
*!*		    this.lFirst = .t.
*!*	ENDWITH
ENDPROC
PROCEDURE _loadrs
LOCAL lnDefItem ,mFrmPartTvrID,nRecNo
			*!*	USE IN SELECT('tmpHist')
			*!*	LOCAL lcUniqueName
			*!*	lcUniqueName = spGetParentChild(thisform.npartfrmid)
			*!*	*21.04.2011 14:08 -&gt;Òåïåðü îòêðîåì äàííûé Alias
			*!*	USE (lcUniqueName) IN 0 ALIAS tmpHist
SELECT tmpHist
this.BeginUpdate()
this.FixedHeightNode = 80 &amp;&amp;93
*this.FixedWidthNode = 250
this.FixedWidthNode = 250
with this.Nodes
	.Clear()
	SELECT tmpHist
	STORE -99999 TO lnDefTvrId ,lnDefParId ,lnDefResursId ,lnBarId
	**SCAN ALL FOR NVL(tmpHist.FrmParId,0) = 0
	LOCATE ALL FOR NVL(tmpHist.FrmParId,0) = 0
	IF !FOUND()
	RETURN
	ENDIF
		** äîáàâëÿåì ðîäèòåëÿ
		nRecNo = RECNO('tmpHist')
		this._addParent()
	    this.cDefaultKey  = ALLTRIM(STR(tmpHist.FrmPartTvr,12,0))
	    mFrmPartTvrID = tmpHist.FrmPartTvr
		** äîáàâëÿåì äî÷åðíèå çàïèñè
	this._addChild( mFrmPartTvrID)
	    GO nRecNo
	**ENDSCAN
*!*		for each h in this.Items
*!*			.DefaultItem = h
*!*			.ExpandItem(0) = .t.
*!*		next
* this.ExpandAll(.t.)

	SELECT tmpHist
*	LOCATE ALL FOR tmpHist.FrmPartTvr = thisform.npartfrmid
*!*		IF FOUND()
*!*			.UnselectAll()
*!*			.SelectItem(tmpHist._idTmp )=.t.
*!*			.EnsureVisibleItem(tmpHist._idTmp)
*!*		ENDIF
ENDWITH

this.EndUpdate()
*USE IN tmpHist

ENDPROC
</methods>
		<objcode/>
		<ole>0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7////+////BQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAA/v///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAcELjahcwBAwAAAIAAAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAyhIAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAQAAAAAAAAA/v////7///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////84AAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAEAAAQAAgAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFXk3/T+AQ5CoIhkNG3MN5FJTAEBAAAEAAQAEAAQAP////8hAP//////////Qk02AAAAAAAAADYAAAAoAAAAQAAAABAAAAABACAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFXk3/T+AQ5CoIhkNG3MN5FJTAEBAAAEAAQAEAAQAP////8hAP//////////Qk02AAAAAAAAADYAAAAoAAAAQAAAABAAAAABACAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEJNPgAAAAAAAAA+AAAAKAAAAEAAAAAQAAAAAQABAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAA23YAAOk9AAATAAUAAIATAAgAAIAJAANS4wuRj84RneMAqgBLuFEBzAAAkAFEQgEABUFyaWFsCQAAAAAAAAAAAAAAAAAAAAAAAwAwAAAAAwACAAAAAwAKAAAAAwAEAAAACwAAAAMA9AEAAAMAiBMAAAsA//8IAAIAAAAAABMA////ABMAAAAAAAsA//8DAAAAAAALAP//EwD/AAAACwD//xMACgAAgAMAAgAAAAMA/////wMA/////wsA//8LAP//CwD//wMAxAAAAAUAAAAAAAAA8D8FAAAAAAAAAPA/AwAAAAAAAwAAAAAACwD//wMAAAAAAAMAEAAAAAsA//8DAAEAAAATAAoAAIADAAEAAAADAAIAAAADAP////8DAP////8DAP////8DAP////8JAANS4wuRj84RneMAqgBLuFEBAQAAkAGAOAEABUFyaWFsAwAPAAAAAwAPAAAAAwAPAAAAAwCAAAAACwAAAAsAAAALAAAAAwD/////AwD/////CwAAAAsAAAATAAoAAIADAAEAAAADAAIAAAADAAAAAAADAAAAAAA=</ole>
		<ole2>OLEObject = C:\Windows\SysWOW64\ExOrgChart.dll
</ole2>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>frmdepend</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1></reserved1>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3BR1A03IM</uniqueid>
		<timestamp>1062097213</timestamp>
		<class>frmresulipa</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>form</baseclass>
		<objname>frmresutable</objname>
		<parent/>
		<properties>DoCreate = .T.
Caption = "Ïëàí - ãðàôèê ðàçìåùåíèÿ ïîñåòèòåëåé ñòîëîâîé"
Name = "frmresutable"
Shape1.Visible = .F.
Shape1.Name = "Shape1"
cstmsghandler.Name = "cstmsghandler"
cstresizable.Name = "cstresizable"
Img1.Name = "Img1"
G2ANTT1.Top = 0
G2ANTT1.Left = 1
G2ANTT1.Height = 600
G2ANTT1.Width = 1000
G2ANTT1.cname0 = Ñòîëû
G2ANTT1._handledcustommsgpromptlist = Âñòàâèòü
G2ANTT1._handledcustommsglist = Insert_BAR
G2ANTT1.cbarfont = Aryal:9:1
G2ANTT1.ccolumnfont = Aryal:10:1
G2ANTT1.citemfont = Aryal:9:0
G2ANTT1.cpoditemfont = Aryal:9:1
G2ANTT1.ncountunits = 25
G2ANTT1.lmultybar = .T.
G2ANTT1.nwithcol1 = 1
G2ANTT1.nwithcol0 = 120
G2ANTT1.npanewith0 = 120
G2ANTT1.Name = "G2ANTT1"
cmdReload.Name = "cmdReload"
cmdToday.Name = "cmdToday"
Shape2.Visible = .F.
Shape2.Name = "Shape2"
Shape4.Visible = .F.
Shape4.Name = "Shape4"
Label2.Visible = .F.
Label2.Name = "Label2"
Label3.Visible = .F.
Label3.Name = "Label3"
Label4.Visible = .F.
Label4.Name = "Label4"
Label1.Visible = .F.
Label1.Name = "Label1"
PrintGantt.Top = 600
PrintGantt.Left = 84
PrintGantt.Height = 13
PrintGantt.Width = 25
PrintGantt.Name = "PrintGantt"
CmdPrint.Name = "CmdPrint"
Shape6.Visible = .F.
Shape6.Name = "Shape6"
Shape7.Visible = .F.
Shape7.Name = "Shape7"
Shape3.Visible = .F.
Shape3.Name = "Shape3"
cmdGoDate.Name = "cmdGoDate"
</properties>
		<protected/>
		<methods>PROCEDURE G2ANTT1._find
LPARAMETERS nTvrId,tStart,tEnd,nKey,nItem
LOCAL nBars
SET STEP ON
this.lParentChange = .t.
nBars = g2antt::_find(nTvrId,tStart,tEnd,nKey,nItem)
this.lParentChange = .f.
if nBars &gt;= VAL(SUBSTR(this.Items.CellValue(nItem,0),10))
	=MESSAGEBOX('Çà ýòèì ñòîëîì âñå ìåñòà çàíÿòû ...',0+64,'Íåò ñâîáîäíûõ ìåñò ...')
	RETURN 1
ENDIF
RETURN 0
**WAIT WINDOW VAL(SUBSTR('Ñòîë 017-04                                   ',10))
ENDPROC
PROCEDURE G2ANTT1.BarParentChange
*** ActiveX Control Event ***
LPARAMETERS item, key, newitem, cancel
*
LOCAL nTvrId


*!*	if nBars &gt;= VAL(SUBSTR(this.Items.CellValue(newitem,0),10))
*!*		=MESSAGEBOX('Çà ýòèì ñòîëîì âñå ìåñòà çàíÿòû ...',0+64,'Íåò ñâîáîäíûõ ìåñò ...')
*!*		RETURN 1
*!*	ENDIF
*!*	*IF this.lMouseDown
	*CANCEL = .t.
*	RETURN
*ENDIF
nTvrId = VAL(this.Items.ItemData(newitem))
SELECT rv_ResursJrn
LOCATE FOR rv_ResursJrn.BarId = key
IF FOUND() AND !ISNULL(nTvrId)
		LOCAL _PARAM,nTvrId
		_PARAM = rv_ResursJrn.FrmPartTvr
		USE IN SELECT('lvOrderTvrEdit')
		SET DATABASE TO BASIS
		USE lvOrderTvrEdit IN 0
		REPLACE TvrIDCalc WITH nTvrId IN lvOrderTvrEdit
		llResult = TABLEUPDATE(1,.T.,[lvOrderTvrEdit])
		USE IN SELECT('lvOrderTvrEdit')
		RETURN
ENDIF
CANCEL = .f.
ENDPROC
PROCEDURE G2ANTT1.Init
DODEFAULT()
*this.Columns.Item(1).Visible = .F.
** çàïðåùàåì äåëàòü ñâÿçè ìåæäó çàïèñÿìè
this.Chart.AllowLinkBars = .F.
*this.Chart.PaneWidth(0)  = 75

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7>ðàçìåùåíå ïîñåòèòåëåé â ñòîëîâîé</reserved7>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>frmresutable</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
Arial, 1, 10, 6, 16, 13, 34, 3, 0
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18L1B4NYC</uniqueid>
		<timestamp>1080993627</timestamp>
		<class>frmedit</class>
		<classloc>baseform_v1.vcx</classloc>
		<baseclass>form</baseclass>
		<objname>frmqmsindexedit</objname>
		<parent/>
		<properties>Height = 571
Width = 1000
DoCreate = .T.
Caption = "Ïîðÿäîê ñòàäèé â ïðîöåññå"
Icon = ..\graphic\frmqryparselect.ico
Name = "frmqmsindexedit"
cstmsghandler.Name = "cstmsghandler"
cstresizable.Name = "cstresizable"
Img1.Name = "Img1"
cstdatawork.Name = "cstdatawork"
</properties>
		<protected/>
		<methods>PROCEDURE _handlecntcancelsaveevent
*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: ScreenForm_v1.vcx
* Class.Module....: frmScrFrmQryParIndexEdit._HandleCntCancelSaveEvent
* Called by.......: &lt;.cmdCancel.Click();.cmdOk.Click()&gt;
* Parameters......: &lt;tcMessage&gt;
* Returns.........: &lt;none&gt;
* Notes...........:
*-------------------------------------------------------
LPARAMETERS tcMessage

*28.03.2005 17:43 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	llDataWasChanged, ;
		llResSave
*------------------------------------------------------------------------------

WITH This

*04.04.2005 17:03 -&gt; Ñîõðàíèì ðåçóëüòàò
IF tcMessage == [OK]
	*04.04.2005 17:22 -&gt; Ïðîèçâîäèì èíäåêñèðîâàíèå
	SELECT LVQMSSTEPIDX
	SCAN ALL
		IF NVL(FSID,0) # .LstQmsIdx.ItemIDToIndex(NVL(FSID,0))
			REPLACE FSID WITH .LstQmsIdx.ItemIDToIndex(NVL(FrmId,0))
		ENDIF
	ENDSCAN
	*------------------------------------------------------------------------------

	*24.01.2005 12:06 -&gt; Ïðîâåðèì áûëè ëè èçìåíåíû äàííûå
	llDataWasChanged = .cstDataWork.DataChanged([LVQMSSTEPIDX],.T.)
	*------------------------------------------------------------------------------

	*24.01.2005 12:07 -&gt; Åñëè äàííûå áûëè èçìåíåíû
	IF llDataWasChanged
			
		*24.01.2005 12:08 -&gt; Ïðîèçâîäèì ñîõðàíåíèå Alias-à äëÿ ðåäàêòèðîâàíèÿ
		llResSave = .cstDataWork.Save([LVQMSSTEPIDX])
		*------------------------------------------------------------------------------
			
		*24.01.2005 12:08 -&gt; Îáðàáîòàåì ðåçóëüòàòû ñîõðàíåíèÿ
		IF !llResSave
			IF .cstDataWork.HandleSaveFail() &amp;&amp;åñëè îøèáêà îáðàáîòàíà
				RETURN .T. &amp;&amp;âîçâðàùàåìñÿ ê ðåäàêòèðîâàíèþ
			ELSE	
				MESSAGEBOX([Â ïðîöåññå ñîõðàíåíèÿ ïðîèçîøëà îøèáêà. Èçìåíåíèÿ ñîõðàíåíû íå áóäóò.],16,[Îøèáêà...])
				.cstDataWork.Restore([LVQMSSTEPIDX])
			ENDIF
		ENDIF
		*------------------------------------------------------------------------------

		*25.07.2004 10:56 -&gt; Âîçâðàùàþ ðåçóëüòàò
		.uRetVal = llResSave
		*------------------------------------------------------------------------------
		
	ELSE
		*{
		.cstDataWork.Restore([LVQMSSTEPIDX])
		.uRetVal = .F.
		*}
	ENDIF
	*------------------------------------------------------------------------------

ELSE
	*{
	.cstDataWork.Restore([LVQMSSTEPIDX])
	.uRetVal = .F.
	*}
ENDIF
*------------------------------------------------------------------------------

*04.04.2005 17:20 -&gt; Ñêðîåì ôîðìó
.Hide()
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE Init
*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: ScreenForm_v1.vcx
* Class.Module....: frmScrFrmQryParIndexEdit.Init
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;tnScrFrmID&gt;
* Returns.........: &lt;none&gt;
* Notes...........:
*-------------------------------------------------------
LPARAMETERS tnScrFrmID

*21.01.2005 17:45 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnCounter, ;
		lcSourceStr
***
lcSourceStr = []
*------------------------------------------------------------------------------

*21.01.2005 17:45 -&gt; Ïåðå÷èòàåì Local View ñ äàííûìè äëÿ òåêóùåé ýêðàííîé ôîðìû
PRIVATE	_PARAM
_PARAM = tnScrFrmId
REQUERY([LVQMSSTEPIDX])
*------------------------------------------------------------------------------
WITH This.LstQmsIdx
	.RowSourceType = 0

	SELECT LVQMSSTEPIDX
	SCAN
		.AddListItem(LVQMSSTEPIDX.FrmNote,LVQMSSTEPIDX.FrmId)
		REPLACE FSID WITH .ItemIDToIndex(NVL(FrmId,0))
	ENDSCAN
	*------------------------------------------------------------------------------
	.MoverBars = .T.
	
ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE Load
*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: ScreenForm_v1.vcx
* Class.Module....: frmScrFrmQryParIndexEdit.Load
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Çàãðóçêà äàííûõ.
*-------------------------------------------------------

*16.05.2004 22:10 -&gt;Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------

*04.04.2005 17:12 -&gt; Îòêðûâàåì LocalView
USE Basis!LVQMSSTEPIDX IN 0 NODATA
CURSORSETPROP([BUFFERING],5,[LVQMSSTEPIDX])
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>3</reserved2>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7>ðàññòàíîâêà ñòàäèé â ïðîöåññå</reserved7>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18L1BE4FO</uniqueid>
		<timestamp>1080993627</timestamp>
		<class>cntcancelsavehandled</class>
		<classloc>baseform_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntCancelSaveHandled</objname>
		<parent>frmqmsindexedit</parent>
		<properties>Top = 545
Left = 792
Name = "cntCancelSaveHandled"
cmdCancel.Name = "cmdCancel"
cmdOk.Name = "cmdOk"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1HL0ZNX4H</uniqueid>
		<timestamp>1080986094</timestamp>
		<class>lstrptqrypar</class>
		<classloc>report_v1.vcx</classloc>
		<baseclass>listbox</baseclass>
		<objname>LstQmsIdx</objname>
		<parent>frmqmsindexedit</parent>
		<properties>Height = 518
Left = 1
TabIndex = 6
Top = 22
Width = 995
Name = "LstQmsIdx"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>frmqmsindexedit</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3GR0PE7AR</uniqueid>
		<timestamp>1081832452</timestamp>
		<class>frmpdeditoffice</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>form</baseclass>
		<objname>frmpdeditsmk</objname>
		<parent/>
		<properties>DoCreate = .T.
Name = "frmpdeditsmk"
shpFrmAttribute.Name = "shpFrmAttribute"
cstmsghandler.Name = "cstmsghandler"
cstresizable.Name = "cstresizable"
Img1.Name = "Img1"
shpCommon.Name = "shpCommon"
lblFrmType.Name = "lblFrmType"
cntIdCtlGridFrmType.cmdClear.Name = "cmdClear"
cntIdCtlGridFrmType.txtText.Name = "txtText"
cntIdCtlGridFrmType.cmdShow.Name = "cmdShow"
cntIdCtlGridFrmType.Olecommprox1.Top = 0
cntIdCtlGridFrmType.Olecommprox1.Left = 36
cntIdCtlGridFrmType.Olecommprox1.Height = 16
cntIdCtlGridFrmType.Olecommprox1.Width = 38
cntIdCtlGridFrmType.Olecommprox1.Name = "Olecommprox1"
cntIdCtlGridFrmType.CmdTree.Name = "CmdTree"
cntIdCtlGridFrmType.Name = "cntIdCtlGridFrmType"
lblFrmNum.Caption = "Íîìåð :"
lblFrmNum.Name = "lblFrmNum"
txtFrmNum.Name = "txtFrmNum"
chkFrmAutoNum.Alignment = 0
chkFrmAutoNum.Name = "chkFrmAutoNum"
lblFrmDate.Caption = "Äàòà ñîçäàíèÿ:"
lblFrmDate.Name = "lblFrmDate"
cntTxtCtlCalendarFrmDate.txtText.Name = "txtText"
cntTxtCtlCalendarFrmDate.cmdShow.Name = "cmdShow"
cntTxtCtlCalendarFrmDate.Name = "cntTxtCtlCalendarFrmDate"
lblFrmDateAcc.Caption = "Äëèòåëüíîñòü (÷÷,ìì):"
lblFrmDateAcc.Name = "lblFrmDateAcc"
cntTxtCtlCalendarFrmDateAcc.txtText.ControlSource = "lvFrmEdit.FSPerc"
cntTxtCtlCalendarFrmDateAcc.txtText._calendarshowondblclick = .F.
cntTxtCtlCalendarFrmDateAcc.txtText._convertcommatopoint = .T.
cntTxtCtlCalendarFrmDateAcc.txtText.Name = "txtText"
cntTxtCtlCalendarFrmDateAcc.cmdShow.Enabled = .F.
cntTxtCtlCalendarFrmDateAcc.cmdShow.Visible = .F.
cntTxtCtlCalendarFrmDateAcc.cmdShow.Name = "cmdShow"
cntTxtCtlCalendarFrmDateAcc.Top = 38
cntTxtCtlCalendarFrmDateAcc.Left = 516
cntTxtCtlCalendarFrmDateAcc.Width = 168
cntTxtCtlCalendarFrmDateAcc.Height = 23
cntTxtCtlCalendarFrmDateAcc.Name = "cntTxtCtlCalendarFrmDateAcc"
lblReason.Name = "lblReason"
edtReason.Name = "edtReason"
lblNote.Caption = "Îïèñàíèå:"
lblNote.Name = "lblNote"
edtNote.Name = "edtNote"
lblFrmPrcTypeID.Name = "lblFrmPrcTypeID"
cntIDCtlGridFrmPrcTypeID.txtText.Name = "txtText"
cntIDCtlGridFrmPrcTypeID.cmdShow.Name = "cmdShow"
cntIDCtlGridFrmPrcTypeID.cmdClear.Name = "cmdClear"
cntIDCtlGridFrmPrcTypeID.CmdTree.Name = "CmdTree"
cntIDCtlGridFrmPrcTypeID.Olecommprox1.Top = 0
cntIDCtlGridFrmPrcTypeID.Olecommprox1.Left = 36
cntIDCtlGridFrmPrcTypeID.Olecommprox1.Height = 16
cntIDCtlGridFrmPrcTypeID.Olecommprox1.Width = 38
cntIDCtlGridFrmPrcTypeID.Olecommprox1.Name = "Olecommprox1"
cntIDCtlGridFrmPrcTypeID.Name = "cntIDCtlGridFrmPrcTypeID"
lblFrmCurTypeID.Name = "lblFrmCurTypeID"
cntIDCtlGridFrmCurTypeID.txtText.Name = "txtText"
cntIDCtlGridFrmCurTypeID.cmdShow.Name = "cmdShow"
cntIDCtlGridFrmCurTypeID.cmdClear.Name = "cmdClear"
cntIDCtlGridFrmCurTypeID.CmdTree.Name = "CmdTree"
cntIDCtlGridFrmCurTypeID.Olecommprox1.Top = 0
cntIDCtlGridFrmCurTypeID.Olecommprox1.Left = 36
cntIDCtlGridFrmCurTypeID.Olecommprox1.Height = 16
cntIDCtlGridFrmCurTypeID.Olecommprox1.Width = 38
cntIDCtlGridFrmCurTypeID.Olecommprox1.Name = "Olecommprox1"
cntIDCtlGridFrmCurTypeID.Name = "cntIDCtlGridFrmCurTypeID"
lblFrmStatus.Name = "lblFrmStatus"
cntIdCtlGridFrmStatus.txtText.Name = "txtText"
cntIdCtlGridFrmStatus.cmdShow.Name = "cmdShow"
cntIdCtlGridFrmStatus.cmdClear.Name = "cmdClear"
cntIdCtlGridFrmStatus.CmdTree.Name = "CmdTree"
cntIdCtlGridFrmStatus.Olecommprox1.Top = 0
cntIdCtlGridFrmStatus.Olecommprox1.Left = 36
cntIdCtlGridFrmStatus.Olecommprox1.Height = 16
cntIdCtlGridFrmStatus.Olecommprox1.Width = 38
cntIdCtlGridFrmStatus.Olecommprox1.Name = "Olecommprox1"
cntIdCtlGridFrmStatus.Name = "cntIdCtlGridFrmStatus"
lblFrmParID.Name = "lblFrmParID"
cntIDCtlGridFrmParID.txtText.Name = "txtText"
cntIDCtlGridFrmParID.cmdShow.Name = "cmdShow"
cntIDCtlGridFrmParID.cmdClear.Name = "cmdClear"
cntIDCtlGridFrmParID.CmdTree.Name = "CmdTree"
cntIDCtlGridFrmParID.Olecommprox1.Top = 0
cntIDCtlGridFrmParID.Olecommprox1.Left = 36
cntIDCtlGridFrmParID.Olecommprox1.Height = 16
cntIDCtlGridFrmParID.Olecommprox1.Width = 38
cntIDCtlGridFrmParID.Olecommprox1.Name = "Olecommprox1"
cntIDCtlGridFrmParID.Name = "cntIDCtlGridFrmParID"
shpControl.Name = "shpControl"
lblDev.WordWrap = .T.
lblDev.Left = 10
lblDev.Top = 218
lblDev.Name = "lblDev"
Lbl1.Enabled = .F.
Lbl1.Visible = .F.
Lbl1.Name = "Lbl1"
CntidctlgridPbook.txtText.Name = "txtText"
CntidctlgridPbook.cmdShow.Name = "cmdShow"
CntidctlgridPbook.cmdClear.Name = "cmdClear"
CntidctlgridPbook.CmdTree.Name = "CmdTree"
CntidctlgridPbook.Olecommprox1.Top = 0
CntidctlgridPbook.Olecommprox1.Left = 36
CntidctlgridPbook.Olecommprox1.Height = 16
CntidctlgridPbook.Olecommprox1.Width = 38
CntidctlgridPbook.Olecommprox1.Name = "Olecommprox1"
CntidctlgridPbook.Enabled = .F.
CntidctlgridPbook.Visible = .F.
CntidctlgridPbook.Name = "CntidctlgridPbook"
cntIdCtlGridDev.txtText.Name = "txtText"
cntIdCtlGridDev.cmdShow.Name = "cmdShow"
cntIdCtlGridDev.cmdClear.Name = "cmdClear"
cntIdCtlGridDev.CmdTree.Name = "CmdTree"
cntIdCtlGridDev.Olecommprox1.Top = 0
cntIdCtlGridDev.Olecommprox1.Left = 36
cntIdCtlGridDev.Olecommprox1.Height = 16
cntIdCtlGridDev.Olecommprox1.Width = 38
cntIdCtlGridDev.Olecommprox1.Name = "Olecommprox1"
cntIdCtlGridDev._controlsource = lvFrmEdit.FrmAttribute
cntIdCtlGridDev.Name = "cntIdCtlGridDev"
lblContr.WordWrap = .T.
lblContr.Name = "lblContr"
cntIdCtlGridContr.txtText.Name = "txtText"
cntIdCtlGridContr.cmdShow.Name = "cmdShow"
cntIdCtlGridContr.cmdClear.Name = "cmdClear"
cntIdCtlGridContr.CmdTree.Name = "CmdTree"
cntIdCtlGridContr.Olecommprox1.Top = 0
cntIdCtlGridContr.Olecommprox1.Left = 36
cntIdCtlGridContr.Olecommprox1.Height = 16
cntIdCtlGridContr.Olecommprox1.Width = 38
cntIdCtlGridContr.Olecommprox1.Name = "Olecommprox1"
cntIdCtlGridContr.Name = "cntIdCtlGridContr"
shpQualityEmi.Name = "shpQualityEmi"
lblPointEmi.Name = "lblPointEmi"
cntIdCtlGridPointEmi.txtText.Name = "txtText"
cntIdCtlGridPointEmi.cmdShow.Name = "cmdShow"
cntIdCtlGridPointEmi.cmdClear.Name = "cmdClear"
cntIdCtlGridPointEmi.CmdTree.Name = "CmdTree"
cntIdCtlGridPointEmi.Olecommprox1.Top = 0
cntIdCtlGridPointEmi.Olecommprox1.Left = 36
cntIdCtlGridPointEmi.Olecommprox1.Height = 16
cntIdCtlGridPointEmi.Olecommprox1.Width = 38
cntIdCtlGridPointEmi.Olecommprox1.Name = "Olecommprox1"
cntIdCtlGridPointEmi.Name = "cntIdCtlGridPointEmi"
lblPointEmiAccount.WordWrap = .T.
lblPointEmiAccount.Name = "lblPointEmiAccount"
cntIdCtlGridPointEmiAccount.txtText.Name = "txtText"
cntIdCtlGridPointEmiAccount.cmdShow.Name = "cmdShow"
cntIdCtlGridPointEmiAccount.cmdClear.Name = "cmdClear"
cntIdCtlGridPointEmiAccount.CmdTree.Name = "CmdTree"
cntIdCtlGridPointEmiAccount.Olecommprox1.Top = 0
cntIdCtlGridPointEmiAccount.Olecommprox1.Left = 36
cntIdCtlGridPointEmiAccount.Olecommprox1.Height = 16
cntIdCtlGridPointEmiAccount.Olecommprox1.Width = 38
cntIdCtlGridPointEmiAccount.Olecommprox1.Name = "Olecommprox1"
cntIdCtlGridPointEmiAccount.Name = "cntIdCtlGridPointEmiAccount"
lblExecEmi.WordWrap = .T.
lblExecEmi.Height = 32
lblExecEmi.Left = 10
lblExecEmi.Top = 306
lblExecEmi.Width = 80
lblExecEmi.Name = "lblExecEmi"
cntIdCtlGridExecEmi.txtText.Height = 23
cntIdCtlGridExecEmi.txtText.Left = 0
cntIdCtlGridExecEmi.txtText.Top = 0
cntIdCtlGridExecEmi.txtText.Width = 186
cntIdCtlGridExecEmi.txtText.Name = "txtText"
cntIdCtlGridExecEmi.cmdShow.Top = 0
cntIdCtlGridExecEmi.cmdShow.Left = 187
cntIdCtlGridExecEmi.cmdShow.Name = "cmdShow"
cntIdCtlGridExecEmi.cmdClear.Top = 0
cntIdCtlGridExecEmi.cmdClear.Left = 210
cntIdCtlGridExecEmi.cmdClear.Name = "cmdClear"
cntIdCtlGridExecEmi.CmdTree.Top = 0
cntIdCtlGridExecEmi.CmdTree.Left = 213
cntIdCtlGridExecEmi.CmdTree.Name = "CmdTree"
cntIdCtlGridExecEmi.Olecommprox1.Top = 0
cntIdCtlGridExecEmi.Olecommprox1.Left = 36
cntIdCtlGridExecEmi.Olecommprox1.Height = 16
cntIdCtlGridExecEmi.Olecommprox1.Width = 38
cntIdCtlGridExecEmi.Olecommprox1.Name = "Olecommprox1"
cntIdCtlGridExecEmi.Top = 312
cntIdCtlGridExecEmi.Left = 108
cntIdCtlGridExecEmi.Width = 232
cntIdCtlGridExecEmi.Height = 24
cntIdCtlGridExecEmi._controlsource = lvFrmEdit.ID_
cntIdCtlGridExecEmi.Name = "cntIdCtlGridExecEmi"
shpQualityIsp.Name = "shpQualityIsp"
lblPointIsp.WordWrap = .T.
lblPointIsp.Name = "lblPointIsp"
cntIdCtlGridPointIsp.txtText.Name = "txtText"
cntIdCtlGridPointIsp.cmdShow.Name = "cmdShow"
cntIdCtlGridPointIsp.cmdClear.Name = "cmdClear"
cntIdCtlGridPointIsp.CmdTree.Name = "CmdTree"
cntIdCtlGridPointIsp.Olecommprox1.Top = 0
cntIdCtlGridPointIsp.Olecommprox1.Left = 36
cntIdCtlGridPointIsp.Olecommprox1.Height = 16
cntIdCtlGridPointIsp.Olecommprox1.Width = 38
cntIdCtlGridPointIsp.Olecommprox1.Name = "Olecommprox1"
cntIdCtlGridPointIsp.Name = "cntIdCtlGridPointIsp"
lblPointIspAccount.WordWrap = .T.
lblPointIspAccount.Name = "lblPointIspAccount"
cntIdCtlGridPointIspAccount.txtText.Name = "txtText"
cntIdCtlGridPointIspAccount.cmdShow.Name = "cmdShow"
cntIdCtlGridPointIspAccount.cmdClear.Name = "cmdClear"
cntIdCtlGridPointIspAccount.CmdTree.Name = "CmdTree"
cntIdCtlGridPointIspAccount.Olecommprox1.Top = 0
cntIdCtlGridPointIspAccount.Olecommprox1.Left = 36
cntIdCtlGridPointIspAccount.Olecommprox1.Height = 16
cntIdCtlGridPointIspAccount.Olecommprox1.Width = 38
cntIdCtlGridPointIspAccount.Olecommprox1.Name = "Olecommprox1"
cntIdCtlGridPointIspAccount.Name = "cntIdCtlGridPointIspAccount"
lblExecIsp.WordWrap = .T.
lblExecIsp.Left = 360
lblExecIsp.Top = 306
lblExecIsp.Name = "lblExecIsp"
cntIdCtlGridExecIsp.txtText.Name = "txtText"
cntIdCtlGridExecIsp.cmdShow.Name = "cmdShow"
cntIdCtlGridExecIsp.cmdClear.Name = "cmdClear"
cntIdCtlGridExecIsp.CmdTree.Name = "CmdTree"
cntIdCtlGridExecIsp.Olecommprox1.Top = 0
cntIdCtlGridExecIsp.Olecommprox1.Left = 36
cntIdCtlGridExecIsp.Olecommprox1.Height = 16
cntIdCtlGridExecIsp.Olecommprox1.Width = 38
cntIdCtlGridExecIsp.Olecommprox1.Name = "Olecommprox1"
cntIdCtlGridExecIsp.Name = "cntIdCtlGridExecIsp"
lblFrmAttribute.Name = "lblFrmAttribute"
grdBit.COLUMN1.Header1.Name = "Header1"
grdBit.COLUMN1.CHK1.Alignment = 0
grdBit.COLUMN1.CHK1.Name = "CHK1"
grdBit.COLUMN1.Name = "COLUMN1"
grdBit.COLUMN2.Header1.Name = "Header1"
grdBit.COLUMN2.Txtgrd1.Name = "Txtgrd1"
grdBit.COLUMN2.Name = "COLUMN2"
grdBit.Name = "grdBit"
cntcancelsavehandled.cmdCancel.Name = "cmdCancel"
cntcancelsavehandled.cmdOk.Name = "cmdOk"
cntcancelsavehandled.Name = "cntcancelsavehandled"
cstdatawork.Name = "cstdatawork"
CmdOrigWork.Name = "CmdOrigWork"
CmdOrigDele.Name = "CmdOrigDele"
cmdToday.Name = "cmdToday"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7>ðåäàêòèðîâàíèå äîêóìåíòîâ ÑÌÊ</reserved7>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>frmpdeditsmk</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
Arial, 1, 9, 6, 15, 12, 32, 3, 0
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2HJ108LI8</uniqueid>
		<timestamp>1081833764</timestamp>
		<class>frmprimarydocview</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>form</baseclass>
		<objname>frmprimarydocviewqms</objname>
		<parent/>
		<properties>Top = 0
Left = 0
DoCreate = .T.
viewfrm = .T.
viewhistory = .T.
viewprbook = .T.
viewres = .T.
viewtvr = .T.
Name = "frmprimarydocviewqms"
cstmsghandler.Top = 432
cstmsghandler.Left = 516
cstmsghandler.Height = 17
cstmsghandler.Width = 108
cstmsghandler.Name = "cstmsghandler"
cstresizable.Top = 432
cstresizable.Left = 468
cstresizable.Name = "cstresizable"
Img1.ZOrderSet = 0
Img1.Name = "Img1"
CmdFlt.Top = 438
CmdFlt.Left = 606
CmdFlt.ZOrderSet = 1
CmdFlt.Name = "CmdFlt"
Cntfrmstatusinfo1.ShpFrmStatusInfo.Name = "ShpFrmStatusInfo"
Cntfrmstatusinfo1.lblStatusID.Name = "lblStatusID"
Cntfrmstatusinfo1.shpStatusID1.Name = "shpStatusID1"
Cntfrmstatusinfo1.lblStatusID1.Name = "lblStatusID1"
Cntfrmstatusinfo1.shpStatusID2.Name = "shpStatusID2"
Cntfrmstatusinfo1.lblStatusID2.Name = "lblStatusID2"
Cntfrmstatusinfo1.shpStatusID3.Name = "shpStatusID3"
Cntfrmstatusinfo1.lblStatusID3.Name = "lblStatusID3"
Cntfrmstatusinfo1.shpStatusID4.Name = "shpStatusID4"
Cntfrmstatusinfo1.lblStatusID4.Name = "lblStatusID4"
Cntfrmstatusinfo1.Top = 444
Cntfrmstatusinfo1.Left = 5
Cntfrmstatusinfo1.ZOrderSet = 3
Cntfrmstatusinfo1.Name = "Cntfrmstatusinfo1"
math.Name = "math"
cntSum.Shp2.Name = "Shp2"
cntSum.lblDocumentCountCaption.Name = "lblDocumentCountCaption"
cntSum.txtDocumentCount.Name = "txtDocumentCount"
cntSum.txtDocumentSum.Name = "txtDocumentSum"
cntSum.txtDocumentVatSum.Name = "txtDocumentVatSum"
cntSum.txtDocumentCountMark.Name = "txtDocumentCountMark"
cntSum.txtDocumentVatSumMark.Name = "txtDocumentVatSumMark"
cntSum.Lbl1.Name = "Lbl1"
cntSum.txtDocumentSumMark.Name = "txtDocumentSumMark"
cntSum.Top = 223
cntSum.Left = 12
cntSum.Width = 684
cntSum.Height = 20
cntSum.ZOrderSet = 5
cntSum.Name = "cntSum"
GrdDocsView.Cl1.Header1.Name = "Header1"
GrdDocsView.Cl1.Text1.Name = "Text1"
GrdDocsView.Cl1.Name = "Cl1"
GrdDocsView.Cl2.Header1.Name = "Header1"
GrdDocsView.Cl2.Name = "Cl2"
GrdDocsView.ClShortNM.Header1.Name = "Header1"
GrdDocsView.ClShortNM.Text1.Name = "Text1"
GrdDocsView.ClShortNM.ColumnOrder = 2
GrdDocsView.ClShortNM.Width = 29
GrdDocsView.ClShortNM.Name = "ClShortNM"
GrdDocsView.ClFrmDate.Header1.Name = "Header1"
GrdDocsView.ClFrmDate.Text1.Name = "Text1"
GrdDocsView.ClFrmDate.ColumnOrder = 4
GrdDocsView.ClFrmDate.Width = 72
GrdDocsView.ClFrmDate.Name = "ClFrmDate"
GrdDocsView.ClFrmNum.Header1.Name = "Header1"
GrdDocsView.ClFrmNum.Text1.Name = "Text1"
GrdDocsView.ClFrmNum.ColumnOrder = 5
GrdDocsView.ClFrmNum.Width = 57
GrdDocsView.ClFrmNum.Name = "ClFrmNum"
GrdDocsView.ClPemiNM.Header1.Name = "Header1"
GrdDocsView.ClPemiNM.Text1.Name = "Text1"
GrdDocsView.ClPemiNM.ColumnOrder = 7
GrdDocsView.ClPemiNM.Name = "ClPemiNM"
GrdDocsView.ClPIspNM.Header1.Name = "Header1"
GrdDocsView.ClPIspNM.Text1.Name = "Text1"
GrdDocsView.ClPIspNM.ColumnOrder = 13
GrdDocsView.ClPIspNM.Name = "ClPIspNM"
GrdDocsView.ClFrmSum.Header1.Caption = "Ñóììà îòãðóæåíî"
GrdDocsView.ClFrmSum.Header1.Name = "Header1"
GrdDocsView.ClFrmSum.Text1.ControlSource = "PrimaryDocView.FrmSumTvr"
GrdDocsView.ClFrmSum.Text1.Enabled = .F.
GrdDocsView.ClFrmSum.Text1.Visible = .F.
GrdDocsView.ClFrmSum.Text1.cgrdtotal = FrmSumTvr
GrdDocsView.ClFrmSum.Text1.Name = "Text1"
GrdDocsView.ClFrmSum.ControlSource = "PrimaryDocView.FrmSumTvr"
GrdDocsView.ClFrmSum.Enabled = .F.
GrdDocsView.ClFrmSum.Visible = .F.
GrdDocsView.ClFrmSum.Name = "ClFrmSum"
GrdDocsView.ClFrmVatSum.Header1.Name = "Header1"
GrdDocsView.ClFrmVatSum.Text1.Enabled = .T.
GrdDocsView.ClFrmVatSum.Text1.Visible = .F.
GrdDocsView.ClFrmVatSum.Text1.Name = "Text1"
GrdDocsView.ClFrmVatSum.Enabled = .T.
GrdDocsView.ClFrmVatSum.Visible = .F.
GrdDocsView.ClFrmVatSum.Name = "ClFrmVatSum"
GrdDocsView.ClFrmSumBuy.Header1.Caption = "Ñóììà ïîëó÷åíî"
GrdDocsView.ClFrmSumBuy.Header1.Name = "Header1"
GrdDocsView.ClFrmSumBuy.Text1.ControlSource = "PrimaryDocView.FrmPay"
GrdDocsView.ClFrmSumBuy.Text1.Enabled = .F.
GrdDocsView.ClFrmSumBuy.Text1.Visible = .F.
GrdDocsView.ClFrmSumBuy.Text1.Name = "Text1"
GrdDocsView.ClFrmSumBuy.ControlSource = "PrimaryDocView.FrmPay*-1"
GrdDocsView.ClFrmSumBuy.Enabled = .F.
GrdDocsView.ClFrmSumBuy.Visible = .F.
GrdDocsView.ClFrmSumBuy.Name = "ClFrmSumBuy"
GrdDocsView.ClFrmVatBuy.Header1.Name = "Header1"
GrdDocsView.ClFrmVatBuy.Text1.Enabled = .F.
GrdDocsView.ClFrmVatBuy.Text1.Name = "Text1"
GrdDocsView.ClFrmVatBuy.Enabled = .F.
GrdDocsView.ClFrmVatBuy.Name = "ClFrmVatBuy"
GrdDocsView.ClFrmSumSale.Header1.Name = "Header1"
GrdDocsView.ClFrmSumSale.Text1.Enabled = .F.
GrdDocsView.ClFrmSumSale.Text1.Name = "Text1"
GrdDocsView.ClFrmSumSale.Enabled = .F.
GrdDocsView.ClFrmSumSale.Name = "ClFrmSumSale"
GrdDocsView.ClFrmVatSale.Header1.Name = "Header1"
GrdDocsView.ClFrmVatSale.Text1.Enabled = .F.
GrdDocsView.ClFrmVatSale.Text1.Name = "Text1"
GrdDocsView.ClFrmVatSale.Enabled = .F.
GrdDocsView.ClFrmVatSale.Name = "ClFrmVatSale"
GrdDocsView.ClFrmBNDS10.Header1.Name = "Header1"
GrdDocsView.ClFrmBNDS10.Text1.Name = "Text1"
GrdDocsView.ClFrmBNDS10.Name = "ClFrmBNDS10"
GrdDocsView.ClFrmBNDS18.Header1.Name = "Header1"
GrdDocsView.ClFrmBNDS18.Text1.Name = "Text1"
GrdDocsView.ClFrmBNDS18.Name = "ClFrmBNDS18"
GrdDocsView.ClDevCltNM.Header1.Name = "Header1"
GrdDocsView.ClDevCltNM.Text1.Enabled = .F.
GrdDocsView.ClDevCltNM.Text1.Visible = .T.
GrdDocsView.ClDevCltNM.Text1.Name = "Text1"
GrdDocsView.ClDevCltNM.Visible = .T.
GrdDocsView.ClDevCltNM.Name = "ClDevCltNM"
GrdDocsView.ClFrmDateAcc.Header1.Name = "Header1"
GrdDocsView.ClFrmDateAcc.Text1.Enabled = .T.
GrdDocsView.ClFrmDateAcc.Text1.Visible = .T.
GrdDocsView.ClFrmDateAcc.Text1.Name = "Text1"
GrdDocsView.ClFrmDateAcc.Enabled = .T.
GrdDocsView.ClFrmDateAcc.Visible = .T.
GrdDocsView.ClFrmDateAcc.Name = "ClFrmDateAcc"
GrdDocsView.ClExEmiCltNM.Header1.Name = "Header1"
GrdDocsView.ClExEmiCltNM.Text1.Enabled = .T.
GrdDocsView.ClExEmiCltNM.Text1.Visible = .T.
GrdDocsView.ClExEmiCltNM.Text1.Name = "Text1"
GrdDocsView.ClExEmiCltNM.Enabled = .T.
GrdDocsView.ClExEmiCltNM.Visible = .T.
GrdDocsView.ClExEmiCltNM.Name = "ClExEmiCltNM"
GrdDocsView.ClFrmPay.Header1.Name = "Header1"
GrdDocsView.ClFrmPay.Text1.ControlSource = "PrimaryDocView.FrmPay"
GrdDocsView.ClFrmPay.Text1.Enabled = .F.
GrdDocsView.ClFrmPay.Text1.Visible = .F.
GrdDocsView.ClFrmPay.Text1.cgrdtotal = FrmPay
GrdDocsView.ClFrmPay.Text1.Name = "Text1"
GrdDocsView.ClFrmPay.Enabled = .F.
GrdDocsView.ClFrmPay.Visible = .F.
GrdDocsView.ClFrmPay.Name = "ClFrmPay"
GrdDocsView.ClFrmTotal.Header1.Name = "Header1"
GrdDocsView.ClFrmTotal.Text1.ControlSource = "PrimaryDocView.FrmSum"
GrdDocsView.ClFrmTotal.Text1.Enabled = .F.
GrdDocsView.ClFrmTotal.Text1.Visible = .F.
GrdDocsView.ClFrmTotal.Text1.cgrdtotal = FrmSum
GrdDocsView.ClFrmTotal.Text1.Name = "Text1"
GrdDocsView.ClFrmTotal.ControlSource = "PrimaryDocView.FrmSum"
GrdDocsView.ClFrmTotal.Enabled = .F.
GrdDocsView.ClFrmTotal.Visible = .F.
GrdDocsView.ClFrmTotal.Name = "ClFrmTotal"
GrdDocsView.Column21.Header1.Name = "Header1"
GrdDocsView.Column21.Text1.Name = "Text1"
GrdDocsView.Column21.Name = "Column21"
GrdDocsView.Column22.Header1.Name = "Header1"
GrdDocsView.Column22.Text1.Name = "Text1"
GrdDocsView.Column22.Name = "Column22"
GrdDocsView.Column23.Header1.Name = "Header1"
GrdDocsView.Column23.Text1.Name = "Text1"
GrdDocsView.Column23.Name = "Column23"
GrdDocsView.Column24.Header1.Name = "Header1"
GrdDocsView.Column24.Text1.Name = "Text1"
GrdDocsView.Column24.Name = "Column24"
GrdDocsView.Column25.Header1.Name = "Header1"
GrdDocsView.Column25.Text1.Name = "Text1"
GrdDocsView.Column25.Name = "Column25"
GrdDocsView.Column26.Header1.Name = "Header1"
GrdDocsView.Column26.Text1.Name = "Text1"
GrdDocsView.Column26.Name = "Column26"
GrdDocsView.Column27.Header1.Name = "Header1"
GrdDocsView.Column27.Text1.Name = "Text1"
GrdDocsView.Column27.Name = "Column27"
GrdDocsView.Column28.Header1.Name = "Header1"
GrdDocsView.Column28.Text1.Name = "Text1"
GrdDocsView.Column28.Name = "Column28"
GrdDocsView.Column29.Header1.Name = "Header1"
GrdDocsView.Column29.Text1.Name = "Text1"
GrdDocsView.Column29.Name = "Column29"
GrdDocsView.Column30.Header1.Name = "Header1"
GrdDocsView.Column30.Text1.Name = "Text1"
GrdDocsView.Column30.Name = "Column30"
GrdDocsView.Column31.Header1.Name = "Header1"
GrdDocsView.Column31.Text1.Name = "Text1"
GrdDocsView.Column31.Name = "Column31"
GrdDocsView.Column32.Header1.Name = "Header1"
GrdDocsView.Column32.Text1.Name = "Text1"
GrdDocsView.Column32.Name = "Column32"
GrdDocsView.Column33.Header1.Name = "Header1"
GrdDocsView.Column33.Text1.Name = "Text1"
GrdDocsView.Column33.Name = "Column33"
GrdDocsView.Column34.Header1.Name = "Header1"
GrdDocsView.Column34.Text1.Name = "Text1"
GrdDocsView.Column34.Name = "Column34"
GrdDocsView.Column35.Header1.Name = "Header1"
GrdDocsView.Column35.Text1.Name = "Text1"
GrdDocsView.Column35.Name = "Column35"
GrdDocsView.Column36.Header1.Name = "Header1"
GrdDocsView.Column36.Text1.Name = "Text1"
GrdDocsView.Column36.Name = "Column36"
GrdDocsView.Column37.Header1.Name = "Header1"
GrdDocsView.Column37.Text1.Name = "Text1"
GrdDocsView.Column37.Name = "Column37"
GrdDocsView.Column38.Header1.Name = "Header1"
GrdDocsView.Column38.Text1.Name = "Text1"
GrdDocsView.Column38.Name = "Column38"
GrdDocsView.Column39.Header1.Name = "Header1"
GrdDocsView.Column39.Text1.Name = "Text1"
GrdDocsView.Column39.Name = "Column39"
GrdDocsView.Column40.Header1.Name = "Header1"
GrdDocsView.Column40.Text1.Name = "Text1"
GrdDocsView.Column40.Name = "Column40"
GrdDocsView.Column41.Header1.Name = "Header1"
GrdDocsView.Column41.Text1.Name = "Text1"
GrdDocsView.Column41.Name = "Column41"
GrdDocsView.Column42.Header1.Name = "Header1"
GrdDocsView.Column42.Text1.Name = "Text1"
GrdDocsView.Column42.Name = "Column42"
GrdDocsView.Column43.Header1.Name = "Header1"
GrdDocsView.Column43.Text1.Name = "Text1"
GrdDocsView.Column43.Name = "Column43"
GrdDocsView.Column44.Header1.Name = "Header1"
GrdDocsView.Column44.Text1.Name = "Text1"
GrdDocsView.Column44.Name = "Column44"
GrdDocsView.Column45.Header1.Name = "Header1"
GrdDocsView.Column45.Text1.Name = "Text1"
GrdDocsView.Column45.Name = "Column45"
GrdDocsView.Column46.Header1.Name = "Header1"
GrdDocsView.Column46.Text1.Name = "Text1"
GrdDocsView.Column46.Name = "Column46"
GrdDocsView.Column47.Header1.Name = "Header1"
GrdDocsView.Column47.Text1.Name = "Text1"
GrdDocsView.Column47.Name = "Column47"
GrdDocsView.Column48.Header1.Name = "Header1"
GrdDocsView.Column48.Text1.Name = "Text1"
GrdDocsView.Column48.Name = "Column48"
GrdDocsView.ClFrmNote.Header1.Caption = "Íàèìåíîâàíèå ïðîöåññà"
GrdDocsView.ClFrmNote.Header1.Name = "Header1"
GrdDocsView.ClFrmNote.Text1.Name = "Text1"
GrdDocsView.ClFrmNote.ColumnOrder = 6
GrdDocsView.ClFrmNote.Width = 170
GrdDocsView.ClFrmNote.Name = "ClFrmNote"
GrdDocsView.ClFrmReason.Header1.Caption = "Îïèñàíèå"
GrdDocsView.ClFrmReason.Header1.Name = "Header1"
GrdDocsView.ClFrmReason.Text1.Name = "Text1"
GrdDocsView.ClFrmReason.Width = 113
GrdDocsView.ClFrmReason.Name = "ClFrmReason"
GrdDocsView.Height = 225
GrdDocsView.Left = 0
GrdDocsView.Panel = 1
GrdDocsView.Top = 0
GrdDocsView.Width = 701
GrdDocsView.ZOrderSet = 8
GrdDocsView.cgrdtotal = 
GrdDocsView.Name = "GrdDocsView"
splitter2.Top = 224
splitter2.Left = 2
splitter2.Height = 4
splitter2.Width = 697
splitter2.Enabled = .T.
splitter2.ZOrderSet = 7
splitter2.Name = "splitter2"
</properties>
		<protected/>
		<methods>PROCEDURE Cntfrmstatusinfo1.lblStatusID1.Click
DODEFAULT()
thisform.grdPartPr._rsrequery(PrimaryDocView.FrmID)

ENDPROC
PROCEDURE Cntfrmstatusinfo1.lblStatusID2.Click
DODEFAULT()
thisform.grdPartPr._rsrequery(PrimaryDocView.FrmID)

ENDPROC
PROCEDURE Cntfrmstatusinfo1.lblStatusID3.Click
DODEFAULT()
thisform.grdPartPr._rsrequery(PrimaryDocView.FrmID)

ENDPROC
PROCEDURE Cntfrmstatusinfo1.lblStatusID4.Click
DODEFAULT()
thisform.grdPartPr._rsrequery(PrimaryDocView.FrmID)

ENDPROC
PROCEDURE GrdDocsView._add
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRIMARYDOC_V1.VCX
* Class.Module....: GRDDOCSVIEW._ADD
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Äîáàâëåíèå äîêóìåíòà.
*-------------------------------------------------------

*12.05.2004 03:25 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	luResAdding
*------------------------------------------------------------------------------

*12.05.2004 03:26 -&gt;Âûïîëíÿåì îïåðàöèþ äîáàâëåíèÿ äîêóìåíòà
luResAdding = oMgrPD.Operate([FORM],[ADD],ThisForm.nScrFrmID)
*------------------------------------------------------------------------------
*** - 22.03.2009 09:16:56 Ãëóõîâ Â.Þ. (C) - Ïðàâà ïðèíàäëåæàò
* Îáðàáàòûâàåì ðåçóëüòàò äîáàâëåíèÿ
IF TYPE([luResAdding])==[N] AND !EMPTY(luResAdding)
	IF thisform.SelectSour.PrBook.Value  =1
		LOCAL luResultAdding
		*express_add = .t.
		DO WHILE TYPE('luResAdding')=[N] AND luResAdding&lt;&gt;0
luResultAdding = oMgrPD.Operate([PARTPRBOOK],[ADD],luResAdding )
IF TYPE('luResultAdding')&lt;&gt;[N] OR luResultAdding =0
EXIT
ENDIF
		ENDDO
	ENDIF
	*22.12.2004 15:16 -&gt;Îáíîâëÿåì çàïèñü
	This._RSRequeryOne(luResAdding)
ENDIF
*------------------------------------------------------------------------------

************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE GrdDocsView._refreshrelatedobjects
LOCAL _PARAM
_PARAM = PrimaryDocView.FrmID
**USE lvFrmContain IN 0
WITH ThisForm
*!*	IF .ViewHistory
*!*	          .GrdPartHS._RSRequery(PrimaryDocView.FrmID)
*!*	ENDIF
*!*	IF .ViewPrBook
*!*	          .GrdPartPr._RSRequery(PrimaryDocView.FrmID)
*!*	ENDIF
*!*	IF .ViewFrm
*!*	          .GrdPartFrm._RSRequery(PrimaryDocView.FrmID)
*!*	ENDIF
*!*	IF .ViewTvr
*!*	          .GrdPartTvr._RSRequery(PrimaryDocView.FrmID)
*!*	ENDIF
*!*	IF .ViewRes
*!*	          .GrdPartRes._RSRequery(PrimaryDocView.FrmID)
*!*	ENDIF

*!*	IF (.SelectSour.Hist.Value =1)
*!*	*  .GrdPartHS.SourceKeep()
*!*	  .GrdPartHs.Visible  = .t.
*!*	ENDIF
*!*	IF (.SelectSour.PrBook.Value =1)
*!*	*  .GrdPartPr.SourceKeep()
*!*	  .GrdPartPr.Visible  = .t.
*!*	ENDIF
*!*	IF (.SelectSour.FrmIncl.Value =1)
*!*	*  .GrdPartFrm.SourceKeep()
*!*	  .GrdPartFrm.Visible = .t.
*!*	ENDIF
*!*	IF (.SelectSour.Sour.Value =1)
*!*	*  .GrdPartTvr.SourceKeep()
*!*	  .GrdPartTvr.Visible = .t.
*!*	ENDIF
*!*	IF (.SelectSour.Resurs.Value =1)
*!*	*  .GrdPartRes.SourceKeep()
*!*	  .GrdPartRes.Visible = .t.
*!*	ENDIF

.GrdPartHs.Visible  = (.SelectSour.Hist.Value    =1)
.GrdPartHs.Enabled  = (.SelectSour.Hist.Value    =1)
.GrdPartPr.Visible  = (.SelectSour.PrBook.Value  =1)
.GrdPartPr.Enabled  = (.SelectSour.PrBook.Value  =1)
.GrdPartFrm.Visible = (.SelectSour.FrmIncl.Value =1)
.GrdPartFrm.Enabled = (.SelectSour.FrmIncl.Value =1)
.GrdPartTvr.Visible = (.SelectSour.Sour.Value    =1)
.GrdPartTvr.Enabled = (.SelectSour.Sour.Value    =1)
.GrdPartRes.Visible = (.SelectSour.Resurs.Value  =1)
.GrdPartRes.Enabled = (.SelectSour.Resurs.Value  =1)
DO CASE
CASE .SelectSour.Hist.Value   =1
.GrdPartHS.SourceRecall()
.GrdPartHS._RSRequery(PrimaryDocView.FrmID)
CASE .SelectSour.PrBook.Value =1
.GrdPartPr.SourceRecall()
.GrdPartPr._RSRequery(PrimaryDocView.FrmID)
CASE .SelectSour.FrmIncl.Value =1
.GrdPartFrm.SourceRecall()
.GrdPartFrm._RSRequery(PrimaryDocView.FrmID)
CASE .SelectSour.Sour.Value =1
.GrdPartTvr.SourceRecall()
.GrdPartTvr._RSRequery(PrimaryDocView.FrmID)
CASE .SelectSour.Resurs.Value =1
.GrdPartRes.SourceRecall()
.GrdPartRes._RSRequery(PrimaryDocView.FrmID)
ENDCASE

ENDWITH
ENDPROC
PROCEDURE Init
LPARAMETERS	tnScrFrmID
DODEFAULT(tnScrFrmID)
WITH ThisForm

*.GrdPartHS.SourceKeep()
*!*	  .GrdPartPr.SourceKeep()
*.GrdPartFrm.SourceKeep()
*!*	  .GrdPartTvr.SourceKeep()
*!*	  .GrdPartRes.SourceKeep()

*!*			  .GrdPartHs.Visible  = .ViewHistory
*!*			  .GrdPartHs.Enabled  = .ViewHistory
*!*			  .GrdPartPr.Visible  = .ViewPrBook
*!*			  .GrdPartPr.Enabled  = .ViewPrBook
*!*	 		  .GrdPartFrm.Visible = .ViewFrm
*!*			  .GrdPartFrm.Enabled = .ViewFrm
*!*	          .GrdPartRes.Visible = .ViewRes
*!*	          .GrdPartRes.Enabled = .ViewRes
*!*	          .GrdPartTvr.Visible = .ViewTvr
*!*	          .GrdPartTvr.Enabled = .ViewTvr
*!*	
*!*	         .GrdPartTvr.SetFocus()

*!*	 DO CASE
*!*	     CASE .ViewHistory
*!*			  .GrdPartHs.Visible  = .t.
*!*			  .GrdPartHs.Enabled  = .t.
*!*	     CASE .ViewPrBook
*!*			  .GrdPartPr.Visible  = .t.
*!*			  .GrdPartPr.Enabled  = .t.
*!*	     CASE .ViewFrm
*!*	 		  .GrdPartFrm.Visible = .t.
*!*			  .GrdPartFrm.Enabled = .t.
*!*	     CASE .ViewTvr
*!*	          .GrdPartTvr.Visible = .t.
*!*	          .GrdPartTvr.Enabled = .t.
*!*	     CASE .ViewRes
*!*	          .GrdPartRes.Visible = .t.
*!*	          .GrdPartRes.Enabled = .t.
*!*	       OTHERWISE
*!*	          .GrdPartTvr.Visible = .t.
*!*	          .GrdPartTvr.Enabled = .t.
*!*	 ENDCASE
ENDWITH
ENDPROC
PROCEDURE Load
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRIMARYDOC_V1.VCX
* Class.Module....: FRMPRIMARYDOCVIEWTVR.LOAD
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Îòêðûòèå LV äëÿ Grid-à ñ ñîäåðæàíèåì äîêóìåíòà (òîâàðíûì)
*-------------------------------------------------------
*14.07.2004 00:13 -&gt;Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------

*******************************************************************************
*1. Çàãðóçèì ïóñòîé Alias äëÿ ïðîñìîòðà íîã äîêóìåíòîâ                        *
*******************************************************************************

*02.12.2004 16:59 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcUniqueNameBook,lcUniqueNameFrm,lcUniqueNameTvr,lcUniqueNameAct,lcUniqueNameRes
*------------------------------------------------------------------------------
*21.04.2004 14:05 -&gt;Âûïîëíèì õðàíèìóþ ïðîöåäóðó äëÿ ïîëó÷åíèÿ ïóñòîé òàáëèöû
lcUniqueNameBook = spFrmPrBookView([NODATA])
lcUniqueNameFrm  = spFrmPartFrmViewQMS([NODATA])
lcUniqueNameTvr  = spFrmPartTvrView([NODATA])
*lcUniqueNameAct  = spFrmActionView([NODATA])
lcUniqueNameRes = spFrmPartTvrJrnView([NODATA])
*------------------------------------------------------------------------------

*21.04.2004 14:08 -&gt;Òåïåðü îòêðîåì äàííûé Alias
USE (lcUniqueNameRes) IN 0 ALIAS FrmPartResView
CURSORSETPROP([BUFFERING],3,[FrmPartResView])
*------------------------------------------------------------------------------
*------------------------------------------------------------------------------
*21.04.2004 14:08 -&gt;Òåïåðü îòêðîåì äàííûé Alias
USE (lcUniqueNameBook) IN 0 ALIAS FrmPrBookView
CURSORSETPROP([BUFFERING],3,[FrmPrBookView])
USE (lcUniqueNameFrm) IN 0 ALIAS FrmPartFrmView
CURSORSETPROP([BUFFERING],3,[FrmPartFrmView])
USE (lcUniqueNameTvr) IN 0 ALIAS FrmPartTvrView
CURSORSETPROP([BUFFERING],3,[FrmPartTvrView])
USE lvFrmActionView IN 0 NODATA

************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE Resize
LOCAL Caller
Caller=UPPER(PROGRAM(1))
IF Caller="FORM1.SPLITTER2"
		* up down resize/reposition
		this.grdDocsView.Height = this.Splitter2.Top-5
		this.grdpartfrm.Top=this.Splitter2.Top+this.Splitter2.Height+1
		this.grdPartHs.Top= this.grdpartfrm.Top
		this.grdPartPr.Top= this.grdpartfrm.Top
		this.grdpartres.Top= this.grdpartfrm.Top
		this.grdparttvr.Top= this.grdpartfrm.Top

		this.grdpartfrm.Height=this.Height-this.grdpartfrm.Top-10
		this.grdPartHs.Height= this.grdpartfrm.Height
		this.grdPartPr.Height= this.grdpartfrm.Height
		this.grdpartres.Height= this.grdpartfrm.Height
		this.grdparttvr.Height= this.grdpartfrm.Height
	ELSE
		DODEFAULT()
ENDIF

ENDPROC
PROCEDURE Unload
*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocViewTvr.UnLoad
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;sysevent&gt; Âûãðóçêà ôîðìû
*-------------------------------------------------------

*21.07.2004 16:27 -&gt; Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*----------------------------------------------------------------------------

*****************************************************************************
* Çàêðîåì Alias äëÿ ïðîñìîòðà òîâàðíûõ ïîçèöèé äîêóìåíòîâ è óäàëèì âðåìåííóþ*
* òàáëèöó                                                                   *
*****************************************************************************

*21.07.2004 16:27 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcUniqueFilePath
*------------------------------------------------------------------------------

*21.07.2004 16:27 -&gt; Çàêðîåì Alias è óäàëèì âðåìåííóþ òàáëèöó
lcUniqueFilePath = DBF([FrmPrBookView])
***
USE IN FrmPrBookView
***
IF FILE(lcUniqueFilePath)
	ERASE (lcUniqueFilePath)
ENDIF
*------------------------------------------------------------------------------
lcUniqueFilePath = DBF([FrmPartFrmView])
***
USE IN FrmPartFrmView
***
IF FILE(lcUniqueFilePath)
	ERASE (lcUniqueFilePath)
ENDIF
*------------------------------------------------------------------------------
lcUniqueFilePath = DBF([FrmPartTvrView])
***
USE IN FrmPartTvrView
***
IF FILE(lcUniqueFilePath)
	ERASE (lcUniqueFilePath)
ENDIF
USE IN lvFrmActionView

*!*	*21.07.2004 16:27 -&gt; Çàêðîåì Alias è óäàëèì âðåìåííóþ òàáëèöó
*!*	lcUniqueFilePath = DBF([FrmPartResView])
*!*	***
*!*	USE IN FrmPartResView
*!*	***
*!*	IF FILE(lcUniqueFilePath)
*!*		ERASE (lcUniqueFilePath)
*!*	ENDIF

*!*	*------------------------------------------------------------------------------

************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>11</reserved2>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7>Ðàáîòà ñ äîêóìåíòàìè ïî ÑÌÊ</reserved7>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2HJ10U0H3</uniqueid>
		<timestamp>1080973413</timestamp>
		<class>optiongroup</class>
		<classloc/>
		<baseclass>optiongroup</baseclass>
		<objname>SelectSour</objname>
		<parent>frmprimarydocviewqms</parent>
		<properties>ButtonCount = 5
Value = 4
Height = 18
Left = 13
SpecialEffect = 0
Top = 426
Width = 451
ZOrderSet = 4
Name = "SelectSour"
Option1.Caption = "Ïðîäóêòû"
Option1.Value = 0
Option1.Enabled = .F.
Option1.Height = 17
Option1.Left = 9
Option1.Top = 0
Option1.Width = 100
Option1.Name = "Sour"
Option2.Caption = "Ïðîâîäêè"
Option2.Enabled = .F.
Option2.Height = 17
Option2.Left = 105
Option2.Top = 0
Option2.Width = 84
Option2.Name = "PrBook"
Option3.Caption = "Èñòîðèÿ"
Option3.Height = 17
Option3.Left = 201
Option3.Top = 0
Option3.Width = 72
Option3.Name = "Hist"
Option4.Caption = "Äîêóìåíòû"
Option4.Value = 1
Option4.Height = 17
Option4.Left = 284
Option4.Top = 0
Option4.Width = 84
Option4.Name = "FrmIncl"
Option5.Caption = "Ðåñóðñû"
Option5.Enabled = .F.
Option5.Height = 17
Option5.Left = 376
Option5.Top = 0
Option5.Width = 65
Option5.Name = "Resurs"
</properties>
		<protected/>
		<methods>PROCEDURE InteractiveChange
thisform.grdDocsView._refreshrelatedobjects()
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2SM194CHM</uniqueid>
		<timestamp>1080973413</timestamp>
		<class>commandbutton</class>
		<classloc/>
		<baseclass>commandbutton</baseclass>
		<objname>Cmd1</objname>
		<parent>frmprimarydocviewqms</parent>
		<properties>Top = 444
Left = 564
Height = 25
Width = 25
Caption = ""
Enabled = .F.
Visible = .F.
ZOrderSet = 6
Name = "Cmd1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3GE0NOTNT</uniqueid>
		<timestamp>1080974217</timestamp>
		<class>grdparttvr</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>grid</baseclass>
		<objname>Grdparttvr</objname>
		<parent>frmprimarydocviewqms</parent>
		<properties>Enabled = .F.
Height = 184
Left = 3
Top = 243
Visible = .F.
Width = 690
ZOrderSet = 9
Name = "Grdparttvr"
Column1.Header1.Name = "Header1"
Column1.Text1.Enabled = .F.
Column1.Text1.Visible = .F.
Column1.Text1.Name = "Text1"
Column1.Enabled = .F.
Column1.Visible = .F.
Column1.Name = "Column1"
Column2.Header1.Name = "Header1"
Column2.Text1.Enabled = .F.
Column2.Text1.Visible = .F.
Column2.Text1.Name = "Text1"
Column2.Enabled = .F.
Column2.Visible = .F.
Column2.Name = "Column2"
Column3.Header1.Name = "Header1"
Column3.Text1.Enabled = .F.
Column3.Text1.Visible = .F.
Column3.Text1.Name = "Text1"
Column3.Enabled = .F.
Column3.Visible = .F.
Column3.Name = "Column3"
Column4.Header1.Name = "Header1"
Column4.Text1.Enabled = .F.
Column4.Text1.Visible = .F.
Column4.Text1.Name = "Text1"
Column4.Enabled = .F.
Column4.Visible = .F.
Column4.Name = "Column4"
COLUMN5.Header1.Name = "Header1"
COLUMN5.Text1.Enabled = .F.
COLUMN5.Text1.Visible = .F.
COLUMN5.Text1.Name = "Text1"
COLUMN5.Enabled = .F.
COLUMN5.Visible = .F.
COLUMN5.Name = "COLUMN5"
COLUMN6.Header1.Name = "Header1"
COLUMN6.Text1.Enabled = .F.
COLUMN6.Text1.Visible = .F.
COLUMN6.Text1.Name = "Text1"
COLUMN6.Enabled = .F.
COLUMN6.Visible = .F.
COLUMN6.Name = "COLUMN6"
COLUMN7.Header1.Name = "Header1"
COLUMN7.Text1.Enabled = .F.
COLUMN7.Text1.Visible = .F.
COLUMN7.Text1.Name = "Text1"
COLUMN7.Enabled = .F.
COLUMN7.Visible = .F.
COLUMN7.Name = "COLUMN7"
COLUMN8.Header1.Name = "Header1"
COLUMN8.Text1.Enabled = .F.
COLUMN8.Text1.Visible = .F.
COLUMN8.Text1.Name = "Text1"
COLUMN8.Enabled = .F.
COLUMN8.Visible = .F.
COLUMN8.Name = "COLUMN8"
COLUMN9.Header1.Name = "Header1"
COLUMN9.Text1.Enabled = .F.
COLUMN9.Text1.Visible = .F.
COLUMN9.Text1.Name = "Text1"
COLUMN9.Enabled = .F.
COLUMN9.Visible = .F.
COLUMN9.Name = "COLUMN9"
COLUMN10.Header1.Name = "Header1"
COLUMN10.Text1.Enabled = .F.
COLUMN10.Text1.Visible = .F.
COLUMN10.Text1.Name = "Text1"
COLUMN10.Enabled = .F.
COLUMN10.Visible = .F.
COLUMN10.Name = "COLUMN10"
COLUMN11.Header1.Name = "Header1"
COLUMN11.Text1.Enabled = .F.
COLUMN11.Text1.Visible = .F.
COLUMN11.Text1.Name = "Text1"
COLUMN11.Enabled = .F.
COLUMN11.Visible = .F.
COLUMN11.Name = "COLUMN11"
ColTvrCalc.Header1.Name = "Header1"
ColTvrCalc.Text1.Enabled = .F.
ColTvrCalc.Text1.Visible = .F.
ColTvrCalc.Text1.Name = "Text1"
ColTvrCalc.Enabled = .F.
ColTvrCalc.Visible = .F.
ColTvrCalc.Name = "ColTvrCalc"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3GE0NOTOU</uniqueid>
		<timestamp>1080973413</timestamp>
		<class>grdpartpractical</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>grid</baseclass>
		<objname>grdPartPr</objname>
		<parent>frmprimarydocviewqms</parent>
		<properties>Enabled = .F.
Height = 185
Left = 3
RecordSource = "FrmPrBookView"
Top = 243
Visible = .F.
Width = 690
ZOrderSet = 10
Name = "grdPartPr"
COLUMN1.Header1.Name = "Header1"
COLUMN1.Text1.ControlSource = "FrmPrBookView.PBookSum"
COLUMN1.Text1.Enabled = .F.
COLUMN1.Text1.Visible = .F.
COLUMN1.Text1.Name = "Text1"
COLUMN1.ControlSource = "FrmPrBookView.PBookSum"
COLUMN1.Enabled = .F.
COLUMN1.Visible = .F.
COLUMN1.Name = "COLUMN1"
COLUMN2.Header1.Name = "Header1"
COLUMN2.Text1.Enabled = .F.
COLUMN2.Text1.Visible = .F.
COLUMN2.Text1.Name = "Text1"
COLUMN2.ControlSource = "FrmPrBookView.Debet"
COLUMN2.Enabled = .F.
COLUMN2.Visible = .F.
COLUMN2.Name = "COLUMN2"
COLUMN3.Header1.Name = "Header1"
COLUMN3.Text1.ControlSource = "FrmPrBookView.Credit"
COLUMN3.Text1.Enabled = .F.
COLUMN3.Text1.Visible = .F.
COLUMN3.Text1.Name = "Text1"
COLUMN3.ControlSource = "FrmPrBookView.Credit"
COLUMN3.Enabled = .F.
COLUMN3.Visible = .F.
COLUMN3.Name = "COLUMN3"
COLUMN4.Header1.Name = "Header1"
COLUMN4.Text1.Enabled = .F.
COLUMN4.Text1.Visible = .F.
COLUMN4.Text1.Name = "Text1"
COLUMN4.ControlSource = ""
COLUMN4.Enabled = .F.
COLUMN4.Visible = .F.
COLUMN4.Name = "COLUMN4"
</properties>
		<protected/>
		<methods>PROCEDURE _rsrequeryone
LPARAMETERS tnFrmPartID
DODEFAULT(tnFrmPartID)
ThisForm.GrdDocsView._RSRequeryOne(This.nFrmID,.T.)
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3GE0NOTPR</uniqueid>
		<timestamp>1080974217</timestamp>
		<class>grdpartres</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>grid</baseclass>
		<objname>Grdpartres</objname>
		<parent>frmprimarydocviewqms</parent>
		<properties>Enabled = .F.
Height = 183
Left = 3
Top = 243
Visible = .F.
Width = 690
ZOrderSet = 11
Name = "Grdpartres"
COLUMN1.Header1.Name = "Header1"
COLUMN1.Text1.Enabled = .F.
COLUMN1.Text1.Visible = .F.
COLUMN1.Text1.Name = "Text1"
COLUMN1.Enabled = .F.
COLUMN1.Visible = .F.
COLUMN1.Name = "COLUMN1"
COLUMN2.Header1.Name = "Header1"
COLUMN2.Text1.Enabled = .F.
COLUMN2.Text1.Visible = .F.
COLUMN2.Text1.Name = "Text1"
COLUMN2.Enabled = .F.
COLUMN2.Visible = .F.
COLUMN2.Name = "COLUMN2"
COLUMN3.Header1.Name = "Header1"
COLUMN3.Text1.Enabled = .F.
COLUMN3.Text1.Visible = .F.
COLUMN3.Text1.Name = "Text1"
COLUMN3.Enabled = .F.
COLUMN3.Visible = .F.
COLUMN3.Name = "COLUMN3"
COLUMN4.Header1.Name = "Header1"
COLUMN4.Text1.Enabled = .F.
COLUMN4.Text1.Visible = .F.
COLUMN4.Text1.Name = "Text1"
COLUMN4.Enabled = .F.
COLUMN4.Visible = .F.
COLUMN4.Name = "COLUMN4"
COLUMN5.Header1.Name = "Header1"
COLUMN5.Text1.Enabled = .F.
COLUMN5.Text1.Visible = .F.
COLUMN5.Text1.Name = "Text1"
COLUMN5.Enabled = .F.
COLUMN5.Visible = .F.
COLUMN5.Name = "COLUMN5"
COLUMN6.Header1.Name = "Header1"
COLUMN6.Text1.Enabled = .F.
COLUMN6.Text1.Visible = .F.
COLUMN6.Text1.Name = "Text1"
COLUMN6.Enabled = .F.
COLUMN6.Visible = .F.
COLUMN6.Name = "COLUMN6"
COLUMN7.Header1.Name = "Header1"
COLUMN7.Text1.Enabled = .F.
COLUMN7.Text1.Visible = .F.
COLUMN7.Text1.Name = "Text1"
COLUMN7.Enabled = .F.
COLUMN7.Visible = .F.
COLUMN7.Name = "COLUMN7"
COLUMN8.Header1.Name = "Header1"
COLUMN8.Text1.Enabled = .F.
COLUMN8.Text1.Visible = .F.
COLUMN8.Text1.Name = "Text1"
COLUMN8.Enabled = .F.
COLUMN8.Visible = .F.
COLUMN8.Name = "COLUMN8"
COLUMN9.Header1.Name = "Header1"
COLUMN9.Text1.Enabled = .F.
COLUMN9.Text1.Visible = .F.
COLUMN9.Text1.Name = "Text1"
COLUMN9.Enabled = .F.
COLUMN9.Visible = .F.
COLUMN9.Name = "COLUMN9"
COLUMN10.Header1.Name = "Header1"
COLUMN10.Text1.Enabled = .F.
COLUMN10.Text1.Visible = .F.
COLUMN10.Text1.Name = "Text1"
COLUMN10.Enabled = .F.
COLUMN10.Visible = .F.
COLUMN10.Name = "COLUMN10"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3GE0NOTRP</uniqueid>
		<timestamp>1080974080</timestamp>
		<class>grdfrmaction</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>grid</baseclass>
		<objname>GrdPartHs</objname>
		<parent>frmprimarydocviewqms</parent>
		<properties>Enabled = .F.
Height = 180
Left = 3
RecordSource = "lvFrmActionView"
Top = 242
Visible = .F.
Width = 690
ZOrderSet = 13
Name = "GrdPartHs"
Column1.Header1.Name = "Header1"
Column1.Txtgrd1.Enabled = .F.
Column1.Txtgrd1.Visible = .F.
Column1.Txtgrd1.Name = "Txtgrd1"
Column1.Enabled = .F.
Column1.Visible = .F.
Column1.Name = "Column1"
Column2.Header1.Name = "Header1"
Column2.Txtgrd1.Enabled = .F.
Column2.Txtgrd1.Visible = .F.
Column2.Txtgrd1.Name = "Txtgrd1"
Column2.Enabled = .F.
Column2.Visible = .F.
Column2.Name = "Column2"
Column3.Header1.Name = "Header1"
Column3.Txtgrd1.Enabled = .F.
Column3.Txtgrd1.Visible = .F.
Column3.Txtgrd1.Name = "Txtgrd1"
Column3.Enabled = .F.
Column3.Visible = .F.
Column3.Name = "Column3"
Column4.Header1.Name = "Header1"
Column4.Txtgrd1.Enabled = .F.
Column4.Txtgrd1.Visible = .F.
Column4.Txtgrd1.Name = "Txtgrd1"
Column4.Enabled = .F.
Column4.Visible = .F.
Column4.Name = "Column4"
COLUMN5.Header1.Name = "Header1"
COLUMN5.Text1.Enabled = .F.
COLUMN5.Text1.Visible = .F.
COLUMN5.Text1.Name = "Text1"
COLUMN5.Enabled = .F.
COLUMN5.Visible = .F.
COLUMN5.Name = "COLUMN5"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3GE0OFMJJ</uniqueid>
		<timestamp>1081833613</timestamp>
		<class>grdpartfrmqms</class>
		<classloc>prom_proj.vcx</classloc>
		<baseclass>grid</baseclass>
		<objname>Grdpartfrm</objname>
		<parent>frmprimarydocviewqms</parent>
		<properties>Height = 184
Left = 3
Panel = 1
Top = 242
Width = 690
Name = "Grdpartfrm"
Cl1.Header1.Name = "Header1"
Cl1.Name = "Cl1"
Cl2.Header1.Name = "Header1"
Cl2.Name = "Cl2"
ClShortNM.Header1.Name = "Header1"
ClShortNM.Text1.Name = "Text1"
ClShortNM.Name = "ClShortNM"
ClFrmDate.Header1.Name = "Header1"
ClFrmDate.Text1.Name = "Text1"
ClFrmDate.Name = "ClFrmDate"
ClFrmNum.Header1.Name = "Header1"
ClFrmNum.Text1.Name = "Text1"
ClFrmNum.Name = "ClFrmNum"
ClPemiNM.Header1.Name = "Header1"
ClPemiNM.Text1.Name = "Text1"
ClPemiNM.ColumnOrder = 7
ClPemiNM.Name = "ClPemiNM"
ClPIspNM.Header1.Caption = "Äëèò-òü"
ClPIspNM.Header1.Name = "Header1"
ClPIspNM.Text1.ControlSource = "FrmPartFrmView.FSPerc"
ClPIspNM.Text1.Name = "Text1"
ClPIspNM.ControlSource = "nvl(FrmPartFrmView.FSPerc,'')"
ClPIspNM.Name = "ClPIspNM"
ClDevCltNM.Header1.Caption = "Îòâåòñòâåííûé"
ClDevCltNM.Header1.Name = "Header1"
ClDevCltNM.Text1.ControlSource = "FrmPartFrmView.StaffName"
ClDevCltNM.Text1.Name = "Text1"
ClDevCltNM.ControlSource = "nvl(FrmPartFrmView.StaffName,'')"
ClDevCltNM.Width = 132
ClDevCltNM.Name = "ClDevCltNM"
ClFrmDateAcc.Header1.Caption = "Äîêóìåíò"
ClFrmDateAcc.Header1.Name = "Header1"
ClFrmDateAcc.Text1.ControlSource = "FrmPartFrmView.DocNm"
ClFrmDateAcc.Text1.Name = "Text1"
ClFrmDateAcc.ControlSource = "nvl(FrmPartFrmView.DocNm,'')"
ClFrmDateAcc.Width = 122
ClFrmDateAcc.Name = "ClFrmDateAcc"
ClExEmiCltNM.Header1.Name = "Header1"
ClExEmiCltNM.Text1.Name = "Text1"
ClExEmiCltNM.ControlSource = "FrmPartFrmView.ExEmiCltNM"
ClExEmiCltNM.Width = 103
ClExEmiCltNM.Name = "ClExEmiCltNM"
ClFrmNote.Header1.Name = "Header1"
ClFrmNote.Text1.Name = "Text1"
ClFrmNote.Name = "ClFrmNote"
ClFrmReason.Header1.Name = "Header1"
ClFrmReason.Text1.Name = "Text1"
ClFrmReason.ColumnOrder = 8
ClFrmReason.Name = "ClFrmReason"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3GE0OFMLO</uniqueid>
		<timestamp>1080985111</timestamp>
		<class>textbox</class>
		<classloc/>
		<baseclass>textbox</baseclass>
		<objname>Text1</objname>
		<parent>frmprimarydocviewqms.Grdpartfrm.Cl1</parent>
		<properties>BorderStyle = 0
Margin = 0
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "Text1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3GE0OFMLP</uniqueid>
		<timestamp>1080974080</timestamp>
		<class>textbox</class>
		<classloc/>
		<baseclass>textbox</baseclass>
		<objname>Text1</objname>
		<parent>frmprimarydocviewqms.Grdpartfrm.Cl2</parent>
		<properties>BorderStyle = 0
Margin = 0
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "Text1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2HJ108LJB</uniqueid>
		<timestamp>961382171</timestamp>
		<class>textbox</class>
		<classloc/>
		<baseclass>textbox</baseclass>
		<objname>Text1</objname>
		<parent>frmprimarydocviewqms.GrdDocsView.Cl2</parent>
		<properties>BorderStyle = 0
Margin = 0
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "Text1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>frmprimarydocviewqms</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
Arial, 1, 9, 6, 15, 12, 32, 3, 0
Arial, 1, 8, 5, 14, 11, 29, 3, 0
Arial, 0, 8, 5, 14, 11, 29, 3, 0
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_3AO17ASQY</uniqueid>
		<timestamp>1084385002</timestamp>
		<class>frmresuprom</class>
		<classloc>prom_proj.vcx</classloc>
		<baseclass>form</baseclass>
		<objname>frmressmeta</objname>
		<parent/>
		<properties>DoCreate = .T.
Caption = "Ïëàí - ãðàôèê âûïîëíåíèÿ ðàáîò ïî ïî ñìåòå"
Name = "frmressmeta"
cstmsghandler.Name = "cstmsghandler"
cstresizable.Name = "cstresizable"
Img1.Name = "Img1"
G2ANTT1.Top = 0
G2ANTT1.Left = 1
G2ANTT1.Height = 600
G2ANTT1.Width = 1080
G2ANTT1._handledstandartmsglist = EDIT;INFO;DELE;;;;;
G2ANTT1.cname0 = Ðàáîòû óêðóïíåííî
G2ANTT1.npanewith0 = 260
G2ANTT1.cname1 = Íà÷àëî
G2ANTT1.cname2 = Îêîí÷àíèå
G2ANTT1.cname3 = Îêîí÷àíèå1
G2ANTT1.nwithcol1 = 70
G2ANTT1.nwithcol2 = 70
G2ANTT1.nwithcol0 = 120
G2ANTT1.citemfont = Aryal CYR:8:1
G2ANTT1.cpoditemfont = Aryal CYR:8:1
G2ANTT1.ccolumnfont = Aryal CYR:11:1
G2ANTT1.cbarfont = Aryal CYR:9:1
G2ANTT1.Name = "G2ANTT1"
cmdReload.Name = "cmdReload"
cmdToday.Name = "cmdToday"
Shape1.Enabled = .F.
Shape1.Visible = .F.
Shape1.Name = "Shape1"
Shape2.Enabled = .F.
Shape2.Visible = .F.
Shape2.Name = "Shape2"
Shape4.Enabled = .F.
Shape4.Visible = .F.
Shape4.Name = "Shape4"
Label2.Enabled = .F.
Label2.Visible = .F.
Label2.Name = "Label2"
Label3.Enabled = .F.
Label3.Visible = .F.
Label3.Name = "Label3"
Label4.Enabled = .F.
Label4.Visible = .F.
Label4.Name = "Label4"
Label1.Enabled = .F.
Label1.Visible = .F.
Label1.Name = "Label1"
PrintGantt.Top = 600
PrintGantt.Left = 1044
PrintGantt.Height = 13
PrintGantt.Width = 25
PrintGantt.Name = "PrintGantt"
Command1.Name = "Command1"
Shape6.Enabled = .F.
Shape6.Visible = .F.
Shape6.Name = "Shape6"
Shape7.Enabled = .F.
Shape7.Visible = .F.
Shape7.Name = "Shape7"
Shape3.Enabled = .F.
Shape3.Visible = .F.
Shape3.Name = "Shape3"
</properties>
		<protected/>
		<methods>PROCEDURE cmdReload.Click
thisform.lOnlyTime = .f.
*!*	IF MESSAGEBOX('Ïîêàçûâàòü òîëüêî âðåìÿ çàñåëåíèÿ áåç èìåí ãîñòåé?',4+64,'Âûáåðèòå, ÷òî ïîêàçûâàòü î çàñåëåíèè')=6
*!*		thisform.lOnlyTime = .t.
*!*	ENDIF
with thisform.G2antt1
	.BeginUpdate
	.Items.RemoveAllItems()
	.LoadData()
	*!*		with .Items
	*!*		for each h in thisform.G2antt1.Items
	*!*			.DefaultItem = h
	*!*			.ExpandItem(0) = thisform.g2ANTT1.lExpandResu
	*!*		next
	*!*		endwith
	.EndUpdate
endwith

ENDPROC
PROCEDURE G2ANTT1.BarResize
*** ActiveX Control Event ***
LPARAMETERS item, key
IF this.linload
RETURN .t.
ENDIF
IF !TYPE('item')= 'N'
		 * thisform.CmdReload.Click()
RETURN .f.
ENDIF
LOCAL  lStart, lEnd, stringWk, lChange,lnResursId, lBarCnt,lresult ,llResult

SELECT  rv_ResursLst
LOCATE ALL FOR rv_ResursLst.ItemId = item
IF !FOUND()
	RETURN
ENDIF
SET DATABASE TO BASIS
_PARAM = rv_ResursLst.BarId
USE IN SELECT('rv_JurnalUseEdit')
USE rv_JurnalUseEdit IN 0
*** - 19.03.2009 10:56:41 Ãëóõîâ Â.Þ. (C) - Ïðàâà ïðèíàäëåæàò
*** îáúåêò íå íàøëè
IF !RECCOUNT('rv_JurnalUseEdit')=1
=MESSAGEBOX('Îøèáî÷íûé êîä îáúåêòà. '+CHR(13)+'Ñîõðàíåíèå íå ïðîèçîøëî ...',0+16, 'Ïðîáëåìà')
		     USE IN SELECT('rv_JurnalUseEdit')
		 * thisform.CmdReload.Click()
RETURN .f.
ENDIF
*!*	     SELECT rv_ResursLst
*!*	     LOCATE FOR rv_ResursLst.BarId = key
lChange = .f.
lStart = NVL(rv_JurnalUseEdit.UseStart ,{})
lEnd   = NVL(rv_JurnalUseEdit.UseEnd,{})
*** äîêóìåíò îïëà÷åí èëè àêöåïòîâàí
IF rv_ResursLst.FrmStatusI&gt;3     &amp;&amp; òàê áûëî rv_ResursJrn.FrmStatusI&gt;2 OR rv_ResursJrn.FrmIsPayed
=MESSAGEBOX('Äîêóìåíò àêöåïòîâàí .'+CHR(13)+'Èçìåíÿòü íåëüçÿ.'+CHR(13)+'Îáðàòèòåñü ê àäìèíèñòðàòîðó.',0+32+4096, 'Íåäîïóñòèìîå äåéñòâèå ...',5000)
		  *thisform.CmdReload.Click()
		  RETURN .f.
ELSE
		with this.Items
		 lStart = .ItemBar(item,key,1)
		 lEnd   = .ItemBar(item,key,2)
		EndWith
	     IF VARTYPE(lStart)='C' OR VARTYPE(lEnd)='C'
		  *thisform.CmdReload.Click()
	     	RETURN .f.
	     ENDIF
	    *** ïîìåíÿëè ñòàðò è îí â çàïðåòíîì ïåðèîäå ÈËÈ îêîí÷àíèå â çàïðåòíîì ïåðèîäå ÈËÈ íîâîå íà÷àëî â çàïðåòíîì ïåðèîäå
*!*		     IF (thisform.tOgrDate &gt; rv_JurnalUseEdit.UseStart  AND rv_JurnalUseEdit.UseStart  &lt;&gt; lStart) OR  thisform.tOgrDate &gt; lEnd OR  (thisform.tOgrDate &gt; lStart AND rv_JurnalUseEdit.UseStart  &lt;&gt; lStart)
*!*				MESSAGEBOX('Æåëàåìàÿ äàòà íàõîäèòñÿ â çàêðûòîì ïåðèîäå.',0+32,'Âíåñåíèå èçìåíåíèé çàïðåùåíî ...')
*!*	       		thisform.CmdReload.Click()
*!*				RETURN .f.
*!*			 ENDIF
*!*		     IF MESSAGEBOX('Èçìåíèòü ñðîêè âûïîëíåíèÿ?',4+32+256,'Èçìåíåíèå äàííûõ î ïðîæèâàíèè ...')=6
*!*				     lBarCnt = this._find(lnResursId,lStart,lEnd,Key)
*!*						IF lBarCnt &gt;0
*!*	       					  thisform.CmdReload.Click()
*!*								RETURN .f.
*!*						ENDIF
*!*				     lChange = .t.
*!*			     ELSE
*!*	       		  thisform.CmdReload.Click()
*!*			       RETURN .f.
*!*		     ENDIF
ENDIF
					IF this.chart.UnitScale =&lt; 4096
						DO CASE
							CASE this.nTypeTime = 0 &amp;&amp; C 12 äî 12
								lStart = CTOT(DTOC(lStart )+ ' 12:00:00')
								lEnd   = CTOT(DTOC(lEnd   )  + ' 12:00:00')
							CASE this.nTypeTime = 1 &amp;&amp; C 14 äî 12
								lStart = CTOT(DTOC(lStart )+ ' 14:00:00')
								lEnd   = CTOT(DTOC(lEnd   )  + ' 12:00:00')
							CASE this.nTypeTime = 2 &amp;&amp; C òåêóùåãî ÷àñà äî òåêóùåãî ÷àñà
								lEnd   = CTOT(DTOC(lEnd   )  + ' '+TTOC(lStart ,2))
						ENDCASE
				    ENDIF
*!*					    IF (lStart &lt;DATETIME() AND MESSAGEBOX('Íà÷àëî ïðîæèâàíèÿ â ïðîøåäøåì ïåðèîäå.'+CHR(13)+'Èçìåíèòü ñðîêè ïðîæèâàíèÿ?',4+32+256,'Èçìåíåíèå äàííûõ î ïðîæèâàíèè ...')=7)
*!*	       				  thisform.CmdReload.Click()
*!*					    	RETURN .f.
*!*					    ENDIF
				 *   stringWk = "Items.ItemBar("+ ALLTRIM(STR(item,16,0))+" , "+ ALLTRIM(STR(key,10,0))+" , 6) = `" +  "Çàñåëåíèå:"+ TTOC(NVL(lStart,{}))+ ;
	    																			  "      Âûåçä:        "+ TTOC(NVL(lEnd,{}))+"`"    &amp;&amp; exBarToolTip
				  *  this.ExecuteTemplate(stringWk)
IF !(rv_ResursLst.FrmStatusI&gt;2) &amp;&amp;AND lChange
REPLACE  UseStart WITH  lStart , ;
	 UseEnd   WITH  lEnd IN rv_JurnalUseEdit
		llResult = TABLEUPDATE(1,.T.,[rv_JurnalUseEdit])
			IF !llResult
	            =MESSAGEBOX('Îøèáêà ïðè ñîõðàíåíèè íà ñåðâåðå [rv_JurnalUseEdit]. '+CHR(13)+'Ñîõðàíåíèå íå ïðîèçîøëî ...',0+64+4096, 'Ïðîáëåìà ëîêàëüíîé ñåòè',900)
		  thisform.CmdReload.Click()
			   RETURN .f.
			ENDIF		
	       REPLACE  UseStart WITH  lStart ,UseEnd   WITH  lEnd IN rv_ResursLst
	   	   llResult = spParentDates(rv_JurnalUseEdit.FrmPartTvrId)
			USE IN SELECT([rv_JurnalUseEdit])
*!*			IF MESSAGEBOX('Äîêóìåíò èçìåíåí. Ðàñïå÷àòàòü åãî?',4+32,'Ïîäãîòîâêà ê ïå÷àòè ...')=6
*!*				this.lnbarid= key
*!*				this._prndoc()
*!*			ENDIF

			this.BeginUpdate()
				stringWk = "Items.ItemBar("+ ALLTRIM(STR(item,16,0))+" ,"+ ALLTRIM(STR(key,16,0))+" , 1) = `" + dTOC(NVL(lStart,{}))+"`"
				this.executeTemplate(stringWk)
				stringWk = "Items.ItemBar("+ ALLTRIM(STR(item,16,0))+" ,"+ ALLTRIM(STR(key,16,0))+" , 2) = `" + dTOC(NVL(lEnd,{}))+"`"
				this.executeTemplate(stringWk)
*!*					stringWk = "Items.ItemBar("+ ALLTRIM(STR(item,16,0))+" ,1 , 1) = `" + dTOC(NVL(TTOD(lEnd)+1,{}))+"`"
*!*					this.executeTemplate(stringWk)
*!*					stringWk = "Items.ItemBar("+ ALLTRIM(STR(item,16,0))+" ,1 , 2) = `" + dTOC(NVL(TTOD(lEnd)+3,{}))+"`"
*!*					this.executeTemplate(stringWk)

				with this.Items
				  this.Tag = ltrim(Str(Eval(this.Tag) + 1))
						.DefaultItem = item
					    .CellValue(0, 1) = .ItemBar(0,key , 1)
					    .CellValue(0, 2) = .ItemBar(0,key , 2)
				  this.Tag = ltrim(Str(Eval(this.Tag) - 1))
				EndWith
			this.EndUpdate
ENDIF



ENDPROC
PROCEDURE G2ANTT1.barsprop
*DODEFAULT()
*RETURN
WITH .VisualAppearance
	*Task
	s = "gBFLBCJwBAEHhEJAEGg4BagCg6AADACAxRDAMgBQKAAzQFAYZBuGgBIRGcZoJhUAIIRZGMIjFDcEwxC6NIpAWLoJDCH4mSTHYxAJIMWwzDiGZIgOL5BgyIIDShOEpSPKkNR7DMXdAzOAFBr/"
	s = s + "I4AKLfeJpcimG4nULIMbhDDQJwTIaPaKpCioWjYMg1CTXVgTMKoYTDBKybLlaqYapSQouXBMdLTVaYABlEa4ZamC5pSoSNZ9TiAGAwPatJQ0BarYRBW7aaouXIVUzdEK1BaFuKIQLVUB4XaVXw"
	s = s + "HLjHYRsKyrWqOaJmWRqGS4TAeMABNwAM4vHBsSwKO6FT5GVB0Hp2ZwzSLbKbkWodZgPMJDZoAG67dCuR6dU7SLRmaJaYxZEWBJsDkfJMm0EARAkKAaEwZxDimSJKDGD4QiGBAiG+JgzBSAYKCEPIdh"
	s = s + "QIAxBYBh0nYdInEEIAfnwf4flefJnBGQJnn4BoAGCCACAqAIgEOGBGAMTgxCAEA2AWUJJiENoFkCPJiBmQ4TkSLwjE8cpUhIPoLHIUJ7gkT5CmCFYKGKOIqCyC5imiRIVD4IgjlSMwkA6MokgkNh"
	s = s + "GFCYJVBCGwjhgSQEg6Yo0gsPQLCIQJ5C2CQ4jCfQuEkU58jsJZlCkUhThUZYJF4Wglk+KQwnULIInOMIsCKDZigiAgzkQBpJn8O5hnkIhKhMJJpEIWYVicSZOHOFxJQIDw6kqOYQiMIJMkCeAMEIZo5jYS"
	s = s + "YSmSWIon4LoJGmWhbiPYJiHqGIIiMfIkCEJoJimfQ7gqYgwnILBIniBgjgkYhyFIMILGqCoeieDQJCiWIQDsCoyCyYgpEgUxQEGIJQDefJshGJpCDYbooiqSgikKEwsDITpFiIDxilCEQ8gsAg6Hw"
	s = s + "IhOFKHIGo0agRn0OonlONItCMDwLDaHwjk8OoCG6OJkhuEIQjmJprH6HAjCeQgomgKhIgOBBEi4AAHn6WAizsMILi6SI7i6a4vHACB/AEIxwDqdprj8LxziSKgiG0SxYA+NoIkucwShGMQMFaW5Fgi"
	s = s + "TBjBiPwvhILwdj8MJamWfQ8CmWx0g6QRwCyJwEkqMoMi8LpAnIQgwmgEpctGbQPk8S4KmWTpuHycpok+NAMnaZ4oA6MZEEIOoGlEAQJFKDghhAOA5kSIBKAeApgh0TxWlUdYICmIRAEAgI="
	.Add(10,s)   &amp;&amp;64, s)
	
	*Summary
	s = "gBFLBCJwBAEHhEJAEGg4BLICg6AADACAxRDAMgBQKAAzQFAYaQNBgABhGYZYJhUAIIRZGMIjFDcEwxC6NIpAWLoJDCH4mSTHYwgJIMWwzDiBZgkCA4fiGEInThCI4TTJ0aw0BCSJohEAoJb5P4DUZGM6ABJE"
	s = s + "Bx3EqiJ5hEC4aBOQYzABUIAUTTdDwtCAZBpEWwLChANQwWLCNj2TSUByBDKqKCla46Yo2TJLDTIdxAA79ezpCyZJijeboZjeKaHU5Scg4IAADQTN4ALhrCqrdb+fJ+RTSdzUfAYYS1RapYRxaA6WgPEofZRf"
	s = s + "WS1fDdS5bNgALTsayIQyCbqiaDpUZaTi2V4zRC7ZyxKKsMh/EKjX7tXA5bD+OSZT7iNxrDQuDeEwtjIbAsDsDYVisaY7iuZAjnkLhHFoLYDkeQhKAaEwZlCahyDKDBjmyKoJAiG5zgyDYhCKCBPFMTiSBEYhRl"
	s = s + "AX5ZFgFgGAICojH4BoCmCSA0n+AggigOYYGWYJABSMw7EAAp8n+BYOlgSgegcIYYG4F4DhCGAsAULZPDiBgqgaABSmCc4HpwNgpgaIoznwBguA8SAuCUXxAFKbJ4syCIyD6A4jlifg0hGWRpCABgvA+"
	s = s + "Fp5AMLpPjAAI8D8AACnYVIUmUKReFSFYlhAAhQhUT5ZgIXYXCWCYWFuFolmkRQJC8T5SBSYQ5ggY4MmgIhOHOMIJDoDpSCyaw8AiI4om+HxnnmeoAiCaApnoeg8Ccc42HQOwnBOIhuDmJgkCYGghmcIgcmQOh"
	s = s + "IgOGJrCKJ4CCiaQ7imaoCh+KBqEqDomiiKgJmKGQ6mkY4mhQOgiioSJ/CIDhTiqNItimKouguLpnFqch2i8bAKnzERsEqVo3iwUA4GqJInGmWoeiWKgsnsRpOjMDpagaSIIEiY48nQIxOmOTpcjeLZbH6Yo4G4"
	s = s + "S4CmaOJuHuFpZD0LRynyfoQGSG5GnCPJkguUhJjuUA0AQgI="
	.Add(11,s)   &amp;&amp;65, s)

	*Progress
	s = "gBFLBCJwBAEHhEJAEGg4BBIDg6AADACAxRDAMgBQKAAzQFAYaQNBgABhGYZYJACCIDEYeSzRNCsOw8GSEZAgOJ4eiWJIkDDKADQTAoYBKFoZJTgQYJOjCJULIRkSZ0CgmOY3UBHMjwSBEEigNIxToOU"
	s = s + "4jFimCROQwQRK1BDwbQSFCEUDnaagABiHQYRBQMavfYlSr+fx/LLtF7Xdb5fD8Py+b5vY7TdTofR9XxfxLDaz4ep+HreR63WbNej1PI+LyPC7DZrhRp4MCdTBXLbdcTqPg8DovM5zTrudpzHrdNxXWapZDxOw"
	s = s + "4bx6S6TVrEeR0XAeJx2fbBZTdPC5DabSzjXLEazfGvBCyrXq+aZ3G6aJzWbZBbjaM7zbLuWzbFJoGwMZck0Zgrh2KpEHUdpdG0RgjiWJJCHMM5Xm4NoCm2RJPF0OJZkuFwbC0bphGSLRcAwdYbgWDIyDgDBSk"
	s = s + "WegrE2cwYiyAAKjMeJDCoTZjACJw3EuYoUlwLxKEMdI7CiTYSnSHw2EuMh4lgLoJlMYI4CaTYCliGQ1gsQhclcLIJGMWIxCUTRSkSEw1AsAhIlUK5InMUIuCMDQijCCg0gqIgclMKhIEMSIoCCTQCiCBQzkocg"
	s = s + "Qk4KYIDMOIkB+TJigwfAzEoEZgkwKAHHMLIfB2DByG4YIY1OaB0DGSYBkiRgmAbGoWBtU5UGsMZJGGKJDCSJxiEwaQwgkIYgkIJBGFMCIQVWMg8GEMIImEfJBCMRZinCCwWGjEg9CKBYCniCQVmkYRcj8IZFR+BgVGm"
	s = s + "YRUj4IJFBqDBRC8SAhECPAgEScpsgAE4LiGfBNC4R5hDKNATAuMZ8EuLhEjKaB+BKC4RnQSQuAeQQgjcHpEHKWB6BGLIhBkZRCFYZYVGgWoPnWMRuFwFwll0dxeFeNZ1H8YBYDYFYHGIWI2EGEBkhkRhZhgZoZkYe"
	s = s + "YgGiGhGhmKBqhqRo5jAbIbEaWY4G6G5HAWQRwlwVwdkkcsxkmUh1B0ZxhlodwdmeAJFHiHhHhmaB6h6R45nAfIfEeWZ4H6H5HnoAIAgweASAaAggigMgOgQIQoFIFoGCGKByB6CAiCiEgmgoIoojILoMCMKJSDa"
	s = s + "Dgjiicg+hAJApBIRoSCSKQyE6FAlCkUhWhYJYpHIXoYnUCYWGeGhmjmNhvhwZw5lYd4eGeOZ2H+IBoDoFoHiIaI6DaD4kGkOhWheJhpjodofigamsiiKoqkqOowiyKx6l6HkLwVxrAFEKGILA1giibDMNkdAGgBEBA"
	.Add(12,s)    &amp;&amp;66, s)
ENDWITH

WITH this.Chart.Bars
	.Item("Task").Height = 12 &amp;&amp; 18
	.Item("Task").Color = 0xa000000  &amp;&amp; 1073741824 &amp;&amp;0x1000000   &amp;&amp; RGB(138,244,244)
	.Copy("Task","Summary").Color = 0xb000000  &amp;&amp;1090519040
	.Item("Progress").Color =  0xc000000  &amp;&amp;1107296256 &amp;&amp;0x1000000   &amp;&amp; RGB(138,244,244)
	.Copy("Progress","PRed").Color = RGB(255,123,0)
	.Item("PRed").Height = 3
	.Add('Task%PRed')
ENDWITH

*!*		Bars("Task").Color = 1073741824
*!*		Bars.Copy("Task","Summary").Color = 1090519040
*!*		Bars("Progress").Color = 1107296256

retu


DODEFAULT()
this.VisualAppearance.Add(10,"Ebn\Bar_work.ebn")
this.VisualAppearance.Add(11,"Ebn\Bar_mone.ebn")
this.VisualAppearance.Add(12,"Ebn\Bar_green.ebn")
this.VisualAppearance.Add(13,"Ebn\Bar_red.ebn")
With this.Chart.Bars
	.Item("Task").Height = 9 &amp;&amp; 18
	.Item("Task").Pattern = 1&amp;&amp;1
	.Item("Task").StartColor =  RGB(138,244,244)   &amp;&amp; - íåãàðàíòèðîâàííîå áðîíèðîâàíèå  -  îæèäàþùàÿ áðîíü
	.Item("Task").Color = RGB(138,244,244)
	.Item("Task").EndColor =  RGB(138,244,244)
	.Item("Task").StartShape = 0 &amp;&amp;17  &amp;&amp;61447  &amp;&amp; exShapeIconFrameLeft
	.Item("Task").EndShape = 0&amp;&amp; 8 &amp;&amp;61448  &amp;&amp; exShapeIconFrameRight
	*** îïðåäåëÿåì ïîðÿäîê ïîêàçà íåñêîëüêèõ áàðîâ â îäíîé ñòðîêå
	.Item("Task").OverlaidType = 515


.Copy("Task", "garTask")  &amp;&amp; - èòîãè (òåìíî-ñèíèé)
		.Item("garTask").Color =  0xa000000  &amp;&amp;0x1000000   &amp;&amp; RGB(138,244,244)
*!*			.Item("garTask").StartColor =  RGB(255,255,0)
*!*			.Item("garTask").Color =       RGB(255,255,0)
*!*			.Item("garTask").EndColor =    RGB(255,255,0)
.Copy("Task", "preTask")   &amp;&amp; - äåíüãè  (æåëòûé)
		.Item("preTask").Color =  0xb000000  &amp;&amp;0x1000000   &amp;&amp; RGB(138,244,244)
*!*			.Item("preTask").StartColor =  RGB(0,128,192)
*!*			.Item("preTask").Color =       RGB(0,128,192)
*!*			.Item("preTask").EndColor =    RGB(0,128,192)
.Copy("Task", "RedTask")  &amp;&amp;  - îòðèöàòåëüíûé èòîã êðàñíûé
		.Item("RedTask").Color = 0xd000000  &amp;&amp;0x1000000   &amp;&amp; RGB(138,244,244)
*!*			.Item("RedTask").StartColor =  RGB(255,0,0)
*!*			.Item("RedTask").Color =		RGB(255,0,0)
*!*			.Item("RedTask").EndColor =  	RGB(255,0,0)
.Copy("Task", "GreenTask")  &amp;&amp;  - ïîëîæèòåëüíûé èòîã òåìíî-çåëåíûé
		.Item("GreenTask").Color = 0xc000000  &amp;&amp;0x1000000   &amp;&amp; RGB(138,244,244)
*!*			.Item("GreenTask").StartColor =  RGB(0,255,64)
*!*			.Item("GreenTask").Color = RGB(0,255,64)
*!*			.Item("GreenTask").EndColor =  RGB(0,255,64)
.Copy("Task", "LiveTask")  &amp;&amp;  - ïðîæèâàíèå  (LiveTask) òåìíî-çåëåíûé
		.Item("LiveTask").StartColor =  RGB(0,255,64)
		.Item("LiveTask").Color = RGB(0,255,64)
		.Item("LiveTask").EndColor =  RGB(0,255,64)
.Copy("Task", "errTask")  &amp;&amp;  - ïðîæèâàíèå  (LiveTask) îðàíüæåâûé
		.Item("errTask").StartColor =  RGB(255,128,0)
		.Item("errTask").Color = RGB(255,128,0)
		.Item("errTask").EndColor =  RGB(255,128,0)

		.Item("Task").HistogramPattern = 32
		.Item("Task").HistogramColor = RGB(138,244,244)
		.Item("preTask").HistogramPattern = 32
		.Item("preTask").HistogramColor =       RGB(255,255,0)
		.Item("garTask").HistogramPattern = 32
		.Item("garTask").HistogramColor =       RGB(0,0,255)
		.Item("LiveTask").HistogramPattern = 1
		.Item("LiveTask").HistogramColor = RGB(0,255,0)
		.Item("errTask").HistogramPattern = 32
		.Item("errTask").HistogramColor = RGB(255,0,0)
		.Item("GreenTask").HistogramPattern = 32
		.Item("GreenTask").HistogramColor = RGB(255,0,0)
		.Item("RedTask").HistogramPattern = 32
		.Item("RedTask").HistogramColor = RGB(255,0,0)

		.Item("Task").OverlaidGroup = "preTask,garTask,LiveTask,errTask,GreenTask,RedTask"
		.Item("preTask").OverlaidGroup = "Task,garTask,LiveTask,errTask,GreenTask,RedTask"
		.Item("garTask").OverlaidGroup = "Task,preTask,LiveTask,errTask,GreenTask,RedTask"
		.Item("errTask").OverlaidGroup = "Task,preTask,garTask,LiveTask,GreenTask,RedTask"
		.Item("LiveTask").OverlaidGroup = "Task,preTask,garTask,errTask,GreenTask,RedTask"
		.Item("GreenTask").OverlaidGroup = "RedTask"
		.Item("RedTask").OverlaidGroup = "GreenTask"

*!*			.Add('preTask%PRed')
*!*			.Add('garTask%PRed')
*!*			.Add('LiveTask%PRed')
*!*			.Add('Task%PRed')
*!*			.Add('errTask%PRed')
*!*			.Add('GreenTask%PRed')
*!*			.Add('RedTask%PRed')
ENDWITH


ENDPROC
PROCEDURE G2ANTT1.Change
*** ActiveX Control Event ***
LPARAMETERS item, colindex, newvalue
IF this.linload OR !( eval(this.Tag) = 0 )
RETURN .t.
ENDIF
	this.Tag = ltrim(Str(Eval(this.Tag) + 1))
	with this.Items
		.DefaultItem = item

SELECT  rv_ResursLst
LOCATE ALL FOR rv_ResursLst.ItemId = item
IF !FOUND()
	RETURN
ENDIF

SET DATABASE TO BASIS
_PARAM = rv_ResursLst.BarId
USE IN SELECT('rv_JurnalUseEdit')
USE rv_JurnalUseEdit IN 0
*** - 19.03.2009 10:56:41 Ãëóõîâ Â.Þ. (C) - Ïðàâà ïðèíàäëåæàò
*** îáúåêò íå íàøëè
IF !RECCOUNT('rv_JurnalUseEdit')=1
=MESSAGEBOX('Îøèáî÷íûé êîä îáúåêòà. '+CHR(13)+'Ñîõðàíåíèå íå ïðîèçîøëî ...',0+16, 'Ïðîáëåìà')
		     USE IN SELECT('rv_JurnalUseEdit')
		 * thisform.CmdReload.Click()
RETURN .f.
ENDIF

*!*	     SELECT rv_ResursLst
*!*	     LOCATE FOR rv_ResursLst.BarId = key
lChange = .f.
lStart = NVL(rv_JurnalUseEdit.UseStart ,{})
lEnd   = NVL(rv_JurnalUseEdit.UseEnd,{})
*** äîêóìåíò îïëà÷åí èëè àêöåïòîâàí
IF rv_ResursLst.FrmStatusI&gt;3     &amp;&amp; òàê áûëî rv_ResursJrn.FrmStatusI&gt;2 OR rv_ResursJrn.FrmIsPayed
=MESSAGEBOX('Äîêóìåíò àêöåïòîâàí .'+CHR(13)+'Èçìåíÿòü íåëüçÿ.'+CHR(13)+'Îáðàòèòåñü ê àäìèíèñòðàòîðó.',0+32+4096, 'Íåäîïóñòèìîå äåéñòâèå ...',5000)
		  *thisform.CmdReload.Click()
		  RETURN .f.
ELSE
		with this.Items

		 	if ( colindex = 1 )
				 lStart = IIF(VARTYPE(newvalue)='C',CTOD(newvalue),newvalue)
		*		 lEnd   = .ItemBar(item,,2)
		 	else
		 		if ( colindex = 2 )
				* lStart = .ItemBar(item,,1)
				 lEnd   = IIF(VARTYPE(newvalue)='C',CTOD(newvalue),newvalue)
		 		endif
		 	endif


		EndWith
	     IF VARTYPE(lStart)='C' OR VARTYPE(lEnd)='C'
		  *thisform.CmdReload.Click()
	     	RETURN .f.
	     ENDIF
	    *** ïîìåíÿëè ñòàðò è îí â çàïðåòíîì ïåðèîäå ÈËÈ îêîí÷àíèå â çàïðåòíîì ïåðèîäå ÈËÈ íîâîå íà÷àëî â çàïðåòíîì ïåðèîäå
*!*		     IF (thisform.tOgrDate &gt; rv_JurnalUseEdit.UseStart  AND rv_JurnalUseEdit.UseStart  &lt;&gt; lStart) OR  thisform.tOgrDate &gt; lEnd OR  (thisform.tOgrDate &gt; lStart AND rv_JurnalUseEdit.UseStart  &lt;&gt; lStart)
*!*				MESSAGEBOX('Æåëàåìàÿ äàòà íàõîäèòñÿ â çàêðûòîì ïåðèîäå.',0+32,'Âíåñåíèå èçìåíåíèé çàïðåùåíî ...')
*!*	       		thisform.CmdReload.Click()
*!*				RETURN .f.
*!*			 ENDIF
*!*		     IF MESSAGEBOX('Èçìåíèòü ñðîêè âûïîëíåíèÿ?',4+32+256,'Èçìåíåíèå äàííûõ î ïðîæèâàíèè ...')=6
*!*				     lBarCnt = this._find(lnResursId,lStart,lEnd,Key)
*!*						IF lBarCnt &gt;0
*!*	       					  thisform.CmdReload.Click()
*!*								RETURN .f.
*!*						ENDIF
*!*				     lChange = .t.
*!*			     ELSE
*!*	       		  thisform.CmdReload.Click()
*!*			       RETURN .f.
*!*		     ENDIF
ENDIF
					IF this.chart.UnitScale =&lt; 4096
						DO CASE
							CASE this.nTypeTime = 0 &amp;&amp; C 12 äî 12
								lStart = CTOT(DTOC(lStart )+ ' 12:00:00')
								lEnd   = CTOT(DTOC(lEnd   )  + ' 12:00:00')
							CASE this.nTypeTime = 1 &amp;&amp; C 14 äî 12
								lStart = CTOT(DTOC(lStart )+ ' 14:00:00')
								lEnd   = CTOT(DTOC(lEnd   )  + ' 12:00:00')
							CASE this.nTypeTime = 2 &amp;&amp; C òåêóùåãî ÷àñà äî òåêóùåãî ÷àñà
								lEnd   = CTOT(DTOC(lEnd   )  + ' '+TTOC(lStart ,2))
						ENDCASE
				    ENDIF
*!*					    IF (lStart &lt;DATETIME() AND MESSAGEBOX('Íà÷àëî ïðîæèâàíèÿ â ïðîøåäøåì ïåðèîäå.'+CHR(13)+'Èçìåíèòü ñðîêè ïðîæèâàíèÿ?',4+32+256,'Èçìåíåíèå äàííûõ î ïðîæèâàíèè ...')=7)
*!*	       				  thisform.CmdReload.Click()
*!*					    	RETURN .f.
*!*					    ENDIF
				 *   stringWk = "Items.ItemBar("+ ALLTRIM(STR(item,16,0))+" , "+ ALLTRIM(STR(key,10,0))+" , 6) = `" +  "Çàñåëåíèå:"+ TTOC(NVL(lStart,{}))+ ;
	    																			  "      Âûåçä:        "+ TTOC(NVL(lEnd,{}))+"`"    &amp;&amp; exBarToolTip
				  *  this.ExecuteTemplate(stringWk)
IF !(rv_ResursLst.FrmStatusI&gt;2) &amp;&amp;AND lChange
REPLACE  UseStart WITH  lStart , ;
	 UseEnd   WITH  lEnd IN rv_JurnalUseEdit
		llResult = TABLEUPDATE(1,.T.,[rv_JurnalUseEdit])
			IF !llResult
	            =MESSAGEBOX('Îøèáêà ïðè ñîõðàíåíèè íà ñåðâåðå [rv_JurnalUseEdit]. '+CHR(13)+'Ñîõðàíåíèå íå ïðîèçîøëî ...',0+64+4096, 'Ïðîáëåìà ëîêàëüíîé ñåòè',900)
		  thisform.CmdReload.Click()
			   RETURN .f.
			ENDIF		
	       REPLACE  UseStart WITH  lStart ,UseEnd   WITH  lEnd IN rv_ResursLst

		 	if ( colindex = 1 )
		 		*this.Template = "Items.ItemBar(0,``,1) = `" + dtoc(newvalue) + "`"
		 		this.Template = "Items.ItemBar(0,``,1) = `" + IIF(VARTYPE(newvalue)='T',dtoc(newvalue),newvalue) + "`"
		 	else
		 		if ( colindex = 2 )
		 			*this.Template = "Items.ItemBar(0,``,2) = `" + dtoc(newvalue) + "`"
		 			this.Template = "Items.ItemBar(0,``,2) = `" +IIF(VARTYPE(newvalue)='T',dtoc(newvalue),newvalue) + "`"
		 			this.Template = "Items.ItemBar(0,1,2) = `" +IIF(VARTYPE(newvalue)='T',dtoc(TTOD(newvalue)+1),newvalue) + "`"
		 			this.Template = "Items.ItemBar(0,1,2) = `" +IIF(VARTYPE(newvalue)='T',dtoc(TTOD(newvalue)+3),newvalue) + "`"
		 		endif
		 	endif
	ENDIF
	this.Tag = ltrim(Str(Eval(this.Tag) - 1))
endwith

ENDPROC
PROCEDURE G2ANTT1.CreateBar
*** ActiveX Control Event ***
LPARAMETERS item, datestart, dateend
RETURN
ENDPROC
PROCEDURE G2ANTT1.Init
DODEFAULT()
WITH this
.Tag = "0"
.DefaultItemHeight = 17
.Font = .oColumnFont
.Columns.Item(1).Editor.EditType = 7
.Columns.Item(2).Editor.EditType = 7
.Font = .oDefFont
ENDWITH


ENDPROC
PROCEDURE G2ANTT1.loaddata
*!*	thisform.LoadData1()
*!*	RETURN
LOCAL lcUniqueName,lcUniqueFilePath,dStartDate,dEndDate, lnCountRec , Lfirst
LOCAL ARRAY items(1,2)
LOCAL lnDefItem, lnDefParId, lnDefTvrId,lnDefResursId,lnBarId ,lnBarId, stringWk, nRecResursLst, nTvrParId ,cCmdStr,nMainParItem
this.linload=.t.
* Çàãðóæàåì òàáëèöó ñ äàííûìè
lcUniqueName  = spGetSmetaWork(thisform.nFrmId)

* Òàáëèöà äëÿ äèàãðàììû
USE IN SELECT('rv_ResursLst')
USE (lcUniqueName) IN 0 ALIAS rv_ResursLst
SELECT rv_ResursLst
*!*	CALCULATE MIN(rv_ResursLst.UseStart) TO dStartDate
*!*	CALCULATE MAX(rv_ResursLst.UseEnd) TO dEndDate
SELECT rv_ResursLst
*BROWSE
lnCountRec  = RECCOUNT()
GO TOP
SET DATE GERMAN
this.BeginUpdate()
Lfirst = .t.	
WITH this.Items
STORE -99999 TO lnFrmTypeId ,lnDefParId ,lnDefResursId ,lnBarId
SET DATE YMD
this.Font = this.oBarFont
SCAN ALL FOR rv_ResursLst.TvrAttr= 512 OR rv_ResursLst.TvrAttr= 32
		   IF rv_ResursLst.FrmTypeId &lt;&gt; lnFrmTypeId
		   	lnFrmTypeId = rv_ResursLst.FrmTypeId
		   	IF lnFrmTypeId &lt;&gt; 8
			   	lnDefParId  = .AddItem(ALLTRIM(rv_ResursLst.FrmTypeNM))
			   	nMainParItem = lnDefParId
			   	*.AddBar(lnDefParId  , 'Summary',ttod(dStartDate),TTOd(dEndDate),1)
				.AddBar(lnDefParId  ,"Summary",{^2011-6-22},{^2011-6-23 16:00:00})
			   	.CellValue(lnDefParId ,1) = rv_ResursLst.UseStart   &amp;&amp;dTOC(rv_ResursLst.UseStart)
			   	.CellValue(lnDefParId ,2) = rv_ResursLst.UseEnd &amp;&amp;dTOC(rv_ResursLst.UseEnd)
		   	ENDIF
		   ENDIF
	       IF (lnFrmTypeId = 8 AND Lfirst) OR lnFrmTypeId &lt;&gt; 8
			*** èùåì ðîäèòåëÿ çàïèñè, ÷òî áû âñòàâèòü â ðîäèòåëÿ
			lnCountRec  = RECNO('rv_ResursLst')
			nTvrParId = rv_ResursLst.FrmParID
		   	LOCATE ALL FOR rv_ResursLst.FrmPartTvr = nTvrParId
			IF FOUND()
				lnDefParId  = rv_ResursLst.ItemId
			ENDIF
			GO lnCountRec
			**
	        lnDefItem = .InsertItem( lnDefParId , 0, ALLTRIM(rv_ResursLst.TvrNm))
		       IF lnFrmTypeId = 8
		       		Lfirst = .f.	
		       ENDIF
	       ENDIF
	       lnBarId   =  rv_ResursLst.JrnUseId
		   REPLACE ItemId WITH lnDefItem ,BarId WITH lnBarId NEXT  1 IN rv_ResursLst
		   	.AddBar(lnDefItem , "Task%PRed" , ttod(rv_ResursLst.UseStart),;
					ttod(rv_ResursLst.UseEnd),lnBarId,STR(rv_ResursLst.TvrSumBuy,12,2)) &amp;&amp;+' %'+STR(NVL(rv_ResursLst.PrcBuy,0),7,0)) &amp;&amp;,rv_ResursLst.JrnUseId,STR(rv_ResursLst.TvrSumSale))
		IF rv_ResursLst.PrcBuy&lt;&gt;0
				stringWk = "Items.ItemBar("+ ALLTRIM(STR(lnDefItem ,10,0))+" , "+ ALLTRIM(STR(lnBarId))+" , 12) = `"+STRTRAN(STR(NVL(rv_ResursLst.PrcBuy/100,0),7,2),'.',',')+"`" &amp;&amp; exBarPercent
				ELSE
				stringWk = "Items.ItemBar("+ ALLTRIM(STR(lnDefItem ,10,0))+" , "+ ALLTRIM(STR(lnBarId))+" , 12) = `0`" &amp;&amp; exBarPercent
			ENDIF
			 ThisForm.G2ANTT1.ExecuteTemplate(stringWk)
			stringWk = "Items.ItemBar("+ ALLTRIM(STR(lnDefItem ,10,0))+" , "+ ALLTRIM(STR(lnBarId))+" , 16) = False" &amp;&amp; exBarPercent
			 ThisForm.G2ANTT1.ExecuteTemplate(stringWk)
			stringWk = "Items.ItemBar("+ ALLTRIM(STR(lnDefItem ,10,0))+" , "+ ALLTRIM(STR(lnBarId))+" , 14) = True" &amp;&amp; exBarPercent
			 ThisForm.G2ANTT1.ExecuteTemplate(stringWk)
		   	.CellValue(lnDefItem ,1) = ttod(rv_ResursLst.UseStart)
		   	.CellValue(lnDefItem ,2) = ttod(rv_ResursLst.UseEnd)
			.DefineSummaryBars(lnDefParId ,"",lnDefItem ,lnBarId) &amp;&amp; .DefaultItem
ENDSCAN
	IF lnDefParId &lt;&gt; -99999
	   	.ExpandItem(lnDefParId) = .T.
		this.Chart.FirstVisibleDate =  .ItemBar(nMainParItem ,,1) - 1
	ENDIF
ENDWITH
this.Font = this.oDefFont
this.EndUpdate()	
this.linload=.f.
SET DATE GERMAN
RETURN


ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>frmressmeta</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
Arial, 1, 10, 6, 16, 13, 34, 3, 0
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25I136UUP</uniqueid>
		<timestamp>1084396758</timestamp>
		<class>frmview</class>
		<classloc>baseform_v1.vcx</classloc>
		<baseclass>form</baseclass>
		<objname>frmresuprom</objname>
		<parent/>
		<properties>Top = 0
Left = 0
Height = 634
Width = 1082
DoCreate = .T.
Caption = "Ïëàí - ãðàôèê âûïîëíåíèÿ ðàáîò ïî äîãîâîðó 111"
HalfHeightCaption = .T.
WindowState = 2
resuparent = 0
ndefclt = 0
ntimeclearnum = 0
nwkdays = 0
nfrmid = 0
_memberdata =      477&lt;VFPData&gt;&lt;memberdata name="ndefclt" type="property" display="nDefClt"/&gt;&lt;memberdata name="lonlytime" type="property" display="lOnlyTime"/&gt;&lt;memberdata name="ntimeclearnum" type="property" display="nTimeClearNum"/&gt;&lt;memberdata name="nwkdays" type="property" display="nWkdays"/&gt;&lt;memberdata name="nfrmid" type="property" display="nFrmId"/&gt;&lt;memberdata name="loaddata1" type="method" display="LoadData1"/&gt;&lt;memberdata name="loadfromxml" type="method" display="LoadFromXml"/&gt;&lt;/VFPData&gt;

nscrfrmid = 0
Name = "frmresuprom"
cstmsghandler.Name = "cstmsghandler"
cstresizable.Name = "cstresizable"
Img1.ZOrderSet = 2
Img1.Name = "Img1"
</properties>
		<protected/>
		<methods>PROCEDURE Activate
DODEFAULT()
_VFP.AutoYield = .f.
ENDPROC
PROCEDURE Deactivate
DODEFAULT()
_VFP.AutoYield = .t.
ENDPROC
PROCEDURE Destroy
DODEFAULT()
_VFP.AutoYield = .t.
pnScrFrmID = null
RELEASE pnScrFrmID

ENDPROC
PROCEDURE Init
LPARAMETERS	nFrmId
IF PCOUNT()&lt;1
	nFrmId = -1
ENDIF

*05.05.2004 01:57 -&gt;Ìîäèôèöèðóåì èìÿ ôîðìû ñ ó÷åòîì åå èäåíòèôèêàòîðà
This.Name = This.Name + [_GANT] &amp;&amp; + ALLTRIM(STR(tnScrFrmID))
*------------------------------------------------------------------------------

*04.05.2004 23:30 -&gt;Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------

WITH This
*04.05.2004 23:16 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
PRIVATE	_PARAM	
*------------------------------------------------------------------------------
.nFrmId = nFrmId
*.nFrmId = 67573
*04.05.2004 23:13 -&gt;Ñîõðàíèì èäåíòèôèêàòîð ôîðìû â ñâîéñòâå ôîðìû

*******************************************************************************
*Ïîëó÷èì èíôîðìàöèþ î äîêóìåíòàõ, îòîáðàæàåìûõ íà äàííîé ôîðìå.
*******************************************************************************


.g2ANTT1.nTypeTime = VAL(oRes.GetParam([SET],[TYPETIME],0))

.g2ANTT1.lExpandResu = (VAL(oRes.GetParam([SET],[EXPANDRESU],1))=1)
.g2ANTT1.loaddata()
ENDWITH

************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE loaddata1
with thisform.G2antt1
	.BeginUpdate
	.MarkSearchColumn = .F.
	.ShowFocusRect = .F.
	.Columns.Add("Tasks")
	with .Columns.Add("C")
		.HeaderAlignment = 1
		.Def(0) = .T.
		.PartialCheck = .T.
		.AllowSizing = .F.
		.Width = 18
	endwith
	with .Chart
		*.PaneWidth(0) = 96
		.AllowCreateBar = 1
		.FirstVisibleDate = {^2005-6-20}
		.DrawLevelSeparator = .F.
		.LevelCount = 3
		.Level(1).DrawGridLines = .F.
		.AllowInsideZoom = .T.
		.DrawDateTicker = .T.
		.DateTickerLabel = "&lt;%mmm%&gt; &lt;%d%&gt;&lt;br&gt;&lt;b&gt;&lt;%hh%&gt;:&lt;%nn%&gt;&lt;/b&gt;"
		.MarkSelectDateColor = 0x7ffff8ee
		with .DefaultInsideZoomFormat
			.OwnerLabel = "&lt;%mmm%&gt; &lt;%d%&gt;"
			.BackColor = RGB(238,248,255)
			.BackColorChart = .BackColor
			.InsideCount = 4
			.InsideLabel = "&lt;b&gt;&lt;%hh%&gt;&lt;/b&gt;"
		endwith
		.InsideZooms.Add({^2005-6-22})
		.DrawGridLines = 2
	endwith
	with .Items
		h = .AddItem("Project 1")
		.AddBar(h,"Summary",{^2005-6-21},{^2005-7-1})
		h1 = .InsertItem(h,0,"Task 1")
		.AddBar(h1,"Task",{^2005-6-21},{^2005-6-28})
		.CellMerge(h1,0) = 1
		.DefineSummaryBars(h,"",h1,"")
		h1 = .InsertItem(h,0,"Task 2")
		.AddBar(h1,"Task",{^2005-6-23},{^2005-7-1},"E")
		.CellMerge(h1,0) = 1
		.DefineSummaryBars(h,"",h1,"E")
		.ItemBar(h1,"E",21) = 5
		h1 = .InsertItem(h,0,"Task 3")
		.AddBar(h1,"Task",{^2005-6-25},{^2005-6-27},"E")
		.CellMerge(h1,0) = 1
		.DefineSummaryBars(h,"",h1,"E")
		.ExpandItem(h) = .T.
		.CellState(h,1) = 1
		h = .AddItem("Project 2")
		.AddBar(h,"Summary",{^2005-6-26},{^2005-7-6})
		h1 = .InsertItem(h,0,"Task 1")
		.AddBar(h1,"Task",{^2005-6-26},{^2005-7-2})
		.CellMerge(h1,0) = 1
		.DefineSummaryBars(h,"",h1,"")
		h1 = .InsertItem(h,0,"Task 2")
		.AddBar(h1,"Task",{^2005-6-28},{^2005-7-6},"E")
		.CellMerge(h1,0) = 1
		.DefineSummaryBars(h,"",h1,"E")
		.ItemBar(h1,"E",21) = 5
		h1 = .InsertItem(h,0,"Task 3")
		.AddBar(h1,"Task",{^2005-6-30},{^2005-7-2},"E")
		.CellMerge(h1,0) = 1
		.DefineSummaryBars(h,"",h1,"E")
		.ExpandItem(h) = .T.
		.CellState(h,1) = 1
	endwith
	.EndUpdate
endwith

ENDPROC
PROCEDURE loadfromxml
LOCAL cNameV,cValue ,	cAddStr,nPosNm,nPosVl,nOcc
RETURN
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>16</reserved2>
		<reserved3>resuparent Ðîäèòåëü ðåñóðñîâ ïî äåðåâó òîâàðîâ
ndefclt êëèåíò ïî-óìîë÷àíèþ
lonlytime Ïîêàçûâàòü íà áàðàõ òîëüêî âðåìÿ èëè åùå èíô î êëèåíòå
ntimeclearnum Âðåìÿ â ÷àñàõ ìåæäó óáîðêàìè íîìåðîâ
nwkdays êîëè÷åñòâî äíåé äëÿ çàãðóçêè ñ òåêóùåé äàòû
nfrmid Id ôîðìû äëÿ ïëàíà
*addxml äîáàâëÿåì äîï íàñòðîéêè
*loaddata1 
*loadfromxml Çàãðóçêà Ãàíòòà èç XML ôàéëà 
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7>Ïðîñìîòð ðåñóðñîâ ÷åðåç Ãàííòà äëÿ ïðîì. ïðîåêòîâ</reserved7>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1084396758</timestamp>
		<class>g2antt</class>
		<classloc>gannt.vcx</classloc>
		<baseclass>olecontrol</baseclass>
		<objname>G2ANTT1</objname>
		<parent>frmresuprom</parent>
		<properties>Top = 0
Left = 1
Height = 600
Width = 1080
ZOrderSet = 3
dbtablename = Basis!rv_ResursJrn
_handledcustommsglist = 
_handledcustommsgpromptlist = 
cname0 = Ðàáîòû, ñîáûòèÿ
ncountunits = 15
npanewith0 = 180
nwithcol0 = 180
nhistogramheight = 10
Name = "G2ANTT1"
</properties>
		<protected/>
		<methods>PROCEDURE _add
LPARAMETERS item, datestart, dateend
LOCAL lPartFrmId ,lPartFrmId1 ,tnTvrID,lnMsuID,lnPrice ,_PARAM1,_PARAM2,llResult,lnQnt,lRetValPut, lFreeChoise
nitem = item
WITH this
.Enabled = .F.

		PUBLIC nMakerOuId,nDefClt1,nIspCltID,nTvrId,cRezult
		nDefClt1 = thisform.nDefClt

		SELECT rv_ResursLst
		LOCATE ALL FOR BarId = nitem
		nTvrId = rv_ResursLst.TvrId
		lFreeChoise = !FOUND()
		IF lFreeChoise
				GO top
				LOCATE ALL FOR ItemId = nitem
		ENDIF
		nMakerOuId = rv_ResursLst.MakerOuId
		*** - 29.09.2009 17:45:17 Ãëóõîâ Â.Þ. (C) - &gt;
		** îïðåäåëÿåì åñòü ëè çàåçäû ïî ïóòåâêàì äëÿ ýòîãî òîâàðà-ðåñóðñà
		_PARAM = rv_ResursLst.ServID
		USE BASIS!lvmatrixhotel IN 0 ALIAS matrixhotel
		USE IN SELECT('lvmatrixhotel')
		SELECT * FROM matrixhotel INTO TABLE tmp\lvmatrixhotel
		USE IN SELECT('matrixhotel')
		IF RECCOUNT('lvmatrixhotel')&gt;0
			USE IN SELECT('lvmatrixhotel')
			PUBLIC lRetValm[1,2]
			lRetValPut = oApp.DoModalFormRetValObj([frmhotelput;primarydoc_v1.vcx;primarydoc.app]) &amp;&amp;,rv_ResursLst.ServID)
			IF lRetValPut
				lnPrice = lRetValm[1,2]
				lnQnt   = lRetValm[1,1]
	  	 		 lnQnt   = IIF(TYPE('datestart')='T',lnQnt*24*60*60, lnQnt  )
	      		 dateend   = datestart+   lnQnt
			ENDIF
	        RELEASE lRetValm
		ENDIF
		USE IN SELECT('lvmatrixhotel')
		ERASE tmp\lvmatrixhotel.dbf
		
		IF lFreeChoise
				SELECT rv_ResursLst
				LOCATE ALL FOR ItemId = nitem
				IF !FOUND()
			        RELEASE nMakerOuId,nDefClt1,lRetValm,nTvrId,cRezult
					RETURN 0
				ENDIF
				cRezult = spFreeRec(rv_ResursLst.TvrParId,datestart+1,dateend-1 )
				* ñîçäàåì ñïèñîê ðåñóðñîâ, êîòîðûå äîñòóïíû â ýòîò ïåðèîä
				IF EMPTY(cRezult)
					RETURN 0
				ENDIF
			ELSE
				lBarCnt = ._find(rv_ResursLst.TvrId,datestart, dateend,0)
				IF lBarCnt &gt;0
					RETURN 0
				ENDIF
		ENDIF

	    dStart = datestart
	    dEnd   = dateend
luResAdding = oMgrPD.Operate([FORM],[ADDSCHET],ThisForm.nScrFrmID,datestart, dateend )  &amp;&amp; DATETIME(), DATETIME())
IF !EMPTY(cRezult)
				SELECT rv_ResursLst
				GO TOP
				LOCATE ALL FOR TvrId = nTvrId
				nitem = rv_ResursLst.BarId
				nMakerOuId = rv_ResursLst.MakerOuId
				cRezult = 'TMP\'+cRezult +'.dbf'
				ERASE (cRezult)
ENDIF
datestart = dStart
dateend   = dEnd
RELEASE nMakerOuId,nDefClt1,lRetValm,nTvrId,cRezult
.Enabled = .T.
SET DATABASE TO BASIS
IF TYPE('luResAdding')='L'
RETURN 0
ENDIF
		lPartFrmId1  = luResAdding

		SELECT rv_ResursLst
		SCATTER MEMVAR
		** ñ÷èòàåì âðåìÿ â ìèíóòàõ
		nTime = (dateend - datestart)
		*** - 14.03.2009 11:46:58 Ãëóõîâ Â.Þ. (C) - Ïðàâà ïðèíàäëåæàò
		IF TYPE('datestart')='T'
		   nTime = nTime /60 /60  &amp;&amp; ïðèâåëè ê ÷àñàì
**		   nTime = nTime /60 /60/24  &amp;&amp; ïðèâåëè ê ñóòêàì
		  ELSE
		   nTime  = nTime * 24  &amp;&amp; ïðèâåëè ê ÷àñàì
**		   nTime  = nTime   &amp;&amp; ïðèâåëè ê ñóòêàì
		ENDIF
		** îïðåäåëÿåì êîä óñëóãè è öåíó
		_PARAM1 = m.ServID &amp;&amp;22023 &amp;&amp;tnTvrID
		_PARAM2 = 1
		***
		USE IN SELECT([lvPriceTvr])
		USE lvPriceTvr IN 0
IF lRetValPut
	nTime  = 1
	ELSE
	lnPrice = lvPriceTvr.Price
		ENDIF
		USE lvOrderTvrEdit IN 0 NODATA
		APPEND BLANK IN lvOrderTvrEdit
		REPLACE ;
			FrmID WITH luResAdding  , ;
			TvrId WITH m.ServID, ; &amp;&amp; (ïðîæèâàíèå â íîìåðå)
			TvrIDCalc WITH m.TvrId, ; &amp;&amp;(êîä ðåñóðñà)
			MsuId WITH m.MsuID, ;
			TvrQnt WITH nTime  , ;
			TvrPrcSale WITH lnPrice  ;
		IN lvOrderTvrEdit
		RELEASE lnPrice
		**SET STEP ON
		llResult = TABLEUPDATE(1,.T.,[lvOrderTvrEdit])
		*------------------------------------------------------------------------------
		IF llResult
			lPartFrmId = spGetLastIncrementedID([lvOrderTvrEdit])
			**lPartFrmId = spGetLastIncrementedID([JrnUsege])
		ELSE
		   RETURN 0
		ENDIF

USE IN SELECT('lvJrnUsageEditPartTvr')
		_PARAM = lPartFrmId
			
			**FrmPartTvrId WITH lPartFrmId ,;

USE lvJrnUsageEditPartTvr IN 0
SELECT lvJrnUsageEditPartTvr
		REPLACE ;
			UseStart WITH datestart, ;
			UseEnd WITH dateend, ;
			UsePlan WITH .t. ;
		IN lvJrnUsageEditPartTvr
		llResult = TABLEUPDATE(1,.T.,[lvJrnUsageEditPartTvr])
		IF llResult
			.lnbarid= lvJrnUsageEditPartTvr.JrnUseId
			lPartFrmId = .lnbarid
	    	INSERT INTO rv_ResursJrn (JrnUseId,ItemId, FrmId,BarId,UseStart,UseEnd,PointIspCl,FrmIsPayed) ;
	    					  VALUES (lPartFrmId,item,luResAdding,lPartFrmId,datestart,dateend,pPointIspCltID,.f.)  &amp;&amp; äëÿ îòîáðàæåíèÿ
		ELSE
		   RETURN 0
		ENDIF
		*** lvFrmEdit.PointIspCltID
	lresult = spDiscRecount(lPartFrmId1, nIspCltID,null,null)
RELEASE nIspCltID
ENDWITH 		
RETURN luResAdding
ENDPROC
PROCEDURE _dele
LOCAL luRes , lFrmId
WITH this
	SELECT rv_ResursJrn
	LOCATE ALL FOR rv_ResursJrn.JrnUseId = .lnbarid
	IF FOUND() AND 	(rv_ResursJrn.FrmStatusI&lt;3 AND !rv_ResursJrn.FrmIsPayed)
	   lFrmId = rv_ResursJrn.FrmID
	   luRes = oMgrPD.Operate([FORM],[DELE],rv_ResursJrn.FrmID)
	
	  IF luRes
		SELECT rv_ResursJrn
		LOCATE ALL FOR rv_ResursJrn.FrmID = lFrmId
	   DO while FOUND()
		   .Items.RemoveBar(rv_ResursJrn.itemid , rv_ResursJrn.JrnUseId)
			DELETE next 1 IN rv_ResursJrn
			LOCATE ALL FOR rv_ResursJrn.FrmID = lFrmId
	   ENDDO
	  ENDIF
ENDIF
ENDWITH

ENDPROC
PROCEDURE _edit
*LPARAMETERS lnJrnUseId, h
LOCAL luRes, lstr, datestart, dateend,stringWk,test1
luResAdding  =.f.
SELECT rv_ResursLst
LOCATE ALL FOR rv_ResursLst.JrnUseId = .lnbarid
** åñëè äîêóìåíò íå çàêðûò äëÿ ðàáîòû
IF !FOUND()
RETURN
ENDIF
IF rv_ResursLst.FrmStatusI &gt;3 &amp;&amp;!rv_ResursJrn.FrmIsPayed òàê áûëî
	  	MESSAGEBOX('Ñòàóñ äîêóìåíòà íå ïîçâîëÿåò åãî ðåäàêòèðîâàòü.'+CHR(13)+;
	  			   'Åãî ìåíÿòü íåëüçÿ.',0+32,'Îòìåíà ðåäàêòèðîâàíèÿ äîêóìåíòîâ')
ENDIF

WITH this.Items
LOCAL h, lnJrnUseId
h = rv_ResursLst.ItemId
lnJrnUseId = rv_ResursLst.JrnUseId
datestart = .ItemBar(h, lnJrnUseId,1)
dateend   = .ItemBar(h, lnJrnUseId,2)
	ENDWITH
PUBLIC barCltName, nFrmStatusI,dStart,dend
nFrmStatusI   = rv_ResursLst.FrmStatusI
barCltName  =''
this.Enabled = .F.
dStart = IIF(VARTYPE(datestart)='C',CTOT(datestart),datestart)
dEnd   = IIF(VARTYPE(dateend)='C',CTOT(dateend),dateend)
luRes = oMgrPD.Operate([FORM],[EDIT],rv_ResursLst.FrmID)
datestart = TTOC(dStart)
dateend   = TTOC(dEnd)
this.Enabled = .t.
IF luRes
REPLACE rv_ResursLst.FrmStatusI WITH nFrmStatusI NEXT 1 IN rv_ResursLst
this.BeginUpdate()
WITH this.Items
.RemoveBar(h, lnJrnUseId)
	                .AddBar( h, this.namebar(rv_ResursLst.FrmStatusI,rv_ResursLst.FrmIsPayed) , datestart, dateend, , ALLTRIM(barCltName) )
stringWk = "Items.ItemBar("+ ALLTRIM(STR(h,10,0))+" , "+ ALLTRIM(STR(lnJrnUseId,10,0))+" , 12) =`" +IIF(rv_ResursLst.FrmIsPayed,"1","0")+"`"   &amp;&amp; exBarPercent
this.executeTemplate(stringWk)
				    stringWk = "Items.ItemBar("+ ALLTRIM(STR(h,16,0))+" , "+ ALLTRIM(STR(lnJrnUseId,10,0))+" ,  6) = `" ;
				    						   +  "Çàñåëåíèå:"+ IIF(VARTYPE(datestart)='C',datestart,TTOC(NVL(datestart,{})))+ ;
				    							  "      Âûåçä:        "+ IIF(VARTYPE(dateend)='C',dateend,TTOC(NVL(dateend,{})))+"`"    &amp;&amp; exBarToolTip
				    This.ExecuteTemplate(stringWk)
	  ENDWITH
this.EndUpdate()
ENDIF
RELEASE barCltName, nFrmStatusI,dStart,dend
RETURN luRes

ENDPROC
PROCEDURE _handlecustommsg
LPARAMETERS tcMsg
DODEFAULT(tcMsg)
DO CASE
	CASE tcMsg = [GUESTIN]
		*16.09.2007 18:10 -&gt;Ìåíÿåì ñòàòóñ íà 3 - ãîñòü çàñåëåí
		LOCAL lnFrmID, lRetVal, lnUserClt
		lRetVal  = .f.
		SELECT rv_ResursJrn
		LOCATE ALL FOR rv_ResursJrn.JrnUseId = this.lnbarid
		
		IF FOUND() AND rv_ResursJrn.FrmStatusI &lt; 3 AND MESSAGEBOX('Çàñåëÿòü ãîñòÿ â íîìåð?',4+32+256,'Èçìåíåíèå äàííûõ î ïðîæèâàíèè ...')=6
			lnFrmID = rv_ResursJrn.FrmID
			_PARAM = lnFrmID
			lnUserClt = spUserClt()
			USE lvFrmEdit IN 0
			CURSORSETPROP([BUFFERING],3,[lvFrmEdit])
			REPLACE FrmStatusID WITH 3, ExecEmiCltID WITH lnUserClt IN lvFrmEdit
			**oApp.nUserKod
			lRetVal = TABLEUPDATE(1,.T.,[lvFrmEdit])
			USE IN lvFrmEdit
		ENDIF
		*------------------------------------------------------------------------------
		IF lRetVal
REPLACE rv_ResursJrn.FrmStatusI  WITH 3 NEXT 1 IN rv_ResursJrn
this.BeginUpdate()
WITH this.Items
LOCAL h, lnJrnUseId
h = rv_ResursJrn.ItemId
lnJrnUseId = rv_ResursJrn.JrnUseId
datestart = .ItemBar(h, lnJrnUseId,1)
dateend   = .ItemBar(h, lnJrnUseId,2)
.RemoveBar(h, lnJrnUseId)
		                .AddBar( h, this.namebar(3,rv_ResursJrn.FrmIsPayed) , datestart, dateend, lnJrnUseId, ALLTRIM(rv_ResursJrn.CltNm) )
stringWk = "Items.ItemBar("+ ALLTRIM(STR(h,10,0))+" , "+ ALLTRIM(STR(lnJrnUseId,10,0))+" , 12) =`" ;
						   +IIF(rv_ResursJrn.FrmIsPayed,"1","0")+"`"   &amp;&amp; exBarPercent
this.executeTemplate(stringWk)
					    stringWk = "Items.ItemBar("+ ALLTRIM(STR(h,16,0))+" , "+ ALLTRIM(STR(lnJrnUseId,10,0))+" ,  6) = `" ;
					    						   +  "Çàñåëåíèå:"+ IIF(VARTYPE(datestart)='C',datestart,TTOC(NVL(datestart,{})))+ ;
													  "      Âûåçä:        "+ IIF(VARTYPE(dateend)='C',dateend,TTOC(NVL(dateend,{})))+"`"    &amp;&amp; exBarToolTip
					    This.ExecuteTemplate(stringWk)
		  ENDWITH
this.EndUpdate()
		ENDIF
	CASE tcMsg = [PAYORD]
LOCAL nPayVarNum
nPayVarNum = ALLT(oRes.GetParam([RST],[PAYTYPE]))
		*16.09.2007 18:10 -&gt;Îïëàòà ñ÷åòà êëèåíòà
		LOCAL lnFrmID
		SELECT rv_ResursJrn
		LOCATE ALL FOR rv_ResursJrn.JrnUseId = this.lnbarid
		IF FOUND()
			lnFrmID = rv_ResursJrn.FrmID
			IF rv_ResursJrn.FrmIsPayed
				IF MESSAGEBOX('Äîêóìåíò óæå îïëà÷åí, îôîðìèòü âîçâðàò äåíåã (âûáåðèòå Äà)',4+32+256,'Îôîðìëåíèå âîçâðàòà çàêàçà')=6
			**+ CHR(13) + ;
			**		 								   'èëè ñäåëàòü Äîïëàòó (âûáåðèòå Íåò)?'
				lRetVal = oApp.DoModalFormRetValObj([FrmPayment;payment.vcx],lnFrmID  ,nPayVarNum,IIF(rv_ResursJrn.FrmIsPayed,2,1) ,0)
				  ELSE
				 	RETURN
				 ENDIF
			 ELSE
				lRetVal = oApp.DoModalFormRetValObj([FrmPayment;payment.vcx],lnFrmID  ,nPayVarNum,IIF(rv_ResursJrn.FrmIsPayed,1,1) ,0)
			ENDIF
			*------------------------------------------------------------------------------
			IF lRetVal
	         REPLACE rv_ResursJrn.FrmIsPayed WITH IIF(rv_ResursJrn.FrmIsPayed,!lRetVal,lRetVal) NEXT 1 IN rv_ResursJrn
	         this.BeginUpdate()
	          WITH this.Items
					        stringWk = "Items.ItemBar("+ ALLTRIM(STR(rv_ResursJrn.ItemId ,10,0))+" , "+ ALLTRIM(STR(rv_ResursJrn.JrnUseId,10,0))+" , 12) = 1" &amp;&amp; exBarPercent
					        This.ExecuteTemplate(stringWk)
			  ENDWITH
	         this.EndUpdate()
	         ENDIF
		ENDIF
ENDCASE


ENDPROC
PROCEDURE _info
WITH this
	SELECT rv_ResursJrn
	LOCATE ALL FOR rv_ResursJrn.JrnUseId = .lnbarid
	IF FOUND()
	   luRes = oMgrPD.Operate([FORM],[INFO],rv_ResursJrn.FrmID)
ENDIF
ENDWITH

ENDPROC
PROCEDURE _setappearance
DODEFAULT()
	WITH this.VisualAppearance
		*** Ïðîãðåññ-áàð
		s = 'gBFLBCJwBAEHhEJAEGg4BBIDg6AADACAxRDAMgBQKAAzQFAYaQNBgABhGYZYJACCIDEYeSzRNCsOw8GSEZAgOJ4eiWJIkDD'
		s = s+'KADQTAoYBKFoZJTgQYJOjCJULIRkSZ0CgmOY3UBHMjwSBEEigNIxToOU4jFimCROQwQRK1BDwbQSFCEUDnaagABiHQYRBQMa'
		s = s+'vfYlSr+fx/LLtF7Xdb5fD8Py+b5vY7TdTofR9XxfxLDaz4ep+HreR63WbNej1PI+LyPC7DZrhRp4MCdTBXLbdcTqPg8DovM5z'
		s = s+'TrudpzHrdNxXWapZDxOw4bx6S6TVrEeR0XAeJx2fbBZTdPC5DabSzjXLEazfGvBCyrXq+aZ3G6aJzWbZBbjaM7zbLuW'
		s = s+'zbFJoGwMZck0Zgrh2KpEHUdpdG0RgjiWJJCHMM5Xm4NoCm2RJPF0OJZkuFwbC0bphGSLRcAwdYbgWDIyDgDBSkWegrE2cwYiy'
		s = s+'AAKjMeJDCoTZjACJw3EuYoUlwLxKEMdI7CiTYSnSHw2EuMh4lgLoJlMYI4CaTYCliGQ1gsQhclcLIJGMWIxCUTRSkSEw1AsAh'
		s = s+'IlUK5InMUIuCMDQijCCg0gqIgclMKhIEMSIoCCTQCiCBQzkocgQk4KYIDMOIkB+TJigwfAzEoEZgkwKAHHMLIfB2DByG4YIY1'
		s = s+'OaB0DGSYBkiRgmAbGoWBtU5UGsMZJGGKJDCSJxiEwaQwgkIYgkIJBGFMCIQVWMg8GEMIImEfJBCMRZinCCwWGjEg9CKBYCniC'
		s = s+'QVmkYRcj8IZFR+BgVGmYRUj4IJFBqDBRC8SAhECPAgEScpsgAE4LiGfBNC4R5hDKNATAuMZ8EuLhEjKaB+BKC4RnQSQuAeQQg'
		s = s+'jcHpEHKWB6BGLIhBkZRCFYZYVGgWoPnWMRuFwFwll0dxeFeNZ1H8YBYDYFYHGIWI2EGEBkhkRhZhgZoZkYeYgGiGhGhmKBqhq'
		s = s+'Ro5jAbIbEaWY4G6G5HAWQRwlwVwdkkcsxkmUh1B0ZxhlodwdmeAJFHiHhHhmaB6h6R45nAfIfEeWZ4H6H5HnoAIAgweASAaAg'
		s = s+'gigMgOgQIQoFIFoGCGKByB6CAiCiEgmgoIoojILoMCMKJSDaDgjiicg+hAJApBIRoSCSKQyE6FAlCkUhWhYJYpHIXoYnUCYWG'
		s = s+'eGhmjmNhvhwZw5lYd4eGeOZ2H+IBoDoFoHiIaI6DaD4kGkOhWheJhpjodofigamsiiKoqkqOowiyKx6l6HkLwVxrAFEKGILA1giibDMNkdAGgBEBA'
		.Add(54,s)
	ENDWITH

ENDPROC
PROCEDURE AddLink
*** ActiveX Control Event ***
LPARAMETERS linkkey
RETURN
LOCAL nFrmId1,nFrmId2,nPointIspCl1,nPointIspCl2,_PARAM
SELECT rv_ResursJrn
WITH This
	LOCATE ALL FOR rv_ResursJrn.JrnUseId = .lnbaridu
	IF FOUND()
		IF NVL(rv_ResursJrn.FrmIsPayed,.f.)
			  	MESSAGEBOX('Îäèí èç äîêóìåíòîâ óæå îïëà÷åí.'+CHR(13)+;
	  			   'Åãî ìåíÿòü íåëüçÿ.',0+32,'Îòìåíà îáúåäèíåíèÿ äîêóìåíòîâ')
	  			   RETURN .f.
		ENDIF
	    nFrmId2 = rv_ResursJrn.FrmID
		nPointIspCl2 = rv_ResursJrn.PointIspCl
		ELSE
	  			   RETURN .f.
	ENDIF

	LOCATE ALL FOR rv_ResursJrn.JrnUseId = .lnbarid
	IF FOUND()
		IF NVL(rv_ResursJrn.FrmIsPayed,.f.)
			  	MESSAGEBOX('Îäèí èç äîêóìåíòîâ óæå îïëà÷åí.'+CHR(13)+;
	  			   'Åãî ìåíÿòü íåëüçÿ.',0+32,'Îòìåíà îáúåäèíåíèÿ äîêóìåíòîâ')
	  			   RETURN .f.
		ENDIF
	   nFrmId1 = rv_ResursJrn.FrmID
	   nPointIspCl1 = rv_ResursJrn.PointIspCl
		ELSE
	  			   RETURN .f.
	ENDIF

	IF nFrmId1 = nFrmId2
	  	MESSAGEBOX('Ýòè äîêóìåíòû óæå îáúåäåíåíû.',0+32,'Îòìåíà îáúåäèíåíèÿ äîêóìåíòîâ')
	  			   RETURN .f.
	ENDIF

	IF nPointIspCl1 &lt;&gt; nPointIspCl2
	  	MESSAGEBOX('Ó äîêóìåíòîâ ðàçíûå êëèåíòû.'+CHR(13)+;
	  			   'Ñäåëàéòå îäíîãî êëèåíòà.',0+32,'Îòìåíà îáúåäèíåíèÿ äîêóìåíòîâ')
	  			   RETURN .f.
	ENDIF


	IF   	MESSAGEBOX('Îáúåäèíÿòü ýòè äâà äîêóìåíòà?',4+0+32,'Îáúåäèíåíèå äîêóìåíòîâ') &lt;&gt; 6
	RETURN .f.
	ENDIF

*** - 18.03.2009 20:15:36 Ãëóõîâ Â.Þ. (C) - Ïðàâà ïðèíàäëåæàò
llResult = spFormJoin(nFrmId1,nFrmId2)

		IF !llResult
		   RETURN .f.
		ENDIF
*------------------------------------------------------------------------------
llResult = spDiscRecount(nFrmId2, rv_ResursJrn.PointIspCl,null,null)
REPLACE ALL FOR rv_ResursJrn.FrmId = nFrmId1 rv_ResursJrn.FrmID WITH nFrmId2 IN rv_ResursJrn
IF MESSAGEBOX('Äîêóìåíò èçìåíåí. Ðàñïå÷àòàòü åãî?',4+32,'Ïîäãîòîâêà ê ïå÷àòè ...')=6
	.lnbarid= .lnbaridu
	._prndoc()
ENDIF
ENDWITH

DODEFAULT(linkkey)

ENDPROC
PROCEDURE addxml
LOCAL s
WITH this
.BeginUpdate
.SingleSel = .F.
s = "gBJJgBAIDAAGAAEAAQhYAf8Pf4hh0QihCJo2AEZjQAjEZFEaIEaEEaAIAkcbk0olUrlktl0vmExmUzmk1m03nE5nU7nk9n0/oFBoVDolFo1HpFJpVLplNp1PqFRqVTq"
s=s+"lVq1XrFZrVbrldr1fsFhsVjslls1ntFptVrtltt1vuFxuVzul1u13vF5vV7vl9v1BAmBhOCwMKwuDw2ExWJxmIx2HyGLx+SyONyuTy2UzWZzmYz2X0Gbx1kUigUAAMwzG"
s=s+"eo1Ws1ZV2Go1IAL+1ACZMxm2+52W63Ov2Op1fC13F0un4nJ1vE2BV2XD2e/4vK4fL63V1bMTKZ5/d2pf3vh6Xj2ff3e63G683S5vF0mmAD4+Xx+bA+wAeP5/H6a/9+h8P2"
s=s+"eIAGZAiHHYZkDQQ7TuH/Ap4GUUzjPgiCJn+AD7GBAMNQJBD8wFDwAFlEUExJBaHQdCDixM+UARYABuxg/8ZQ5DUQRpEEbQKf8DxPBDiPe08KRdDEZHVIwANU1YRSWAALSdJ"
s=s+"snxpHcFO3HsrOI48Ky1IkKQpERZAA9sjHVC77ynEsqwbBE1RVNKHgAQ04yQ1skvDOJDRkZc9ABJYRT5Jk+z/P0pR49sgQHAsaUVApx0aAD+mvOclSZIkYG7MsMxNTUqyw+F"
s=s+"FwVRNQwRSwACFUwADvVNHv9IlNu5V02u5UjzVMIUQxHMYABzXdUVVRpxgBXM60DX9MQHTjWrJE0uzfGkXRdXNa0FYMjxBM8vxJM7iWXN8KSlbs31zWlT1Ja0eWxM9tNbbkL"
s=s+"UhY1mQtaU62hI9hyZUl0x5H6x3ZLVvwtekyWlYlHXNBF0R5dTszdC1vR1cELVJO9JABLODVvMF8x9deGS1fE3yJXYc4pgOKUDfGE31ZN+Srd13U/VdI1y9uCWBPRl2NE1sW"
s=s+"xbeWv9l2f6DSNSXdkTaNtd1WyrncR567mgaHGJLanMLY2laVc2FOjW1JpTuX2sV0YhmMtQpXLct1msZRBLmU421exYbN93XgAFixA9s61ztkzbc4u47LHmb6O8ExSPs0j6N"
s=s+"Otyv1hSy8BCm6bHs7eUDXMXb5DOLuJyG5v9CjzWLCkszrqZLS2+/NtbwEQdFN9sPbLPEYFU/Fxj1TV2U7WyahslSdM8O9SPGkieK+8iW33fe1JXNUjvqrnWlo1A2lUnieO+"
s=s+"/k1lGMs7RjDwvNiciedUtT6Nd3B+RlaxQJBmx8luULWLLPqxjZ769S/UQe1svPUi6M+D5DzN5a2athyHX9H6f43VIjE3yMTbqrlbB5l3OYgU+ssL7X+rtc+2Nj7AD5vwRkk"
s=s+"SCyAoFvvg6/FaiZIIuHbGv9DRxEuQeRjC2FkKH/pvRcs4+b+4MFgH+mmISDIhrHN0dqI5uIjRLGYbOJp2YnRRihAaIsQYiRXIdFVKsSImRKiegOKUYIpxZiwg2MsWokxpjF"
s=s+"Gs7UY4vxvNmWSKwAEHoRjrHRFMZkToMd3HqOcf4lRBN1IKLMg4vGzjnHeRUeY+yNj5GeIkhpJSFkpF+RKKZFoRj9I6PcZJKSElBIGUUR44ljkBJCT0gI1RclZIeN0YZLRal"
s=s+"RKqLsq5XRslhIiWUqY0S1l9HCV8YyyEWB8SuYpHiQEiJIAAkpKJmk4QoX8pJFE3zSKCQEA="
.Images(s)
s="gBJJgBAICAAGAAEAAQhYAf8Pf4hh0QihCJo2AEZjQAjEZFEaIEaEEaAIAkcbk0olUrlktl0vmExmUzmk1m03nE5nU7nk9n0/oFBoVDolFo1HpFJpVLplNp1PqFRqVTqlVq1XrF"
s=s+"ZrVbrldr1fsFhsVjslls1ntFptVrtltt1vuFxuVzul1u13vF5vV7vl9v1/wGBwWDwmFw2HxGJxWLxmNx2PyGRyWTymVy2XzGZzWbzmdz2f0Gh0WjwEWH0r08ekEikgAkso184iG"
s=s+"kicPjcU2+zjW43e6jO8jL+b79X8bfif48bfAffgP43IT8b4XE3O23vW3++2r/6vcjUB"
.Images(s)

*!*		.DrawGridLines = -1
*!*		.BackColor = RGB(255,255,255)
*!*		.MarkSearchColumn = .F.
*!*		.ShowFocusRect = .F.
*!*		.HasLines = .F.
*!*		.Indent = 24
*!*		.DefaultItemHeight = 20
*!*		.AllowChartScrollPage = .T.
*!*		.ScrollPartCaption(2,2048) = "&lt;img&gt;4&lt;/img&gt;"
*!*		.ScrollPartCaption(2,32) = "&lt;img&gt;5&lt;/img&gt;"
*!*		   WITH .VisualAppearance
*!*			.Add(1,"gBFLBCJwBAEHhEJAEGg4BOEIQAAYAQGKIYBkAKBQAGaAoDDMOILQiMQxDPBMKgBBCLIxiGK4DhiGoZQ0HKCRZDeI4DDSNcgjCLIZw8GYCIRjaL5UkPGSZJpmSRwAiWPIpSrLMrgLLMdR1HCBaQiehoaiEMg1CTTVQSCKoYSjBKqarjGbKGoqSozUxNMAggI=")
*!*			.Add(2,"XP: Header 1 1")
*!*		   ENDWITH
*!*				.HTMLPicture("excel") = "gAAAABgYAEAgBEChSohIAC0KFEKEEKIEKgkNhQAAkZjkCgkejshkUjkklk0nlEplUrlRofQSADbMhEABwl8xmYAI0KaoPawANgYYwAeIDIIARE3mU0A08n1AoVEo1IBVDYrjo7NrFQoaoqoAK5+IYAXE3N1iAB2tCcfcwQFosswpsCns/fDVmlBobQm4GHVMi0KJQBBcceE3VAscJ3XgADAAucFgWDwt1ADNVa6bgUtoAcxSxeWxuPyMfAGUjhwfkwGmdQ5kxbXAL/f+jyGByeEjhQzrwEJ1OOy2m20uC3SszpvE/A4m40+6TfLOOqmEZSBCCYAu80jLY35xjPCf/UyU1zocYECGmrxzDOxxKAmOJx2m0aGdOgl4HX7PNkDcsK8iMnQzoNmCOQ4v88rUCI9jlOYxzbv+57Cui4EBIU/jtLwjg1mBBCMjgYjsvIbgjsW20NO2ABIPYFj2RamEYgAW4PnMO4ICQxb6n+UD2DsE0IMfEJ+phFZMAeoYBIVJaOw0kQwPY2wuSK9r3iA+T6PqYD2MTFEIuLACayqzDNG49gyROO4QhkIoACsESKhxKpsTiAB4PYVgOGOjSFAYWShkKEiKkoaChipKpMhOioMUAAAbhEo6NoFP6hgiECj0qAB7Uwjk9T5TQ2A3Ph4A1PhYI+KtBgAcEqj9VdBIqjLTGJKo3BsipVzsWE6TsOEq0mABcz2AFapgAhYqGdliGhKoXUWAB6WJYc+E4HiK2MAFPz6gVroqBznNMZAJz4UwFiEABnXVdd2Xbd133heN5Xnel63oHwo3zfV935ft83gHxAYFgeCYLgxACjgGD4Xg+E3fgOBX9iV84jhWI4IKOI4phGN4Ri2EYxjWM45kePYfgd/ZJkWUY/kuQZJfmWZPi+UZXlWK5nmF9ZvneKj4H2f6DoGh6Fl2UY7hOiaVoWg5do2WZ/hmB5/iekGdoGD6VoGnZDn2A6ZrGg6pruaY9rGlkBoJAa3quoa/om06HuOuZriusbiPm8bOPm6bLhOo4FvOhanfG27tvO071wGt7Jl+PajwWl7fvvHaTvOlbXtW2X6H138huWBblwGDYhhHO6vxGpbv0mI9OZ2wdhoeY9D012cl2PU4LfHXXj0upYGH3ed73/dXt4Pj+R5PkXfHkeH8hXnoF6IAen6voev6XseolnuJW0wBoUA6FAf6IP+iH/oj+gI="
*!*				.HTMLPicture("word") = "gAAAABgYAEAgBEChSohIAC0KFEKEEKIEKgkNhQAAkZjkCgkejshkUjkklk0nlEplUrlRofQSADbMhEABwl8xmYAI0KaoPawANgYYwAeIDIIARE3mU0A08n1AoVEo1IBVDYrjo7NrFQoaoqoAK5+IYAXE3N1iAB2tCcfcwQFosswpsCns/fDVmlBobQm4GHVMi0KPwCDMceE3VAscJ3NQBCYAucFgWDwt1ADNVa6bgUtoAcxSxeWxuPyMfAGUjhwfkwGmdQ5kxa1AL/f+jyGByeEjhQzrwEJ1OOy2m20uC3SszpvE/A4m40+6TfLOOqmEZGBux93mkZbG/OMZ4T/6mSmudDjAgQ01YADDDOxxKAmOJx2m0aGdOgl4HXx/NkDcsK8aMnQzoNmCOQ4v88jUCI9blOYxzbv+57Cui4EBIU/gAO0jg1mBBCMjwYTHvGbgjsW20NQ4SD1hY9cWJhGAAFuD5zDuCAkMW+p/lA9Y7BNCDHoyOB+phDhMAeoYBIVJaOw0kQwPW2wuSK9j3DiID5Po+pgPWxMUQi4sAJrKrMM0bhkqGDQQoqEIZCKAArBEiocSqbE5gAeD1nRNKNIUBhZKGQoSIqKB7KGKkqkyE6KgxQIABuESjo2gVAKGCIQKPSwAHtTKOT4odNjwfqhn4fihgAAaBCrQgAHBKoSHxNU2TImFKAAe8+gohRaTwWE7Twb88VvXKhmJKoYVoFFZAAaEqhdRgABhZligATgeIrY6YVBPyBWwioIOc0wwWYUwFiEABnXVdd2Xbd133heN5Xnel63oHxjXzfV935ft83gHxAYFgeCYLgxAGNgGD4Xg+E3fgOGYjgWHXdiGJX7geKXbi2JYXjV2Ytf2RGNjOFY7hmP3XkOR4xieTZPhpnBbmWaZnm2amdlmSZdnGb59mWYYTmeO5nnWS6BmxAZvgegZPoRnEBmmo5tnei5Zo4W6VpGaYhpuO6fqee6hrV84nluEXVrOf6pqeCX1hGy5doet7UZ2A6ts23axqW+bnrOM7juO0Z9rW65vwOC53tGxbXr24YEH136HiXJ7NfOQ8jtOO8dfeIGNzPGdDheA8/dvG7X0fS3njmOh90F5dZiXX9h13a9t2/a3fHcdn8hXeoF34AeD4ffeL4HjeElnlJW01VIEA6FAf34P9+H/fj+gIA=="

*!*	.SelBackColor = 16777216
*!*	.SelForeColor = RGB(0,0,128)
**'Uncomment it if you are running Windows XP
** .BackColorHeader = 33554432
WITH .Chart
			*!*		.AllowCreateBar = .F.
			*!*		.NonworkingDaysColor = RGB(196,196,128)
			*!*		.NonworkingDaysPattern = 6
			*!*			*!*		.FirstVisibleDate = "Feb 24 2006"
			*!*		.BackColor = RGB(255,255,255)
			*!*		.DrawGridLines = 2
			*!*		WITH .Bars.Add("End")
			*!*			.Pattern = 2
			*!*			.Color = RGB(255,128,128)
			*!*		ENDWITH
	
	
			*!*		exYear         0  Indicates the year. Values: ..., 2001, 2002, 2003, ...
			*!*	    exHalfYear     1  A date between January 1st and June 31 indicates the first half of the year, and from July 1 to December 31, indicates the second half of the year. Values: 1 and 2
			*!*	    exQuarterYear  2  A date between January 1st and March 31 indicates the first quarter of the year, a date between April 1st and June 30 indicates the second quarter of the year, a date between July 1st and September 30 indicates the third quarter of the year, and if a date between October 1st and December 31 indicates the forth quarter of the year. Values: 1, 2, 3 and 4
			*!*	    exMonth       16  Indicates the month. Values: 1 ( January ), 2 ( February ), ..., and 12 ( December ). Use the MonthNames property to specify the name of the months.
			*!*	    exThirdMonth  17  The first ten days in a month indicates the first third of the month, the next 10 days indicates the second third of the month, and the last 10 days in the month indicates the last third of the month. Values: 1, 2 and 3.
			*!*	    exWeek        256  Indicates the week in the year. Values: 1,2,...,53. Use the WeekDays property to specify the name of the days in the week.
			*!*	    exDay         4096  Indicates the day of the date. Values: 1,2,..,31
			*!*	    exHour        65536  Indicates the hour.
			*!*	    exMinute      1048576  Indicates the minute.
			*!*	    exSecond      16777216  Indicates the second.

		.Label(0) = ""  &amp;&amp; exYear
		.Label(1) = ""  &amp;&amp; exHalfYear
		.Label(2) = ""  &amp;&amp; exQuarterYear
		.Label(16) = ""  &amp;&amp; exMonth
		.Label(17) = ""  &amp;&amp; exThirdMonth
*!*		.Label(256) = ""  &amp;&amp; exWeek
*!*		.Label(4096  ) = ""  &amp;&amp; exDay
*!*		.Label(65536  ) = ""  &amp;&amp; exHour
		.Label(1048576) = ""  &amp;&amp; exMinute
		.Label(16777216) = ""  &amp;&amp; exSecond
		*!*		.OverviewBackColor = RGB(255,255,255)
		*!*		.OverviewVisible = .T.
		*!*		.AllowOverviewZoom = 1
	***.OverviewZoomCaption = "Year|  ?Year|  ?Year|&lt;img&gt;3&lt;/img&gt;|Third|&lt;img&gt;2&lt;/img&gt;|&lt;img&gt;1&lt;/img&gt;|Hour|Min|Sec"
	*.OverviewZoomCaption =    "Year|1\2Year|1\4Year|&lt;img&gt;11&lt;/img&gt;|Third|&lt;img&gt;11&lt;/img&gt;|&lt;img&gt;10&lt;/img&gt;|&lt;img&gt;9&lt;/img&gt;|Min|Sec"
*!*		.OverviewZoomUnit = 24
ENDWITH
.EndUpdate
ENDWITH


ENDPROC
PROCEDURE BarResize
*** ActiveX Control Event ***
LPARAMETERS item, key
IF this.linload
RETURN .t.
ENDIF
IF !TYPE('key')= 'N'
		  thisform.CmdReload.Click()
RETURN .f.
ENDIF
LOCAL  lStart, lEnd, stringWk, lChange,lnResursId, lBarCnt,lresult ,llResult

with this.Items
SET DATABASE TO BASIS
_PARAM = key
USE IN SELECT('rv_JurnalUseEdit')
USE rv_JurnalUseEdit IN 0
*** - 19.03.2009 10:56:41 Ãëóõîâ Â.Þ. (C) - Ïðàâà ïðèíàäëåæàò
*** îáúåêò íå íàøëè
IF !RECCOUNT('rv_JurnalUseEdit')=1
=MESSAGEBOX('Îøèáî÷íûé êîä îáúåêòà. '+CHR(13)+'Ñîõðàíåíèå íå ïðîèçîøëî ...',0+16, 'Ïðîáëåìà')
		     USE IN SELECT('rv_JurnalUseEdit')
		  thisform.CmdReload.Click()
RETURN .f.
ENDIF
SELECT rv_ResursJrn
LOCATE FOR rv_ResursJrn.BarId = key
lChange = .f.
lStart = NVL(rv_JurnalUseEdit.UseStart ,{})
lEnd   = NVL(rv_JurnalUseEdit.UseEnd,{})
lnResursId = rv_ResursJrn.ResursID
*!*	    *** äîêóìåíò îïëà÷åí,íî äëèòåëüíîñòü òà æå, èëè àêöåïòîâàí
*!*	     IF rv_ResursJrn.FrmStatusI&gt;3 OR (rv_ResursJrn.FrmIsPayed AND (.ItemBar(item,key,2)-.ItemBar(item,key,1))&lt;&gt;(lEnd-lStart) )    &amp;&amp; òàê áûëî rv_ResursJrn.FrmStatusI&gt;2 OR rv_ResursJrn.FrmIsPayed
*** äîêóìåíò îïëà÷åí èëè àêöåïòîâàí
IF rv_ResursJrn.FrmStatusI&gt;3 OR rv_ResursJrn.FrmIsPayed    &amp;&amp; òàê áûëî rv_ResursJrn.FrmStatusI&gt;2 OR rv_ResursJrn.FrmIsPayed
=MESSAGEBOX('Äîêóìåíò àêöåïòîâàí èëè îïëà÷åí.'+CHR(13)+'Èçìåíÿòü íåëüçÿ.'+CHR(13)+'Îáðàòèòåñü ê àäìèíèñòðàòîðó.',0+32+4096, 'Íåäîïóñòèìîå äåéñòâèå ...',5000)
		  thisform.CmdReload.Click()
		  RETURN .f.
ELSE
	     lStart = .ItemBar(item,key,1)
	     lEnd   = .ItemBar(item,key,2)
	     IF VARTYPE(lStart)='C' OR VARTYPE(lEnd)='C'
		  thisform.CmdReload.Click()
	     	RETURN .f.
	     ENDIF
	    *** ïîìåíÿëè ñòàðò è îí â çàïðåòíîì ïåðèîäå ÈËÈ îêîí÷àíèå â çàïðåòíîì ïåðèîäå ÈËÈ íîâîå íà÷àëî â çàïðåòíîì ïåðèîäå
	     IF (thisform.tOgrDate &gt; rv_JurnalUseEdit.UseStart  AND rv_JurnalUseEdit.UseStart  &lt;&gt; lStart) OR  thisform.tOgrDate &gt; lEnd OR  (thisform.tOgrDate &gt; lStart AND rv_JurnalUseEdit.UseStart  &lt;&gt; lStart)
			MESSAGEBOX('Æåëàåìàÿ äàòà íàõîäèòñÿ â çàêðûòîì ïåðèîäå.',0+32,'Âíåñåíèå èçìåíåíèé çàïðåùåíî ...')
		thisform.CmdReload.Click()
			RETURN .f.
		 ENDIF
	     IF MESSAGEBOX('Èçìåíèòü ñðîêè ïðîæèâàíèÿ?',4+32+256,'Èçìåíåíèå äàííûõ î ïðîæèâàíèè ...')=6
			     lBarCnt = this._find(lnResursId,lStart,lEnd,Key)
					IF lBarCnt &gt;0
					  thisform.CmdReload.Click()
							RETURN .f.
					ENDIF
			     lChange = .t.
		     ELSE
		  thisform.CmdReload.Click()
		       RETURN .f.
	     ENDIF
ENDIF
					IF this.chart.UnitScale =&lt; 4096
						DO CASE
							CASE this.nTypeTime = 0 &amp;&amp; C 12 äî 12
								lStart = CTOT(DTOC(lStart )+ ' 12:00:00')
								lEnd   = CTOT(DTOC(lEnd   )  + ' 12:00:00')
							CASE this.nTypeTime = 1 &amp;&amp; C 14 äî 12
								lStart = CTOT(DTOC(lStart )+ ' 14:00:00')
								lEnd   = CTOT(DTOC(lEnd   )  + ' 12:00:00')
							CASE this.nTypeTime = 2 &amp;&amp; C òåêóùåãî ÷àñà äî òåêóùåãî ÷àñà
								lEnd   = CTOT(DTOC(lEnd   )  + ' '+TTOC(lStart ,2))
						ENDCASE
				    ENDIF
				    IF (lStart &lt;DATETIME() AND MESSAGEBOX('Íà÷àëî ïðîæèâàíèÿ â ïðîøåäøåì ïåðèîäå.'+CHR(13)+'Èçìåíèòü ñðîêè ïðîæèâàíèÿ?',4+32+256,'Èçìåíåíèå äàííûõ î ïðîæèâàíèè ...')=7)
				  thisform.CmdReload.Click()
				    	RETURN .f.
				    ENDIF
				    this.BeginUpdate()
				    stringWk = "Items.ItemBar("+ ALLTRIM(STR(item,16,0))+" , "+ ALLTRIM(STR(key,10,0))+" , 1) = `" + TTOC(lStart)+"`"
				    this.executeTemplate(stringWk)
				    stringWk = "Items.ItemBar("+ ALLTRIM(STR(item,16,0))+" , "+ ALLTRIM(STR(key,10,0))+" , 2) = `" + TTOC(lEnd)+"`"
				    this.executeTemplate(stringWk)
				    stringWk = "Items.ItemBar("+ ALLTRIM(STR(item,16,0))+" , "+ ALLTRIM(STR(key,10,0))+" , 6) = `" +  "Çàñåëåíèå:"+ TTOC(NVL(lStart,{}))+ ;
	    																			  "      Âûåçä:        "+ TTOC(NVL(lEnd,{}))+"`"    &amp;&amp; exBarToolTip
				    this.ExecuteTemplate(stringWk)
				    this.EndUpdate
IF !(rv_ResursJrn.FrmStatusI&gt;2 OR rv_ResursJrn.FrmIsPayed) AND lChange
REPLACE  UseStart WITH  lStart , ;
	 UseEnd   WITH  lEnd IN rv_JurnalUseEdit
		llResult = TABLEUPDATE(1,.T.,[rv_JurnalUseEdit])
			IF !llResult
	            =MESSAGEBOX('Îøèáêà ïðè ñîõðàíåíèè íà ñåðâåðå [rv_JurnalUseEdit]. '+CHR(13)+'Ñîõðàíåíèå íå ïðîèçîøëî ...',0+64+4096, 'Ïðîáëåìà ëîêàëüíîé ñåòè',900)
		  thisform.CmdReload.Click()
			   RETURN .f.
			ENDIF		
		lresult = spDiscRecount(rv_ResursJrn.FrmId, rv_ResursJrn.PointIspCl,null,null)
	       REPLACE  UseStart WITH  lStart , ;
	 UseEnd   WITH  lEnd IN rv_ResursJrn
		IF MESSAGEBOX('Äîêóìåíò èçìåíåí. Ðàñïå÷àòàòü åãî?',4+32,'Ïîäãîòîâêà ê ïå÷àòè ...')=6
			this.lnbarid= key
			this._prndoc()
		ENDIF
	
ENDIF
endwith


ENDPROC
PROCEDURE barsprop
DODEFAULT()
this.VisualAppearance.Add(10,"Ebn\Bar_work.ebn")
this.VisualAppearance.Add(11,"Ebn\Bar_mone.ebn")
*this.VisualAppearance.Add(12,"Ebn\Bar_work.ebn")
With this.Chart.Bars
	.Item("Task").Height = 17 &amp;&amp;13
	.Item("Task").Pattern = 1 &amp;&amp;1
	.Item("Task").StartColor =  RGB(138,244,244)   &amp;&amp; - íåãàðàíòèðîâàííîå áðîíèðîâàíèå  -  îæèäàþùàÿ áðîíü
	.Item("Task").Color =  RGB(138,244,244)
	.Item("Task").EndColor =  RGB(138,244,244)
	.Item("Task").StartShape = 17  &amp;&amp;61447  &amp;&amp; exShapeIconFrameLeft
	.Item("Task").EndShape = 8 &amp;&amp;61448  &amp;&amp; exShapeIconFrameRight

.Copy("Task", "preTask")   &amp;&amp; - íåãàðàíòèðîâàííîå áðîíèðîâàíèå  (æåëòûé)
	*	.Item("preTask").StartColor =  RGB(0,128,192)
		.Item("preTask").Height = 22 &amp;&amp;13
		.Item("preTask").Color =  0xa000000  &amp;&amp;0x1000000   &amp;&amp; RGB(138,244,244)
	*	.Item("preTask").Color =       RGB(0,128,192)
	*	.Item("preTask").EndColor =    RGB(0,128,192)
		.Item("preTask").StartShape = 0  &amp;&amp;61447  &amp;&amp; exShapeIconFrameLeft
		.Item("preTask").EndShape = 0 &amp;&amp;61448  &amp;&amp; exShapeIconFrameRight
.Copy("Task", "garTask")  &amp;&amp; - ãàðàíòèðîâàííîå áðîíèðîâàíèå (ðàçìåùåííàÿ) (òåìíî-ñèíèé)
		.Item("garTask").Height = 22 &amp;&amp;13
		.Item("garTask").Color =  0xb000000  &amp;&amp;0x1000000   &amp;&amp; RGB(138,244,244)
		.Item("garTask").StartShape = 0  &amp;&amp;61447  &amp;&amp; exShapeIconFrameLeft
		.Item("garTask").EndShape = 0 &amp;&amp;61448  &amp;&amp; exShapeIconFrameRight
		*.Item("garTask").StartColor =  RGB(255,255,0)
		*.Item("garTask").Color =       RGB(255,255,0)
		*.Item("garTask").EndColor =    RGB(255,255,0)
.Copy("Task", "LiveTask")  &amp;&amp;  - ïðîæèâàíèå  (LiveTask) òåìíî-çåëåíûé
		.Item("LiveTask").StartColor =  RGB(0,255,64)
		.Item("LiveTask").Color = RGB(0,255,64)
		.Item("LiveTask").EndColor =  RGB(0,255,64)
.Copy("Task", "errTask")  &amp;&amp;  - ïðîæèâàíèå  (LiveTask) îðàíüæåâûé
		.Item("errTask").StartColor =  RGB(255,128,0)
		.Item("errTask").Color = RGB(255,128,0)
		.Item("errTask").EndColor =  RGB(255,128,0)

		.Item("Task").HistogramPattern = 32
		.Item("Task").HistogramColor = RGB(138,244,244)
		.Item("preTask").HistogramPattern = 32
		.Item("preTask").HistogramColor =       RGB(255,255,0)
		.Item("garTask").HistogramPattern = 32
		.Item("garTask").HistogramColor =       RGB(0,0,255)
		.Item("LiveTask").HistogramPattern = 1
		.Item("LiveTask").HistogramColor = RGB(0,255,0)
		.Item("errTask").HistogramPattern = 32
		.Item("errTask").HistogramColor = RGB(255,0,0)


	.Add('preTask%PRed')
	.Add('garTask%PRed')
	.Add('LiveTask%PRed')
	.Add('Task%PRed')
	.Add('errTask%PRed')
ENDWITH


ENDPROC
PROCEDURE Click
*** ActiveX Control Event ***
With this
	local h, c, hit, llResult
.lnitemid = .ItemFromPoint(-1, -1, c, hit)
If (.lnitemid  # 0)
.lnbarid = .Chart.BarFromPoint(-1, -1)
If Empty(NVL(.lnbarid,0))
RETURN .f.
EndIf
EndIf
ENDWITH

ENDPROC
PROCEDURE CreateBar
*** ActiveX Control Event ***
LPARAMETERS item, datestart, dateend
LOCAL lPartFrmId ,newBar,llResult
IF dateend-datestart&lt;150
RETURN
ENDIF
IF thisform.tOgrDate &gt; dateend OR thisform.tOgrDate &gt; datestart
	MESSAGEBOX('Æåëàåìàÿ äàòà íàõîäèòñÿ â çàêðûòîì ïåðèîäå.',0+32,'Âíåñåíèå èçìåíåíèé çàïðåùåíî ...')
	RETURN
ENDIF
*IF (HOUR(datestart)=14 AND HOUR(dateend)=12) OR MESSAGEBOX('Ïðèâîäèòü âðåìÿ çàñåëåíèÿ ê 14 ÷àñàì,'+CHR(13)+;
*			  ' à âðåìÿ ñäà÷è ê 12 ÷àñàì?',4+32+256,'Êîððåêòèðîâêà âðåìåíè çàåçäà-âûåçäà')=6
IF this.chart.UnitScale =&lt; 4096
	DO CASE
		CASE this.lCopy
		CASE this.nTypeTime = 0 &amp;&amp; C 12 äî 12
			datestart = CTOT(DTOC(datestart)+ ' 12:00:00')
			dateend   = CTOT(DTOC(dateend)  + ' 12:00:00')
		CASE this.nTypeTime = 1 &amp;&amp; C 14 äî 12
			datestart = CTOT(DTOC(datestart)+ ' 14:00:00')
			dateend   = CTOT(DTOC(dateend)  + ' 12:00:00')
		CASE this.nTypeTime = 2 &amp;&amp; C òåêóùåãî ÷àñà äî òåêóùåãî ÷àñà
			dateend   = CTOT(DTOC(dateend)  + ' '+TTOC(datestart,2))
	ENDCASE
ENDIF
*ENDIF
IF (datestart &lt;DATETIME() AND MESSAGEBOX('Íà÷àëî ïðîæèâàíèÿ â ïðîøåäøåì ïåðèîäå.'+CHR(13)+'Äîáàâëÿòü ïðîæèâàíèå?',4+32+256,'Èçìåíåíèå äàííûõ î ïðîæèâàíèè ...')=7)
	RETURN .f.
ENDIF

PUBLIC barCltName,nFrmStatusI,pPointIspCltID,dStart,dEnd,nitem
with this
	barCltName =''
	lPartFrmId = ._add(item, datestart, dateend)
	datestart = dStart
	dateend   = dEnd
	IF lPartFrmId &gt;0	
	    .BeginUpdate()
		with .Items
			.AddBar( nitem, this.namebar(nFrmStatusI,.f.), datestart, dateend,this.lnbarid, ALLTRIM(barCltName) )
		    stringWk = "Items.ItemBar("+ALLTRIM(STR(nitem,16,0))+" , "+ ALLTRIM(STR(lPartFrmId,10,0))+" , 6) = `" +  "Çàñåëåíèå:"+ TTOC(datestart)+ ;
		    																			  "      Âûåçä:        "+ TTOC(dateend)+"`"    &amp;&amp; exBarToolTip
		    This.ExecuteTemplate(stringWk)
	 	ENDWITH
	    .EndUpdate
		spDiscRecount(lPartFrmId ,pPointIspCltID,null,null)
		IF MESSAGEBOX('Äîêóìåíò äîáàâëåí. Äîïîëíèòü åãî?',4+32,'Âíåñåíèå äîïîëíèòåëüíîé èíôîðìàöèè ...')=6
			._edit()
		ENDIF
		IF MESSAGEBOX('Äîêóìåíò äîáàâëåí. Ðàñïå÷àòàòü åãî?',4+32,'Ïîäãîòîâêà ê ïå÷àòè ...')=6
			._prndoc()
		ENDIF
	ENDIF
ENDWITH
RELEASE barCltName,typeNewFrm,pPointIspCltID,dStart,dEnd

ENDPROC
PROCEDURE DblClick
*** ActiveX Control Event ***
LPARAMETERS shift, x, y

With this
	local h, c, hit, llResult,lTvrId
.lnitemid = .ItemFromPoint(-1, -1, c, hit)
If (.lnitemid  # 0)
.lnbarid = .Chart.BarFromPoint(-1, -1)
If Empty(NVL(.lnbarid,0))
*** Êëèêè íà ïàíåëè ñëåâà
				SELECT rv_ResursLst
				LOCATE ALL FOR BarId = .lnitemid
				lTvrId = rv_ResursLst.TvrId
				IF !FOUND()
		          				lTvrId = null
				ENDIF
		           IF !ISNULL(lTvrId) AND MESSAGEBOX('Ïðîøëà óáîðêà ýòîãî íîìåðà?',4+64,'Îòìå÷àåì óáîðêó íîìåðà ...')=6
						SET DATABASE TO Basis
						llResult = ClearNumber(lTvrId , DATETIME())
						IF llResult
							replace rv_ResursLst.clearnum WITH 0 NEXT 1 IN rv_ResursLst
							this.Items.CellValue(.lnitemid,0) = ALLTRIM(rv_ResursLst.TvrNm)
							WAIT WINDOW 'Îòìåòêà îá óáîðêå íîìåðà ñäåëàíà ...' TIMEOUT .7
						ENDIF
		           ENDIF
RETURN .f.
EndIf
EndIf
*** Êëèêè íà ïàíåëè ñïðàâà
ENDWITH
DODEFAULT()
ENDPROC
PROCEDURE Init
WAIT WINDOW 'Ãîòîâèì äàííûå ê ðàáîòå ...' NOWAIT
DODEFAULT()
LOCAL s
WITH this
.BeginUpdate()
.SingleSel = .F.
.Enabled = .f.
.DefaultItemHeight = 24
.Chart.AllowLinkBars =0
*.Chart.PaneWidth(0) = 180
.Chart.AllowLinkBars= .T.
.Chart.ShowLinks= .T.

.BackColor= RGB(232,233,236)
*.Chart.BackColor = RGB(232,233,236)    &amp;&amp;205,211,216)
.Chart.SelBackColor = RGB(210,210,210)    &amp;&amp;205,211,216)
*!*			.Chart.BackColor = 16777215
*!*			.Chart.SelBackColor = 16119285

.EndUpdate()
.Enabled = .t.
ENDWITH
WAIT CLEAR

** ñîçäàòü áàð÷èêè:
*!*		   - íåãàðàíòèðîâàííîå áðîíèðîâàíèå  -  îæèäàþùàÿ áðîíü  (Task) 28
*!*		   - íåãàðàíòèðîâàííîå áðîíèðîâàíèå (ðàçìåùåííàÿ) (preTask)     29
*!*		   - ãàðàíòèðîâàííîå áðîíèðîâàíèå (ðàçìåùåííàÿ)    (garTask)   30 (èëè 22)
*!*		   - ïðîæèâàíèå  (LiveTask) (äîêóìåíò - ñ÷åò ãîñòÿ)             22

*!*		   - îáñëóæèâàíèå â íîìåðå
*!*		   - äîáàâëåíèå ÷åðåç ðåñóðñ "Ïîèñê ñâîáîäíîãî"
ENDPROC
PROCEDURE loaddata
*!*	thisform.LoadData1()
*!*	RETURN
LOCAL lcUniqueName,lcUniqueFilePath,dStartDate,dEndDate, lnCountRec , Lfirst
LOCAL ARRAY items(1,2)
LOCAL lnDefItem, lnDefParId, lnDefTvrId,lnDefResursId,lnBarId ,lnBarId, stringWk, nRecResursLst, nTvrParId
this.linload=.t.
* Çàãðóæàåì òàáëèöó ñ äàííûìè
lcUniqueName  = spGetProjectList(thisform.nFrmId,0,0)

* Òàáëèöà äëÿ äèàãðàììû
USE IN SELECT('rv_ResursLst')
USE (lcUniqueName) IN 0 ALIAS rv_ResursLst
SELECT rv_ResursLst
CALCULATE MIN(rv_ResursLst.UseStart) TO dStartDate
CALCULATE MAX(rv_ResursLst.UseEnd) TO dEndDate
SELECT rv_ResursLst
*BROWSE
lnCountRec  = RECCOUNT()
GO TOP
*SELECT DISTINCT FrmTypeID,FrmTypeNM,FrmTypeShortNM FROM rv_ResursLst INTO CURSOR tmpFrmType
this.Chart.FirstVisibleDate = dStartDate-1
*SET DATE GERMAN
this.BeginUpdate()
Lfirst = .t.	
SET DATE  YMD
WITH this.Items
STORE -99999 TO lnFrmTypeId ,lnDefParId ,lnDefResursId ,lnBarId
SCAN
		   IF rv_ResursLst.FrmTypeId &lt;&gt; lnFrmTypeId
		   	IF lnFrmTypeId &lt;&gt; -99999
		   	.ExpandItem(lnDefParId) = .T.
		   	ENDIF
		   	lnDefParId  = .AddItem(ALLTRIM(rv_ResursLst.FrmTypeNM))
		   	*this.namebar(3,.F.)
		   	lnFrmTypeId = rv_ResursLst.FrmTypeId
		   	IF lnFrmTypeId &lt;&gt; 8
		   	.AddBar(lnDefParId  , 'Project Summary',TTOD(dStartDate),TTOD(dEndDate))
		   	ENDIF
		   ENDIF
	       IF (lnFrmTypeId = 8 AND Lfirst) OR lnFrmTypeId &lt;&gt; 8
	        .DefaultItem = .InsertItem( lnDefParId , "", ALLTRIM(rv_ResursLst.TvrNm))
	        lnDefItem = .DefaultItem
		       IF lnFrmTypeId = 8
		       		Lfirst = .f.	
		       ENDIF
	       ENDIF
		   REPLACE ItemId WITH .DefaultItem NEXT 1 IN rv_ResursLst
		   .AddBar(.DefaultItem , this.namebar(rv_ResursLst.FrmTypeId,.F.) , rv_ResursLst.UseStart,;
					rv_ResursLst.UseEnd,IIF(lnFrmTypeId &lt;&gt; 8,null,rv_ResursLst.JrnUseId),STR(rv_ResursLst.TvrSumSale)) &amp;&amp;,rv_ResursLst.JrnUseId,STR(rv_ResursLst.TvrSumSale))
	* ïåðåñòàëî ðàáîòàòü 20120502	   .AddBar(.DefaultItem , this.namebar(rv_ResursLst.FrmTypeId,.F.) , TTOC(rv_ResursLst.UseStart),;
					TTOC(rv_ResursLst.UseEnd),IIF(lnFrmTypeId &lt;&gt; 8,null,rv_ResursLst.JrnUseId),STR(rv_ResursLst.TvrSumSale)) &amp;&amp;,rv_ResursLst.JrnUseId,STR(rv_ResursLst.TvrSumSale))
	*	   .AddBar(.DefaultItem , this.namebar(rv_ResursLst.FrmTypeId,.F.) , {01.05.2010 07:00},;
					{01.05.2011 22:00},IIF(lnFrmTypeId &lt;&gt; 8,null,rv_ResursLst.JrnUseId),STR(rv_ResursLst.TvrSumSale)) &amp;&amp;,rv_ResursLst.JrnUseId,STR(rv_ResursLst.TvrSumSale))
					*lnDefItem rv_ResursLst.JrnUseId
		   	IF lnFrmTypeId &lt;&gt; 8
			.DefineSummaryBars(lnDefParId ,"",.DefaultItem,"") &amp;&amp; .DefaultItem
			ENDIF
ENDSCAN
	IF lnFrmTypeId &lt;&gt; -99999
	.ExpandItem(lnDefParId) = .T.
	ENDIF

ENDWITH

RETURN


** Äîáàâëÿåì ðåñóðñû
SELECT rv_ResursLst
STORE -99999 TO lnDefTvrId ,lnDefParId ,lnDefResursId ,lnBarId
SCAN
	IF rv_ResursLst.Loaded = 0
REPLACE Loaded WITH 1 NEXT 1 IN rv_ResursLst
nRecResursLst = RECNO('rv_ResursLst')
nTvrParId = rv_ResursLst.TvrParId
GO TOP
LOCATE ALL FOR rv_ResursLst.TvrId = nTvrParId AND rv_ResursLst.BarId&lt;&gt;0
IF FOUND()
	   lnDefItem = rv_ResursLst.BarId
	   lnDefParId = NVL(rv_ResursLst.TvrParId,0)
	   GO nRecResursLst
ELSE
		GO nRecResursLst
	    IF !lnDefParId = NVL(rv_ResursLst.TvrParId,0)
		   .DefaultItem = .AddItem(ALLTRIM(rv_ResursLst.ParNM))
		   lnDefItem = .DefaultItem
		   lnDefParId = NVL(rv_ResursLst.TvrParId,0)
		ENDIF
	ENDIF
.DefaultItem = .InsertItem( lnDefItem , "" , "")  &amp;&amp;lText)
	* îòìå÷àåì íîìåðà, êîòîðûå íàäî ÷èñòèòü
IF thisForm.nTimeClearNum &gt;0
			IF rv_ResursLst.clearnum=1
				.CellValueFormat(.DefaultItem,0) = 1
			ENDIF
			.CellValue(.DefaultItem,0) = ALLTRIM(rv_ResursLst.TvrNm)+ IIF(rv_ResursLst.clearnum=1,' &lt;b&gt;&lt;fgcolor=FF0000&gt;&lt;bgcolor=00FF00&gt; óá &lt;/bgcolor&gt;&lt;/fgcolor&gt;&lt;/b&gt;','')
		ELSE
			.CellValue(.DefaultItem,0) = ALLTRIM(rv_ResursLst.TvrNm)
	ENDIF
.CellValue(.DefaultItem , 1) = ALLTRIM(rv_ResursLst.TvrNote)
lnBarId = .DefaultItem
	SELECT rv_ResursLst
	GO nRecResursLst
	REPLACE ItemId WITH lnDefItem ,BarId WITH lnBarId
	ENDIF
ENDSCAN
SELECT rv_ResursJrn
STORE -99999 TO lnDefTvrId ,lnDefParId ,lnDefResursId ,lnBarId

** Äîáàâëÿåì çàíÿòîñòü ðåñóðñà
SCAN
	SELECT rv_ResursLst
	LOCATE ALL FOR rv_ResursLst.TvrId = rv_ResursJrn.ResursID
	IF !FOUND()
	 SELECT rv_ResursJrn
LOOP
	ENDIF
SELECT rv_ResursJrn
	lnDefItem = rv_ResursLst.BarId  &amp;&amp; ñèñòåìíûé êîä ðåñóðñà
	lnBarId = rv_ResursJrn.JrnUseId
.AddBar(lnDefItem , this.namebar(rv_ResursJrn.FrmStatusI,rv_ResursJrn.FrmIsPayed) , TTOC(rv_ResursJrn.UseStart),;
					TTOC(rv_ResursJrn.UseEnd),rv_ResursJrn.JrnUseId, ;
					IIF(thisform.lOnlyTime = .f.,ALLTRIM(rv_ResursJrn.CltNM),'-'))
					
					
	** âàðèàíò ñ óêàçàíèåì âðåìåíè çàñåëåíèÿ-âûñåëåíèÿ " ñ:"+ SUBSTR(NVL(TTOC(rv_ResursJrn.UseStart),""),12)+ ;
																		 "... äî:"+ SUBSTR(NVL(TTOC(rv_ResursJrn.UseEnd),""),12)
**  1                                   2                                                  3                             4                     5                          6                          7                            8
	.DefaultItem = lnDefItem
stringWk = "Items.ItemBar("+ ALLTRIM(STR(lnDefItem ,10,0))+" , "+ ALLTRIM(STR(rv_ResursJrn.JrnUseId,10,0))+" , 12) =" + ALLTRIM(STR(this.prcworkdate(TTOD(rv_ResursJrn.UseStart),TTOD(rv_ResursJrn.UseEnd)),5,2))   &amp;&amp; exBarPercent
this.executeTemplate(stringWk)
*** Îïðåäåëÿåì ToolTip íà êàæäûé áàð
stringWk = "Items.ItemBar(0 , "+ ALLTRIM(STR(rv_ResursJrn.JrnUseId,10,0))+" , 6) = `" +  "Ñ÷åò ¹"+NVL(ALLTRIM(rv_ResursJrn.FrmNum),"á/í")+" îò "+ ;
																				 SUBSTR(TTOC(rv_ResursJrn.FrmDate),1,16)+ ;
																				 " Çàñåëåíèå:"+ NVL(TTOC(rv_ResursJrn.UseStart),"")+ ;
																				 "      Âûåçä:        "+ NVL(TTOC(rv_ResursJrn.UseEnd),"")+"`"    &amp;&amp; exBarToolTip
IF !ISNULL(stringWk)
	    ThisForm.G2ANTT1.ExecuteTemplate(stringWk)
ENDIF

	IF rv_ResursJrn.FrmIsPayed
			stringWk = "Items.ItemBar("+ ALLTRIM(STR(lnDefItem ,10,0))+" , "+ ALLTRIM(STR(rv_ResursJrn.JrnUseId,10,0))+" , 12) = `1`" &amp;&amp; exBarPercent
	    ELSE
			stringWk = "Items.ItemBar("+ ALLTRIM(STR(lnDefItem ,10,0))+" , "+ ALLTRIM(STR(rv_ResursJrn.JrnUseId,10,0))+" , 12) = `0`" &amp;&amp; exBarPercent
	ENDIF
ThisForm.G2ANTT1.ExecuteTemplate(stringWk)
*!*		IF rv_ResursJrn.FrmIsPayed
*!*				stringWk = "Items.ItemBar("+ ALLTRIM(STR(lnDefItem ,10,0))+" , "+ ALLTRIM(STR(rv_ResursJrn.JrnUseId,10,0))+" , 10) = `.f.`" &amp;&amp; íåëüçÿ äâèãàòü
*!*			    ThisForm.G2ANTT1.ExecuteTemplate(stringWk)
*!*				stringWk = "Items.ItemBar("+ ALLTRIM(STR(lnDefItem ,10,0))+" , "+ ALLTRIM(STR(rv_ResursJrn.JrnUseId,10,0))+" , 11) = `.f.`" &amp;&amp; íåëüçÿ ìåíÿòü
*!*			    ThisForm.G2ANTT1.ExecuteTemplate(stringWk)
*!*			   ELSE
*!*				stringWk = "Items.ItemBar("+ ALLTRIM(STR(lnDefItem ,10,0))+" , "+ ALLTRIM(STR(rv_ResursJrn.JrnUseId,10,0))+" , 22) = `"+TTOC(thisform.tOgrDate)+"`" &amp;&amp; íåëüçÿ ìåíÿòü
*!*			    ThisForm.G2ANTT1.ExecuteTemplate(stringWk)
*!*		ENDIF
	SELECT rv_ResursJrn
	REPLACE ItemId WITH lnDefItem ,BarId WITH lnBarId
ENDSCAN
*endwith
for each h in this.Items
	this.Items.DefaultItem = h
	this.Items.ExpandItem(0) = thisform.g2ANTT1.lExpandResu
next
this.EndUpdate()	
this.linload=.f.



ENDPROC
PROCEDURE MouseDown
*** ActiveX Control Event ***
LPARAMETERS button, shift, x, y

With this
	local h, c, hit, llResult
.lnitemidu = .ItemFromPoint(-1, -1, c, hit)
If (.lnitemidu # 0)
.lnbaridu = .Chart.BarFromPoint(-1, -1)
If Empty(NVL(.lnbaridu,0))
RETURN .f.
EndIf
EndIf
ENDWITH


DODEFAULT(button, shift, x, y)

ENDPROC
PROCEDURE MouseUp
*** ActiveX Control Event ***
LPARAMETERS button, shift, x, y
RETURN
With this
	local h, c, hit, llResult ,nDefCltTmp
.lnitemid = .ItemFromPoint(-1, -1, c, hit)
If (.lnitemid # 0)
.lnbarid = .Chart.BarFromPoint(-1, -1)
*** thisform.wkStile.optCopy.Value=1 AND
		IF ISNULL(.lnbarid) AND !ISNULL(.lnbaridu) ;
			AND (.lnitemid&lt;&gt;.lnitemidu) ;
			AND MESSAGEBOX('Ñêîïèðîâàòü áðîíü?',4+0+32,'Êîïîâàíèå äîêóìåíòîâ') = 6
		     SELECT rv_ResursJrn
		     LOCATE FOR rv_ResursJrn.BarId = .lnbaridu
		     IF !FOUND()
		     	RETURN .f.
		     ENDIF
		     lStart = NVL(rv_ResursJrn.UseStart ,{})
		     lEnd   = NVL(rv_ResursJrn.UseEnd,{})
		    .lCopy=.t.
		    nDefCltTmo = thisform.nDefClt
		    thisform.nDefClt = rv_ResursJrn.PointIspCl
			.createBar(.lnitemid,lStart ,lEnd   )
		    thisform.nDefClt = nDefCltTmo
			.lCopy=.f.
		ENDIF
If Empty(NVL(.lnbarid,0))
RETURN .f.
EndIf
EndIf
ENDWITH


DODEFAULT(button, shift, x, y)

ENDPROC
PROCEDURE namebar
LPARAMETERS lnFrmTypeId,llFrmIsPayed
** StartDate, EndDate, ControlDate
cntPar =  PCOUNT()
IF cntPar &lt;2
llFrmIsPayed = .f.
ENDIF
LOCAL lcNameBar
	DO CASE
	   CASE lnFrmTypeId = 3	&amp;&amp; - ìàòåðèàëû
	       lcNameBar = 'Task'
	   CASE lnFrmTypeId = 15	&amp;&amp; - ðàáîòû
	       lcNameBar = 'preTask'
	   CASE lnFrmTypeId = 8	&amp;&amp; - äåíüãè
	       lcNameBar = 'garTask'
	       llFrmIsPayed = .t.

	   OTHERWISE
	       lcNameBar = 'Task'
*	       lcNameBar = 'LiveTask'
	         ** 'PRed'   &amp;&amp;
ENDCASE
*IF llFrmIsPayed
lcNameBar= lcNameBar + '%PRed'	&amp;&amp; - ïðîèçâåäåíà îïëàòà
*ENDIF
RETURN lcNameBar
ENDPROC
PROCEDURE OverviewZoom
*** ActiveX Control Event ***
DODEFAULT()
RETURN
SELECT rv_ResursJrn
LOCATE ALL FOR rv_ResursJrn.JrnUseId = this.lnbarid
this.beginUpdate()
WITH This.Chart



	IF FOUND() AND !EMPTY(rv_ResursJrn.UseStart)
		.FirstVisibleDate = rv_ResursJrn.UseStart-60*60
		ELSE
		.FirstVisibleDate = DATE()-2
	ENDIF
*WAIT WINDOW this.Chart.UnitScale
**** 256 - íåäåëè, 4096 - äíè, 65536 - ÷àñû

DO CASE
	CASE .UnitScale = 256  &amp;&amp; exWeek
	    .Zoom(.NextDate(.FirstVisibleDate,4096,-5), .NextDate(.FirstVisibleDate, 4096,25), .t.) &amp;&amp; exWeek
	CASE .UnitScale = 4096  &amp;&amp; exDay
	    .Zoom(.NextDate(.FirstVisibleDate,4096,-2), .NextDate(.FirstVisibleDate, 4096,20), .t.) &amp;&amp; exWeek
	CASE .UnitScale = 65536  &amp;&amp; exHour
	.Zoom(.NextDate(.FirstVisibleDate,65536,-3), .NextDate(.FirstVisibleDate, 65536,12), .t.) &amp;&amp; exWeek
	OTHERWISE
	.Zoom(.NextDate(.FirstVisibleDate,4096,-2), .NextDate(.FirstVisibleDate, 4096,7), .t.) &amp;&amp; exWeek
ENDCASE
	.UnitWidth = .PaneWidth(1)/ this.nCountUnits  &amp;&amp;55 &amp;&amp;70
ENDWITH
DODEFAULT()
this.EndUpdate()
RETURN


ENDPROC
PROCEDURE timescale
DODEFAULT()
LOCAL s
WITH this
.BeginUpdate
.SingleSel = .F.
s = "gBJJgBAIDAAGAAEAAQhYAf8Pf4hh0QihCJo2AEZjQAjEZFEaIEaEEaAIAkcbk0olUrlktl0vmExmUzmk1m03nE5nU7nk9n0/oFBoVDolFo1HpFJpVLplNp1PqFRqVTq"
s=s+"lVq1XrFZrVbrldr1fsFhsVjslls1ntFptVrtltt1vuFxuVzul1u13vF5vV7vl9v1BAmBhOCwMKwuDw2ExWJxmIx2HyGLx+SyONyuTy2UzWZzmYz2X0Gbx1kUigUAAMwzG"
s=s+"eo1Ws1ZV2Go1IAL+1ACZMxm2+52W63Ov2Op1fC13F0un4nJ1vE2BV2XD2e/4vK4fL63V1bMTKZ5/d2pf3vh6Xj2ff3e63G683S5vF0mmAD4+Xx+bA+wAeP5/H6a/9+h8P2"
s=s+"eIAGZAiHHYZkDQQ7TuH/Ap4GUUzjPgiCJn+AD7GBAMNQJBD8wFDwAFlEUExJBaHQdCDixM+UARYABuxg/8ZQ5DUQRpEEbQKf8DxPBDiPe08KRdDEZHVIwANU1YRSWAALSdJ"
s=s+"snxpHcFO3HsrOI48Ky1IkKQpERZAA9sjHVC77ynEsqwbBE1RVNKHgAQ04yQ1skvDOJDRkZc9ABJYRT5Jk+z/P0pR49sgQHAsaUVApx0aAD+mvOclSZIkYG7MsMxNTUqyw+F"
s=s+"FwVRNQwRSwACFUwADvVNHv9IlNu5V02u5UjzVMIUQxHMYABzXdUVVRpxgBXM60DX9MQHTjWrJE0uzfGkXRdXNa0FYMjxBM8vxJM7iWXN8KSlbs31zWlT1Ja0eWxM9tNbbkL"
s=s+"UhY1mQtaU62hI9hyZUl0x5H6x3ZLVvwtekyWlYlHXNBF0R5dTszdC1vR1cELVJO9JABLODVvMF8x9deGS1fE3yJXYc4pgOKUDfGE31ZN+Srd13U/VdI1y9uCWBPRl2NE1sW"
s=s+"xbeWv9l2f6DSNSXdkTaNtd1WyrncR567mgaHGJLanMLY2laVc2FOjW1JpTuX2sV0YhmMtQpXLct1msZRBLmU421exYbN93XgAFixA9s61ztkzbc4u47LHmb6O8ExSPs0j6N"
s=s+"Otyv1hSy8BCm6bHs7eUDXMXb5DOLuJyG5v9CjzWLCkszrqZLS2+/NtbwEQdFN9sPbLPEYFU/Fxj1TV2U7WyahslSdM8O9SPGkieK+8iW33fe1JXNUjvqrnWlo1A2lUnieO+"
s=s+"/k1lGMs7RjDwvNiciedUtT6Nd3B+RlaxQJBmx8luULWLLPqxjZ769S/UQe1svPUi6M+D5DzN5a2athyHX9H6f43VIjE3yMTbqrlbB5l3OYgU+ssL7X+rtc+2Nj7AD5vwRkk"
s=s+"SCyAoFvvg6/FaiZIIuHbGv9DRxEuQeRjC2FkKH/pvRcs4+b+4MFgH+mmISDIhrHN0dqI5uIjRLGYbOJp2YnRRihAaIsQYiRXIdFVKsSImRKiegOKUYIpxZiwg2MsWokxpjF"
s=s+"Gs7UY4vxvNmWSKwAEHoRjrHRFMZkToMd3HqOcf4lRBN1IKLMg4vGzjnHeRUeY+yNj5GeIkhpJSFkpF+RKKZFoRj9I6PcZJKSElBIGUUR44ljkBJCT0gI1RclZIeN0YZLRal"
s=s+"RKqLsq5XRslhIiWUqY0S1l9HCV8YyyEWB8SuYpHiQEiJIAAkpKJmk4QoX8pJFE3zSKCQEA="
.Images(s)
s="gBJJgBAICAAGAAEAAQhYAf8Pf4hh0QihCJo2AEZjQAjEZFEaIEaEEaAIAkcbk0olUrlktl0vmExmUzmk1m03nE5nU7nk9n0/oFBoVDolFo1HpFJpVLplNp1PqFRqVTqlVq1XrF"
s=s+"ZrVbrldr1fsFhsVjslls1ntFptVrtltt1vuFxuVzul1u13vF5vV7vl9v1/wGBwWDwmFw2HxGJxWLxmNx2PyGRyWTymVy2XzGZzWbzmdz2f0Gh0WjwEWH0r08ekEikgAkso184iG"
s=s+"kicPjcU2+zjW43e6jO8jL+b79X8bfif48bfAffgP43IT8b4XE3O23vW3++2r/6vcjUB"
.Images(s)

**'Uncomment it if you are running Windows XP
** .BackColorHeader = 33554432
WITH .Chart
.LevelCount = 2
** Çäåñü ìû îòêðûâàåì èëè çàêðûâàåì èêîíêè Zoom
		.Label(0) = ""  &amp;&amp; exYear
		.Label(1) = ""  &amp;&amp; exHalfYear
		.Label(2) = ""  &amp;&amp; exQuarterYear
*		.Label(16) = ""  &amp;&amp; exMonth
		.Label(17) = ""  &amp;&amp; exThirdMonth
*		.Label(256) = ""  &amp;&amp; exWeek
*		.Label(4096  ) = ""  &amp;&amp; exDay
		.Label(65536  ) = ""  &amp;&amp; exHour
		.Label(1048576) = ""  &amp;&amp; exMinute
		.Label(16777216) = ""  &amp;&amp; exSecond
		.Level(1).DrawGridLines = .t.
*	.OverviewZoomCaption =    "Year|1\2Year|1\4Year|&lt;img&gt;11&lt;/img&gt;|Third|&lt;img&gt;11&lt;/img&gt;|&lt;img&gt;10&lt;/img&gt;|&lt;img&gt;9&lt;/img&gt;|Min|Sec"
*	.OverviewZoomCaption =    "Ãîä|Ïîëóãîäèå|Êâàðòàë|Ìåñÿö|Äåñÿòêà|Íåäåëÿ|Äåíü|×àñ|Ìèí|Ñåê"
	.OverviewZoomCaption =    "Year|1\2Year|1\4Year|&lt;img&gt;11&lt;/img&gt;||&lt;img&gt;10&lt;/img&gt;|&lt;img&gt;9&lt;/img&gt;||Min|Sec"
	.LabelToolTip(4096) = "&lt;%dd%&gt; &lt;%m3%&gt;"
	.LabelToolTip(65536) = "&lt;%hh%&gt;:&lt;%nn%&gt; &lt;%dd%&gt; &lt;%m3%&gt;"
	.UnitWidth = .PaneWidth(1)/this.nCountUnits &amp;&amp;55 &amp;&amp;70
	
	.NonworkingHours = 16253183 - 524288 - 1048576 -2097152 + 256


	*.NonworkingDays = 0
	.NonworkingHoursColor = RGB(197,96,90)
	*.ShowNonworkingUnits = .F.
*.DrawDateTicker = .t.
ENDWITH
.EndUpdate
ENDWITH


ENDPROC
</methods>
		<objcode/>
		<ole>0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7////+////BQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAP7//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALBfvIFgKM0BAwAAAMAAAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAghQAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBAAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAQAAAAAAAAAAgAAAP7////+//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9BAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACQAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADUxMzk3OTE1AQAAgAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAABDAGwAYQBzADEfSM0lLVlHgD91LFaPU7dJTAEBAAAEAAQAEAAQAP////8hAP//////////Qk02AAAAAAAAADYAAAAoAAAAQABNH0jNJS1ZR4A/dSxWj1O3SUwBAQAABAAEABAAEAD/////IQD//////////0JNNgAAAAAAAAA2AAAAKAAAAEAAAAAQAAAAAQAgAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAGUAbAAgAEMAbABhAHMAcwAJAHsANgA1AEQANQA0ADAAQwAxAC0AOAA1ADkARQAtADQAOQBGADUALQBCADMANQBCAC0ANwAwADgAMgAxADgAMwAxAEYANwBBADcAfQAgAEMAOgBcAFcASQBOAEQATwBXAFMAXABzAHkAcwB0AGUAbQAzADIAXABiAHQAeABwAHAAYQBuAGUAbAAuAGQAbABsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE0fSM0lLVlHgD91LFaPU7dJTAEBAAAEAAQAEAAQAP////8hAP//////////Qk02AAAAAAAAADYAAAAoAAAAQAAAABAAAAABACAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEJNPgAAAAAAAAA+AAAAKAAAAEAAAAAQAAAAAQABAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAn28AAAM+AAAJAANS4wuRj84RneMAqgBLuFEBzAAAvALcfAEABUFyaWFsCwD//wsA//8DAAAAAAATAOvr6wATAAgAAIATAAUAAIATAAgAAIALAP//AwAAAAAAAwADAAAAAwASAAAAAwD/////AwAAAAAACwD//wsA//8DAAAAAAALAAAAAwD/////AwD/////AwAAAAAAAwD/////AwAWAAAAAwAAAAAACwAAAAMAAAAAAAsA//8TAA4AAIATAA0AAIADAAAAAAADAAIAAAALAAAACwAAAAsA//8JAAAAAAAAAAAAAAAAAAAAAAADADAAAAADAAAAAAATADFl/wATAA8AAIATAAgAAIADAP////8TAA8AAIATAAgAAIAJAANS4wuRj84RneMAqgBLuFEBzAAAvAJEQgEABUFyaWFsEwAAAAAACwAAAAgABgAAAA0ACgAAAAsA//8DABIAAAALAP//CABkAAAAYQBiAGMAZABlAGYAZwBoAGkAagBrAGwAbQBuAG8AcABxAHIAcwB0AHUAdgB3AHgAeQB6AEwEOQQyBDQEMAQ1BDcEOgQ7BDgEPwQ+BDwERARGBEIESwRJBDEEPQRDBEoEQQQAAAgAZAAAAEEAQgBDAEQARQBGAEcASABJAEoASwBMAE0ATgBPAFAAUQBSAFMAVABVAFYAVwBYAFkAWgAsBBkEEgQUBBAEFQQXBBoEGwQYBB8EHgQcBCQEJgQiBCsEKQQRBB0EIwQqBCEEAAALAP//CAACAAAAAAADAPQBAAADAIgTAAADAMQAAAADAAMAAAATABAAAIALAAAABQAAAAAAAADgPwsAAAALAP//EwAPAACACQAAAAAAAAAAAAAAAAAAAAAAAwAwAAAACwD//wMAAAAAAAsAAAAIAAIAAAAAABMAEAAAgBMAEAAAgBMADwAAgAMAEgAAAAMAoP///wsA//8DAAAAAAALAAAAAwAozpd8AwAAAAAACwD//wsAAAALAAAAEwAxZf8AAwAAAAAACwAAAAMAAAAAAAgAAgAAAAAAAwD/////AwD/////AwD/////AwD/////CwAAAAkAA1LjC5GPzhGd4wCqAEu4UQEAAACQAZBfAQAFQXJpYWwLAP//AwD///8AAwAAAAAACwD//w==</ole>
		<ole2>OLEObject = C:\Windows\SysWOW64\ExG2antt.dll
</ole2>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1026001568</timestamp>
		<class>commandbutton</class>
		<classloc/>
		<baseclass>commandbutton</baseclass>
		<objname>cmdReload</objname>
		<parent>frmresuprom</parent>
		<properties>Top = 603
Left = 250
Height = 25
Width = 100
Caption = "Îáíîâèò äàííûå"
ZOrderSet = 4
Name = "cmdReload"
</properties>
		<protected/>
		<methods>PROCEDURE Click
thisform.lOnlyTime = .f.
IF MESSAGEBOX('Ïîêàçûâàòü òîëüêî âðåìÿ çàñåëåíèÿ áåç èìåí ãîñòåé?',4+64,'Âûáåðèòå, ÷òî ïîêàçûâàòü î çàñåëåíèè')=6
	thisform.lOnlyTime = .t.
ENDIF
with thisform.G2antt1
	.BeginUpdate
	.Items.RemoveAllItems()
	.LoadData()
	with .Items
	for each h in thisform.G2antt1.Items
		.DefaultItem = h
		.ExpandItem(0) = thisform.g2ANTT1.lExpandResu
	next
	endwith
	.EndUpdate
endwith

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25L0SGZE5</uniqueid>
		<timestamp>1026001568</timestamp>
		<class>commandbutton</class>
		<classloc/>
		<baseclass>commandbutton</baseclass>
		<objname>cmdToday</objname>
		<parent>frmresuprom</parent>
		<properties>Top = 603
Left = 352
Height = 25
Width = 78
FontBold = .T.
FontSize = 10
Caption = "Ñåãîäíÿ"
ZOrderSet = 5
Name = "cmdToday"
</properties>
		<protected/>
		<methods>PROCEDURE Click
with thisform.G2antt1
	.BeginUpdate
WITH .Chart
		IF .UnitScale =&lt; 4096
				.FirstVisibleDate = DATE()-2
			ELSE
				.FirstVisibleDate = DATETIME()-4*60*60
		ENDIF
ENDWITH
	.EndUpdate
endwith

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1084396758</timestamp>
		<class>shape</class>
		<classloc/>
		<baseclass>shape</baseclass>
		<objname>Shape1</objname>
		<parent>frmresuprom</parent>
		<properties>Top = 601
Left = 433
Height = 13
Width = 85
BackColor = 138,244,244
ZOrderSet = 6
Name = "Shape1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1084396758</timestamp>
		<class>shape</class>
		<classloc/>
		<baseclass>shape</baseclass>
		<objname>Shape2</objname>
		<parent>frmresuprom</parent>
		<properties>Top = 619
Left = 433
Height = 13
Width = 85
BackColor = 0,128,192
ZOrderSet = 7
Name = "Shape2"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0OUJQ9</uniqueid>
		<timestamp>1084396758</timestamp>
		<class>shape</class>
		<classloc/>
		<baseclass>shape</baseclass>
		<objname>Shape4</objname>
		<parent>frmresuprom</parent>
		<properties>Top = 601
Left = 791
Height = 13
Width = 85
BackColor = 255,255,0
ZOrderSet = 8
Name = "Shape4"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25X0QUXS4</uniqueid>
		<timestamp>1084396758</timestamp>
		<class>label</class>
		<classloc/>
		<baseclass>label</baseclass>
		<objname>Label2</objname>
		<parent>frmresuprom</parent>
		<properties>AutoSize = .T.
FontSize = 8
Caption = "- èòîãè"
Height = 16
Left = 522
Top = 601
Width = 37
ZOrderSet = 9
Name = "Label2"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25X0QUXS5</uniqueid>
		<timestamp>1084396758</timestamp>
		<class>label</class>
		<classloc/>
		<baseclass>label</baseclass>
		<objname>Label3</objname>
		<parent>frmresuprom</parent>
		<properties>AutoSize = .T.
FontSize = 8
Caption = "- ðàáîòû è ìàòåðèàëû"
Height = 16
Left = 522
Top = 618
Width = 117
ZOrderSet = 10
Name = "Label3"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1084396758</timestamp>
		<class>label</class>
		<classloc/>
		<baseclass>label</baseclass>
		<objname>Label4</objname>
		<parent>frmresuprom</parent>
		<properties>AutoSize = .T.
FontSize = 8
Caption = "- äåíåæíûå ñðåäñòâà"
Height = 16
Left = 880
Top = 601
Width = 113
ZOrderSet = 11
Name = "Label4"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2DL11LO1J</uniqueid>
		<timestamp>1084396758</timestamp>
		<class>label</class>
		<classloc/>
		<baseclass>label</baseclass>
		<objname>Label1</objname>
		<parent>frmresuprom</parent>
		<properties>AutoSize = .T.
FontSize = 8
Caption = "- îïëàòà ïðèíÿòà"
Height = 16
Left = 880
Top = 618
Width = 90
ZOrderSet = 12
Name = "Label1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2LT0Y9P5S</uniqueid>
		<timestamp>1084396758</timestamp>
		<class>olecontrol</class>
		<classloc/>
		<baseclass>olecontrol</baseclass>
		<objname>PrintGantt</objname>
		<parent>frmresuprom</parent>
		<properties>Top = 600
Left = 1044
Height = 13
Width = 25
ZOrderSet = 13
Name = "PrintGantt"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole>0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7////+/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFDmvYFgKM0BAwAAAMABAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAA4AAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAGIAAAAAAAAAAwAAAP7///8GAAAABAAAAAUAAAD+/////v////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8rDetNvW4iSpg1SKuc3ICIAAgAALkDAAC5AwAACAAeAAAAHQQ+BDwENQRABD0EPgQ5BCAARAQ+BD0ENAQgAAAAOAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAIAIAAAAQ2FwdGlvbgAXAAAASAAAAAAOAAAAze7s5fDt7ukg9O7t5CAQAAAAUGFnZU9yaWVudGF0aW9uAAkLAP//AwABAAAAAwACAAAAAwAAAAAAAwABAAAAAwACAAAACQADUuMLkY/OEZ3jAKoAS7hRAQEAAJABoIYBAA9UaW1lcyBOZXcgUm9tYW4LAP//CABIAAAALQAxACwAMQAwADAALAAxADAAMQAsADEAMAAyACwALQAxACwAMQAwADMALAAtADEALAAxADAANAAsAC0AMQAsADEAMAA1AAAACAACAAAAAAAIABIAAAA8ACUAcABhAGcAZQAlAD4AAAAAAABJCgAAAAIAAAAJAAAAQXNTY3JlZW4ABQAAAEwBAAAAcgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwABAAAACwD//wMAAAAAABMAAAAAABQA/////wEAEABgYRcAH8wCAAAAAADAAAAAAAAARi0ANQAGAEgAAAEMAA==</ole>
		<ole2>OLEObject = C:\Windows\SysWOW64\ExPrint.dll
</ole2>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2LT0Y9P5W</uniqueid>
		<timestamp>1061976837</timestamp>
		<class>commandbutton</class>
		<classloc/>
		<baseclass>commandbutton</baseclass>
		<objname>Command1</objname>
		<parent>frmresuprom</parent>
		<properties>Top = 603
Left = 3
Height = 25
Width = 73
Caption = "Íà ïå÷àòü"
ZOrderSet = 14
Name = "Command1"
</properties>
		<protected/>
		<methods>PROCEDURE Click
with thisform.PrintGantt
	** thisform.g2ANTT1.Chart.EndPrintDate
	thisform.g2ANTT1.Chart.StartPrintDate = thisform.g2ANTT1.Chart.FirstVisibleDate
	thisform.g2ANTT1.Chart.EndPrintDate   = thisform.g2ANTT1.Chart.FirstVisibleDate + 100*24*60*60

	**thisform.g2ANTT1.Chart.FirstVisibleDate
	.Caption = 'Ðàáîòû è îïëàòû ïî ñîñòîÿíèþ íà '+ TTOC(DATETIME())+ '. C '+TTOC(thisform.g2ANTT1.Chart.StartPrintDate)+' ïî '+TTOC(thisform.g2ANTT1.Chart.EndPrintDate)
	.PrintExt = thisform.G2antt1.Object
	.Preview
	thisform.g2ANTT1.Copy()
endwith
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2MN0O16AU</uniqueid>
		<timestamp>1084396758</timestamp>
		<class>shape</class>
		<classloc/>
		<baseclass>shape</baseclass>
		<objname>Shape6</objname>
		<parent>frmresuprom</parent>
		<properties>Top = 619
Left = 794
Height = 13
Width = 42
BackColor = 0,128,192
ZOrderSet = 15
Name = "Shape6"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2MN0O16AV</uniqueid>
		<timestamp>1084396758</timestamp>
		<class>shape</class>
		<classloc/>
		<baseclass>shape</baseclass>
		<objname>Shape7</objname>
		<parent>frmresuprom</parent>
		<properties>Top = 619
Left = 830
Height = 13
Width = 43
BackColor = 255,255,0
ZOrderSet = 16
Name = "Shape7"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2DL11LO1L</uniqueid>
		<timestamp>1084396758</timestamp>
		<class>shape</class>
		<classloc/>
		<baseclass>shape</baseclass>
		<objname>Shape3</objname>
		<parent>frmresuprom</parent>
		<properties>Top = 624
Left = 791
Height = 3
Width = 85
BorderStyle = 0
BackColor = 255,0,0
ZOrderSet = 17
Name = "Shape3"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>frmresuprom</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
Arial, 1, 10, 6, 16, 13, 34, 3, 0
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25I136UUP</uniqueid>
		<timestamp>1084396835</timestamp>
		<class>frmview</class>
		<classloc>baseform_v1.vcx</classloc>
		<baseclass>form</baseclass>
		<objname>frmresfin</objname>
		<parent/>
		<properties>Top = 0
Left = 0
Height = 634
Width = 1082
DoCreate = .T.
Caption = "Ôèíàíñîâûé ïëàí-ãðàôèê âûïîëíåíèÿ äîãîâîðà"
HalfHeightCaption = .T.
WindowState = 2
resuparent = 0
ndefclt = 0
ntimeclearnum = 0
nwkdays = 0
nfrmid = 0
czoom = dd
_memberdata =      601&lt;VFPData&gt;&lt;memberdata name="ndefclt" type="property" display="nDefClt"/&gt;&lt;memberdata name="lonlytime" type="property" display="lOnlyTime"/&gt;&lt;memberdata name="ntimeclearnum" type="property" display="nTimeClearNum"/&gt;&lt;memberdata name="nwkdays" type="property" display="nWkdays"/&gt;&lt;memberdata name="nfrmid" type="property" display="nFrmId"/&gt;&lt;memberdata name="loaddata1" type="method" display="LoadData1"/&gt;&lt;memberdata name="czoom" type="property" display="cZoom"/&gt;&lt;memberdata name="reloader" type="method" display="ReLoader"/&gt;&lt;memberdata name="initrecordset" type="method" display="InitRecordSet"/&gt;&lt;/VFPData&gt;

nscrfrmid = 0
Name = "frmresfin"
cstmsghandler.Name = "cstmsghandler"
cstresizable.Name = "cstresizable"
Img1.ZOrderSet = 2
Img1.Name = "Img1"
</properties>
		<protected/>
		<methods>PROCEDURE Activate
DODEFAULT()
_VFP.AutoYield = .f.
ENDPROC
PROCEDURE Deactivate
DODEFAULT()
_VFP.AutoYield = .t.
ENDPROC
PROCEDURE Destroy
DODEFAULT()
_VFP.AutoYield = .t.
pnScrFrmID = null
RELEASE pnScrFrmID
ERASE TMP\listadd.dbf

ENDPROC
PROCEDURE Init
LPARAMETERS	nFrmId
IF PCOUNT()&lt;1
	nFrmId = -1
ENDIF

*05.05.2004 01:57 -&gt;Ìîäèôèöèðóåì èìÿ ôîðìû ñ ó÷åòîì åå èäåíòèôèêàòîðà
This.Name = This.Name + [_GANT] &amp;&amp; + ALLTRIM(STR(tnScrFrmID))
*------------------------------------------------------------------------------

*04.05.2004 23:30 -&gt;Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------

WITH This
*04.05.2004 23:16 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
PRIVATE	_PARAM	
*------------------------------------------------------------------------------
.nFrmId = nFrmId
*.nFrmId = 67573
*04.05.2004 23:13 -&gt;Ñîõðàíèì èäåíòèôèêàòîð ôîðìû â ñâîéñòâå ôîðìû

*******************************************************************************
*Ïîëó÷èì èíôîðìàöèþ î äîêóìåíòàõ, îòîáðàæàåìûõ íà äàííîé ôîðìå.
*******************************************************************************


.g2ANTT1.nTypeTime = VAL(oRes.GetParam([SET],[TYPETIME],0))

.g2ANTT1.lExpandResu = (VAL(oRes.GetParam([SET],[EXPANDRESU],1))=1)
*.InitRecordSet()
.g2ANTT1.loaddata()
ENDWITH

************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE initrecordset

* Required to let eXG2antt fires its events

Application.AutoYield = .f.

With thisform.G2antt1.Object

.BeginUpdate

			thisform.G2antt1.ColumnAutoResize = .F.
			thisform.G2antt1.ContinueColumnScroll = .F.
			rs = CreateObject("ADOR.Recordset")
			with rs
				var_s = [Provider=SQLNCLI10.1;Integrated Security=SSPI;Persist Security Info=False;User ID="";Initial Catalog=basis_buh2;Data Source=iruboss;Initial File Name="";Server SPN=""]
				z = .Open("tsk_tmp",var_s,3,3)
			endwith
			thisform.G2antt1.DataSource = rs

	with .Columns
		.Item("Start").LevelKey = "L1"
		.Item("End").LevelKey = "L1"
	endwith

With .Chart
*   .PaneWidth(0) = thisform.Width / 2
.OverviewVisible = .t.
.FirstVisibleDate = "4/28/2006"
EndWith

.EndUpdate
EndWith
ENDPROC
PROCEDURE loaddata1
with thisform.G2antt1
	.BeginUpdate
	.MarkSearchColumn = .F.
	.ShowFocusRect = .F.
	.Columns.Add("Tasks")
	with .Columns.Add("C")
		.HeaderAlignment = 1
		.Def(0) = .T.
		.PartialCheck = .T.
		.AllowSizing = .F.
		.Width = 18
	endwith
	with .Chart
		.PaneWidth(0) = 96
		.AllowCreateBar = 1
		.FirstVisibleDate = {^2005-6-20}
		.DrawLevelSeparator = .F.
		.LevelCount = 3
		.Level(1).DrawGridLines = .F.
		.AllowInsideZoom = .T.
		.DrawDateTicker = .T.
		.DateTickerLabel = "&lt;%mmm%&gt; &lt;%d%&gt;&lt;br&gt;&lt;b&gt;&lt;%hh%&gt;:&lt;%nn%&gt;&lt;/b&gt;"
		.MarkSelectDateColor = 0x7ffff8ee
		with .DefaultInsideZoomFormat
			.OwnerLabel = "&lt;%mmm%&gt; &lt;%d%&gt;"
			.BackColor = RGB(238,248,255)
			.BackColorChart = .BackColor
			.InsideCount = 4
			.InsideLabel = "&lt;b&gt;&lt;%hh%&gt;&lt;/b&gt;"
		endwith
		.InsideZooms.Add({^2005-6-22})
		.DrawGridLines = 2
	endwith
	with .Items
		h = .AddItem("Project 1")
		.AddBar(h,"Summary",{^2005-6-21},{^2005-7-1})
		h1 = .InsertItem(h,0,"Task 1")
		.AddBar(h1,"Task",{^2005-6-21},{^2005-6-28})
		.CellMerge(h1,0) = 1
		.DefineSummaryBars(h,"",h1,"")
		h1 = .InsertItem(h,0,"Task 2")
		.AddBar(h1,"Task",{^2005-6-23},{^2005-7-1},"E")
		.CellMerge(h1,0) = 1
		.DefineSummaryBars(h,"",h1,"E")
		.ItemBar(h1,"E",21) = 5
		h1 = .InsertItem(h,0,"Task 3")
		.AddBar(h1,"Task",{^2005-6-25},{^2005-6-27},"E")
		.CellMerge(h1,0) = 1
		.DefineSummaryBars(h,"",h1,"E")
		.ExpandItem(h) = .T.
		.CellState(h,1) = 1
		h = .AddItem("Project 2")
		.AddBar(h,"Summary",{^2005-6-26},{^2005-7-6})
		h1 = .InsertItem(h,0,"Task 1")
		.AddBar(h1,"Task",{^2005-6-26},{^2005-7-2})
		.CellMerge(h1,0) = 1
		.DefineSummaryBars(h,"",h1,"")
		h1 = .InsertItem(h,0,"Task 2")
		.AddBar(h1,"Task",{^2005-6-28},{^2005-7-6},"E")
		.CellMerge(h1,0) = 1
		.DefineSummaryBars(h,"",h1,"E")
		.ItemBar(h1,"E",21) = 5
		h1 = .InsertItem(h,0,"Task 3")
		.AddBar(h1,"Task",{^2005-6-30},{^2005-7-2},"E")
		.CellMerge(h1,0) = 1
		.DefineSummaryBars(h,"",h1,"E")
		.ExpandItem(h) = .T.
		.CellState(h,1) = 1
	endwith
	.EndUpdate
endwith

ENDPROC
PROCEDURE reloader
with thisform.G2antt1
	.BeginUpdate
	.Items.RemoveAllItems()
	.LoadData()
*!*		with .Items
*!*		for each h in thisform.G2antt1.Items
*!*			.DefaultItem = h
*!*			.ExpandItem(0) = .t.
*!*		next
*!*		endwith
	.EndUpdate
endwith

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>16</reserved2>
		<reserved3>resuparent Ðîäèòåëü ðåñóðñîâ ïî äåðåâó òîâàðîâ
ndefclt êëèåíò ïî-óìîë÷àíèþ
lonlytime Ïîêàçûâàòü íà áàðàõ òîëüêî âðåìÿ èëè åùå èíô î êëèåíòå
ntimeclearnum Âðåìÿ â ÷àñàõ ìåæäó óáîðêàìè íîìåðîâ
nwkdays êîëè÷åñòâî äíåé äëÿ çàãðóçêè ñ òåêóùåé äàòû
nfrmid Id ôîðìû äëÿ ïëàíà
czoom Ìàñøòàá âûáîðêè äàííûõ
*addxml äîáàâëÿåì äîï íàñòðîéêè
*loaddata1 
*reloader Ïåðåãðóçêà äàííûõ 
*initrecordset Ïðîáóåì ðàáîòàòü ñ RecordSet 
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7>Ïðîñìîòð Ôèíàíñîâ ÷åðåç Ãàííòà äëÿ ïðîì. ïðîåêòîâ</reserved7>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1084396835</timestamp>
		<class>g2antt</class>
		<classloc>gannt.vcx</classloc>
		<baseclass>olecontrol</baseclass>
		<objname>G2ANTT1</objname>
		<parent>frmresfin</parent>
		<properties>Top = 0
Left = 0
Height = 603
Width = 1082
ZOrderSet = 3
dbtablename = Basis!rv_ResursJrn
_handledcustommsglist = 
_handledcustommsgpromptlist = 
cname0 = Ðàáîòû, ñîáûòèÿ
ncountunits = 24
cbarfont = Aryal CYR:10:0
citemfont = Aryal CYR:10:1
cpoditemfont = Aryal CYR:8:0
ccolumnfont = Aryal CYR:11:1
nwithcol0 = 180
npanewith0 = 180
lmultybar = .T.
Name = "G2ANTT1"
</properties>
		<protected/>
		<methods>PROCEDURE _add
LPARAMETERS item, datestart, dateend
retu
LOCAL lPartFrmId ,lPartFrmId1 ,tnTvrID,lnMsuID,lnPrice ,_PARAM1,_PARAM2,llResult,lnQnt,lRetValPut, lFreeChoise
nitem = item
WITH this
.Enabled = .F.

		PUBLIC nMakerOuId,nDefClt1,nIspCltID,nTvrId,cRezult
		nDefClt1 = thisform.nDefClt

		SELECT rv_ResursLst
		LOCATE ALL FOR BarId = nitem
		nTvrId = rv_ResursLst.TvrId
		lFreeChoise = !FOUND()
		IF lFreeChoise
				GO top
				LOCATE ALL FOR ItemId = nitem
		ENDIF
		nMakerOuId = rv_ResursLst.MakerOuId
		*** - 29.09.2009 17:45:17 Ãëóõîâ Â.Þ. (C) - &gt;
		** îïðåäåëÿåì åñòü ëè çàåçäû ïî ïóòåâêàì äëÿ ýòîãî òîâàðà-ðåñóðñà
		_PARAM = rv_ResursLst.ServID
		USE BASIS!lvmatrixhotel IN 0 ALIAS matrixhotel
		USE IN SELECT('lvmatrixhotel')
		SELECT * FROM matrixhotel INTO TABLE tmp\lvmatrixhotel
		USE IN SELECT('matrixhotel')
		IF RECCOUNT('lvmatrixhotel')&gt;0
			USE IN SELECT('lvmatrixhotel')
			PUBLIC lRetValm[1,2]
			lRetValPut = oApp.DoModalFormRetValObj([frmhotelput;primarydoc_v1.vcx;primarydoc.app]) &amp;&amp;,rv_ResursLst.ServID)
			IF lRetValPut
				lnPrice = lRetValm[1,2]
				lnQnt   = lRetValm[1,1]
	  	 		 lnQnt   = IIF(TYPE('datestart')='T',lnQnt*24*60*60, lnQnt  )
	      		 dateend   = datestart+   lnQnt
			ENDIF
	        RELEASE lRetValm
		ENDIF
		USE IN SELECT('lvmatrixhotel')
		ERASE tmp\lvmatrixhotel.dbf
		
		IF lFreeChoise
				SELECT rv_ResursLst
				LOCATE ALL FOR ItemId = nitem
				IF !FOUND()
			        RELEASE nMakerOuId,nDefClt1,lRetValm,nTvrId,cRezult
					RETURN 0
				ENDIF
				cRezult = spFreeRec(rv_ResursLst.TvrParId,datestart+1,dateend-1 )
				* ñîçäàåì ñïèñîê ðåñóðñîâ, êîòîðûå äîñòóïíû â ýòîò ïåðèîä
				IF EMPTY(cRezult)
					RETURN 0
				ENDIF
			ELSE
				lBarCnt = ._find(rv_ResursLst.TvrId,datestart, dateend,0)
				IF lBarCnt &gt;0
					RETURN 0
				ENDIF
		ENDIF

	    dStart = datestart
	    dEnd   = dateend
luResAdding = oMgrPD.Operate([FORM],[ADDSCHET],ThisForm.nScrFrmID,datestart, dateend )  &amp;&amp; DATETIME(), DATETIME())
IF !EMPTY(cRezult)
				SELECT rv_ResursLst
				GO TOP
				LOCATE ALL FOR TvrId = nTvrId
				nitem = rv_ResursLst.BarId
				nMakerOuId = rv_ResursLst.MakerOuId
				cRezult = 'TMP\'+cRezult +'.dbf'
				ERASE (cRezult)
ENDIF
datestart = dStart
dateend   = dEnd
RELEASE nMakerOuId,nDefClt1,lRetValm,nTvrId,cRezult
.Enabled = .T.
SET DATABASE TO BASIS
IF TYPE('luResAdding')='L'
RETURN 0
ENDIF
		lPartFrmId1  = luResAdding

		SELECT rv_ResursLst
		SCATTER MEMVAR
		** ñ÷èòàåì âðåìÿ â ìèíóòàõ
		nTime = (dateend - datestart)
		*** - 14.03.2009 11:46:58 Ãëóõîâ Â.Þ. (C) - Ïðàâà ïðèíàäëåæàò
		IF TYPE('datestart')='T'
		   nTime = nTime /60 /60  &amp;&amp; ïðèâåëè ê ÷àñàì
**		   nTime = nTime /60 /60/24  &amp;&amp; ïðèâåëè ê ñóòêàì
		  ELSE
		   nTime  = nTime * 24  &amp;&amp; ïðèâåëè ê ÷àñàì
**		   nTime  = nTime   &amp;&amp; ïðèâåëè ê ñóòêàì
		ENDIF
		** îïðåäåëÿåì êîä óñëóãè è öåíó
		_PARAM1 = m.ServID &amp;&amp;22023 &amp;&amp;tnTvrID
		_PARAM2 = 1
		***
		USE IN SELECT([lvPriceTvr])
		USE lvPriceTvr IN 0
IF lRetValPut
	nTime  = 1
	ELSE
	lnPrice = lvPriceTvr.Price
		ENDIF
		USE lvOrderTvrEdit IN 0 NODATA
		APPEND BLANK IN lvOrderTvrEdit
		REPLACE ;
			FrmID WITH luResAdding  , ;
			TvrId WITH m.ServID, ; &amp;&amp; (ïðîæèâàíèå â íîìåðå)
			TvrIDCalc WITH m.TvrId, ; &amp;&amp;(êîä ðåñóðñà)
			MsuId WITH m.MsuID, ;
			TvrQnt WITH nTime  , ;
			TvrPrcSale WITH lnPrice  ;
		IN lvOrderTvrEdit
		RELEASE lnPrice
		**SET STEP ON
		llResult = TABLEUPDATE(1,.T.,[lvOrderTvrEdit])
		*------------------------------------------------------------------------------
		IF llResult
			lPartFrmId = spGetLastIncrementedID([lvOrderTvrEdit])
			**lPartFrmId = spGetLastIncrementedID([JrnUsege])
		ELSE
		   RETURN 0
		ENDIF

USE IN SELECT('lvJrnUsageEditPartTvr')
		_PARAM = lPartFrmId
			
			**FrmPartTvrId WITH lPartFrmId ,;

USE lvJrnUsageEditPartTvr IN 0
SELECT lvJrnUsageEditPartTvr
		REPLACE ;
			UseStart WITH datestart, ;
			UseEnd WITH dateend, ;
			UsePlan WITH .t. ;
		IN lvJrnUsageEditPartTvr
		llResult = TABLEUPDATE(1,.T.,[lvJrnUsageEditPartTvr])
		IF llResult
			.lnbarid= lvJrnUsageEditPartTvr.JrnUseId
			lPartFrmId = .lnbarid
	    	INSERT INTO rv_ResursJrn (JrnUseId,ItemId, FrmId,BarId,UseStart,UseEnd,PointIspCl,FrmIsPayed) ;
	    					  VALUES (lPartFrmId,item,luResAdding,lPartFrmId,datestart,dateend,pPointIspCltID,.f.)  &amp;&amp; äëÿ îòîáðàæåíèÿ
		ELSE
		   RETURN 0
		ENDIF
		*** lvFrmEdit.PointIspCltID
	lresult = spDiscRecount(lPartFrmId1, nIspCltID,null,null)
RELEASE nIspCltID
ENDWITH 		
RETURN luResAdding
ENDPROC
PROCEDURE _dele
RETURN
LOCAL luRes , lFrmId
WITH this
	SELECT rv_ResursJrn
	LOCATE ALL FOR rv_ResursJrn.JrnUseId = .lnbarid
	IF FOUND() AND 	(rv_ResursJrn.FrmStatusI&lt;3 AND !rv_ResursJrn.FrmIsPayed)
	   lFrmId = rv_ResursJrn.FrmID
	   luRes = oMgrPD.Operate([FORM],[DELE],rv_ResursJrn.FrmID)
	
	  IF luRes
		SELECT rv_ResursJrn
		LOCATE ALL FOR rv_ResursJrn.FrmID = lFrmId
	   DO while FOUND()
		   .Items.RemoveBar(rv_ResursJrn.itemid , rv_ResursJrn.JrnUseId)
			DELETE next 1 IN rv_ResursJrn
			LOCATE ALL FOR rv_ResursJrn.FrmID = lFrmId
	   ENDDO
	  ENDIF
ENDIF
ENDWITH

ENDPROC
PROCEDURE _edit
*LPARAMETERS lnJrnUseId, h
RETURN
LOCAL luRes, lstr, datestart, dateend,stringWk,test1
luResAdding  =.f.
SELECT rv_ResursJrn
LOCATE ALL FOR rv_ResursJrn.JrnUseId = .lnbarid
** åñëè äîêóìåíò íå çàêðûò äëÿ ðàáîòû
IF !FOUND()
RETURN
ENDIF
IF rv_ResursJrn.FrmStatusI &gt;3 &amp;&amp;!rv_ResursJrn.FrmIsPayed òàê áûëî
	  	MESSAGEBOX('Ñòàóñ äîêóìåíòà íå ïîçâîëÿåò åãî ðåäàêòèðîâàòü.'+CHR(13)+;
	  			   'Åãî ìåíÿòü íåëüçÿ.',0+32,'Îòìåíà ðåäàêòèðîâàíèÿ äîêóìåíòîâ')
ENDIF

WITH this.Items
LOCAL h, lnJrnUseId
h = rv_ResursJrn.ItemId
lnJrnUseId = rv_ResursJrn.JrnUseId
datestart = .ItemBar(h, lnJrnUseId,1)
dateend   = .ItemBar(h, lnJrnUseId,2)
	ENDWITH
PUBLIC barCltName, nFrmStatusI,dStart,dend
nFrmStatusI   = rv_ResursJrn.FrmStatusI
barCltName  =''
this.Enabled = .F.
dStart = IIF(VARTYPE(datestart)='C',CTOT(datestart),datestart)
dEnd   = IIF(VARTYPE(dateend)='C',CTOT(dateend),dateend)
luRes = oMgrPD.Operate([FORM],[EDIT],rv_ResursJrn.FrmID)
datestart = TTOC(dStart)
dateend   = TTOC(dEnd)
this.Enabled = .t.
IF luRes
REPLACE rv_ResursJrn.FrmStatusI WITH nFrmStatusI NEXT 1 IN rv_ResursJrn
this.BeginUpdate()
WITH this.Items
.RemoveBar(h, lnJrnUseId)
	                .AddBar( h, this.namebar(rv_ResursJrn.FrmStatusI,rv_ResursJrn.FrmIsPayed) , datestart, dateend, lnJrnUseId, ALLTRIM(barCltName) )
stringWk = "Items.ItemBar("+ ALLTRIM(STR(h,10,0))+" , "+ ALLTRIM(STR(lnJrnUseId,10,0))+" , 12) =`" +IIF(rv_ResursJrn.FrmIsPayed,"1","0")+"`"   &amp;&amp; exBarPercent
this.executeTemplate(stringWk)
				    stringWk = "Items.ItemBar("+ ALLTRIM(STR(h,16,0))+" , "+ ALLTRIM(STR(lnJrnUseId,10,0))+" ,  6) = `" ;
				    						   +  "Çàñåëåíèå:"+ IIF(VARTYPE(datestart)='C',datestart,TTOC(NVL(datestart,{})))+ ;
				    							  "      Âûåçä:        "+ IIF(VARTYPE(dateend)='C',dateend,TTOC(NVL(dateend,{})))+"`"    &amp;&amp; exBarToolTip
				    This.ExecuteTemplate(stringWk)
	  ENDWITH
this.EndUpdate()
ENDIF
RELEASE barCltName, nFrmStatusI,dStart,dend
RETURN luRes

ENDPROC
PROCEDURE _handlecustommsg
LPARAMETERS tcMsg
RETURN
DODEFAULT(tcMsg)
DO CASE
	CASE tcMsg = [GUESTIN]
		*16.09.2007 18:10 -&gt;Ìåíÿåì ñòàòóñ íà 3 - ãîñòü çàñåëåí
		LOCAL lnFrmID, lRetVal, lnUserClt
		lRetVal  = .f.
		SELECT rv_ResursJrn
		LOCATE ALL FOR rv_ResursJrn.JrnUseId = this.lnbarid
		
		IF FOUND() AND rv_ResursJrn.FrmStatusI &lt; 3 AND MESSAGEBOX('Çàñåëÿòü ãîñòÿ â íîìåð?',4+32+256,'Èçìåíåíèå äàííûõ î ïðîæèâàíèè ...')=6
			lnFrmID = rv_ResursJrn.FrmID
			_PARAM = lnFrmID
			lnUserClt = spUserClt()
			USE lvFrmEdit IN 0
			CURSORSETPROP([BUFFERING],3,[lvFrmEdit])
			REPLACE FrmStatusID WITH 3, ExecEmiCltID WITH lnUserClt IN lvFrmEdit
			**oApp.nUserKod
			lRetVal = TABLEUPDATE(1,.T.,[lvFrmEdit])
			USE IN lvFrmEdit
		ENDIF
		*------------------------------------------------------------------------------
		IF lRetVal
REPLACE rv_ResursJrn.FrmStatusI  WITH 3 NEXT 1 IN rv_ResursJrn
this.BeginUpdate()
WITH this.Items
LOCAL h, lnJrnUseId
h = rv_ResursJrn.ItemId
lnJrnUseId = rv_ResursJrn.JrnUseId
datestart = .ItemBar(h, lnJrnUseId,1)
dateend   = .ItemBar(h, lnJrnUseId,2)
.RemoveBar(h, lnJrnUseId)
		                .AddBar( h, this.namebar(3,rv_ResursJrn.FrmIsPayed) , datestart, dateend, lnJrnUseId, ALLTRIM(rv_ResursJrn.CltNm) )
stringWk = "Items.ItemBar("+ ALLTRIM(STR(h,10,0))+" , "+ ALLTRIM(STR(lnJrnUseId,10,0))+" , 12) =`" ;
						   +IIF(rv_ResursJrn.FrmIsPayed,"1","0")+"`"   &amp;&amp; exBarPercent
this.executeTemplate(stringWk)
					    stringWk = "Items.ItemBar("+ ALLTRIM(STR(h,16,0))+" , "+ ALLTRIM(STR(lnJrnUseId,10,0))+" ,  6) = `" ;
					    						   +  "Çàñåëåíèå:"+ IIF(VARTYPE(datestart)='C',datestart,TTOC(NVL(datestart,{})))+ ;
													  "      Âûåçä:        "+ IIF(VARTYPE(dateend)='C',dateend,TTOC(NVL(dateend,{})))+"`"    &amp;&amp; exBarToolTip
					    This.ExecuteTemplate(stringWk)
		  ENDWITH
this.EndUpdate()
		ENDIF
	CASE tcMsg = [PAYORD]
LOCAL nPayVarNum
nPayVarNum = ALLT(oRes.GetParam([RST],[PAYTYPE]))
		*16.09.2007 18:10 -&gt;Îïëàòà ñ÷åòà êëèåíòà
		LOCAL lnFrmID
		SELECT rv_ResursJrn
		LOCATE ALL FOR rv_ResursJrn.JrnUseId = this.lnbarid
		IF FOUND()
			lnFrmID = rv_ResursJrn.FrmID
			IF rv_ResursJrn.FrmIsPayed
				IF MESSAGEBOX('Äîêóìåíò óæå îïëà÷åí, îôîðìèòü âîçâðàò äåíåã (âûáåðèòå Äà)',4+32+256,'Îôîðìëåíèå âîçâðàòà çàêàçà')=6
			**+ CHR(13) + ;
			**		 								   'èëè ñäåëàòü Äîïëàòó (âûáåðèòå Íåò)?'
				lRetVal = oApp.DoModalFormRetValObj([FrmPayment;payment.vcx],lnFrmID  ,nPayVarNum,IIF(rv_ResursJrn.FrmIsPayed,2,1) ,0)
				  ELSE
				 	RETURN
				 ENDIF
			 ELSE
				lRetVal = oApp.DoModalFormRetValObj([FrmPayment;payment.vcx],lnFrmID  ,nPayVarNum,IIF(rv_ResursJrn.FrmIsPayed,1,1) ,0)
			ENDIF
			*------------------------------------------------------------------------------
			IF lRetVal
	         REPLACE rv_ResursJrn.FrmIsPayed WITH IIF(rv_ResursJrn.FrmIsPayed,!lRetVal,lRetVal) NEXT 1 IN rv_ResursJrn
	         this.BeginUpdate()
	          WITH this.Items
					        stringWk = "Items.ItemBar("+ ALLTRIM(STR(rv_ResursJrn.ItemId ,10,0))+" , "+ ALLTRIM(STR(rv_ResursJrn.JrnUseId,10,0))+" , 12) = 1" &amp;&amp; exBarPercent
					        This.ExecuteTemplate(stringWk)
			  ENDWITH
	         this.EndUpdate()
	         ENDIF
		ENDIF
ENDCASE


ENDPROC
PROCEDURE _info
WITH this
	SELECT rv_ResursJrn
	LOCATE ALL FOR rv_ResursJrn.JrnUseId = .lnbarid
	IF FOUND()
	   luRes = oMgrPD.Operate([FORM],[INFO],rv_ResursJrn.FrmID)
ENDIF
ENDWITH

ENDPROC
PROCEDURE _setappearance
DODEFAULT()
	WITH this.VisualAppearance
		*** Ïðîãðåññ-áàð
		s = 'gBFLBCJwBAEHhEJAEGg4BBIDg6AADACAxRDAMgBQKAAzQFAYaQNBgABhGYZYJACCIDEYeSzRNCsOw8GSEZAgOJ4eiWJIkDD'
		s = s+'KADQTAoYBKFoZJTgQYJOjCJULIRkSZ0CgmOY3UBHMjwSBEEigNIxToOU4jFimCROQwQRK1BDwbQSFCEUDnaagABiHQYRBQMa'
		s = s+'vfYlSr+fx/LLtF7Xdb5fD8Py+b5vY7TdTofR9XxfxLDaz4ep+HreR63WbNej1PI+LyPC7DZrhRp4MCdTBXLbdcTqPg8DovM5z'
		s = s+'TrudpzHrdNxXWapZDxOw4bx6S6TVrEeR0XAeJx2fbBZTdPC5DabSzjXLEazfGvBCyrXq+aZ3G6aJzWbZBbjaM7zbLuW'
		s = s+'zbFJoGwMZck0Zgrh2KpEHUdpdG0RgjiWJJCHMM5Xm4NoCm2RJPF0OJZkuFwbC0bphGSLRcAwdYbgWDIyDgDBSkWegrE2cwYiy'
		s = s+'AAKjMeJDCoTZjACJw3EuYoUlwLxKEMdI7CiTYSnSHw2EuMh4lgLoJlMYI4CaTYCliGQ1gsQhclcLIJGMWIxCUTRSkSEw1AsAh'
		s = s+'IlUK5InMUIuCMDQijCCg0gqIgclMKhIEMSIoCCTQCiCBQzkocgQk4KYIDMOIkB+TJigwfAzEoEZgkwKAHHMLIfB2DByG4YIY1'
		s = s+'OaB0DGSYBkiRgmAbGoWBtU5UGsMZJGGKJDCSJxiEwaQwgkIYgkIJBGFMCIQVWMg8GEMIImEfJBCMRZinCCwWGjEg9CKBYCniC'
		s = s+'QVmkYRcj8IZFR+BgVGmYRUj4IJFBqDBRC8SAhECPAgEScpsgAE4LiGfBNC4R5hDKNATAuMZ8EuLhEjKaB+BKC4RnQSQuAeQQg'
		s = s+'jcHpEHKWB6BGLIhBkZRCFYZYVGgWoPnWMRuFwFwll0dxeFeNZ1H8YBYDYFYHGIWI2EGEBkhkRhZhgZoZkYeYgGiGhGhmKBqhq'
		s = s+'Ro5jAbIbEaWY4G6G5HAWQRwlwVwdkkcsxkmUh1B0ZxhlodwdmeAJFHiHhHhmaB6h6R45nAfIfEeWZ4H6H5HnoAIAgweASAaAg'
		s = s+'gigMgOgQIQoFIFoGCGKByB6CAiCiEgmgoIoojILoMCMKJSDaDgjiicg+hAJApBIRoSCSKQyE6FAlCkUhWhYJYpHIXoYnUCYWG'
		s = s+'eGhmjmNhvhwZw5lYd4eGeOZ2H+IBoDoFoHiIaI6DaD4kGkOhWheJhpjodofigamsiiKoqkqOowiyKx6l6HkLwVxrAFEKGILA1giibDMNkdAGgBEBA'
		.Add(54,s)
	ENDWITH

ENDPROC
PROCEDURE AddItem
*** ActiveX Control Event ***
LPARAMETERS item

with thisform.G2antt1.Items
	.AddBar(item, "GreenTask", .CellValue(Item, 2), .CellValue(Item, 3), 0,'')   &amp;&amp;'Îïèñàíèå ')
endwith
ENDPROC
PROCEDURE AddLink
*** ActiveX Control Event ***
LPARAMETERS linkkey
RETURN
LOCAL nFrmId1,nFrmId2,nPointIspCl1,nPointIspCl2,_PARAM
SELECT rv_ResursJrn
WITH This
	LOCATE ALL FOR rv_ResursJrn.JrnUseId = .lnbaridu
	IF FOUND()
		IF NVL(rv_ResursJrn.FrmIsPayed,.f.)
			  	MESSAGEBOX('Îäèí èç äîêóìåíòîâ óæå îïëà÷åí.'+CHR(13)+;
	  			   'Åãî ìåíÿòü íåëüçÿ.',0+32,'Îòìåíà îáúåäèíåíèÿ äîêóìåíòîâ')
	  			   RETURN .f.
		ENDIF
	    nFrmId2 = rv_ResursJrn.FrmID
		nPointIspCl2 = rv_ResursJrn.PointIspCl
		ELSE
	  			   RETURN .f.
	ENDIF

	LOCATE ALL FOR rv_ResursJrn.JrnUseId = .lnbarid
	IF FOUND()
		IF NVL(rv_ResursJrn.FrmIsPayed,.f.)
			  	MESSAGEBOX('Îäèí èç äîêóìåíòîâ óæå îïëà÷åí.'+CHR(13)+;
	  			   'Åãî ìåíÿòü íåëüçÿ.',0+32,'Îòìåíà îáúåäèíåíèÿ äîêóìåíòîâ')
	  			   RETURN .f.
		ENDIF
	   nFrmId1 = rv_ResursJrn.FrmID
	   nPointIspCl1 = rv_ResursJrn.PointIspCl
		ELSE
	  			   RETURN .f.
	ENDIF

	IF nFrmId1 = nFrmId2
	  	MESSAGEBOX('Ýòè äîêóìåíòû óæå îáúåäåíåíû.',0+32,'Îòìåíà îáúåäèíåíèÿ äîêóìåíòîâ')
	  			   RETURN .f.
	ENDIF

	IF nPointIspCl1 &lt;&gt; nPointIspCl2
	  	MESSAGEBOX('Ó äîêóìåíòîâ ðàçíûå êëèåíòû.'+CHR(13)+;
	  			   'Ñäåëàéòå îäíîãî êëèåíòà.',0+32,'Îòìåíà îáúåäèíåíèÿ äîêóìåíòîâ')
	  			   RETURN .f.
	ENDIF


	IF   	MESSAGEBOX('Îáúåäèíÿòü ýòè äâà äîêóìåíòà?',4+0+32,'Îáúåäèíåíèå äîêóìåíòîâ') &lt;&gt; 6
	RETURN .f.
	ENDIF

*** - 18.03.2009 20:15:36 Ãëóõîâ Â.Þ. (C) - Ïðàâà ïðèíàäëåæàò
llResult = spFormJoin(nFrmId1,nFrmId2)

		IF !llResult
		   RETURN .f.
		ENDIF
*------------------------------------------------------------------------------
llResult = spDiscRecount(nFrmId2, rv_ResursJrn.PointIspCl,null,null)
REPLACE ALL FOR rv_ResursJrn.FrmId = nFrmId1 rv_ResursJrn.FrmID WITH nFrmId2 IN rv_ResursJrn
IF MESSAGEBOX('Äîêóìåíò èçìåíåí. Ðàñïå÷àòàòü åãî?',4+32,'Ïîäãîòîâêà ê ïå÷àòè ...')=6
	.lnbarid= .lnbaridu
	._prndoc()
ENDIF
ENDWITH

DODEFAULT(linkkey)

ENDPROC
PROCEDURE addxml
LOCAL s
WITH this
.BeginUpdate
.SingleSel = .F.
s = "gBJJgBAIDAAGAAEAAQhYAf8Pf4hh0QihCJo2AEZjQAjEZFEaIEaEEaAIAkcbk0olUrlktl0vmExmUzmk1m03nE5nU7nk9n0/oFBoVDolFo1HpFJpVLplNp1PqFRqVTq"
s=s+"lVq1XrFZrVbrldr1fsFhsVjslls1ntFptVrtltt1vuFxuVzul1u13vF5vV7vl9v1BAmBhOCwMKwuDw2ExWJxmIx2HyGLx+SyONyuTy2UzWZzmYz2X0Gbx1kUigUAAMwzG"
s=s+"eo1Ws1ZV2Go1IAL+1ACZMxm2+52W63Ov2Op1fC13F0un4nJ1vE2BV2XD2e/4vK4fL63V1bMTKZ5/d2pf3vh6Xj2ff3e63G683S5vF0mmAD4+Xx+bA+wAeP5/H6a/9+h8P2"
s=s+"eIAGZAiHHYZkDQQ7TuH/Ap4GUUzjPgiCJn+AD7GBAMNQJBD8wFDwAFlEUExJBaHQdCDixM+UARYABuxg/8ZQ5DUQRpEEbQKf8DxPBDiPe08KRdDEZHVIwANU1YRSWAALSdJ"
s=s+"snxpHcFO3HsrOI48Ky1IkKQpERZAA9sjHVC77ynEsqwbBE1RVNKHgAQ04yQ1skvDOJDRkZc9ABJYRT5Jk+z/P0pR49sgQHAsaUVApx0aAD+mvOclSZIkYG7MsMxNTUqyw+F"
s=s+"FwVRNQwRSwACFUwADvVNHv9IlNu5V02u5UjzVMIUQxHMYABzXdUVVRpxgBXM60DX9MQHTjWrJE0uzfGkXRdXNa0FYMjxBM8vxJM7iWXN8KSlbs31zWlT1Ja0eWxM9tNbbkL"
s=s+"UhY1mQtaU62hI9hyZUl0x5H6x3ZLVvwtekyWlYlHXNBF0R5dTszdC1vR1cELVJO9JABLODVvMF8x9deGS1fE3yJXYc4pgOKUDfGE31ZN+Srd13U/VdI1y9uCWBPRl2NE1sW"
s=s+"xbeWv9l2f6DSNSXdkTaNtd1WyrncR567mgaHGJLanMLY2laVc2FOjW1JpTuX2sV0YhmMtQpXLct1msZRBLmU421exYbN93XgAFixA9s61ztkzbc4u47LHmb6O8ExSPs0j6N"
s=s+"Otyv1hSy8BCm6bHs7eUDXMXb5DOLuJyG5v9CjzWLCkszrqZLS2+/NtbwEQdFN9sPbLPEYFU/Fxj1TV2U7WyahslSdM8O9SPGkieK+8iW33fe1JXNUjvqrnWlo1A2lUnieO+"
s=s+"/k1lGMs7RjDwvNiciedUtT6Nd3B+RlaxQJBmx8luULWLLPqxjZ769S/UQe1svPUi6M+D5DzN5a2athyHX9H6f43VIjE3yMTbqrlbB5l3OYgU+ssL7X+rtc+2Nj7AD5vwRkk"
s=s+"SCyAoFvvg6/FaiZIIuHbGv9DRxEuQeRjC2FkKH/pvRcs4+b+4MFgH+mmISDIhrHN0dqI5uIjRLGYbOJp2YnRRihAaIsQYiRXIdFVKsSImRKiegOKUYIpxZiwg2MsWokxpjF"
s=s+"Gs7UY4vxvNmWSKwAEHoRjrHRFMZkToMd3HqOcf4lRBN1IKLMg4vGzjnHeRUeY+yNj5GeIkhpJSFkpF+RKKZFoRj9I6PcZJKSElBIGUUR44ljkBJCT0gI1RclZIeN0YZLRal"
s=s+"RKqLsq5XRslhIiWUqY0S1l9HCV8YyyEWB8SuYpHiQEiJIAAkpKJmk4QoX8pJFE3zSKCQEA="
.Images(s)
s="gBJJgBAICAAGAAEAAQhYAf8Pf4hh0QihCJo2AEZjQAjEZFEaIEaEEaAIAkcbk0olUrlktl0vmExmUzmk1m03nE5nU7nk9n0/oFBoVDolFo1HpFJpVLplNp1PqFRqVTqlVq1XrF"
s=s+"ZrVbrldr1fsFhsVjslls1ntFptVrtltt1vuFxuVzul1u13vF5vV7vl9v1/wGBwWDwmFw2HxGJxWLxmNx2PyGRyWTymVy2XzGZzWbzmdz2f0Gh0WjwEWH0r08ekEikgAkso184iG"
s=s+"kicPjcU2+zjW43e6jO8jL+b79X8bfif48bfAffgP43IT8b4XE3O23vW3++2r/6vcjUB"
.Images(s)

*!*		.DrawGridLines = -1
*!*		.BackColor = RGB(255,255,255)
*!*		.MarkSearchColumn = .F.
*!*		.ShowFocusRect = .F.
*!*		.HasLines = .F.
*!*		.Indent = 24
*!*		.DefaultItemHeight = 20
*!*		.AllowChartScrollPage = .T.
*!*		.ScrollPartCaption(2,2048) = "&lt;img&gt;4&lt;/img&gt;"
*!*		.ScrollPartCaption(2,32) = "&lt;img&gt;5&lt;/img&gt;"
*!*		   WITH .VisualAppearance
*!*			.Add(1,"gBFLBCJwBAEHhEJAEGg4BOEIQAAYAQGKIYBkAKBQAGaAoDDMOILQiMQxDPBMKgBBCLIxiGK4DhiGoZQ0HKCRZDeI4DDSNcgjCLIZw8GYCIRjaL5UkPGSZJpmSRwAiWPIpSrLMrgLLMdR1HCBaQiehoaiEMg1CTTVQSCKoYSjBKqarjGbKGoqSozUxNMAggI=")
*!*			.Add(2,"XP: Header 1 1")
*!*		   ENDWITH
*!*				.HTMLPicture("excel") = "gAAAABgYAEAgBEChSohIAC0KFEKEEKIEKgkNhQAAkZjkCgkejshkUjkklk0nlEplUrlRofQSADbMhEABwl8xmYAI0KaoPawANgYYwAeIDIIARE3mU0A08n1AoVEo1IBVDYrjo7NrFQoaoqoAK5+IYAXE3N1iAB2tCcfcwQFosswpsCns/fDVmlBobQm4GHVMi0KJQBBcceE3VAscJ3XgADAAucFgWDwt1ADNVa6bgUtoAcxSxeWxuPyMfAGUjhwfkwGmdQ5kxbXAL/f+jyGByeEjhQzrwEJ1OOy2m20uC3SszpvE/A4m40+6TfLOOqmEZSBCCYAu80jLY35xjPCf/UyU1zocYECGmrxzDOxxKAmOJx2m0aGdOgl4HX7PNkDcsK8iMnQzoNmCOQ4v88rUCI9jlOYxzbv+57Cui4EBIU/jtLwjg1mBBCMjgYjsvIbgjsW20NO2ABIPYFj2RamEYgAW4PnMO4ICQxb6n+UD2DsE0IMfEJ+phFZMAeoYBIVJaOw0kQwPY2wuSK9r3iA+T6PqYD2MTFEIuLACayqzDNG49gyROO4QhkIoACsESKhxKpsTiAB4PYVgOGOjSFAYWShkKEiKkoaChipKpMhOioMUAAAbhEo6NoFP6hgiECj0qAB7Uwjk9T5TQ2A3Ph4A1PhYI+KtBgAcEqj9VdBIqjLTGJKo3BsipVzsWE6TsOEq0mABcz2AFapgAhYqGdliGhKoXUWAB6WJYc+E4HiK2MAFPz6gVroqBznNMZAJz4UwFiEABnXVdd2Xbd133heN5Xnel63oHwo3zfV935ft83gHxAYFgeCYLgxACjgGD4Xg+E3fgOBX9iV84jhWI4IKOI4phGN4Ri2EYxjWM45kePYfgd/ZJkWUY/kuQZJfmWZPi+UZXlWK5nmF9ZvneKj4H2f6DoGh6Fl2UY7hOiaVoWg5do2WZ/hmB5/iekGdoGD6VoGnZDn2A6ZrGg6pruaY9rGlkBoJAa3quoa/om06HuOuZriusbiPm8bOPm6bLhOo4FvOhanfG27tvO071wGt7Jl+PajwWl7fvvHaTvOlbXtW2X6H138huWBblwGDYhhHO6vxGpbv0mI9OZ2wdhoeY9D012cl2PU4LfHXXj0upYGH3ed73/dXt4Pj+R5PkXfHkeH8hXnoF6IAen6voev6XseolnuJW0wBoUA6FAf6IP+iH/oj+gI="
*!*				.HTMLPicture("word") = "gAAAABgYAEAgBEChSohIAC0KFEKEEKIEKgkNhQAAkZjkCgkejshkUjkklk0nlEplUrlRofQSADbMhEABwl8xmYAI0KaoPawANgYYwAeIDIIARE3mU0A08n1AoVEo1IBVDYrjo7NrFQoaoqoAK5+IYAXE3N1iAB2tCcfcwQFosswpsCns/fDVmlBobQm4GHVMi0KPwCDMceE3VAscJ3NQBCYAucFgWDwt1ADNVa6bgUtoAcxSxeWxuPyMfAGUjhwfkwGmdQ5kxa1AL/f+jyGByeEjhQzrwEJ1OOy2m20uC3SszpvE/A4m40+6TfLOOqmEZGBux93mkZbG/OMZ4T/6mSmudDjAgQ01YADDDOxxKAmOJx2m0aGdOgl4HXx/NkDcsK8aMnQzoNmCOQ4v88jUCI9blOYxzbv+57Cui4EBIU/gAO0jg1mBBCMjwYTHvGbgjsW20NQ4SD1hY9cWJhGAAFuD5zDuCAkMW+p/lA9Y7BNCDHoyOB+phDhMAeoYBIVJaOw0kQwPW2wuSK9j3DiID5Po+pgPWxMUQi4sAJrKrMM0bhkqGDQQoqEIZCKAArBEiocSqbE5gAeD1nRNKNIUBhZKGQoSIqKB7KGKkqkyE6KgxQIABuESjo2gVAKGCIQKPSwAHtTKOT4odNjwfqhn4fihgAAaBCrQgAHBKoSHxNU2TImFKAAe8+gohRaTwWE7Twb88VvXKhmJKoYVoFFZAAaEqhdRgABhZligATgeIrY6YVBPyBWwioIOc0wwWYUwFiEABnXVdd2Xbd133heN5Xnel63oHxjXzfV935ft83gHxAYFgeCYLgxAGNgGD4Xg+E3fgOGYjgWHXdiGJX7geKXbi2JYXjV2Ytf2RGNjOFY7hmP3XkOR4xieTZPhpnBbmWaZnm2amdlmSZdnGb59mWYYTmeO5nnWS6BmxAZvgegZPoRnEBmmo5tnei5Zo4W6VpGaYhpuO6fqee6hrV84nluEXVrOf6pqeCX1hGy5doet7UZ2A6ts23axqW+bnrOM7juO0Z9rW65vwOC53tGxbXr24YEH136HiXJ7NfOQ8jtOO8dfeIGNzPGdDheA8/dvG7X0fS3njmOh90F5dZiXX9h13a9t2/a3fHcdn8hXeoF34AeD4ffeL4HjeElnlJW01VIEA6FAf34P9+H/fj+gIA=="

*!*	.SelBackColor = 16777216
*!*	.SelForeColor = RGB(0,0,128)
**'Uncomment it if you are running Windows XP
** .BackColorHeader = 33554432
WITH .Chart
			*!*		.AllowCreateBar = .F.
			*!*		.NonworkingDaysColor = RGB(196,196,128)
			*!*		.NonworkingDaysPattern = 6
			*!*			*!*		.FirstVisibleDate = "Feb 24 2006"
			*!*		.BackColor = RGB(255,255,255)
			*!*		.DrawGridLines = 2
			*!*		WITH .Bars.Add("End")
			*!*			.Pattern = 2
			*!*			.Color = RGB(255,128,128)
			*!*		ENDWITH
	
	
			*!*		exYear         0  Indicates the year. Values: ..., 2001, 2002, 2003, ...
			*!*	    exHalfYear     1  A date between January 1st and June 31 indicates the first half of the year, and from July 1 to December 31, indicates the second half of the year. Values: 1 and 2
			*!*	    exQuarterYear  2  A date between January 1st and March 31 indicates the first quarter of the year, a date between April 1st and June 30 indicates the second quarter of the year, a date between July 1st and September 30 indicates the third quarter of the year, and if a date between October 1st and December 31 indicates the forth quarter of the year. Values: 1, 2, 3 and 4
			*!*	    exMonth       16  Indicates the month. Values: 1 ( January ), 2 ( February ), ..., and 12 ( December ). Use the MonthNames property to specify the name of the months.
			*!*	    exThirdMonth  17  The first ten days in a month indicates the first third of the month, the next 10 days indicates the second third of the month, and the last 10 days in the month indicates the last third of the month. Values: 1, 2 and 3.
			*!*	    exWeek        256  Indicates the week in the year. Values: 1,2,...,53. Use the WeekDays property to specify the name of the days in the week.
			*!*	    exDay         4096  Indicates the day of the date. Values: 1,2,..,31
			*!*	    exHour        65536  Indicates the hour.
			*!*	    exMinute      1048576  Indicates the minute.
			*!*	    exSecond      16777216  Indicates the second.

		.Label(0) = ""  &amp;&amp; exYear
		.Label(1) = ""  &amp;&amp; exHalfYear
		.Label(2) = ""  &amp;&amp; exQuarterYear
		.Label(16) = ""  &amp;&amp; exMonth
		.Label(17) = ""  &amp;&amp; exThirdMonth
*!*		.Label(256) = ""  &amp;&amp; exWeek
*!*		.Label(4096  ) = ""  &amp;&amp; exDay
*!*		.Label(65536  ) = ""  &amp;&amp; exHour
		.Label(1048576) = ""  &amp;&amp; exMinute
		.Label(16777216) = ""  &amp;&amp; exSecond
		*!*		.OverviewBackColor = RGB(255,255,255)
		*!*		.OverviewVisible = .T.
		*!*		.AllowOverviewZoom = 1
	***.OverviewZoomCaption = "Year|  ?Year|  ?Year|&lt;img&gt;3&lt;/img&gt;|Third|&lt;img&gt;2&lt;/img&gt;|&lt;img&gt;1&lt;/img&gt;|Hour|Min|Sec"
	*.OverviewZoomCaption =    "Year|1\2Year|1\4Year|&lt;img&gt;11&lt;/img&gt;|Third|&lt;img&gt;11&lt;/img&gt;|&lt;img&gt;10&lt;/img&gt;|&lt;img&gt;9&lt;/img&gt;|Min|Sec"
*!*		.OverviewZoomUnit = 24
ENDWITH
.EndUpdate
ENDWITH


ENDPROC
PROCEDURE BarResize
*** ActiveX Control Event ***
LPARAMETERS item, key
IF this.linload
RETURN .t.
ENDIF
IF !TYPE('key')= 'N'
		  thisform.CmdReload.Click()
RETURN .f.
ENDIF
LOCAL  lStart, lEnd, stringWk, lChange,lnResursId, lBarCnt,lresult ,llResult

with this.Items
SET DATABASE TO BASIS
_PARAM = key
USE IN SELECT('rv_JurnalUseEdit')
USE rv_JurnalUseEdit IN 0
*** - 19.03.2009 10:56:41 Ãëóõîâ Â.Þ. (C) - Ïðàâà ïðèíàäëåæàò
*** îáúåêò íå íàøëè
IF !RECCOUNT('rv_JurnalUseEdit')=1
=MESSAGEBOX('Îøèáî÷íûé êîä îáúåêòà. '+CHR(13)+'Ñîõðàíåíèå íå ïðîèçîøëî ...',0+16, 'Ïðîáëåìà')
		     USE IN SELECT('rv_JurnalUseEdit')
		  thisform.CmdReload.Click()
RETURN .f.
ENDIF
SELECT rv_ResursJrn
LOCATE FOR rv_ResursJrn.BarId = key
lChange = .f.
lStart = NVL(rv_JurnalUseEdit.UseStart ,{})
lEnd   = NVL(rv_JurnalUseEdit.UseEnd,{})
lnResursId = rv_ResursJrn.ResursID
*!*	    *** äîêóìåíò îïëà÷åí,íî äëèòåëüíîñòü òà æå, èëè àêöåïòîâàí
*!*	     IF rv_ResursJrn.FrmStatusI&gt;3 OR (rv_ResursJrn.FrmIsPayed AND (.ItemBar(item,key,2)-.ItemBar(item,key,1))&lt;&gt;(lEnd-lStart) )    &amp;&amp; òàê áûëî rv_ResursJrn.FrmStatusI&gt;2 OR rv_ResursJrn.FrmIsPayed
*** äîêóìåíò îïëà÷åí èëè àêöåïòîâàí
IF rv_ResursJrn.FrmStatusI&gt;3 OR rv_ResursJrn.FrmIsPayed    &amp;&amp; òàê áûëî rv_ResursJrn.FrmStatusI&gt;2 OR rv_ResursJrn.FrmIsPayed
=MESSAGEBOX('Äîêóìåíò àêöåïòîâàí èëè îïëà÷åí.'+CHR(13)+'Èçìåíÿòü íåëüçÿ.'+CHR(13)+'Îáðàòèòåñü ê àäìèíèñòðàòîðó.',0+32+4096, 'Íåäîïóñòèìîå äåéñòâèå ...',5000)
		  thisform.CmdReload.Click()
		  RETURN .f.
ELSE
	     lStart = .ItemBar(item,key,1)
	     lEnd   = .ItemBar(item,key,2)
	     IF VARTYPE(lStart)='C' OR VARTYPE(lEnd)='C'
		  thisform.CmdReload.Click()
	     	RETURN .f.
	     ENDIF
	    *** ïîìåíÿëè ñòàðò è îí â çàïðåòíîì ïåðèîäå ÈËÈ îêîí÷àíèå â çàïðåòíîì ïåðèîäå ÈËÈ íîâîå íà÷àëî â çàïðåòíîì ïåðèîäå
	     IF (thisform.tOgrDate &gt; rv_JurnalUseEdit.UseStart  AND rv_JurnalUseEdit.UseStart  &lt;&gt; lStart) OR  thisform.tOgrDate &gt; lEnd OR  (thisform.tOgrDate &gt; lStart AND rv_JurnalUseEdit.UseStart  &lt;&gt; lStart)
			MESSAGEBOX('Æåëàåìàÿ äàòà íàõîäèòñÿ â çàêðûòîì ïåðèîäå.',0+32,'Âíåñåíèå èçìåíåíèé çàïðåùåíî ...')
		thisform.CmdReload.Click()
			RETURN .f.
		 ENDIF
	     IF MESSAGEBOX('Èçìåíèòü ñðîêè ïðîæèâàíèÿ?',4+32+256,'Èçìåíåíèå äàííûõ î ïðîæèâàíèè ...')=6
			     lBarCnt = this._find(lnResursId,lStart,lEnd,Key)
					IF lBarCnt &gt;0
					  thisform.CmdReload.Click()
							RETURN .f.
					ENDIF
			     lChange = .t.
		     ELSE
		  thisform.CmdReload.Click()
		       RETURN .f.
	     ENDIF
ENDIF
					IF this.chart.UnitScale =&lt; 4096
						DO CASE
							CASE this.nTypeTime = 0 &amp;&amp; C 12 äî 12
								lStart = CTOT(DTOC(lStart )+ ' 12:00:00')
								lEnd   = CTOT(DTOC(lEnd   )  + ' 12:00:00')
							CASE this.nTypeTime = 1 &amp;&amp; C 14 äî 12
								lStart = CTOT(DTOC(lStart )+ ' 14:00:00')
								lEnd   = CTOT(DTOC(lEnd   )  + ' 12:00:00')
							CASE this.nTypeTime = 2 &amp;&amp; C òåêóùåãî ÷àñà äî òåêóùåãî ÷àñà
								lEnd   = CTOT(DTOC(lEnd   )  + ' '+TTOC(lStart ,2))
						ENDCASE
				    ENDIF
				    IF (lStart &lt;DATETIME() AND MESSAGEBOX('Íà÷àëî ïðîæèâàíèÿ â ïðîøåäøåì ïåðèîäå.'+CHR(13)+'Èçìåíèòü ñðîêè ïðîæèâàíèÿ?',4+32+256,'Èçìåíåíèå äàííûõ î ïðîæèâàíèè ...')=7)
				  thisform.CmdReload.Click()
				    	RETURN .f.
				    ENDIF
				    this.BeginUpdate()
				    stringWk = "Items.ItemBar("+ ALLTRIM(STR(item,16,0))+" , "+ ALLTRIM(STR(key,10,0))+" , 1) = `" + TTOC(lStart)+"`"
				    this.executeTemplate(stringWk)
				    stringWk = "Items.ItemBar("+ ALLTRIM(STR(item,16,0))+" , "+ ALLTRIM(STR(key,10,0))+" , 2) = `" + TTOC(lEnd)+"`"
				    this.executeTemplate(stringWk)
				    stringWk = "Items.ItemBar("+ ALLTRIM(STR(item,16,0))+" , "+ ALLTRIM(STR(key,10,0))+" , 6) = `" +  "Çàñåëåíèå:"+ TTOC(NVL(lStart,{}))+ ;
	    																			  "      Âûåçä:        "+ TTOC(NVL(lEnd,{}))+"`"    &amp;&amp; exBarToolTip
				    this.ExecuteTemplate(stringWk)
				    this.EndUpdate
IF !(rv_ResursJrn.FrmStatusI&gt;2 OR rv_ResursJrn.FrmIsPayed) AND lChange
REPLACE  UseStart WITH  lStart , ;
	 UseEnd   WITH  lEnd IN rv_JurnalUseEdit
		llResult = TABLEUPDATE(1,.T.,[rv_JurnalUseEdit])
			IF !llResult
	            =MESSAGEBOX('Îøèáêà ïðè ñîõðàíåíèè íà ñåðâåðå [rv_JurnalUseEdit]. '+CHR(13)+'Ñîõðàíåíèå íå ïðîèçîøëî ...',0+64+4096, 'Ïðîáëåìà ëîêàëüíîé ñåòè',900)
		  thisform.CmdReload.Click()
			   RETURN .f.
			ENDIF		
		lresult = spDiscRecount(rv_ResursJrn.FrmId, rv_ResursJrn.PointIspCl,null,null)
	       REPLACE  UseStart WITH  lStart , ;
	 UseEnd   WITH  lEnd IN rv_ResursJrn
		IF MESSAGEBOX('Äîêóìåíò èçìåíåí. Ðàñïå÷àòàòü åãî?',4+32,'Ïîäãîòîâêà ê ïå÷àòè ...')=6
			this.lnbarid= key
			this._prndoc()
		ENDIF
	
ENDIF
endwith


ENDPROC
PROCEDURE barsprop
DODEFAULT()
this.VisualAppearance.Add(10,"Ebn\Bar_work.ebn")
this.VisualAppearance.Add(11,"Ebn\Bar_mone.ebn")
this.VisualAppearance.Add(12,"Ebn\Bar_green.ebn")
this.VisualAppearance.Add(13,"Ebn\Bar_red.ebn")

With this.Chart.Bars
	.Item("Task").Height = 15 &amp;&amp;18
	.Item("Task").Pattern = 1&amp;&amp;1
	.Item("Task").StartColor =  RGB(138,244,244)   &amp;&amp; - íåãàðàíòèðîâàííîå áðîíèðîâàíèå  -  îæèäàþùàÿ áðîíü
	.Item("Task").Color = RGB(138,244,244)
	.Item("Task").EndColor =  RGB(138,244,244)
	.Item("Task").StartShape = 0 &amp;&amp;17  &amp;&amp;61447  &amp;&amp; exShapeIconFrameLeft
	.Item("Task").EndShape = 0&amp;&amp; 8 &amp;&amp;61448  &amp;&amp; exShapeIconFrameRight
	*** îïðåäåëÿåì ïîðÿäîê ïîêàçà íåñêîëüêèõ áàðîâ â îäíîé ñòðîêå
	.Item("Task").OverlaidType = 515


.Copy("Task", "garTask")  &amp;&amp; - èòîãè (òåìíî-ñèíèé)
		.Item("garTask").Color =  0xa000000  &amp;&amp;0x1000000   &amp;&amp; RGB(138,244,244)
*!*			.Item("garTask").StartColor =  RGB(255,255,0)
*!*			.Item("garTask").Color =       RGB(255,255,0)
*!*			.Item("garTask").EndColor =    RGB(255,255,0)
.Copy("Task", "preTask")   &amp;&amp; - äåíüãè  (æåëòûé)
		.Item("preTask").Color =  0xb000000  &amp;&amp;0x1000000   &amp;&amp; RGB(138,244,244)
*!*			.Item("preTask").StartColor =  RGB(0,128,192)
*!*			.Item("preTask").Color =       RGB(0,128,192)
*!*			.Item("preTask").EndColor =    RGB(0,128,192)
.Copy("Task", "RedTask")  &amp;&amp;  - îòðèöàòåëüíûé èòîã êðàñíûé
		.Item("RedTask").Color = 0xd000000  &amp;&amp;0x1000000   &amp;&amp; RGB(138,244,244)
*!*			.Item("RedTask").StartColor =  RGB(255,0,0)
*!*			.Item("RedTask").Color =		RGB(255,0,0)
*!*			.Item("RedTask").EndColor =  	RGB(255,0,0)
.Copy("Task", "GreenTask")  &amp;&amp;  - ïîëîæèòåëüíûé èòîã òåìíî-çåëåíûé
		.Item("GreenTask").Color = 0xc000000  &amp;&amp;0x1000000   &amp;&amp; RGB(138,244,244)
*!*			.Item("GreenTask").StartColor =  RGB(0,255,64)
*!*			.Item("GreenTask").Color = RGB(0,255,64)
*!*			.Item("GreenTask").EndColor =  RGB(0,255,64)
.Copy("Task", "LiveTask")  &amp;&amp;  - ïðîæèâàíèå  (LiveTask) òåìíî-çåëåíûé
		.Item("LiveTask").StartColor =  RGB(0,255,64)
		.Item("LiveTask").Color = RGB(0,255,64)
		.Item("LiveTask").EndColor =  RGB(0,255,64)
.Copy("Task", "errTask")  &amp;&amp;  - ïðîæèâàíèå  (LiveTask) îðàíüæåâûé
		.Item("errTask").StartColor =  RGB(255,128,0)
		.Item("errTask").Color = RGB(255,128,0)
		.Item("errTask").EndColor =  RGB(255,128,0)

		.Item("Task").HistogramPattern = 32
		.Item("Task").HistogramColor = RGB(138,244,244)
		.Item("preTask").HistogramPattern = 32
		.Item("preTask").HistogramColor =       RGB(255,255,0)
		.Item("garTask").HistogramPattern = 32
		.Item("garTask").HistogramColor =       RGB(0,0,255)
		.Item("LiveTask").HistogramPattern = 1
		.Item("LiveTask").HistogramColor = RGB(0,255,0)
		.Item("errTask").HistogramPattern = 32
		.Item("errTask").HistogramColor = RGB(255,0,0)
		.Item("GreenTask").HistogramPattern = 32
		.Item("GreenTask").HistogramColor = RGB(255,0,0)
		.Item("RedTask").HistogramPattern = 32
		.Item("RedTask").HistogramColor = RGB(255,0,0)

		.Item("Task").OverlaidGroup = "preTask,garTask,LiveTask,errTask,GreenTask,RedTask"
		.Item("preTask").OverlaidGroup = "Task,garTask,LiveTask,errTask,GreenTask,RedTask"
		.Item("garTask").OverlaidGroup = "Task,preTask,LiveTask,errTask,GreenTask,RedTask"
		.Item("errTask").OverlaidGroup = "Task,preTask,garTask,LiveTask,GreenTask,RedTask"
		.Item("LiveTask").OverlaidGroup = "Task,preTask,garTask,errTask,GreenTask,RedTask"
		.Item("GreenTask").OverlaidGroup = "RedTask"
		.Item("RedTask").OverlaidGroup = "GreenTask"

*!*			.Add('preTask%PRed')
*!*			.Add('garTask%PRed')
*!*			.Add('LiveTask%PRed')
*!*			.Add('Task%PRed')
*!*			.Add('errTask%PRed')
*!*			.Add('GreenTask%PRed')
*!*			.Add('RedTask%PRed')
ENDWITH


ENDPROC
PROCEDURE Click
*** ActiveX Control Event ***
With this
	local h, c, hit, llResult
.lnitemid = .ItemFromPoint(-1, -1, c, hit)
If (.lnitemid  # 0)
.lnbarid = .Chart.BarFromPoint(-1, -1)
If Empty(NVL(.lnbarid,0))
RETURN .f.
EndIf
EndIf
ENDWITH

ENDPROC
PROCEDURE CreateBar
*** ActiveX Control Event ***
LPARAMETERS item, datestart, dateend
RETURN
LOCAL lPartFrmId ,newBar,llResult
IF dateend-datestart&lt;150
RETURN
ENDIF
IF thisform.tOgrDate &gt; dateend OR thisform.tOgrDate &gt; datestart
	MESSAGEBOX('Æåëàåìàÿ äàòà íàõîäèòñÿ â çàêðûòîì ïåðèîäå.',0+32,'Âíåñåíèå èçìåíåíèé çàïðåùåíî ...')
	RETURN
ENDIF
*IF (HOUR(datestart)=14 AND HOUR(dateend)=12) OR MESSAGEBOX('Ïðèâîäèòü âðåìÿ çàñåëåíèÿ ê 14 ÷àñàì,'+CHR(13)+;
*			  ' à âðåìÿ ñäà÷è ê 12 ÷àñàì?',4+32+256,'Êîððåêòèðîâêà âðåìåíè çàåçäà-âûåçäà')=6
IF this.chart.UnitScale =&lt; 4096
	DO CASE
		CASE this.lCopy
		CASE this.nTypeTime = 0 &amp;&amp; C 12 äî 12
			datestart = CTOT(DTOC(datestart)+ ' 12:00:00')
			dateend   = CTOT(DTOC(dateend)  + ' 12:00:00')
		CASE this.nTypeTime = 1 &amp;&amp; C 14 äî 12
			datestart = CTOT(DTOC(datestart)+ ' 14:00:00')
			dateend   = CTOT(DTOC(dateend)  + ' 12:00:00')
		CASE this.nTypeTime = 2 &amp;&amp; C òåêóùåãî ÷àñà äî òåêóùåãî ÷àñà
			dateend   = CTOT(DTOC(dateend)  + ' '+TTOC(datestart,2))
	ENDCASE
ENDIF
*ENDIF
IF (datestart &lt;DATETIME() AND MESSAGEBOX('Íà÷àëî ïðîæèâàíèÿ â ïðîøåäøåì ïåðèîäå.'+CHR(13)+'Äîáàâëÿòü ïðîæèâàíèå?',4+32+256,'Èçìåíåíèå äàííûõ î ïðîæèâàíèè ...')=7)
	RETURN .f.
ENDIF

PUBLIC barCltName,nFrmStatusI,pPointIspCltID,dStart,dEnd,nitem
with this
	barCltName =''
	lPartFrmId = ._add(item, datestart, dateend)
	datestart = dStart
	dateend   = dEnd
	IF lPartFrmId &gt;0	
	    .BeginUpdate()
		with .Items
			.AddBar( nitem, this.namebar(nFrmStatusI,.f.), datestart, dateend,this.lnbarid, ALLTRIM(barCltName) )
		    stringWk = "Items.ItemBar("+ALLTRIM(STR(nitem,16,0))+" , "+ ALLTRIM(STR(lPartFrmId,10,0))+" , 6) = `" +  "Çàñåëåíèå:"+ TTOC(datestart)+ ;
		    																			  "      Âûåçä:        "+ TTOC(dateend)+"`"    &amp;&amp; exBarToolTip
		    This.ExecuteTemplate(stringWk)
	 	ENDWITH
	    .EndUpdate
		spDiscRecount(lPartFrmId ,pPointIspCltID,null,null)
		IF MESSAGEBOX('Äîêóìåíò äîáàâëåí. Äîïîëíèòü åãî?',4+32,'Âíåñåíèå äîïîëíèòåëüíîé èíôîðìàöèè ...')=6
			._edit()
		ENDIF
		IF MESSAGEBOX('Äîêóìåíò äîáàâëåí. Ðàñïå÷àòàòü åãî?',4+32,'Ïîäãîòîâêà ê ïå÷àòè ...')=6
			._prndoc()
		ENDIF
	ENDIF
ENDWITH
RELEASE barCltName,typeNewFrm,pPointIspCltID,dStart,dEnd

ENDPROC
PROCEDURE DblClick
*** ActiveX Control Event ***
LPARAMETERS shift, x, y

With this
	local h, c, hit, llResult,lTvrId
.lnitemid = .ItemFromPoint(-1, -1, c, hit)
If (.lnitemid  # 0)
.lnbarid = .Chart.BarFromPoint(-1, -1)
If Empty(NVL(.lnbarid,0))
*** Êëèêè íà ïàíåëè ñëåâà
				SELECT rv_ResursLst
				LOCATE ALL FOR BarId = .lnitemid
				lTvrId = rv_ResursLst.TvrId
				IF !FOUND()
		          				lTvrId = null
				ENDIF
		           IF !ISNULL(lTvrId) AND MESSAGEBOX('Ïðîøëà óáîðêà ýòîãî íîìåðà?',4+64,'Îòìå÷àåì óáîðêó íîìåðà ...')=6
						SET DATABASE TO Basis
						llResult = ClearNumber(lTvrId , DATETIME())
						IF llResult
							replace rv_ResursLst.clearnum WITH 0 NEXT 1 IN rv_ResursLst
							this.Items.CellValue(.lnitemid,0) = ALLTRIM(rv_ResursLst.TvrNm)
							WAIT WINDOW 'Îòìåòêà îá óáîðêå íîìåðà ñäåëàíà ...' TIMEOUT .7
						ENDIF
		           ENDIF
RETURN .f.
EndIf
EndIf
*** Êëèêè íà ïàíåëè ñïðàâà
ENDWITH
DODEFAULT()
ENDPROC
PROCEDURE Init
WAIT WINDOW 'Ãîòîâèì äàííûå ê ðàáîòå ...' NOWAIT
DODEFAULT()
LOCAL s
WITH this
.BeginUpdate()
.SingleSel = .F.
.Enabled = .f.
.DefaultItemHeight = 15 &amp;&amp;22
.Chart.AllowLinkBars =0
.Chart.PaneWidth(0) = 180
.Chart.AllowLinkBars= .T.
.Chart.ShowLinks= .T.

.BackColor= RGB(232,233,236)
.Chart.SelBackColor = RGB(210,210,210)    &amp;&amp;205,211,216)
*!*			.Chart.BackColor = 16777215
*!*			.Chart.SelBackColor = 16119285
** çàïðåùàåì èçìåíÿòü ðàçìåðû áàðîâ
.Chart.BarsAllowSizing = .f.
.Timescale()
.EndUpdate()
.Enabled = .t.
ENDWITH
WAIT CLEAR

** ñîçäàòü áàð÷èêè:
*!*		   - íåãàðàíòèðîâàííîå áðîíèðîâàíèå  -  îæèäàþùàÿ áðîíü  (Task) 28
*!*		   - íåãàðàíòèðîâàííîå áðîíèðîâàíèå (ðàçìåùåííàÿ) (preTask)     29
*!*		   - ãàðàíòèðîâàííîå áðîíèðîâàíèå (ðàçìåùåííàÿ)    (garTask)   30 (èëè 22)
*!*		   - ïðîæèâàíèå  (LiveTask) (äîêóìåíò - ñ÷åò ãîñòÿ)             22

*!*		   - îáñëóæèâàíèå â íîìåðå
*!*		   - äîáàâëåíèå ÷åðåç ðåñóðñ "Ïîèñê ñâîáîäíîãî"
ENDPROC
PROCEDURE loaddata
this.LoadDataDoc
RETURN

LOCAL lcUniqueName,lcUniqueFilePath,dStartDate,dEndDate, lnCountRec , Lfirst
LOCAL ARRAY items(1,2)
LOCAL lnDefItem, lnDefParId, lnDefTvrId,lnDefResursId,lnBarId ,lnBarId, stringWk, nRecResursLst, nTvrParId ,nTotal,nTotalItem
this.linload=.t.
* Çàãðóæàåì òàáëèöó ñ äàííûìè
lcUniqueName  = spGetProjectList(thisform.nFrmId,0,1,thisform.cZoom) &amp;&amp; dd ww

* Òàáëèöà äëÿ äèàãðàììû
USE IN SELECT('rv_ResursLst')
USE (lcUniqueName) IN 0 ALIAS rv_ResursLst
SELECT rv_ResursLst
brow
CALCULATE MIN(rv_ResursLst.UseStart) TO dStartDate
CALCULATE MAX(rv_ResursLst.UseEnd) TO dEndDate
SELECT rv_ResursLst
lnCountRec  = RECCOUNT()
GO TOP
*SELECT DISTINCT FrmTypeID,FrmTypeNM,FrmTypeShortNM FROM rv_ResursLst INTO CURSOR tmpFrmType
this.Chart.FirstVisibleDate = dStartDate-1
SET DATE GERMAN
this.BeginUpdate()
nTotal = 0
LOCAL lnFrmId
lnFrmId = 0
WITH this.Items
STORE -99999 TO lnFrmTypeId ,lnDefParId ,lnDefResursId ,lnBarId
SCAN
		
		   IF rv_ResursLst.FrmTypeId &lt;&gt; lnFrmTypeId &amp;&amp;OR (rv_ResursLst.FrmTypeId=lnFrmTypeId AND rv_ResursLst.FrmId &lt;&gt; lnFrmId)
				Lfirst = .t.	
			   	IF lnFrmTypeId &lt;&gt; -99999
			   	.ExpandItem(lnDefParId) = .T.
			   	ENDIF
			   	lnFrmTypeId = rv_ResursLst.FrmTypeId
			   	lnFrmId =  rv_ResursLst.FrmId
			   	IF !INLIST(rv_ResursLst.FrmTypeId,-1, 8)
				   	lnDefParId  = .AddItem(ALLTRIM(rv_ResursLst.FrmTypeNM))
					.ItemFont(lnDefParId) = this.oItemFont
		 		   this.Font = this.oBarFont
				   	.AddBar(lnDefParId  , 'Project Summary',TTOC(dStartDate),TTOC(dEndDate))
			   	ENDIF
		   ENDIF
		  * SET STEP ON
		   this.Font = this.oItemFont
	       IF INLIST(rv_ResursLst.FrmTypeId,-1, 8) AND Lfirst
			        .DefaultItem = .InsertItem( , "", IIF(rv_ResursLst.FrmTypeId= 8,'Ïîñòóïëåíèÿ äåíåã',ALLTRIM(rv_ResursLst.TvrNm)))
					.ItemFont(.DefaultItem) = this.oItemFont
					Lfirst = .f.
					IF 	rv_ResursLst.FrmTypeId = -1
			        nTotalItem = .InsertItem( , "", "Îáùèé")
					.ItemFont(nTotalItem) = this.oItemFont
					ENDIF
	       ENDIF
		   this.Font = this.oBarFont
	       IF !INLIST(rv_ResursLst.FrmTypeId,-1, 8)
		        .DefaultItem = .InsertItem( lnDefParId , "", ALLTRIM(rv_ResursLst.TvrNm))
				.ItemFont(.DefaultItem) = this.oPodItemFont
		        lnDefItem = .DefaultItem
	 		   this.Font.Bold = .f.
			   .AddBar(.DefaultItem , this.namebar(rv_ResursLst.FrmTypeId,.F.) , TTOC(rv_ResursLst.UseStart),;
	    					TTOC(rv_ResursLst.UseEnd+1),rv_ResursLst.JrnUseId,STR(rv_ResursLst.TvrSumSale))
	    	   IF !ISNULL(rv_ResursLst.JrnUseId)
			   	.DefineSummaryBars(lnDefParId ,"",rv_ResursLst.JrnUseId,"") &amp;&amp; .DefaultItem
			   ENDIF
	   		ELSE
				IF rv_ResursLst.FrmTypeId = -1
					.AddBar(.DefaultItem , this.namebar(IIF(rv_ResursLst.TvrSumSale&gt;0,0,-1),.F.) , TTOC(rv_ResursLst.UseStart),;
				    					TTOC(rv_ResursLst.UseEnd+1),RECNO(),STR(rv_ResursLst.TvrSumSale))
	    		 ELSE
				    .AddBar(.DefaultItem , this.namebar(rv_ResursLst.FrmTypeId,.F.) , TTOC(rv_ResursLst.UseStart),;
	    					TTOC(rv_ResursLst.UseEnd+1),RECNO(),STR(rv_ResursLst.TvrSumSale))
	    		ENDIF
				IF rv_ResursLst.FrmTypeId =-1
				   nTotal = rv_ResursLst.TvrSumSale + nTotal
				   .AddBar(nTotalItem , this.namebar(IIF(nTotal&gt;0,0,-1),.F.) , TTOC(rv_ResursLst.UseStart),;
	    					TTOC(rv_ResursLst.UseEnd+1),RECNO()+10,STR(nTotal))
				ENDIF
	       ENDIF
		   REPLACE ItemId WITH .DefaultItem NEXT 1 IN rv_ResursLst
ENDSCAN
	IF lnFrmTypeId &lt;&gt; -99999
	.ExpandItem(lnDefParId) = .T.
	ENDIF
ENDWITH
this.Font = this.oDefFont

RETURN


ENDPROC
PROCEDURE loaddatadoc
*!*	thisform.LoadData1()
*!*	RETURN
this.ScrollBySingleLine = .T.		&amp;&amp; ðàçðåøàåì èçìåíåíèå âûñîòû ñòðîêè
LOCAL lcUniqueName,lcUniqueFilePath,dStartDate,dEndDate, lnCountRec , Lfirst
LOCAL ARRAY items(1,2)
LOCAL lnDefItem, lnDefParId, lnDefTvrId,lnDefResursId,lnBarId ,lnBarId, stringWk, nRecResursLst, nTvrParId ,nTotal,nTotalItem
this.linload=.t.
* Çàãðóæàåì òàáëèöó ñ äàííûìè
lcUniqueName  = spGetProjectList(thisform.nFrmId,1,1,thisform.cZoom) &amp;&amp; dd wwscr

* Òàáëèöà äëÿ äèàãðàììû
USE IN SELECT('rv_ResursLst')

USE (lcUniqueName) IN 0 ALIAS rv_ResursLst
SELECT rv_ResursLst

CALCULATE MIN(rv_ResursLst.UseStart) TO dStartDate
CALCULATE MAX(rv_ResursLst.UseEnd) TO dEndDate
SELECT rv_ResursLst
lnCountRec  = RECCOUNT()
GO TOP
*SELECT DISTINCT FrmTypeID,FrmTypeNM,FrmTypeShortNM FROM rv_ResursLst INTO CURSOR tmpFrmType
this.Chart.FirstVisibleDate = dStartDate-1
SET DATE GERMAN
this.BeginUpdate()
nTotal = 0
LOCAL lnFrmTypeId ,lnDefParId ,lnDefResursId ,lnBarId,lnFrmId ,nMainPar,nTotalItem
lnFrmId = 0

WITH this.Items
STORE -99999 TO lnFrmTypeId ,lnDefParId ,lnDefResursId ,lnBarId,lnFrmId ,nMainPar,nTotalItem
SCAN ALL FOR !ISNULL(rv_ResursLst.UseStart) OR  !ISNULL(rv_ResursLst.UseEnd)
		   **** äîáàâëÿåì ñòðîêó ñ äîãîâîðîì èëè èòîãàìè
		   **** äîáàâëÿåì â ñóùåñòâóþùóþ ñòðîêó äîãîâîðà ïîäèòîãè, ïîñòóïëåíèÿ è îòãðóçêè
		
		   **IF rv_ResursLst.FrmTypeId &lt;&gt; lnFrmTypeId OR (rv_ResursLst.FrmTypeId=lnFrmTypeId AND rv_ResursLst.FrmId &lt;&gt; lnFrmId)
		   IF rv_ResursLst.FrmId &lt;&gt; lnFrmId OR  ISNULL(rv_ResursLst.FrmId) &amp;&amp; OR (rv_ResursLst.FrmTypeId=lnFrmTypeId AND rv_ResursLst.FrmId &lt;&gt; lnFrmId)
				Lfirst = .t.	
			   	IF NVL(rv_ResursLst.FrmId,0)  = 0
					   	nMainPar = .AddItem('Èòîãî ïî âñåì äîãîâîðàì')
					   	lnDefParId   = nMainPar
				   	ELSE
					   	lnDefParId   = .AddItem(ALLTRIM(rv_ResursLst.FrmTypeNM))
					   	**lnDefParId  = .InsertItem( nMainPar, "",ALLTRIM(rv_ResursLst.FrmTypeNM))
			   	ENDIF
			   	nTotalItem = lnDefParId
			   	nTotal = 0
			   	.DefaultItem = lnDefParId
				.ItemFont(lnDefParId) = this.oItemFont
	 		    this.Font = this.oBarFont
		   ENDIF
		
		   this.Font = this.oBarFont
	       IF rv_ResursLst.FrmTypeId &lt;&gt; lnFrmTypeId
			       .DefaultItem = .InsertItem( lnDefParId , "", ALLTRIM(rv_ResursLst.TvrNm))
				   .ItemFont(.DefaultItem) = this.oPodItemFont
	       ENDIF
		   this.Font.Bold = .f.
			       lnDefItem = .DefaultItem
		   IF rv_ResursLst.FrmTypeId = -1
					.AddBar(lnDefItem , this.namebar(IIF(rv_ResursLst.TvrSumSale&gt;0,0,-1),.F.) , rv_ResursLst.UseStart,;
				    					rv_ResursLst.UseEnd+1,RECNO(),ALLTRIM(TRANSFORM(rv_ResursLst.TvrSumSale,'999 999 999 999 999')))
				*	.AddBar(lnDefItem , this.namebar(IIF(-1*rv_ResursLst.TvrSumSale&gt;0,0,-1),.F.) , TTOC(rv_ResursLst.UseStart),;
				    					TTOC(rv_ResursLst.UseEnd+1),RECNO()*-1,ALLTRIM(TRANSFORM(-1*rv_ResursLst.TvrSumSale,'999 999 999 999 999')))
	    		 ELSE
				    .AddBar(lnDefItem , this.namebar(rv_ResursLst.FrmTypeId,.F.) , rv_ResursLst.UseStart,;
	    					rv_ResursLst.UseEnd+1,RECNO(),ALLTRIM(TRANSFORM(rv_ResursLst.TvrSumSale,'999 999 999 999 999')))
				 *   .AddBar(lnDefItem , this.namebar(rv_ResursLst.FrmTypeId,.F.) , TTOC(rv_ResursLst.UseStart),;
	    					TTOC(rv_ResursLst.UseEnd+1),RECNO()*-1,ALLTRIM(TRANSFORM(-1*rv_ResursLst.TvrSumSale,'999 999 999 999 999')))
	   ENDIF
		   IF rv_ResursLst.FrmTypeId =-1 AND nTotalItem &lt;&gt; -99999
			   nTotal = rv_ResursLst.TvrSumSale + nTotal
			   .AddBar(nTotalItem , this.namebar(IIF(nTotal&gt;0,0,-1),.F.) , rv_ResursLst.UseStart,;
					rv_ResursLst.UseEnd+1,RECNO()+10,ALLTRIM(TRANSFORM(nTotal,'999 999 999 999 999')))
			 *  .AddBar(nTotalItem , this.namebar(IIF(-1*nTotal&gt;0,0,-1),.F.) , TTOC(rv_ResursLst.UseStart),;
					TTOC(rv_ResursLst.UseEnd+1),(RECNO()+10)*-1,ALLTRIM(TRANSFORM(-1*nTotal,'999 999 999 999 999')))
		   ENDIF
		   REPLACE ItemId WITH .DefaultItem NEXT 1 IN rv_ResursLst
			   	lnFrmTypeId = rv_ResursLst.FrmTypeId
			   	lnFrmId =  rv_ResursLst.FrmId
ENDSCAN
	IF lnFrmTypeId &lt;&gt; -99999
	.ExpandItem(lnDefParId) = .T.
	ENDIF
ENDWITH
this.Font = this.oDefFont
this.endUpdate()
this.SaveXML('gantt_fin.xml')
RETURN


ENDPROC
PROCEDURE MouseDown
*** ActiveX Control Event ***
LPARAMETERS button, shift, x, y

With this
	local h, c, hit, llResult
.lnitemidu = .ItemFromPoint(-1, -1, c, hit)
If (.lnitemidu # 0)
.lnbaridu = .Chart.BarFromPoint(-1, -1)
If Empty(NVL(.lnbaridu,0))
RETURN .f.
EndIf
EndIf
ENDWITH


DODEFAULT(button, shift, x, y)

ENDPROC
PROCEDURE MouseUp
*** ActiveX Control Event ***
LPARAMETERS button, shift, x, y
RETURN
With this
	local h, c, hit, llResult ,nDefCltTmp
.lnitemid = .ItemFromPoint(-1, -1, c, hit)
If (.lnitemid # 0)
.lnbarid = .Chart.BarFromPoint(-1, -1)
*** thisform.wkStile.optCopy.Value=1 AND
		IF ISNULL(.lnbarid) AND !ISNULL(.lnbaridu) ;
			AND (.lnitemid&lt;&gt;.lnitemidu) ;
			AND MESSAGEBOX('Ñêîïèðîâàòü áðîíü?',4+0+32,'Êîïîâàíèå äîêóìåíòîâ') = 6
		     SELECT rv_ResursJrn
		     LOCATE FOR rv_ResursJrn.BarId = .lnbaridu
		     IF !FOUND()
		     	RETURN .f.
		     ENDIF
		     lStart = NVL(rv_ResursJrn.UseStart ,{})
		     lEnd   = NVL(rv_ResursJrn.UseEnd,{})
		    .lCopy=.t.
		    nDefCltTmo = thisform.nDefClt
		    thisform.nDefClt = rv_ResursJrn.PointIspCl
			.createBar(.lnitemid,lStart ,lEnd   )
		    thisform.nDefClt = nDefCltTmo
			.lCopy=.f.
		ENDIF
If Empty(NVL(.lnbarid,0))
RETURN .f.
EndIf
EndIf
ENDWITH


DODEFAULT(button, shift, x, y)

ENDPROC
PROCEDURE namebar
LPARAMETERS lnFrmTypeId,llFrmIsPayed
** StartDate, EndDate, ControlDate
cntPar =  PCOUNT()
IF cntPar &lt;2
llFrmIsPayed = .f.
ENDIF
LOCAL lcNameBar
	DO CASE
	   CASE lnFrmTypeId = 3	&amp;&amp; - ìàòåðèàëû
	       lcNameBar = 'Task'
	   CASE lnFrmTypeId = 2	&amp;&amp; - ìàòåðèàëû
	       lcNameBar = 'garTask'
	   CASE lnFrmTypeId = 15	&amp;&amp; - ðàáîòû
	       lcNameBar = 'garTask'
	   CASE lnFrmTypeId = 8	&amp;&amp; - äåíüãè
	       lcNameBar = 'preTask'
	       llFrmIsPayed = .t.

	   CASE lnFrmTypeId = 0	OR lnFrmTypeId = -11 &amp;&amp; - ïîëîæèòåëüíûé ðåçóëüòàò - çåëåíûé
	       lcNameBar = 'GreenTask'
	       llFrmIsPayed = .t.

	   CASE lnFrmTypeId = -1	&amp;&amp; - îòðèöàòåëüíûé ðåçóëüòàò êðàñíû
	       lcNameBar = 'RedTask'
	       llFrmIsPayed = .t.

	   OTHERWISE
	       lcNameBar = 'Task'
*	       lcNameBar = 'LiveTask'
	         ** 'PRed'   &amp;&amp;
ENDCASE
*IF llFrmIsPayed
*    lcNameBar= lcNameBar + '%PRed'	&amp;&amp; - ïðîèçâåäåíà îïëàòà     ÄÐÛÃÀÍÈÅ íà÷èíàåòñÿ áëàãîäàðÿ ýòîé ñòðîêå !!!
*ENDIF
RETURN lcNameBar
ENDPROC
PROCEDURE OverviewZoom
*** ActiveX Control Event ***
WAIT WINDOW NOWAIT 'Ïîëó÷àåì äàííûå ñ ñåðâåðà ...'
WITH This.Chart
DO CASE
	CASE .UnitScale = 256  &amp;&amp; exWeek
	   thisform.cZoom = 'ww'
	   this.nCountUnits  = 14
	   * .Zoom(.NextDate(.FirstVisibleDate,4096,-5), .NextDate(.FirstVisibleDate, 4096,25), .t.) &amp;&amp; exWeek
	CASE .UnitScale = 4096  &amp;&amp; exDay
	   thisform.cZoom = 'dd'
	   this.nCountUnits  = 24
	   * .Zoom(.NextDate(.FirstVisibleDate,4096,-2), .NextDate(.FirstVisibleDate, 4096,20), .t.) &amp;&amp; exWeek
	CASE .UnitScale = 65536  &amp;&amp; exHour
	CASE .UnitScale = 16  &amp;&amp; exMonth
	   thisform.cZoom = 'mm'
	   this.nCountUnits  = 12
	*.Zoom(.NextDate(.FirstVisibleDate,65536,-3), .NextDate(.FirstVisibleDate, 65536,12), .t.) &amp;&amp; exWeek
	OTHERWISE
	*.Zoom(.NextDate(.FirstVisibleDate,4096,-2), .NextDate(.FirstVisibleDate, 4096,7), .t.) &amp;&amp; exWeek
ENDCASE
.UnitWidth = .PaneWidth(1)/ this.nCountUnits  &amp;&amp;55 &amp;&amp;70
ENDWITH
thisform.ReLoader()

DODEFAULT()
WAIT CLEAR
RETURN


SELECT rv_ResursJrn
LOCATE ALL FOR rv_ResursJrn.JrnUseId = this.lnbarid
this.beginUpdate()
WITH This.Chart



	IF FOUND() AND !EMPTY(rv_ResursJrn.UseStart)
		.FirstVisibleDate = rv_ResursJrn.UseStart-60*60
		ELSE
		.FirstVisibleDate = DATE()-2
	ENDIF
*WAIT WINDOW this.Chart.UnitScale
**** 256 - íåäåëè, 4096 - äíè, 65536 - ÷àñû

DO CASE
	CASE .UnitScale = 256  &amp;&amp; exWeek
	    .Zoom(.NextDate(.FirstVisibleDate,4096,-5), .NextDate(.FirstVisibleDate, 4096,25), .t.) &amp;&amp; exWeek
	CASE .UnitScale = 4096  &amp;&amp; exDay
	    .Zoom(.NextDate(.FirstVisibleDate,4096,-2), .NextDate(.FirstVisibleDate, 4096,20), .t.) &amp;&amp; exWeek
	CASE .UnitScale = 65536  &amp;&amp; exHour
	.Zoom(.NextDate(.FirstVisibleDate,65536,-3), .NextDate(.FirstVisibleDate, 65536,12), .t.) &amp;&amp; exWeek
	OTHERWISE
	.Zoom(.NextDate(.FirstVisibleDate,4096,-2), .NextDate(.FirstVisibleDate, 4096,7), .t.) &amp;&amp; exWeek
ENDCASE
	.UnitWidth = .PaneWidth(1)/ this.nCountUnits  &amp;&amp;55 &amp;&amp;70
ENDWITH
DODEFAULT()
this.EndUpdate()
RETURN


ENDPROC
PROCEDURE timescale
DODEFAULT()
LOCAL s
WITH this
.BeginUpdate
.SingleSel = .F.
s = "gBJJgBAIDAAGAAEAAQhYAf8Pf4hh0QihCJo2AEZjQAjEZFEaIEaEEaAIAkcbk0olUrlktl0vmExmUzmk1m03nE5nU7nk9n0/oFBoVDolFo1HpFJpVLplNp1PqFRqVTq"
s=s+"lVq1XrFZrVbrldr1fsFhsVjslls1ntFptVrtltt1vuFxuVzul1u13vF5vV7vl9v1BAmBhOCwMKwuDw2ExWJxmIx2HyGLx+SyONyuTy2UzWZzmYz2X0Gbx1kUigUAAMwzG"
s=s+"eo1Ws1ZV2Go1IAL+1ACZMxm2+52W63Ov2Op1fC13F0un4nJ1vE2BV2XD2e/4vK4fL63V1bMTKZ5/d2pf3vh6Xj2ff3e63G683S5vF0mmAD4+Xx+bA+wAeP5/H6a/9+h8P2"
s=s+"eIAGZAiHHYZkDQQ7TuH/Ap4GUUzjPgiCJn+AD7GBAMNQJBD8wFDwAFlEUExJBaHQdCDixM+UARYABuxg/8ZQ5DUQRpEEbQKf8DxPBDiPe08KRdDEZHVIwANU1YRSWAALSdJ"
s=s+"snxpHcFO3HsrOI48Ky1IkKQpERZAA9sjHVC77ynEsqwbBE1RVNKHgAQ04yQ1skvDOJDRkZc9ABJYRT5Jk+z/P0pR49sgQHAsaUVApx0aAD+mvOclSZIkYG7MsMxNTUqyw+F"
s=s+"FwVRNQwRSwACFUwADvVNHv9IlNu5V02u5UjzVMIUQxHMYABzXdUVVRpxgBXM60DX9MQHTjWrJE0uzfGkXRdXNa0FYMjxBM8vxJM7iWXN8KSlbs31zWlT1Ja0eWxM9tNbbkL"
s=s+"UhY1mQtaU62hI9hyZUl0x5H6x3ZLVvwtekyWlYlHXNBF0R5dTszdC1vR1cELVJO9JABLODVvMF8x9deGS1fE3yJXYc4pgOKUDfGE31ZN+Srd13U/VdI1y9uCWBPRl2NE1sW"
s=s+"xbeWv9l2f6DSNSXdkTaNtd1WyrncR567mgaHGJLanMLY2laVc2FOjW1JpTuX2sV0YhmMtQpXLct1msZRBLmU421exYbN93XgAFixA9s61ztkzbc4u47LHmb6O8ExSPs0j6N"
s=s+"Otyv1hSy8BCm6bHs7eUDXMXb5DOLuJyG5v9CjzWLCkszrqZLS2+/NtbwEQdFN9sPbLPEYFU/Fxj1TV2U7WyahslSdM8O9SPGkieK+8iW33fe1JXNUjvqrnWlo1A2lUnieO+"
s=s+"/k1lGMs7RjDwvNiciedUtT6Nd3B+RlaxQJBmx8luULWLLPqxjZ769S/UQe1svPUi6M+D5DzN5a2athyHX9H6f43VIjE3yMTbqrlbB5l3OYgU+ssL7X+rtc+2Nj7AD5vwRkk"
s=s+"SCyAoFvvg6/FaiZIIuHbGv9DRxEuQeRjC2FkKH/pvRcs4+b+4MFgH+mmISDIhrHN0dqI5uIjRLGYbOJp2YnRRihAaIsQYiRXIdFVKsSImRKiegOKUYIpxZiwg2MsWokxpjF"
s=s+"Gs7UY4vxvNmWSKwAEHoRjrHRFMZkToMd3HqOcf4lRBN1IKLMg4vGzjnHeRUeY+yNj5GeIkhpJSFkpF+RKKZFoRj9I6PcZJKSElBIGUUR44ljkBJCT0gI1RclZIeN0YZLRal"
s=s+"RKqLsq5XRslhIiWUqY0S1l9HCV8YyyEWB8SuYpHiQEiJIAAkpKJmk4QoX8pJFE3zSKCQEA="
.Images(s)
s="gBJJgBAICAAGAAEAAQhYAf8Pf4hh0QihCJo2AEZjQAjEZFEaIEaEEaAIAkcbk0olUrlktl0vmExmUzmk1m03nE5nU7nk9n0/oFBoVDolFo1HpFJpVLplNp1PqFRqVTqlVq1XrF"
s=s+"ZrVbrldr1fsFhsVjslls1ntFptVrtltt1vuFxuVzul1u13vF5vV7vl9v1/wGBwWDwmFw2HxGJxWLxmNx2PyGRyWTymVy2XzGZzWbzmdz2f0Gh0WjwEWH0r08ekEikgAkso184iG"
s=s+"kicPjcU2+zjW43e6jO8jL+b79X8bfif48bfAffgP43IT8b4XE3O23vW3++2r/6vcjUB"
.Images(s)

**'Uncomment it if you are running Windows XP
** .BackColorHeader = 33554432
WITH .Chart
.LevelCount = 2
** Çäåñü ìû îòêðûâàåì èëè çàêðûâàåì èêîíêè Zoom
		.Label(0) = ""  &amp;&amp; exYear
		.Label(1) = ""  &amp;&amp; exHalfYear
		.Label(2) = ""  &amp;&amp; exQuarterYear
*		.Label(16) = ""  &amp;&amp; exMonth
		.Label(17) = ""  &amp;&amp; exThirdMonth
*		.Label(256) = ""  &amp;&amp; exWeek
*		.Label(4096  ) = ""  &amp;&amp; exDay
		.Label(65536  ) = ""  &amp;&amp; exHour
		.Label(1048576) = ""  &amp;&amp; exMinute
		.Label(16777216) = ""  &amp;&amp; exSecond
		.Level(1).DrawGridLines = .t.
*	.OverviewZoomCaption =    "Year|1\2Year|1\4Year|&lt;img&gt;11&lt;/img&gt;|Third|&lt;img&gt;11&lt;/img&gt;|&lt;img&gt;10&lt;/img&gt;|&lt;img&gt;9&lt;/img&gt;|Min|Sec"
*	.OverviewZoomCaption =    "Ãîä|Ïîëóãîäèå|Êâàðòàë|Ìåñÿö|Äåñÿòêà|Íåäåëÿ|Äåíü|×àñ|Ìèí|Ñåê"
	.OverviewZoomCaption =    "Year|1\2Year|1\4Year|&lt;img&gt;11&lt;/img&gt;||&lt;img&gt;10&lt;/img&gt;|&lt;img&gt;9&lt;/img&gt;||Min|Sec"
	.LabelToolTip(4096) = "&lt;%dd%&gt; &lt;%m3%&gt;"
	.LabelToolTip(65536) = "&lt;%hh%&gt;:&lt;%nn%&gt; &lt;%dd%&gt; &lt;%m3%&gt;"
	.UnitWidth = .PaneWidth(1)/this.nCountUnits &amp;&amp;55 &amp;&amp;70
	
	.NonworkingHours = 16253183 - 524288 - 1048576 -2097152 + 256


	*.NonworkingDays = 0
	.NonworkingHoursColor = RGB(197,96,90)
	*.ShowNonworkingUnits = .F.
*.DrawDateTicker = .t.
ENDWITH
.EndUpdate
ENDWITH


ENDPROC
</methods>
		<objcode/>
		<ole>0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7////+////BQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAP7//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALCGZ9dgKM0BAwAAAMAAAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAjhQAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBAAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAQAAAAAAAAAAgAAAP7////+//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9BAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACQAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADUxMzk3OTE1AQAAgAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAABDAGwAYQBzADEfSM0lLVlHgD91LFaPU7dJTAEBAAAEAAQAEAAQAP////8hAP//////////Qk02AAAAAAAAADYAAAAoAAAAQABNH0jNJS1ZR4A/dSxWj1O3SUwBAQAABAAEABAAEAD/////IQD//////////0JNNgAAAAAAAAA2AAAAKAAAAEAAAAAQAAAAAQAgAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAGUAbAAgAEMAbABhAHMAcwAJAHsANgA1AEQANQA0ADAAQwAxAC0AOAA1ADkARQAtADQAOQBGADUALQBCADMANQBCAC0ANwAwADgAMgAxADgAMwAxAEYANwBBADcAfQAgAEMAOgBcAFcASQBOAEQATwBXAFMAXABzAHkAcwB0AGUAbQAzADIAXABiAHQAeABwAHAAYQBuAGUAbAAuAGQAbABsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE0fSM0lLVlHgD91LFaPU7dJTAEBAAAEAAQAEAAQAP////8hAP//////////Qk02AAAAAAAAADYAAAAoAAAAQAAAABAAAAABACAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEJNPgAAAAAAAAA+AAAAKAAAAEAAAAAQAAAAAQABAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAA1G8AAFI+AAAJAANS4wuRj84RneMAqgBLuFEBzAAAvAJEQgEACUFyaWFsIENZUgsA//8LAP//AwAAAAAAEwDr6+sAEwAIAACAEwAFAACAEwAIAACACwD//wMAAAAAAAMAAwAAAAMAEgAAAAMA/////wMAAAAAAAsA//8LAP//AwAAAAAACwAAAAMA/////wMA/////wMAAAAAAAMA/////wMAFgAAAAMAAAAAAAsAAAADAAAAAAALAP//EwAOAACAEwANAACAAwAAAAAAAwACAAAACwAAAAsAAAALAP//CQAAAAAAAAAAAAAAAAAAAAAAAwAwAAAAAwAAAAAAEwAxZf8AEwAPAACAEwAIAACAAwD/////EwAPAACAEwAIAACACQADUuMLkY/OEZ3jAKoAS7hRAcwAALwCREIBAAlBcmlhbCBDWVITAAAAAAALAAAACAAGAAAADQAKAAAACwD//wMAEgAAAAsA//8IAGQAAABhAGIAYwBkAGUAZgBnAGgAaQBqAGsAbABtAG4AbwBwAHEAcgBzAHQAdQB2AHcAeAB5AHoATAQ5BDIENAQwBDUENwQ6BDsEOAQ/BD4EPAREBEYEQgRLBEkEMQQ9BEMESgRBBAAACABkAAAAQQBCAEMARABFAEYARwBIAEkASgBLAEwATQBOAE8AUABRAFIAUwBUAFUAVgBXAFgAWQBaACwEGQQSBBQEEAQVBBcEGgQbBBgEHwQeBBwEJAQmBCIEKwQpBBEEHQQjBCoEIQQAAAsA//8IAAIAAAAAAAMA9AEAAAMAiBMAAAMAxAAAAAMAAwAAABMAEAAAgAsAAAAFAAAAAAAAAOA/CwAAAAsA//8TAA8AAIAJAAAAAAAAAAAAAAAAAAAAAAADADAAAAALAP//AwAAAAAACwAAAAgAAgAAAAAAEwAQAACAEwAQAACAEwAPAACAAwASAAAAAwCg////CwD//wMAAAAAAAsAAAADACjOl3wDAAAAAAALAP//CwAAAAsAAAATADFl/wADAAAAAAALAAAAAwAAAAAACAACAAAAAAADAP////8DAP////8DAP////8DAP////8LAAAACQADUuMLkY/OEZ3jAKoAS7hRAcwAAJABREIBAAlBcmlhbCBDWVILAP//AwD///8AAwAAAAAACwD//w==</ole>
		<ole2>OLEObject = C:\Windows\SysWOW64\ExG2antt.dll
</ole2>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1061511259</timestamp>
		<class>commandbutton</class>
		<classloc/>
		<baseclass>commandbutton</baseclass>
		<objname>cmdReload</objname>
		<parent>frmresfin</parent>
		<properties>Top = 605
Left = 250
Height = 25
Width = 100
Caption = "Îáíîâèò äàííûå"
ZOrderSet = 4
Name = "cmdReload"
</properties>
		<protected/>
		<methods>PROCEDURE Click
thisform.ReLoader()
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25L0SGZE5</uniqueid>
		<timestamp>1061511259</timestamp>
		<class>commandbutton</class>
		<classloc/>
		<baseclass>commandbutton</baseclass>
		<objname>cmdToday</objname>
		<parent>frmresfin</parent>
		<properties>Top = 605
Left = 352
Height = 25
Width = 78
FontBold = .T.
FontSize = 10
Caption = "Ñåãîäíÿ"
ZOrderSet = 5
Name = "cmdToday"
</properties>
		<protected/>
		<methods>PROCEDURE Click
with thisform.G2antt1
	.BeginUpdate
WITH .Chart
		IF .UnitScale =&lt; 4096
				.FirstVisibleDate = DATE()-2
			ELSE
				.FirstVisibleDate = DATETIME()-4*60*60
		ENDIF
ENDWITH
	.EndUpdate
endwith

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1084396835</timestamp>
		<class>shape</class>
		<classloc/>
		<baseclass>shape</baseclass>
		<objname>Shape1</objname>
		<parent>frmresfin</parent>
		<properties>Top = 621
Left = 433
Height = 13
Width = 85
Enabled = .F.
Visible = .F.
BackColor = 138,244,244
ZOrderSet = 6
Name = "Shape1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1084396835</timestamp>
		<class>shape</class>
		<classloc/>
		<baseclass>shape</baseclass>
		<objname>Shape2</objname>
		<parent>frmresfin</parent>
		<properties>Top = 611
Left = 453
Height = 13
Width = 85
BackColor = 0,128,192
ZOrderSet = 7
Name = "Shape2"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0OUJQ9</uniqueid>
		<timestamp>1084396835</timestamp>
		<class>shape</class>
		<classloc/>
		<baseclass>shape</baseclass>
		<objname>Shape4</objname>
		<parent>frmresfin</parent>
		<properties>Top = 611
Left = 811
Height = 13
Width = 85
BackColor = 255,255,0
ZOrderSet = 8
Name = "Shape4"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25X0QUXS4</uniqueid>
		<timestamp>1084396835</timestamp>
		<class>label</class>
		<classloc/>
		<baseclass>label</baseclass>
		<objname>Label2</objname>
		<parent>frmresfin</parent>
		<properties>AutoSize = .T.
FontSize = 8
Caption = "- èòîãè"
Enabled = .F.
Height = 16
Left = 522
Top = 618
Visible = .F.
Width = 37
ZOrderSet = 9
Name = "Label2"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25X0QUXS5</uniqueid>
		<timestamp>1084396835</timestamp>
		<class>label</class>
		<classloc/>
		<baseclass>label</baseclass>
		<objname>Label3</objname>
		<parent>frmresfin</parent>
		<properties>AutoSize = .T.
FontSize = 8
Caption = "- ðàáîòû è ìàòåðèàëû"
Height = 16
Left = 542
Top = 611
Width = 117
ZOrderSet = 10
Name = "Label3"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1084396835</timestamp>
		<class>label</class>
		<classloc/>
		<baseclass>label</baseclass>
		<objname>Label4</objname>
		<parent>frmresfin</parent>
		<properties>AutoSize = .T.
FontSize = 8
Caption = "- äåíåæíûå ñðåäñòâà"
Height = 16
Left = 900
Top = 611
Width = 113
ZOrderSet = 11
Name = "Label4"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2DL11LO1J</uniqueid>
		<timestamp>1084396835</timestamp>
		<class>label</class>
		<classloc/>
		<baseclass>label</baseclass>
		<objname>Label1</objname>
		<parent>frmresfin</parent>
		<properties>AutoSize = .T.
FontSize = 8
Caption = "- îïëàòà ïðèíÿòà"
Enabled = .F.
Height = 16
Left = 880
Top = 620
Visible = .F.
Width = 90
ZOrderSet = 12
Name = "Label1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2LT0Y9P5S</uniqueid>
		<timestamp>1084396835</timestamp>
		<class>olecontrol</class>
		<classloc/>
		<baseclass>olecontrol</baseclass>
		<objname>PrintGantt</objname>
		<parent>frmresfin</parent>
		<properties>Top = 609
Left = 1044
Height = 13
Width = 25
ZOrderSet = 13
Name = "PrintGantt"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole>0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7////+/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFANaddgKM0BAwAAAMABAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7gAAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAA4AAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAGkAAAAAAAAAAwAAAP7///8GAAAABAAAAAUAAAD+/////v////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8rDetNvW4iSpg1SKuc3ICIAAgAALkDAAC5AwAACAAsAAAAHwQ7BDAEPQQ4BEAEPgQyBDAEPQQ4BDUEIABEBDgEOAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAIAIAAAAQ2FwdGlvbgAeAAAASAAAAAAVAAAAz+vg7ejw7uLg7ejlIPTo7eDt8e7iEAAAAFBhZ2VPcmllbnQ9BDAEPQRBBD4EMgQAAAsAAAADAAEAAAADAAIAAAADAAAAAAADAAEAAAADAAIAAAAJAANS4wuRj84RneMAqgBLuFEBAQAAkAGghgEAD1RpbWVzIE5ldyBSb21hbgsA//8IAEgAAAAtADEALAAxADAAMAAsADEAMAAxACwAMQAwADIALAAtADEALAAxADAAMwAsAC0AMQAsADEAMAA0ACwALQAxACwAMQAwADUAAAAIAAIAAAAAAAgAEgAAADwAJQBhdGlvbgAJAAAASQoAAAACAAAACQAAAEFzU2NyZWVuAAUAAABMAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABhAGcAZQAlAD4AAAADAAEAAAALAP//AwAAAAAAEwAAAAAAH8wCAAAAAADAAAAAAAAARi0ANQAGAEgAAAEMAA==</ole>
		<ole2>OLEObject = C:\Windows\SysWOW64\ExPrint.dll
</ole2>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2LT0Y9P5W</uniqueid>
		<timestamp>1061585258</timestamp>
		<class>commandbutton</class>
		<classloc/>
		<baseclass>commandbutton</baseclass>
		<objname>Command1</objname>
		<parent>frmresfin</parent>
		<properties>Top = 605
Left = 3
Height = 25
Width = 73
Caption = "Íà ïå÷àòü"
ZOrderSet = 14
Name = "Command1"
</properties>
		<protected/>
		<methods>PROCEDURE Click
with thisform.PrintGantt
	** thisform.g2ANTT1.Chart.EndPrintDate
	thisform.g2ANTT1.Chart.StartPrintDate = thisform.g2ANTT1.Chart.FirstVisibleDate
	thisform.g2ANTT1.Chart.EndPrintDate   = thisform.g2ANTT1.Chart.FirstVisibleDate + 300*24*60*60

	**thisform.g2ANTT1.Chart.FirstVisibleDate
	.Caption = 'Ðàáîòû è îïëàòû ïî ñîñòîÿíèþ íà '+ TTOC(DATETIME())+ '. C '+TTOC(thisform.g2ANTT1.Chart.StartPrintDate)+' ïî '+TTOC(thisform.g2ANTT1.Chart.EndPrintDate)
	.PrintExt = thisform.G2antt1.Object
	.Preview
	thisform.g2ANTT1.Copy()
endwith
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2MN0O16AU</uniqueid>
		<timestamp>1084396835</timestamp>
		<class>shape</class>
		<classloc/>
		<baseclass>shape</baseclass>
		<objname>Shape6</objname>
		<parent>frmresfin</parent>
		<properties>Top = 621
Left = 794
Height = 13
Width = 42
Enabled = .F.
Visible = .F.
BackColor = 0,128,192
ZOrderSet = 15
Name = "Shape6"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2MN0O16AV</uniqueid>
		<timestamp>1084396835</timestamp>
		<class>shape</class>
		<classloc/>
		<baseclass>shape</baseclass>
		<objname>Shape7</objname>
		<parent>frmresfin</parent>
		<properties>Top = 621
Left = 830
Height = 13
Width = 43
Enabled = .F.
Visible = .F.
BackColor = 255,255,0
ZOrderSet = 16
Name = "Shape7"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2DL11LO1L</uniqueid>
		<timestamp>1084396835</timestamp>
		<class>shape</class>
		<classloc/>
		<baseclass>shape</baseclass>
		<objname>Shape3</objname>
		<parent>frmresfin</parent>
		<properties>Top = 626
Left = 791
Height = 3
Width = 85
BorderStyle = 0
Enabled = .F.
Visible = .F.
BackColor = 255,0,0
ZOrderSet = 17
Name = "Shape3"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>frmresfin</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
Arial, 1, 10, 6, 16, 13, 34, 3, 0
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1EA0UUAUQ</uniqueid>
		<timestamp>1123642529</timestamp>
		<class>grd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>grid</baseclass>
		<objname>grdpartfrmqms</objname>
		<parent/>
		<properties>ColumnCount = 12
HeaderHeight = 30
Height = 210
Panel = 1
RecordSource = "FrmPartFrmView"
SplitBar = .F.
Width = 1183
AllowCellSelection = .F.
nfrmid = 0
_memberdata =      295&lt;VFPData&gt;&lt;memberdata name="_exportto1c" type="method" display="_ExportTo1C"/&gt;&lt;memberdata name="_fromgarant1" display="_FromGarant1"/&gt;&lt;memberdata name="_fromgarant" display="_FromGarant"/&gt;&lt;memberdata name="_addlinkdoc" display="_addLinkDoc"/&gt;&lt;memberdata name="nfrmid" display="nFrmID"/&gt;&lt;/VFPData&gt;
_activerowhighlightexcludecolumnlist = ;1;2;
_activerowhighlight = .T.
_handledstandartmsglist = FIRST;PREV;NEXT;LAST;;ADD;EDIT;INFO;DELE;;COPY;;PRNDOC;PRNREP;MARK
_handledstandartmsgpromptlist = ;;;;;Äîáàâèòü;Ðåäàêòèðîâàòü;Ïîðÿäîê;Óäàëèòü;\-;Ñêîïèðîâàòü;\-;Ïîäãîòîâèòü äîêóìåíò;Ïîäãîòîâèòü îò÷¸ò;Ïîìåòèòü
cgrdtotal = FrmId
Name = "grdpartfrmqms"
Column1.ControlSource = ""
Column1.CurrentControl = ""
Column1.Enabled = .F.
Column1.Width = 5
Column1.Movable = .F.
Column1.Resizable = .F.
Column1.ReadOnly = .T.
Column1.DynamicBackColor = "IIF(PrimaryDocView.FrmIsPayed,RGB(255,0,0),RGB(255,0,0)"
Column1.DynamicForeColor = "IIF(PrimaryDocView.FrmIsPayed,RGB(255,0,0),RGB(255,0,0))"
Column1.Name = "Cl1"
Column2.ColumnOrder = 3
Column2.ControlSource = ""
Column2.Enabled = .F.
Column2.Width = 16
Column2.Movable = .F.
Column2.Resizable = .F.
Column2.ReadOnly = .T.
Column2.DynamicBackColor = "IIF(PrimaryDocView.StatusID=1,RGB(0,255,255),IIF(PrimaryDocView.StatusID=2,RGB(0,255,0),IIF(PrimaryDocView.StatusID=3,RGB(255,255,0),IIF(PrimaryDocView.StatusID=4,RGB(255,0,0),RGB(255,255,255)))))"
Column2.DynamicForeColor = "IIF(PrimaryDocView.StatusID=1,RGB(0,255,255),IIF(PrimaryDocView.StatusID=2,RGB(0,255,0),IIF(PrimaryDocView.StatusID=3,RGB(255,255,0),IIF(PrimaryDocView.StatusID=4,RGB(255,0,0),RGB(255,255,255)))))"
Column2.Name = "Cl2"
Column3.ColumnOrder = 2
Column3.ControlSource = "FrmPartFrmView.FTShortNM"
Column3.Width = 31
Column3.ReadOnly = .T.
Column3.DynamicBackColor = "IIF(PrimaryDocView._mark,RGB(255,125,125),RGB(255,255,255))"
Column3.Name = "ClShortNM"
Column4.ControlSource = "FrmPartFrmView.FrmDate"
Column4.ReadOnly = .T.
Column4.Name = "ClFrmDate"
Column5.ColumnOrder = 5
Column5.ControlSource = "FrmPartFrmView.FSID"
Column5.Width = 53
Column5.ReadOnly = .T.
Column5.Name = "ClFrmNum"
Column6.ColumnOrder = 8
Column6.ControlSource = "FrmPartFrmView.PemiNM"
Column6.ReadOnly = .T.
Column6.Name = "ClPemiNM"
Column7.ColumnOrder = 9
Column7.ControlSource = "FrmPartFrmView.PIspNM"
Column7.ReadOnly = .T.
Column7.Name = "ClPIspNM"
Column8.ColumnOrder = 12
Column8.ControlSource = "FrmPartFrmView.DevCltNM"
Column8.Enabled = .F.
Column8.Visible = .T.
Column8.Name = "ClDevCltNM"
Column9.ColumnOrder = 10
Column9.ControlSource = "FrmPartFrmView.FrmDateAcc"
Column9.Enabled = .F.
Column9.Visible = .T.
Column9.Name = "ClFrmDateAcc"
Column10.ColumnOrder = 11
Column10.ControlSource = "FrmPartFrmView.ExEmiCltNM"
Column10.Enabled = .F.
Column10.Visible = .T.
Column10.Name = "ClExEmiCltNM"
Column11.ColumnOrder = 6
Column11.ControlSource = "FrmPartFrmView.FrmNote"
Column11.Width = 231
Column11.Name = "ClFrmNote"
Column12.ColumnOrder = 7
Column12.ControlSource = "FrmPartFrmView.FrmReason"
Column12.Width = 344
Column12.Name = "ClFrmReason"
</properties>
		<protected/>
		<methods>PROCEDURE _add
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRIMARYDOC_V1.VCX
* Class.Module....: GRDDOCSVIEW._ADD
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Äîáàâëåíèå äîêóìåíòà.
*-------------------------------------------------------

*12.05.2004 03:25 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	luResAdding
*------------------------------------------------------------------------------
*12.05.2004 03:26 -&gt;Âûïîëíÿåì îïåðàöèþ äîáàâëåíèÿ äîêóìåíòà
luResAdding = oMgrPD.Operate([FORM],[ADD],83)
*------------------------------------------------------------------------------


*12.05.2004 03:26 -&gt;Îáðàáàòûâàåì ðåçóëüòàò äîáàâëåíèÿ
IF TYPE([luResAdding])==[N] AND !EMPTY(luResAdding)
	*** ïðèâÿçûâàåì ñòàäèþ ê ïðîöåññó
	USE IN SELECT([lvFrmPartFrmEdit])
	USE lvFrmPartFrmEdit IN 0 NODATA
	   INSERT INTO lvFrmPartFrmEdit ;
	         (FrmId,;
	          cntFrmID,;
	          cntFrmincludeSum,;
	          CntFrmIncludeSumVAT,;
	          cntfrmsumsplitprocid) ;
	       VALUES ;
	         (PrimaryDocView.FrmID,;
	          luResAdding ,;
	          0,;
	          0 ,;
	          1 )
		llResult = TABLEUPDATE(1,.T.,[lvFrmPartFrmEdit])
	USE IN SELECT([lvFrmPartFrmEdit])

	*22.12.2004 15:16 -&gt;Îáíîâëÿåì çàïèñü
	This._RSRequeryOne(luResAdding)
	*------------------------------------------------------------------------------

ENDIF
*------------------------------------------------------------------------------

************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE _addchilddoc
LPARAMETERS nParFrmid,nChildFrmId
IF !DBUSED([BASIS])
	OPEN DATABASE BASIS
ENDIF
SET DATABASE TO BASIS
*------------------------------------------------------------------------------

*15.07.2004 02:29 -&gt;Îòêðîåì LV äëÿ ðåäàêòèðîâàíèÿ ñîäåðæàíèÿ äîêóìåíòà (ñóììîâîé ïîçèöèè)
USE lvFrmPartFrmEdit IN 0 NODATA
*------------------------------------------------------------------------------
*12.05.2004 00:32 -&gt;Äîáàâèì ïóñòóþ çàïèñü è çàïèøåì èäåíòèôèêàòîð ðîäèòåëüñêîãî äîêóìåíòà
APPEND BLANK IN lvFrmPartFrmEdit
***
REPLACE FrmID WITH nParFrmid , ;
		CntFrmID WITH nChildFrmId , ;
		CntFrmIncludeSum WITH 0 , ;
		CntFrmIncludeSumVAT WITH 0 , ;
		CntFrmIncludeSumVATRate WITH 0 , ;
		CntFrmSumSplitProcID WITH 5 IN lvFrmPartFrmEdit
SELECT lvFrmPartFrmEdit
lres =TABLEUPDATE(.t.)

USE IN SELECT('lvFrmPartFrmEdit')

*------------------------------------------------------------------------------

ENDPROC
PROCEDURE _addlinkdoc
LPARAMETERS nParFrmid,nChildFrmId
IF !DBUSED([BASIS])
	OPEN DATABASE BASIS
ENDIF
SET DATABASE TO BASIS
*------------------------------------------------------------------------------


USE IN SELECT([lvFrmEdit])
_PARAM  = nChildFrmId
USE lvFrmEdit IN 0
REPLACE FrmParID WITH nParFrmid IN lvFrmEdit
llResult = TABLEUPDATE(1,.T.,[lvFrmEdit])
IF NOT llResult
	TABLEREVERT(.T.,[lvFrmEdit])
	USE IN SELECT([lvFrmEdit])
	MESSAGEBOX([Äîêóìåíò íå ñâÿçàí!],48,[Ñâÿçûâàíèå äîêóìåíòîâ])
	RETURN
ENDIF

USE IN SELECT('lvFrmEdit')

*------------------------------------------------------------------------------

ENDPROC
PROCEDURE _copy
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRIMARYDOC_V1.VCX
* Class.Module....: GRDDOCSVIEW._COPY
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Êîïèðîâàíèå äîêóìåíòà
*-------------------------------------------------------

*12.05.2004 03:25 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	luResCopying
*------------------------------------------------------------------------------
SELECT FrmId FROM FrmPartFrmView WHERE FrmPartFrmView._Mark INTO TABLE TMP\listadd
USE IN listadd
*12.05.2004 03:26 -&gt;Âûïîëíÿåì îïåðàöèþ êîïèðîâàíèÿ äîêóìåíòà
luResCopying = oMgrPD.Operate([FORM],[COPY],FrmPartFrmView.FrmID)
*------------------------------------------------------------------------------

*12.05.2004 03:26 -&gt;Îáðàáàòûâàåì ðåçóëüòàò êîïèðîâàíèÿ
IF TYPE([luResCopying])==[N] AND !EMPTY(luResCopying)
	USE IN SELECT([lvFrmPartFrmEdit])
	USE lvFrmPartFrmEdit IN 0 NODATA
	   INSERT INTO lvFrmPartFrmEdit ;
	         (FrmId,;
	          cntFrmID,;
	          cntFrmincludeSum,;
	          CntFrmIncludeSumVAT,;
	          cntfrmsumsplitprocid) ;
	       VALUES ;
	         (PrimaryDocView.FrmID,;
	          luResCopying,;
	          0,;
	          0 ,;
	          1 )
		llResult = TABLEUPDATE(1,.T.,[lvFrmPartFrmEdit])
	USE IN SELECT([lvFrmPartFrmEdit])

	
	*22.12.2004 15:16 -&gt;Îáíîâëÿåì çàïèñü
	This._RSRequeryOne(luResCopying)
	*------------------------------------------------------------------------------

ENDIF
*------------------------------------------------------------------------------
USE IN SELECT('listadd')
ERASE TMP\listadd.dbf
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE _dele
*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: grdDocsView._Dele
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Óäàëåíèå äîêóìåíòà
*-------------------------------------------------------

*12.05.2004 03:25 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnFrmID, ;
		luResDeleting
***
lnFrmID = FrmPartFrmView.FrmID
*------------------------------------------------------------------------------

*12.05.2004 03:26 -&gt;Âûïîëíÿåì îïåðàöèþ óäàëåíèÿ äîêóìåíòà
luResDeleting = oMgrPD.Operate([FORM],[DELE],lnFrmID)
*------------------------------------------------------------------------------

*12.05.2004 03:26 -&gt;Îáðàáàòûâàåì ðåçóëüòàò óäàëåíèÿ
IF TYPE([luResDeleting])==[L] AND luResDeleting
	


	USE IN SELECT([lvFrmPartFrmEdit])
	USE lvFrmPartFrmEdit IN 0 NODATA
	   INSERT INTO lvFrmPartFrmEdit ;
	         (FrmId,;
	          cntFrmID,;
	          cntFrmincludeSum,;
	          CntFrmIncludeSumVAT,;
	          cntfrmsumsplitprocid) ;
	       VALUES ;
	         (PrimaryDocView.FrmID,;
	          luResAdding ,;
	          0,;
	          0 ,;
	          1 )
		llResult = TABLEUPDATE(1,.T.,[lvFrmPartFrmEdit])
	USE IN SELECT([lvFrmPartFrmEdit])


	*22.12.2004 15:16 -&gt;Îáíîâëÿåì çàïèñü
	This._RSRequeryOne(lnFrmID)
	*------------------------------------------------------------------------------

ENDIF
*------------------------------------------------------------------------------

************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE _devicedriverfunc
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: grdFormView._DeviceDriverFunc
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Âûïîëíåíèå ôóíêöèè äðàéâåðà
*------------------------------------------------------------------------------
LPARAMETERS tcMessage

*23.01.2006 17:45 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	_PARAM, ;
		lcOldPath, ;
		lcOldOnError, ;
		lcDriverPath, ;
		loDriver
PRIVATE llError
***
lcOldPath    = SET([PATH])
lcOldOnError = ON([ERROR])
*------------------------------------------------------------------------------

*23.01.2006 17:44 -&gt; Ïîëó÷àåì èíôîðìàöèþ î ôóíêöèè
USE IN IIF(USED([lvDeviceDriverFuncByCustomMSG]),[lvDeviceDriverFuncByCustomMSG],0)
***
_PARAM = tcMessage
USE lvDeviceDriverFuncByCustomMSG IN 0
***
IF RECCOUNT([lvDeviceDriverFuncByCustomMSG]) # 1
	RETURN .F.
ENDIF
*------------------------------------------------------------------------------

*23.01.2006 18:06 -&gt; Îïðåäåëÿåì ïàïêó â êîòîðîé ëåæèò äðàéâåð óñòðîéñòâà
lcDriverPath = FULLPATH(CURDIR(SET([DEFAULT]))) + ;
			   [Drivers\] + ;
			   ALLTRIM(lvDeviceDriverFuncByCustomMSG.DeviceTypeDescriptor) + [\] + ;
			   ALLTRIM(lvDeviceDriverFuncByCustomMSG.DeviceModelDescriptor) + [\] + ;
			   ALLTRIM(lvDeviceDriverFuncByCustomMSG.DeviceDriverVersion) + [\]
*------------------------------------------------------------------------------

*23.01.2006 18:06 -&gt; Ïðîâåðÿåì íàëè÷èå äèðåêòîðèè
IF !DIRECTORY(lcDriverPath)
	MESSAGEBOX([Äðàéâåð äëÿ äàííîãî óñòðîéñòâà íå óñòàíîâëåí íà äàííîì êîìïüþòåðå],16,[Íå âûïîëíåíî])
	RETURN .F.
ENDIF
*------------------------------------------------------------------------------

*23.01.2006 17:46 -&gt; Äîáàâëÿåì ê ïóòÿì
SET PATH TO (lcOldPath+[;]+lcDriverPath)
*------------------------------------------------------------------------------

*23.01.2006 17:46 -&gt; Âûãðóæàåì ini ôàéë äëÿ äðàéâåðà
IF !EMPTY(lvDeviceDriverFuncByCustomMSG.DeviceDriverINI)
	COPY MEMO lvDeviceDriverFuncByCustomMSG.DeviceDriverINI TO (lcDriverPath+[driver.ini])
ENDIF
*------------------------------------------------------------------------------

*23.01.2006 17:46 -&gt; Ñîçäàåì îáúåêò äðàéâåðà
ON ERROR llError=.T.
***
loDriver = oApp.CreateObject(ALLTRIM(lvDeviceDriverFuncByCustomMSG.DeviceDriverAppDescriptor))
***
IF TYPE([loDriver])#[O] OR ISNULL(loDriver)
	MESSAGEBOX([Äðàéâåð äëÿ äàííîãî óñòðîéñòâà íå óñòàíîâëåí íà äàííîì êîìïüþòåðå ëèáî óñòàíîâëåí íåêîððåêòíî],16,[Íå âûïîëíåíî])
	RETURN .F.
ENDIF
***
ON ERROR &amp;lcOldOnError
*------------------------------------------------------------------------------

*23.01.2006 17:45 -&gt; Âûïîëíèì ôóíêöèþ äðàéâåðà
loDriver.Do(ALLTRIM(lvDeviceDriverFuncByCustomMSG.DeviceDriverFuncMsg),lcDriverPath)
*------------------------------------------------------------------------------

*23.01.2006 17:45 -&gt; Âîññòàíîâèì ïóòè
SET PATH TO (lcOldPath)
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE _docfromxml
*02.04.2007 14:26 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL lcLoadFromDir, ;
	  lnLastID, ;
	  tmpNaklHead, ;
	  tmpNaklFoot, ;
	  tmpExistKam, ;
	  tmpRegisteredIDs_, ;
	  tmpNewKam, ; &amp;&amp; êóðñîð äëÿ òîâàðîâ, êîòðûå åñòü â ÊÂ, íî îòñóòñòâóþò â ãëàâíîì ñïðàâî÷íèêå
	  lnFrmID, ;
	  lnTvrID, ;
	  llResult
*------------------------------------------------------------------------------

*02.04.2007 14:27 -&gt;Ïîëó÷èì êàòàëîã äëÿ çàãðóçêè
lcLoadFromDir = GETDIR()
IF EMPTY(lcLoadFromDir)
	MESSAGEBOX([Óêàæèòå êàòàëîã äëÿ çàãðóçêè äîêóìåíòà!],48,[Çàãðóçêà äîêóìåíòà])
	RETURN
ELSE
	lcLoadFromDir = ADDBS(lcLoadFromDir)
	IF NOT FILE(lcLoadFromDir + [NaklHead.xml])
		MESSAGEBOX([Îòñóòñòâóåò äîêóìåíò äëÿ çàãðóçêè!],48,[Çàãðóçêà äîêóìåíòà])
		RETURN
	ENDIF
ENDIF
*------------------------------------------------------------------------------

*02.04.2007 14:29 -&gt;çàãðóæàåì ãîëîâó...
XMLTOCURSOR(lcLoadFromDir + [NaklHead.xml], [tmpNaklHead], 512)
REPLACE FrmStatusId WITH 1 IN tmpNaklHead
***
USE IN SELECT([lvFrmEdit])
USE lvFrmEdit IN 0 NODATA
INSERT INTO lvFrmEdit ( ;
	FrmTypeID, FrmDate, FrmDateAcc, FrmNum, FrmNote, FrmReason, FrmStatusID, FrmIsPayed, ;
	PointEmiOuID, PointEmiCltID, PointIspOuID, PointIspCltID, DevCltID, ExecEmiCltID, ;
	ExecIspCltID, ContrCltID, PointEmiCltSAccID, PointIspCltSAccID, FrmCurTypeID, FrmPrcTypeID, ;
	FrmAttribute ;
) VALUES ( ;
	1, tmpNaklHead.FrmDate, tmpNaklHead.FrmDateAcc, tmpNaklHead.FrmNum, ;
	tmpNaklHead.FrmNote, tmpNaklHead.FrmReason, tmpNaklHead.FrmStatusID, tmpNaklHead.FrmIsPayed, ;
	tmpNaklHead.PointEmiOuID, tmpNaklHead.PointEmiCltID, tmpNaklHead.PointIspOuID, tmpNaklHead.PointIspCltID, ;
	tmpNaklHead.DevCltID, tmpNaklHead.ExecEmiCltID, tmpNaklHead.ExecIspCltID, tmpNaklHead.ContrCltID, ;
	tmpNaklHead.PointEmiCltSAccID, tmpNaklHead.PointIspCltSAccID, 1, tmpNaklHead.FrmPrcTypeID, ;
	tmpNaklHead.FrmAttribute ;
)
llResult = TABLEUPDATE(1,.T.,[lvFrmEdit])
IF NOT llResult
	TABLEREVERT(.T.,[lvFrmEdit])
	USE IN SELECT([lvFrmEdit])
	MESSAGEBOX([Äîêóìåíò íå çàãðóæåí!],48,[Çàãðóçêà äîêóìåíòà])
	RETURN
ENDIF
*------------------------------------------------------------------------------

*02.04.2007 14:39 -&gt;Ïîëó÷èì ID íîâîãî äîêóìåíòà
lnFrmID = spGetLastIncrementedId([lvFrmEdit])
USE IN SELECT([lvFrmEdit])
*------------------------------------------------------------------------------

*02.04.2007 14:39 -&gt;çàãðóæàåì íîãè...
XMLTOCURSOR(lcLoadFromDir + [NaklFoot.xml], [tmpNaklFoot], 512)

*02.04.2007 14:55 -&gt;ÑÓÙÅÑÒÂÓÞÙÈÅ ÒÎÂÀÐÛ
USE lvFrmPartTvrEdit IN 0 NODATA
***
INSERT INTO lvFrmPartTvrEdit ( ;
	FrmID,TvrId,MsuId,TvrQnt,TvrQntNetto,TvrPrcBuy,TvrPrcSale,TvrIDCalc,User_) ;
SELECT  lnFrmID, ; &amp;&amp; ïðîñòàâèì èäåíòôèôêàòîð äîêóìåíòà
		Tovar.TvrId, ;
		tmpNaklFoot.MsuId, ;
		tmpNaklFoot.TvrQnt, ;
		tmpNaklFoot.TvrQntNetto, ;
		tmpNaklFoot.TvrPrcBuy, ;
		tmpNaklFoot.TvrPrcSale, ;
		tmpNaklFoot.TvrIdCalc, ;
		-1 ;
FROM tmpNaklFoot ;
INNER JOIN Tovar ON Tovar.ID_= tmpNaklFoot.TvrId
***
llResult = .T. &amp;&amp;llResult = TABLEUPDATE(1,.T.,[lvFrmPartTvrEdit])
IF NOT llResult
	TABLEREVERT(.T.,[lvFrmPartTvrEdit])
	USE IN SELECT([lvFrmPartTvrEdit])
	MESSAGEBOX([Äîêóìåíò íå çàãðóæåí!],48,[Çàãðóçêà äîêóìåíòà])
	RETURN
ELSE
	USE IN SELECT([lvFrmPartTvrEdit])
ENDIF
*------------------------------------------------------------------------------

*02.04.2007 14:56 -&gt;ÍÎÂÛÅ ÒÎÂÀÐÛ
** çàïèñü â òàáëèöó Tovar
USE lvTvrEdit IN 0 NODATA
***
INSERT INTO lvTvrEdit (TvrTypeID,TvrNM,TvrIsActiv,MsuID,ID_,User_) ;
SELECT ;
		2, ;
		ALLTRIM(tmpNaklFoot.TvrNM)+[_], ;
		1, ;
		tmpNaklFoot.MsuId, ;
		tmpNaklFoot.TvrID, ;
		-1 ;
FROM tmpNaklFoot ;
WHERE tmpNaklFoot.TvrId NOT IN (SELECT ID_ FROM Tovar WHERE ID_ &lt;&gt; 0 )
***
llResult = TABLEUPDATE(1,.T.,[lvTvrEdit])
IF NOT llResult
	TABLEREVERT(.T.,[lvTvrEdit])
	USE IN SELECT([lvTvrEdit])
	MESSAGEBOX([Äîêóìåíò íå çàãðóæåí!],48,[Çàãðóçêà äîêóìåíòà])
	RETURN
ELSE
	USE IN SELECT([lvTvrEdit])
ENDIF
*------------------------------------------------------------------------------

USE lvFrmPartTvrEdit IN 0 NODATA
***
INSERT INTO lvFrmPartTvrEdit ( ;
	FrmID,TvrId,MsuId,TvrQnt,TvrQntNetto,TvrPrcBuy,TvrPrcSale,TvrIDCalc,User_) ;
SELECT  lnFrmID, ; &amp;&amp; ïðîñòàâèì èäåíòôèôêàòîð äîêóìåíòà
		Tovar.TvrId, ;
		tmpNaklFoot.MsuId, ;
		tmpNaklFoot.TvrQnt, ;
		tmpNaklFoot.TvrQntNetto, ;
		tmpNaklFoot.TvrPrcBuy, ;
		tmpNaklFoot.TvrPrcSale, ;
		tmpNaklFoot.TvrIdCalc, ;
		-1 ;
FROM tmpNaklFoot ;
WHERE tmpNaklFoot.TvrId NOT IN (SELECT ID_ FROM Tovar WHERE ID_ &lt;&gt; 0 )
***
llResult = llResult = TABLEUPDATE(1,.T.,[lvFrmPartTvrEdit])
IF NOT llResult
	TABLEREVERT(.T.,[lvFrmPartTvrEdit])
	USE IN SELECT([lvFrmPartTvrEdit])
	MESSAGEBOX([Äîêóìåíò íå çàãðóæåí!],48,[Çàãðóçêà äîêóìåíòà])
	RETURN
ELSE
	USE IN SELECT([lvFrmPartTvrEdit])
ENDIF
*------------------------------------------------------------------------------

*22.12.2004 15:16 -&gt;Îáíîâëÿåì çàïèñü
This._RSRequeryOne(lnFrmID)
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE _doctoxml
*02.04.2007 14:03 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL   lcSaveToDir, ;
		_PARAM
*------------------------------------------------------------------------------


*02.04.2007 14:03 -&gt;Ïîëó÷èì êàòàëîã äëÿ âûãðóçêè
lcSaveToDir = GETDIR()
IF EMPTY(lcSaveToDir)
	MESSAGEBOX([Óêàæèòå êàòàëîã äëÿ âûãðóçêè äîêóìåíòà!],48,[Âûãðóçêà äîêóìåíòà])
	RETURN
ELSE
	lcSaveToDir = ADDBS(lcSaveToDir)
ENDIF
*------------------------------------------------------------------------------

_PARAM = PrimaryDocView.FrmID

*02.04.2007 14:05 -&gt;Âûãðóæàåì ãîëîâó äîêóìåíòà
USE IN SELECT([lvFrmView])
USE lvFrmView IN 0
CURSORTOXML([lvFrmView], lcSaveToDir + [NaklHead.xml], 1, 512 + 16, 0, [1])
*------------------------------------------------------------------------------

*02.04.2007 14:15 -&gt;Âûãðóæàåì íîãè äîêóìåíòà
USE IN SELECT([lvFrmPartTvrViewExt])
USE lvFrmPartTvrViewExt IN 0
CURSORTOXML([lvFrmPartTvrViewExt], lcSaveToDir + [NaklFoot.xml], 1, 512 + 16, 0, [1])
USE IN SELECT([lvFrmPartTvrViewExt])
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE _edit
*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: grdDocsView._Edit
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Ðåäàêòèðîâàíèå äîêóìåíòà
*-------------------------------------------------------

*12.05.2004 03:25 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnFrmID, ;
		luResEditing
***
lnFrmID = FrmPartFrmView.FrmID
*------------------------------------------------------------------------------

*12.05.2004 03:26 -&gt;Âûïîëíÿåì îïåðàöèþ ðåäàêòèðîâàíèÿ äîêóìåíòà
luResEditing = oMgrPD.Operate([FORM],[EDIT],lnFrmID)
*------------------------------------------------------------------------------

*12.05.2004 03:26 -&gt;Îáðàáàòûâàåì ðåçóëüòàò ðåäàêòèðîâàíèÿ
IF TYPE([luResEditing])==[L] AND luResEditing
	
	*22.12.2004 15:16 -&gt;Îáíîâëÿåì çàïèñü
	This._RSRequeryOne(lnFrmID)
	*------------------------------------------------------------------------------

ENDIF
*------------------------------------------------------------------------------

************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE _exportto1c
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: grdFormView._ExportTo1C
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Âûãðóçêà äîêóìåíòîâ 1ñ
*------------------------------------------------------------------------------

*10.10.2005 16:16 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL   lnCount, ;
		lnSum, ;
		lnVatSum,;
		lnMCount, ;
		lnMSum, ;
		lnMVatSum,;
		lnOldRecno,;
		lcDispStr
		
lnOldRecno = RECNO('PrimaryDocView')
*------------------------------------------------------------------------------
IF MESSAGEBOX('Âûãðóçèòü âûáðàííûå äàííûå â 1Ñ?',4+64+256,'Îòïðàâêà äàííûõ â 1Ñ')=6
	*** çàïðîñ ïî çàêóïó
	SELECT PrimaryDocView
	IF MESSAGEBOX('Âûãðóæàòü çàêóïû?',4+64+256,'Îòïðàâêà äàííûõ â 1Ñ')=6
		SELECT FrmNum AS NUM;
			 ,FrmDateAcc AS Date;
			 ,PEmiCltNM AS Name;
			 ,PEmiCltINN AS INN;
			 ,'' AS KPP;
			 ,'Çàêóï' AS PRODUCTNAME;
			 ,1 AS QTY;
			 ,FrmSumBuy AS Summa;
			 ,StatusId;
		FROM PrimaryDocView ;
		WHERE FrmTypeDir = 2 AND FrmTypeID &lt;&gt; 6  ;
		INTO TABLE To1C\incom.dbf
		USE IN SELECT([incom])
	***
	ENDIF
	*** çàïðîñ ïî ïðîäàæàì
	IF MESSAGEBOX('Âûãðóæàòü ïðîäàæè?',4+64+256,'Îòïðàâêà äàííûõ â 1Ñ')=6
		SELECT FrmNum AS NUM;
			 ,FrmDateAcc AS Date;
			 ,PIspCltNM AS Name;
			 ,PIspCltINN AS INN;
			 ,'' AS KPP;
			 ,'Ïðîäàæè' AS PRODUCTNAME;
			 ,1 AS QTY;
			 ,FrmSumSale AS Summa;
			 ,FrmSumBuy AS Cost;
			 ,StatusId;
		FROM PrimaryDocView ;
		WHERE FrmTypeDir = 3  AND FrmTypeID &lt;&gt; 6 ;
		INTO TABLE To1C\outcom.dbf
		USE IN SELECT([outcom])
	ENDIF
	*** çàïðîñ ïî ïðèõîäíûì êàññîâûì îðäåðàì
	IF MESSAGEBOX('Âûãðóæàòü Ïðèõîäíûå êàññîâûå îðäåðà?',4+64+256,'Îòïðàâêà äàííûõ â 1Ñ')=6
		SELECT FrmNum AS NUM;
			 ,FrmDateAcc AS Date;
			 ,PEmiCltNM AS Name;
			 ,PEmiCltINN AS INN;
			 ,'' AS KPP;
			 ,FrmSumSale AS Summa;
			 ,StatusId;
		FROM PrimaryDocView ;
		WHERE FrmTypeDir = 2 AND FrmTypeID = 6 ;
		INTO TABLE To1C\pko.dbf
		USE IN SELECT([pko])
	ENDIF
	***
ENDIF
SELECT PrimaryDocView

IF lnOldRecno&gt;RECCOUNT('PrimaryDocView')
IF RECCOUNT('PrimaryDocView')=0
RETURN
ENDIF
GO RECCOUNT('PrimaryDocView')
ELSE
GO lnOldRecno
ENDIF
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE _find
		luOperateResult = oApp.ExecuteScrFormByObjDescRetVal([frmCltFindCode;Client_v1.vcx;Client.app])
		IF  luOperateResult #0
		SELECT PrimaryDocView
		LOCATE ALL FOR PrimaryDocView.PointIspCl = luOperateResult
	    	IF !FOUND()
		    WAIT WINDOW 'Ðàñøèðÿåì ïîèñê ...' nowait
			this._RSRequery()
			SELECT PrimaryDocView
			LOCATE ALL FOR PrimaryDocView.PointIspCl = luOperateResult
			  		IF !FOUND()
			  			MESSAGEBOX('Ïðîâåðòå ïåðèîä äàò è îñòàëüíûå îãðàíè÷åíèÿ.';
			  		   +CHR(13)+'Êëèåíòà ñ òàêèì êîäîì â óêàçàííîì ïåðèîäå íåò.',0+32+4096,'Ïðåäóïðåæäåíèå',5000)
			  		ENDIF
		    ENDIF
		ELSE
			  			MESSAGEBOX('Ïðîâåðòå ïåðèîä äàò è îñòàëüíûå îãðàíè÷åíèÿ.';
			  		   +CHR(13)+'Êëèåíòà ñ òàêèì êîäîì â óêàçàííîì ïåðèîäå íåò.',0+32+4096,'Ïðåäóïðåæäåíèå',5000)
		ENDIF
		RETURN luOperateResult

ENDPROC
PROCEDURE _frmact
oMgrPD.Operate([FRMACT],[VIEW])
ENDPROC
PROCEDURE _fromgarant
LOCAL cNameV,cValue ,cAddStr,nPosNm,nPosVl,nOcc , lcLoadFromFile,lnParId,mQnt ,mPrc ,mStr

*29.10.2011 14:27 -&gt;Ïîëó÷èì êàòàëîã äëÿ çàãðóçêè
lcLoadFromFile =GETFILE('XML', 'Ôàéë ñî ñìåòîé',  'Çàãðóçèòü', 0, 'Âûáåðèòå ôàéë .xml ñî ñìåòîé')

IF !FILE(lcLoadFromFile)
	MESSAGEBOX([Óêàæèòå XML- ôàéë äëÿ çàãðóçêè ñìåòû!],48,[Çàãðóçêà äîêóìåíòà])
	RETURN
ENDIF
*------------------------------------------------------------------------------

LOCAL loXML, x, cSeekStr , i, iPrc
loXML = CREATEOBJECT("MSXML.DOMDocument")
loXML.load(lcLoadFromFile)
USE IN SELECT('tempxml')
CREATE TABLE  tmp\tempxml FREE (Caption1 C(250),Code1 C(40),Quantity Currency,Units C(20),PricePZ Currency,PriceOZ Currency, Id int AUTOINC , ParId int, FrmPartId int,TvrAttr int)
lnParId = null
IF loXML.parseError.errorCode = 0
	  loXMLNodes=loXML.getElementsByTagName("Position")  &amp;&amp; âûáèðàåì äàííûå î ïîçèöèè
	  For i = 0 TO (loXMLNodes.length -1)
	    loNodes = loXMLNodes.nextNode
	    *-* îïðåäåëÿåì öåíó çà ïîçèöèþ
		loNodesPrc = loNodes.getElementsByTagName("PriceBase")
		iPrc = 0
		lFound = .F.
		mTotal = "0"
*    	mTotal = loNodesPrc.Item(iPrc).getAttribute("PZ")

		loNodesPrc1 = loNodes.getElementsByTagName("ItogBim/Itog")
		iPrc = 0
		lFound = .F.
		mTotal = "0"
		  For iPrc = 0 TO (loNodesPrc1.length -1)
		  		IF loNodesPrc1.Item(iPrc).getAttribute("DataType")='TotalWithNP'
		  		lFound = .T.
		  	exit
		  		ENDIF
		  ENDFOR
		  IF !lFound
			iPrc = 0
			  For iPrc = 0 TO (loNodesPrc1.length -1)
			  		IF loNodesPrc1.Item(iPrc).getAttribute("DataType") = 'TotalFo'
			  		lFound = .T.
			  	exit
			  		ENDIF
			  ENDFOR
		  ENDIF
		
		  IF lFound
			  mTotal = loNodesPrc1.Item(iPrc).getAttribute("PZ")
		  ENDIF
		  mStr = STRTRAN(NVL(loNodes.getAttribute("Quantity"),"0"),",",".")
		  IF AT('îêðóãë', mStr ) &gt;0
		  	mStr = STRTRAN(mStr,'îêðóãë','ROUND')
		  	mStr = STRTRAN(mStr,';',',')
		  ENDIF
		  mQnt = EVALUATE(mStr)
		  mPrc = IIF(mQnt = 0,0,EVALUATE(STRTRAN(NVL(mTotal,"0"),",","."))/mQnt )
	WAIT WINDOW NOWAIT 'Äîáàâëÿåì ïîçèöèþ:'+CHR(13)+ SUBSTR(NVL(loNodes.getAttribute("Caption"),""),1,230)
	      INSERT INTO tempxml (Caption1 ;
	    					,Code1 ;
	    					,Quantity;
	    					,PricePZ;
	    					,Units;
	    					,TvrAttr) ;
	    				VALUES (ALLTRIM(NVL(loNodes.getAttribute("Caption"),""));
	    					   ,NVL(loNodes.getAttribute("Code"),"");
	    					   ,mQnt ;
	    					   ,mPrc ;
	    					   ,NVL(loNodes.getAttribute("Units"),"");
	    					   ,BITSET(0,5))
	    lnParId = tempxml.id
		*-* ðàáîòàåì ñ ðåñóðñàìè ïî ïîçèöèè
		loNodesResTzr = loNodes.getElementsByTagName("Resources/Tzr")
		iPrcTzr= 0
		lFound = .F.
		mTotal = "0"
		  For iPrc = 0 TO (loNodesResTzr.length -1)
				  loNodesTzr = loNodesResTzr.nextNode
				  loNodesResTzrPrs = loNodesTzr.getElementsByTagName("PriceBase")
				  IF loNodesResTzrPrs.length &gt;0
					  mTotal = loNodesResTzrPrs.Item(0).getAttribute("Value")
				  ENDIF
			      INSERT INTO tempxml (Caption1 ;
			    					,Code1 ;
			    					,Quantity;
			    					,PricePZ;
			    					,Units;
	    							,ParId;
	    							,TvrAttr) ;
			    				VALUES (ALLTRIM(NVL(loNodesResTzr.Item(iPrc).getAttribute("Caption"),""))+' '+NVL(loNodesResTzr.Item(iPrc).getAttribute("Code"),"");
			    					   ,NVL(loNodesResTzr.Item(iPrc).getAttribute("Code"),"");
			    					   ,EVALUATE(STRTRAN(NVL(loNodesResTzr.Item(iPrc).getAttribute("Quantity"),"0"),",","."));
			    					   ,EVALUATE(STRTRAN(NVL(mTotal,"0"),",","."));
			    					   ,NVL(loNodesResTzr.Item(iPrc).getAttribute("Units"),""),;
			    					   lnParId;
	    					  		   ,BITSET(0,6) )

		  ENDFOR
		*-* ðàáîòàåì ñ ìàøèíàìè è îáîðóä ïî ïîçèöèè
		loNodesResTzr = loNodes.getElementsByTagName("Resources/Mch")
		iPrcTzr= 0
		lFound = .F.
		mTotal = "0"
		  For iPrc = 0 TO (loNodesResTzr.length -1)
				  loNodesTzr = loNodesResTzr.nextNode
				  loNodesResTzrPrs = loNodesTzr.getElementsByTagName("PriceBase")
				  IF loNodesResTzrPrs.length &gt;0
					  mTotal = loNodesResTzrPrs.Item(0).getAttribute("Value")
				  ENDIF
			      INSERT INTO tempxml (Caption1 ;
			    					,Code1 ;
			    					,Quantity;
			    					,PricePZ;
			    					,Units;
	    							,ParId;
	    							,TvrAttr) ;
			    				VALUES (ALLTRIM(NVL(loNodesResTzr.Item(iPrc).getAttribute("Caption"),""))+' '+NVL(loNodesResTzr.Item(iPrc).getAttribute("Code"),"");
			    					   ,NVL(loNodesResTzr.Item(iPrc).getAttribute("Code"),"");
			    					   ,EVALUATE(STRTRAN(NVL(loNodesResTzr.Item(iPrc).getAttribute("Quantity"),"0"),",","."));
			    					   ,EVALUATE(STRTRAN(NVL(mTotal,"0"),",","."));
			    					   ,NVL(loNodesResTzr.Item(iPrc).getAttribute("Units"),""),;
			    					   lnParId ;
	    					  		   ,BITSET(0,7))

		  ENDFOR
		*-* ðàáîòàåì ñ ìàòåðèàëàìè è îáîðóä ïî ïîçèöèè
		loNodesResTzr = loNodes.getElementsByTagName("Resources/Mat")
		iPrcTzr= 0
		lFound = .F.
		mTotal = "0"
		  For iPrc = 0 TO (loNodesResTzr.length -1)
				  loNodesTzr = loNodesResTzr.nextNode
				  loNodesResTzrPrs = loNodesTzr.getElementsByTagName("PriceBase")
				  IF loNodesResTzrPrs.length &gt;0
					  mTotal = loNodesResTzrPrs.Item(0).getAttribute("Value")
				  ENDIF
			      INSERT INTO tempxml (Caption1 ;
			    					,Code1 ;
			    					,Quantity;
			    					,PricePZ;
			    					,Units;
	    							,ParId;
	    							,TvrAttr) ;
			    				VALUES (ALLTRIM(NVL(loNodesResTzr.Item(iPrc).getAttribute("Caption"),""))+' '+NVL(loNodesResTzr.Item(iPrc).getAttribute("Code"),"");
			    					   ,NVL(loNodesResTzr.Item(iPrc).getAttribute("Code"),"");
			    					   ,EVALUATE(STRTRAN(NVL(loNodesResTzr.Item(iPrc).getAttribute("Quantity"),"0"),",","."));
			    					   ,EVALUATE(STRTRAN(NVL(mTotal,"0"),",","."));
			    					   ,NVL(loNodesResTzr.Item(iPrc).getAttribute("Units"),"");
			    					   ,lnParId ;
	    					  		   ,BITSET(0,8))

		  ENDFOR
	 ENDFOR
ELSE
x = loXML.parseError.reason
WAIT WINDOW x NOWAIT
ENDIF
loXML = null

*-* Âûáèðàåì íîâûå åäèíèöû èçìåðåíèÿ è äîáàâëÿåì èõ â òàáëèöó MeasureUnit
USE MeasureUnit IN 0
SELECT DISTINCT MsuNM FROM MeasureUnit ;
	UNION ;
	SELECT DISTINCT MsuShortNM as MsuNM FROM MeasureUnit ;
	INTO CURSOR tmpMeasureUnit
SELECT DISTINCT Units FROM tempxml ;
	WHERE ALLTRIM(units) NOT in ;
	(SELECT ALLTRIM(MsuNM) FROM tmpMeasureUnit) INTO CURSOR tmp1MeasureUnit
USE IN SELECT('tmpMeasureUnit')

INSERT INTO MeasureUnit (MsuNM, MsuShortNM, MsuQnt, MsuType)  ;
SELECT DISTINCT units as MsuNM, units AS MsuShortNM , 1, 0 FROM tmp1MeasureUnit
llResult = TABLEUPDATE(1,.T.,[MeasureUnit])
USE IN SELECT('tmp1MeasureUnit')

*-* Âûáèðàåì íîâûå òîâàðû è äîáàâëÿåì èõ â òàáëèöó Tovar
USE Tovar IN 0
USE IN SELECT('MeasureUnit')

INSERT INTO Tovar (TvrNM, MsuId, TvrTypeId,TvrIsActiv)  ;
SELECT DISTINCT SUBSTR(ALLTRIM(tempxml.Caption1),1,250),MeasureUnit.MsuId,2,1 FROM tempxml ;
left outer join MeasureUnit on tempxml.Units = MeasureUnit.MsuNM or tempxml.Units = MeasureUnit.MsuShortNM;
	WHERE SUBSTR(ALLTRIM(tempxml.Caption1),1,250) NOT in ;
	(SELECT SUBSTR(ALLTRIM(TvrNM),1,250) FROM Tovar) 	
llResult = TABLEUPDATE(1,.T.,[Tovar])

IF MESSAGEBOX('Äîáàâèòü íîâûé äîêóìåíò (Äà) èëè äîïîëíèòü òåêóùèé (Íåò)?',4+64,'Âûáåðèòå âàðèàíò äîáàâëåíèÿ íîâîé ñìåòû') = 6
	*-* äîáàâëÿåì çàãîëîâîê ñìåòû
	USE IN SELECT([lvFrmEdit])
	LOCAL lnFrmTypeId
	lnFrmTypeId = IIF(PrimaryDocView.FrmTypeID=0,NULL,PrimaryDocView.FrmTypeID)
	USE lvFrmEdit IN 0 NODATA
	INSERT INTO lvFrmEdit ( ;
		FrmTypeID, FrmDate, FrmDateAcc, FrmNum, FrmNote, FrmReason, FrmStatusID, FrmIsPayed, ;
		PointEmiOuID, PointEmiCltID, PointIspOuID, PointIspCltID, DevCltID, ExecEmiCltID, ;
		ExecIspCltID, ContrCltID, PointEmiCltSAccID, PointIspCltSAccID, FrmCurTypeID, FrmPrcTypeID, ;
		FrmAttribute ;
	) VALUES ( ;
		NVL(lnFrmTypeId ,42), DATETIME(), DATETIME(), lcLoadFromFile, ;
		lcLoadFromFile, lcLoadFromFile, 1, .f., ;
		null, null, null, null, ;
		null, null, null, null, ;
		null, null, 1, null, ;
		BITSET(0,8);
	)
	llResult = TABLEUPDATE(1,.T.,[lvFrmEdit])
	IF NOT llResult
		TABLEREVERT(.T.,[lvFrmEdit])
		USE IN SELECT([lvFrmEdit])
		MESSAGEBOX([Äîêóìåíò íå çàãðóæåí!],48,[Çàãðóçêà äîêóìåíòà])
		RETURN
	ENDIF
	*------------------------------------------------------------------------------

	*29.10.2010 14:39 -&gt;Ïîëó÷èì ID íîâîãî äîêóìåíòà
	lnFrmID = spGetLastIncrementedId([lvFrmEdit])
	USE IN SELECT([lvFrmEdit])
	*------------------------------------------------------------------------------
ELSE
	lnFrmId = PrimaryDocView.FrmID
ENDIF
*-* äîáàâëÿåì íîãè ñìåòû
USE IN SELECT([Tovar])
USE IN SELECT([FrmPartTvr])

SELECT tempxml
INDEX on parid TO TMP\tempxml.cdx COMPACT
SELECT tempxml
SCAN
	WAIT WINDOW NOWAIT 'Ñîõðàíÿåì íà ñåðâåðå ïîçèöèþ:'+CHR(13)+ SUBSTR(ALLTRIM(NVL(tempxml.Caption1,"")),1,100)
		USE lvFrmPartTvrEdit IN 0 NODATA
		tmpFrmId = tempxml.Id
		INSERT INTO lvFrmPartTvrEdit (FrmID, TvrId, MsuId,TvrQnt,TvrPrcBuy,TvrPrcSale,FrmParId , TvrAttr  )  ;
		SELECT lnFrmID;
				,Tovar.TvrId;
				,Tovar.MsuId;
				,tmpTempXml.Quantity;
				,tmpTempXml.PricePZ;
				,tmpTempXml.PricePZ;
				,tempxmlPar.FrmPartId ;
				,tmpTempXml.TvrAttr ;
		 FROM tempxml tmpTempXml ;
		left outer join Tovar on SUBSTR(ALLTRIM(tmpTempXml.Caption1),1,250)  = SUBSTR(ALLTRIM(Tovar.TvrNM),1,250) ;
		left outer join tempxml tempxmlPar on tmpTempXml.ParId = tempxmlPar.Id ;
		left outer join Tovar TovarPar  on SUBSTR(ALLTRIM(tempxmlPar.Caption1),1,250)  = SUBSTR(ALLTRIM(TovarPar.TvrNM),1,250) ;
		WHERE tmpTempXml.id = tmpFrmId
		llResult = TABLEUPDATE(1,.T.,[lvFrmPartTvrEdit])
		lnPartFrmID = spGetLastIncrementedId([lvFrmPartTvrEdit])
		SELECT tempxml
		replace FrmPartId WITH lnPartFrmID IN tempxml NEXT 1
		USE IN SELECT([lvFrmPartTvrEdit])
		USE IN SELECT([tempxmlPar])
		USE IN SELECT([tmpTempXml])
		USE IN SELECT([Tovar])
		SELECT tempxml
ENDSCAN

*!*				USE FrmPartTvr IN 0 NODATA
*!*				*SET STEP ON

*!*				INSERT INTO FrmPartTvr (FrmID, TvrId, MsuId,TvrQnt,TvrPrcBuy,TvrPrcSale,TvrIDCalc )  ;
*!*				SELECT lnFrmID;
*!*						,Tovar.TvrId;
*!*						,Tovar.MsuId;
*!*						,tempxml.Quantity;
*!*						,tempxml.PricePZ*1.18;
*!*						,tempxml.PricePZ;
*!*						,TovarPar.TvrId;
*!*				 FROM tempxml ;
*!*				left outer join Tovar on SUBSTR(ALLTRIM(tempxml.Caption1),1,80)  = Tovar.TvrNM ;
*!*				left outer join tempxml tempxmlPar on tempxml.ParId = tempxmlPar.Id ;
*!*				left outer join Tovar TovarPar  on SUBSTR(ALLTRIM(tempxmlPar.Caption1),1,80)  = TovarPar.TvrNM ;
*!*				order by  tempxml.Id

*!*					*!*			,IIF(tempxml.Quantity=0,0,ROUND(tempxml.PricePZ*1.18/tempxml.Quantity,4));
*!*					*!*			,IIF(tempxml.Quantity=0,0,ROUND(tempxml.PricePZ/tempxml.Quantity,4));



*!*				llResult = TABLEUPDATE(1,.T.,[FrmPartTvr])
*!*				USE IN SELECT([FrmPartTvr])



USE IN SELECT('MeasureUnit')
USE IN SELECT('tempxml')
ERASE TMP\tempxml.cdx
WAIT CLEAR
RETURN lnFrmID
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE _fromgarant1
LOCAL cNameV,cValue ,	cAddStr,nPosNm,nPosVl,nOcc

*29.10.2011 14:27 -&gt;Ïîëó÷èì êàòàëîã äëÿ çàãðóçêè
lcLoadFromDir =GETFILE('XML', 'Ôàéë ñî ñìåòîé',  'Çàãðóçèòü', 0, 'Âûáåðèòå ôàéë .xml ñî ñìåòîé')

IF !FILE(lcLoadFromDir)
	MESSAGEBOX([Óêàæèòå XML- ôàéë äëÿ çàãðóçêè ñìåòû!],48,[Çàãðóçêà äîêóìåíòà])
	RETURN
ENDIF
*------------------------------------------------------------------------------




LOCAL loXML, x, cSeekStr , i, iPrc
loXML = CREATEOBJECT("MSXML.DOMDocument")
loXML.load(lcLoadFromDir)
USE IN SELECT('tempxml')
CREATE TABLE  tmp\tempxml FREE (Caption1 C(100),Code1 C(40),Quantity Currency,Units C(20),PricePZ Currency,PriceOZ Currency)
cSeekStr = 'TotalWithNP'

IF loXML.parseError.errorCode = 0
loXMLNodes=loXML.getElementsByTagName("Position")  &amp;&amp; âûáèðàåì äàííûå î ïîçèöèè

For i = 0 TO (loXMLNodes.length -1)
* SET STEP ON
loNodes = loXMLNodes.nextNode
	*loNodesPrc = loNodes.getElementsByTagName("PriceBase")
	loNodesPrc = loNodes.getElementsByTagName("ItogBim/Itog")
	iPrc = 0
	lFound = .F.
	mTotal = "0"
	  For iPrc = 0 TO (loNodesPrc.length -1)
	  		IF loNodesPrc.Item(iPrc).getAttribute("DataType")='TotalWithNP'
	  		lFound = .T.
	  	exit
	  		ENDIF
	  ENDFOR
	  IF !lFound
		iPrc = 0
		  For iPrc = 0 TO (loNodesPrc.length -1)
		  		IF loNodesPrc.Item(iPrc).getAttribute("DataType") = 'TotalFo'
		  		lFound = .T.
		  	exit
		  		ENDIF
		  ENDFOR
	  ENDIF
	
	  IF lFound
		  mTotal = loNodesPrc.Item(iPrc).getAttribute("PZ")
	  ENDIF
	
*!*		  IF iPrc &gt; loNodesPrc.length -1
*!*		  	iPrc = 0
*!*		  ENDIF
*!*		loXMLPrice=loXML.getElementsByTagName("Position/PriceBase")  &amp;&amp; âûáèðàåì äàííûå î öåíå ïîçèöèè
	*    x = loNodesPrc.Item(0).getAttribute("PZ")
*!*	    x = loNodes.getAttribute("Code")
*!*	    x = loNodes.getAttribute("Quantity")
INSERT INTO tempxml (Caption1 ;
					,Code1 ;
					,Quantity;
					,PricePZ;
					,Units) ;
				VALUES (NVL(loNodes.getAttribute("Caption"),"");
					   ,NVL(loNodes.getAttribute("Code"),"");
					   ,EVALUATE(STRTRAN(NVL(loNodes.getAttribute("Quantity"),"0"),",","."));
					   ,EVALUATE(STRTRAN(NVL(mTotal,"0"),",","."));
					   ,NVL(loNodes.getAttribute("Units"),""))
ENDFOR
ELSE
x = loXML.parseError.reason
WAIT WINDOW x NOWAIT
ENDIF
loXML = null

*-* Âûáèðàåì íîâûå åäèíèöû èçìåðåíèÿ è äîáàâëÿåì èõ â òàáëèöó MeasureUnit
USE MeasureUnit IN 0
SELECT DISTINCT MsuNM FROM MeasureUnit ;
	UNION ;
	SELECT DISTINCT MsuShortNM as MsuNM FROM MeasureUnit ;
	INTO CURSOR tmpMeasureUnit
SELECT DISTINCT Units FROM tempxml ;
	WHERE ALLTRIM(units) NOT in ;
	(SELECT ALLTRIM(MsuNM) FROM tmpMeasureUnit) INTO CURSOR tmp1MeasureUnit
USE IN SELECT('tmpMeasureUnit')

INSERT INTO MeasureUnit (MsuNM, MsuShortNM, MsuQnt, MsuType)  ;
SELECT DISTINCT units as MsuNM, units AS MsuShortNM , 1, 0 FROM tmp1MeasureUnit
llResult = TABLEUPDATE(1,.T.,[MeasureUnit])
USE IN SELECT('tmp1MeasureUnit')

*-* Âûáèðàåì íîâûå òîâàðû è äîáàâëÿåì èõ â òàáëèöó Tovar
USE Tovar IN 0
USE IN SELECT('MeasureUnit')

INSERT INTO Tovar (TvrNM, MsuId, TvrTypeId,TvrIsActiv)  ;
SELECT DISTINCT Caption1,MeasureUnit.MsuId,2,1 FROM tempxml ;
left outer join MeasureUnit on tempxml.Units = MeasureUnit.MsuNM or tempxml.Units = MeasureUnit.MsuShortNM;
	WHERE SUBSTR(ALLTRIM(Caption1),1,80) NOT in ;
	(SELECT SUBSTR(ALLTRIM(TvrNM),1,80) FROM Tovar) 	
llResult = TABLEUPDATE(1,.T.,[Tovar])

*-* äîáàâëÿåì çàãîëîâîê ñìåòû
USE IN SELECT([lvFrmEdit])
USE lvFrmEdit IN 0 NODATA
INSERT INTO lvFrmEdit ( ;
	FrmTypeID, FrmDate, FrmDateAcc, FrmNum, FrmNote, FrmReason, FrmStatusID, FrmIsPayed, ;
	PointEmiOuID, PointEmiCltID, PointIspOuID, PointIspCltID, DevCltID, ExecEmiCltID, ;
	ExecIspCltID, ContrCltID, PointEmiCltSAccID, PointIspCltSAccID, FrmCurTypeID, FrmPrcTypeID, ;
	FrmAttribute ;
) VALUES ( ;
	42, DATETIME(), DATETIME(), '', ;
	'', '', 1, .f., ;
	null, null, null, null, ;
	null, null, null, null, ;
	null, null, 1, null, ;
	null ;
)
llResult = TABLEUPDATE(1,.T.,[lvFrmEdit])
IF NOT llResult
	TABLEREVERT(.T.,[lvFrmEdit])
	USE IN SELECT([lvFrmEdit])
	MESSAGEBOX([Äîêóìåíò íå çàãðóæåí!],48,[Çàãðóçêà äîêóìåíòà])
	RETURN
ENDIF
*------------------------------------------------------------------------------

*29.10.2010 14:39 -&gt;Ïîëó÷èì ID íîâîãî äîêóìåíòà
lnFrmID = spGetLastIncrementedId([lvFrmEdit])
USE IN SELECT([lvFrmEdit])
*------------------------------------------------------------------------------

*-* äîáàâëÿåì íîãè ñìåòû
USE IN SELECT([Tovar])
USE IN SELECT([FrmPartTvr])
USE FrmPartTvr IN 0 NODATA
INSERT INTO FrmPartTvr (FrmID, TvrId, MsuId,TvrQnt,TvrPrcBuy,TvrPrcSale )  ;
SELECT lnFrmID,Tovar.TvrId,Tovar.MsuId,Quantity,ROUND(PricePZ*1.18/Quantity,4),ROUND(PricePZ/Quantity,4)FROM tempxml ;
left outer join Tovar on SUBSTR(ALLTRIM(Caption1),1,80)  = Tovar.TvrNM

llResult = TABLEUPDATE(1,.T.,[FrmPartTvr])
USE IN SELECT([FrmPartTvr])

USE IN SELECT('MeasureUnit')

SELECT tempxml

RETURN

CREATE CURSOR FromXml (nId I AUTOINC ,cXml M)  &amp;&amp;C(254))
nPos = 1
nOcc = 1
SELECT FromXml
** çàêèäûâàåì xml â òàáëèöó
DO WHILE nPos &gt; 0
		cStartStr = FILETOSTR(lcLoadFromDir + [2.xml])
		nPos = AT('&lt;',cStartStr,nOcc)
		nPosL = AT('&gt;',cStartStr,nOcc)
	IF nPos = 0
	exit
	ENDIF
		cAddStr = SUBSTR(cStartStr,nPos+1,nPosl-nPos -1)
		INSERT INTO FromXml  (cXml) VALUES (cAddStr )
		**WAIT WINDOW NOWAIT SUBSTR(cAddStr ,1,200)
		nOcc = nOcc+1
ENDDO
**** 16,777,184 - ìàêñèìàëüíûé ðàçìåð ñòðîêè
*!*	SELECT * FROM FromXml  ;
*!*		WHERE   SUBSTR(cXml,1,17) = 'Position Caption=' OR ;
*!*				SUBSTR(cXml,1,9) = 'PriceBase' ORDER BY nId INTO CURSOR tmpXml
*!*	SELECT tmpXml

CREATE TABLE TMP\RezultXml.dbf FREE (nId I ,cName C(40),cVal C(254))  &amp;&amp;C(254))
SELECT FromXml
SCAN
	*cXml = 'Position Caption="Êîíôèãóðàöèÿ è íàñòðîéêà ñåòåâûõ êîìïîíåíòîâ (ìîñò, ìàðøðóòèçàòîð, ìîäåì è ò.ï.)          " Number="1" Code="ÒÅÐì10-06-068-15" Units="øò." Quantity="1" PriceLevel="2001" Vr2001="10057"'
	cXml = ALLTRIM(FromXml.cXml)
	nInd = FromXml.nId
	WAIT WINDOW NOWAIT nInd
	nPosNm = 1
	nPosVl = 1
	nOcc = 1
		DO WHILE nPosNm&gt;0
			nPosVl = AT('"',cXml ,nOcc)
			cNameV = SUBSTR(cXml,nPosNm,nPosVl-nPosNm-1)
			cNameV = ALLTRIM(IIF(SUBSTR(cNameV,1,1)='"',SUBSTR(cNameV,2),cNameV))
			nOcc = nOcc+1
			nPosNm = AT('"',cXml ,nOcc)
			nOcc = nOcc+1
			cValue = SUBSTR(cXml,nPosVl,nPosNm-nPosVl)
			cValue = ALLTRIM(IIF(SUBSTR(cValue ,1,1)='"',SUBSTR(cValue ,2),cValue ))
	IF !EMPTY(cNameV+cValue)
		INSERT INTO RezultXml (nId,CName,cVal) VALUES (nInd,cNameV,cValue)
	ENDIF
	SELECT FromXml
	IF nPosNm = 0
	exit
	ENDIF
		 ENDDO
ENDSCAN
USE IN SELECT([FromXml])
SELECT RezultXml
BROWSE
SET STEP ON

RETURN


*29.10.2010 14:29 -&gt;çàãðóæàåì ãîëîâó...
XMLTOCURSOR(lcLoadFromDir + [NaklHead.xml], [tmpNaklHead], 512)
REPLACE FrmStatusId WITH 1 IN tmpNaklHead
***

*29.10.2010 14:39 -&gt;çàãðóæàåì íîãè...
XMLTOCURSOR(lcLoadFromDir + [NaklFoot.xml], [tmpNaklFoot], 512)

*29.10.2010 14:55 -&gt;ÑÓÙÅÑÒÂÓÞÙÈÅ ÒÎÂÀÐÛ
USE lvFrmPartTvrEdit IN 0 NODATA
***
INSERT INTO lvFrmPartTvrEdit ( ;
	FrmID,TvrId,MsuId,TvrQnt,TvrQntNetto,TvrPrcBuy,TvrPrcSale,TvrIDCalc,User_) ;
SELECT  lnFrmID, ; &amp;&amp; ïðîñòàâèì èäåíòôèôêàòîð äîêóìåíòà
		Tovar.TvrId, ;
		tmpNaklFoot.MsuId, ;
		tmpNaklFoot.TvrQnt, ;
		tmpNaklFoot.TvrQntNetto, ;
		tmpNaklFoot.TvrPrcBuy, ;
		tmpNaklFoot.TvrPrcSale, ;
		tmpNaklFoot.TvrIdCalc, ;
		-1 ;
FROM tmpNaklFoot ;
INNER JOIN Tovar ON Tovar.ID_= tmpNaklFoot.TvrId
***
llResult = .T. &amp;&amp;llResult = TABLEUPDATE(1,.T.,[lvFrmPartTvrEdit])
IF NOT llResult
	TABLEREVERT(.T.,[lvFrmPartTvrEdit])
	USE IN SELECT([lvFrmPartTvrEdit])
	MESSAGEBOX([Äîêóìåíò íå çàãðóæåí!],48,[Çàãðóçêà äîêóìåíòà])
	RETURN
ELSE
	USE IN SELECT([lvFrmPartTvrEdit])
ENDIF
*------------------------------------------------------------------------------

*29.10.2010 14:56 -&gt;ÍÎÂÛÅ ÒÎÂÀÐÛ
** çàïèñü â òàáëèöó Tovar
USE lvTvrEdit IN 0 NODATA
***
INSERT INTO lvTvrEdit (TvrTypeID,TvrNM,TvrIsActiv,MsuID,ID_,User_) ;
SELECT ;
		2, ;
		ALLTRIM(tmpNaklFoot.TvrNM)+[_], ;
		1, ;
		tmpNaklFoot.MsuId, ;
		tmpNaklFoot.TvrID, ;
		-1 ;
FROM tmpNaklFoot ;
WHERE tmpNaklFoot.TvrId NOT IN (SELECT ID_ FROM Tovar WHERE ID_ &lt;&gt; 0 )
***
llResult = TABLEUPDATE(1,.T.,[lvTvrEdit])
IF NOT llResult
	TABLEREVERT(.T.,[lvTvrEdit])
	USE IN SELECT([lvTvrEdit])
	MESSAGEBOX([Äîêóìåíò íå çàãðóæåí!],48,[Çàãðóçêà äîêóìåíòà])
	RETURN
ELSE
	USE IN SELECT([lvTvrEdit])
ENDIF
*------------------------------------------------------------------------------

USE lvFrmPartTvrEdit IN 0 NODATA
***
INSERT INTO lvFrmPartTvrEdit ( ;
	FrmID,TvrId,MsuId,TvrQnt,TvrQntNetto,TvrPrcBuy,TvrPrcSale,TvrIDCalc,User_) ;
SELECT  lnFrmID, ; &amp;&amp; ïðîñòàâèì èäåíòôèôêàòîð äîêóìåíòà
		Tovar.TvrId, ;
		tmpNaklFoot.MsuId, ;
		tmpNaklFoot.TvrQnt, ;
		tmpNaklFoot.TvrQntNetto, ;
		tmpNaklFoot.TvrPrcBuy, ;
		tmpNaklFoot.TvrPrcSale, ;
		tmpNaklFoot.TvrIdCalc, ;
		-1 ;
FROM tmpNaklFoot ;
WHERE tmpNaklFoot.TvrId NOT IN (SELECT ID_ FROM Tovar WHERE ID_ &lt;&gt; 0 )
***
llResult = llResult = TABLEUPDATE(1,.T.,[lvFrmPartTvrEdit])
IF NOT llResult
	TABLEREVERT(.T.,[lvFrmPartTvrEdit])
	USE IN SELECT([lvFrmPartTvrEdit])
	MESSAGEBOX([Äîêóìåíò íå çàãðóæåí!],48,[Çàãðóçêà äîêóìåíòà])
	RETURN
ELSE
	USE IN SELECT([lvFrmPartTvrEdit])
ENDIF
*------------------------------------------------------------------------------

*29.10.2010 15:16 -&gt;Îáíîâëÿåì çàïèñü
This._RSRequeryOne(lnFrmID)
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE _gethandledcustommsglist
*-------------------------------------------------------
* Project.........:	BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD._GETHANDLEDCUSTOMMSGLIST
* Called by.......: &lt;.RefreshHandledCustomMsgList();.RightClick()&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;lcHandledCustomMsgList&gt;
* Notes...........: &lt;public/user/nodefault&gt; Ôîðìèðîâàíèå ñïèñêà ïîëüçîâàòåëüñêèõ ñîîáùåíèé íà îñíîâàíèè
*					ñïèñêà ñîîáùåíèé, óêàçàííûõ â ñâîéñòâå ._HandledCustomMsgList, ïóòåì óäàëåíèÿ ñîîáùåíèé,
*					êîòîðûå íå ìîãóò áûòü îáðàáîòàíû â äàííîì êîíòåêñòå.
*-------------------------------------------------------
WITH This

*09.12.2004 14:12 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcHandledCustomMsgList, ;
		lnCounter
*------------------------------------------------------------------------------

*******************************************************************************
* Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà                                         *
*******************************************************************************

*09.12.2004 14:30 -&gt;Ïîëó÷èì ñïèñîê ñîîáùåíèé, êîòîðûå ìîãóò áûòü îáðàáîòàíû ðîäèòåëüñêèì êëàññîì
lcHandledCustomMsgList = DODEFAULT()
*------------------------------------------------------------------------------
*09.12.2004 14:29 -&gt;Åñëè ñïèñîê ñîîáùåíèé ïóñòîé - âûéäåì èç ìåòîäà
IF EMPTY(lcHandledCustomMsgList)
	RETURN lcHandledCustomMsgList
ENDIF
*------------------------------------------------------------------------------

*******************************************************************************
* Èíèöèèðóåì ìàññèâ ñâîéñòâ CustomFuct                                        *
*******************************************************************************
*09.12.2004 14:07 -&gt;Èíèöèèðóåì ìàññèâ ñâîéñòâ CustomFunct
IF !.lCstFuncPropInitiated
	*07.12.2004 14:37 -&gt;Âûïîëíÿåì çàïðîñ èíôîðìàöèè î CustomFunc äëÿ äàííîé ôîðìû
	SELECT lvCstFuncAllByScrFrm
	SCAN ALL
		IF ISNULL(.aCstFuncProp)
			lnNewSref = 1
		ELSE
			lnNewSref = ALEN(.aCstFuncProp,1) + 1
		ENDIF
		DIMENSION .aCstFuncProp[lnNewSref,cnCSTFUNC_ARRAY_COLS]
		.aCstFuncProp[lnNewSref,cnCSTFUNC_MSG] = UPPER(ALLTRIM(lvCstFuncAllByScrFrm.CstFuncMsg))
		.aCstFuncProp[lnNewSref,cnCSTFUNC_FRMTYPE] = lvCstFuncAllByScrFrm.FrmTypeID
	ENDSCAN
	*------------------------------------------------------------------------------
	
	*07.12.2004 14:57 -&gt;Âûñòàâèì ôëàã
	.lCstFuncPropInitiated = .T.
	*------------------------------------------------------------------------------
ENDIF
*------------------------------------------------------------------------------

*******************************************************************************
* Óäàëèì ôóíêöèè, êîòîðûå íå ìîãóò áûòü âûïîëíåíû íàä äàííûì òèïîì äîêóìåíòà  *                                        *
*******************************************************************************

*31.10.2003 17:20 -&gt;Äîáàâëÿåì ñëåâà è ñïðàâà ïî ; ÷òîáû êîððåêòíî îáðàáûòûâàòü "êðàéíèå" ñîîáùåíèÿ
lcHandledCustomMsgList = [;]+UPPER(ALLTRIM(lcHandledCustomMsgList))+[;]
*------------------------------------------------------------------------------

*09.12.2004 14:11 -&gt;Ïðîâåðÿåì ôóíêöèè ïðèâÿçàííûå ê òèïó äîêóìåíòà
IF !ISNULL(.aCstFuncProp)
	FOR lnCounter = 1 TO ALEN(.aCstFuncProp,1)
		IF 	!EMPTY(.aCstFuncProp[lnCounter,cnCSTFUNC_FRMTYPE]) AND ;				&amp;&amp;ôóíêöèÿ ïðèâÿçàíà â òèïó äîêóìåíòà
			.aCstFuncProp[lnCounter,cnCSTFUNC_FRMTYPE] # PrimaryDocView.FrmTypeID	&amp;&amp;è ýòîò òèï íå òèï òåêóùåãî äîêóìåíòà
			*{
			lcHandledCustomMsgList = STRTRAN(lcHandledCustomMsgList,[;]+.aCstFuncProp[lnCounter,cnCSTFUNC_MSG]+[;],[;])
			*}
		ENDIF
	ENDFOR
ENDIF
*------------------------------------------------------------------------------
			
*09.12.2004 14:34 -&gt;Óäàëÿåì ñëåâà è ñïðàâà ; äîáàâëåííûå ðàíåå
IF !(lcHandledCustomMsgList==[;])
	lcHandledCustomMsgList = SUBSTR(lcHandledCustomMsgList,2,LEN(lcHandledCustomMsgList)-2)
ELSE
	lcHandledCustomMsgList = [NAKLOUT]
ENDIF	
*------------------------------------------------------------------------------
			
*05.04.2004 15:30 -&gt;Âåðíåì ñïèñîê ñîîáùåíèé
RETURN lcHandledCustomMsgList
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE _gethandledstandartmsglist
*------------------------------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRIMARYDOC_V1.VCX
* Class.Module....: grdFormView._GETHANDLEDSTANDARTMSGLIST
* Called by.......: &lt;.RefreshHandledStandartMsgList();.RightClick()&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;lcResult&gt;
* Notes...........: Çàïðåòèì óäàëåíèå, åñëè òåêóùèé äîêóìåíò àêöåïòîâàí
*------------------------------------------------------------------------------

*15.09.2005 15:23 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnFrmID, ;
		lcResult
***
lnFrmID = PrimaryDocView.FrmID
*------------------------------------------------------------------------------

*15.09.2005 15:24 -&gt; Îïðåäåëèì ðàçðåø¸ííûå îïåðàöèè
IF lnFrmID = 0

	*21.12.2005 10:33 -&gt; Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
	lcResult = DODEFAULT()
	*------------------------------------------------------------------------------

ELSE
	
	*15.09.2005 15:27 -&gt; Ïîëó÷èì èíôîðìàöèþ î ñòàòóñå äîêóìåíòà
	LOCAL _PARAM
	_PARAM = lnFrmID
	***
	USE IN IIF(USED([lvFrmStatusInfoByFrmID]),[lvFrmStatusInfoByFrmID],0)
	USE lvFrmStatusInfoByFrmID IN 0
	*------------------------------------------------------------------------------

	*15.09.2005 15:28 -&gt; Ïðîâåðèì ó÷àñòâóåò ëè äîêóìåíò â ó÷åòå
	IF	!lvFrmStatusInfoByFrmID.FrmStatIsInvAcc AND ;
		!lvFrmStatusInfoByFrmID.FrmStatIsCostAcc

		*27.03.2006 10:50 -&gt; Ðàçðåøèì âñå îïåðàöèè
		lcResult = DODEFAULT()
		*------------------------------------------------------------------------------

	ELSE

		*27.03.2006 10:54 -&gt; Èñêëþ÷èì óäàëåíèå äîêóìåíòà èç ñïèñêà âîçìîæíûõ îïåðàöèé
		lcResult = STRTRAN([;] + DODEFAULT() + [;],[;DELE;],[;])
		*------------------------------------------------------------------------------

		*15.12.2005 17:49 -&gt; Óäàëÿåì ñëåâà è ñïðàâà ; äîáàâëåííûå ðàíåå
		IF !(lcResult == [;])
			lcResult = SUBSTR(lcResult,2,LEN(lcResult)-2)
		ELSE
			lcResult = []
		ENDIF	
		*------------------------------------------------------------------------------

	ENDIF
	*------------------------------------------------------------------------------

ENDIF
*------------------------------------------------------------------------------

*15.09.2005 15:23 -&gt; Âîçâðàùàåì ðåçóëüòàò
RETURN lcResult
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE _handlecustommsg
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: grdFormView._HandleCustomMsg
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Îáðàáîòêà CustomMsg
*------------------------------------------------------------------------------
LPARAMETERS tcMsg
*!*	oMgrPD._HandleCustomMsg(tcMsg)
*!*	RETURN
*14.10.2005 15:04 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL   luResult
*------------------------------------------------------------------------------
*06.12.2005 13:58 -&gt;Âûïîëíèì êîìàíäó
DO CASE

	CASE tcMsg == [REQSALE]

		*09.12.2004 18:10 -&gt; Ïåðåîïðåäåëÿåì öåíû ïðîäàæè
	    spReqPriceSale(PrimaryDocView.FrmID,PrimaryDocView.PrcTypeID)
	    *------------------------------------------------------------------------------

		*22.12.2004 15:16 -&gt; Îáíîâëÿåì çàïèñü
		This._RSRequeryOne(PrimaryDocView.FrmID)
		*------------------------------------------------------------------------------

	    *20.06.2006 12:12 -&gt; Îáíîâëÿåì ñâÿçàííûå äàííûå
	    This._RefreshRelatedObjects()
		*------------------------------------------------------------------------------

	CASE tcMsg == [REQPRICE]

		*09.12.2004 18:10 -&gt; Ïåðåîïðåäåëÿåì öåíû ïîñòóïëåíèÿ
	    spReqPriceBay(PrimaryDocView.FrmID,.T.)
	    *------------------------------------------------------------------------------

		*22.12.2004 15:16 -&gt; Îáíîâëÿåì çàïèñü
		This._RSRequeryOne(PrimaryDocView.FrmID)
		*------------------------------------------------------------------------------

	    *20.06.2006 12:12 -&gt; Îáíîâëÿåì ñâÿçàííûå äàííûå
	    This._RefreshRelatedObjects()
		*------------------------------------------------------------------------------

	CASE tcMsg == [REQACTBAY]
		*** - 11.07.2009 09:17:24 Ãëóõîâ Â.Þ. (C) - &gt;
		IF PrimaryDocView.StatusId&lt;3
			*09.12.2004 18:10 -&gt; Ïåðåîïðåäåëÿåì öåíû ïîñòóïëåíèÿ íà ãîòîâûå áëþäà
		    spReqActBay(PrimaryDocView.FrmID,.T.)
		    *------------------------------------------------------------------------------

			*22.12.2004 15:16 -&gt; Îáíîâëÿåì çàïèñü
			This._RSRequeryOne(PrimaryDocView.FrmID)
			*------------------------------------------------------------------------------

		    *20.06.2006 12:12 -&gt; Îáíîâëÿåì ñâÿçàííûå äàííûå
		    This._RefreshRelatedObjects()
			*------------------------------------------------------------------------------
		ELSE
			MESSAGEBOX('Ýòîò äîêóìåí íåëüçÿ ìåíÿòü ...',0+64,'Äîêóìåíò àêöåïòîâàí')
		ENDIF
	CASE tcMsg == [MAKEACTPRO]
		*09.12.2004 18:10 -&gt; Ôîðìèðîâàíèå àêòà ïðîèçâîäñòâà ïî íàáîðó áëþä
		spMakeActPro(PrimaryDocView.FrmID,.T.)
		*------------------------------------------------------------------------------

		*22.12.2004 15:16 -&gt; Îáíîâëÿåì çàïèñü
		This._RSRequeryOne(PrimaryDocView.FrmID)
		*------------------------------------------------------------------------------

	    *20.06.2006 12:12 -&gt; Îáíîâëÿåì ñâÿçàííûå äàííûå
	    This._RefreshRelatedObjects()
		*------------------------------------------------------------------------------

	CASE tcMsg == [PAYDOCEXP]

		*09.12.2004 18:10 -&gt;Ýêñïîðò ïëàòåæíûõ ïîðó÷åíèé
		*** Ïðîâåðÿåì íà íàëè÷èå ïîìå÷åíûõ çàïèñåé
		LOCAL lcUniqueName
		PUBLIC lcTmpAl, llAll
		llAll = .f.
		lcTmpAl      = [_d] + SYS(2015)
		lcUniqueNameId = [tmp\] + lcTmpAl + [.DBF]
		SELECT FrmId AS Id FROM PrimaryDocView WHERE _Mark INTO TABLE (lcUniqueNameId)

		IF _tally &gt;0 AND MESSAGEBOX('Ðàáîòàòü ñ òåêóùèì äîêóìåíòîì (ÄÀ) èëè'+CHR(13)+;
									'c ïîìå÷åíûìè (ÍÅÒ)?',4+64+256,'C êàêèìè äîêóìåíòàìè ðàáîòàòü ...')&lt;&gt;6
			llAll = .t.
		ENDIF

		USE IN (lcTmpAl)
		oMgrPD.Operate([PAYDOC],[EXPORT],PrimaryDocView.FrmID)
		RELEASE lcTmpAl, llAll
		*------------------------------------------------------------------------------
	CASE tcMsg == [EMPLWK]
		*01.10.2007 18:10 -&gt;Ðåãèñòðàöèÿ ñîòðóäíèêà íà ðàáîòå
loLoginForm = oApp.DoFormObj([loginempl;pos.vcx])

	CASE tcMsg == [PAYORD]
LOCAL nPayVarNum
nPayVarNum = ALLT(oRes.GetParam([RST],[PAYTYPE]))
		*16.09.2007 18:10 -&gt;Îïëàòà ñ÷åòà êëèåíòà
		LOCAL lnFrmID
		lnFrmID = PrimaryDocView.FrmID
			IF PrimaryDocView.FrmSum&lt;=0 AND MESSAGEBOX('Äîêóìåíò óæå îïëà÷åí, îôîðìèòü Âîçâðàò (âûáåðèòå Äà)'+ CHR(13) + ;
				'èëè ñäåëàòü Äîïëàòó (âûáåðèòå Íåò)?',4+32+256,'Îôîðìëåíèå âîçâðàòà çàêàçà')=6
			**+ CHR(13) + ;
			**		 								   'èëè ñäåëàòü Äîïëàòó (âûáåðèòå Íåò)?'
				lRetVal = oApp.DoModalFormRetValObj([FrmPayment;payment.vcx],lnFrmID  ,nPayVarNum,IIF(PrimaryDocView.FrmSum&lt;=0,2,1) ,0)
*!*					  ELSE
*!*					 	RETURN
*!*					 ENDIF
			 ELSE
				lRetVal = oApp.DoModalFormRetValObj([FrmPayment;payment.vcx],lnFrmID  ,nPayVarNum,IIF(PrimaryDocView.FrmIsPayed,1,1) ,0)
			ENDIF

*****		lRetVal = oApp.DoModalFormRetValObj([FrmPayment;rst_v1.vcx],lnFrmID  ,nPayVarNum,1 ,0)
		*------------------------------------------------------------------------------
	    This._RSRequeryOne(lnFrmID)

	CASE tcMsg == [PAYDOCIMP]

		*09.12.2004 18:10 -&gt;Èìïîðò ïëàòåæíûõ äîêóìåíòîâ
		oMgrPD.Operate([PAYDOC],[IMPORT])
		*------------------------------------------------------------------------------

	CASE tcMsg == [PAYDOCMAKE]

		*15.01.2006 18:10 -&gt;ôîðìèðîâàíèå ïëàòåæíûõ äîêóìåíòîâ
* ïðîâåðÿåì íàëè÷èå ðåæèìà ðàáîòû ñ äîêóìåíòàìè íà îïëàòó
		IF oQryParMgr.ParamGet(thisForm.oFlt.cntQueryParam.cQryParSID,[qplQueue])
		       this._PAYDOCMAKE
		      ELSE
		      =MESSAGEBOX('Ïåðåéäèòå â ðåæèì ðàáîòû "Î÷åðåäü äîêóìåíòîâ íà îïëàòó"',16)
		ENDIF
		*------------------------------------------------------------------------------

	*CASE tcMsg == [MAKETOVOTCH]

		*15.01.2006 18:10 -&gt;ôîðìèðîâàíèå òîâàðíîãî îò÷åòà
		*oMgrPD.Operate([FORM],[MAKETOVOTCH])
	*	WAIT WINDOW "ïîêà íå  ñäåëàíî ..."
		*------------------------------------------------------------------------------

	CASE tcMsg == [INHERIT]
	
		*09.12.2004 18:10 -&gt; Íàñëåäîâàíèå äîêóìåíòà
		This._Inherit()
		*------------------------------------------------------------------------------
		
	CASE tcMsg == [NAKLOUT]
	
		*06.12.2005 13:57 -&gt;Ôîðìèðîâàíèå íàêëàäíîé ïî ðåçóëüòàòàì ïðîäàæ
		This._NaklOut()
		*------------------------------------------------------------------------------
		
	CASE tcMsg == [READDATAIN]
	
		*23.01.2006 17:42 -&gt; Âûïîëíÿåì îïåðàöèþ
		This._ReadDataIn()
		*------------------------------------------------------------------------------

	CASE tcMsg == [READDATAOUT]
	
		*23.01.2006 17:42 -&gt; Âûïîëíÿåì îïåðàöèþ
		This._ReadDataOut()
		*------------------------------------------------------------------------------

	CASE tcMsg == [READDATAINV]
	
		*23.01.2006 17:42 -&gt; Âûïîëíÿåì îïåðàöèþ
		This._ReadDataInv()
		*------------------------------------------------------------------------------

	CASE tcMsg == [INVBLUDO]

		*19.07.2006 10:47 -&gt; Ðàçâîðà÷èâàåì áëþäà ïî èíãðåäèåíòàì
		spInventoryBludo(PrimaryDocView.FrmID)
		*------------------------------------------------------------------------------

		*22.12.2004 15:16 -&gt; Îáíîâëÿåì çàïèñü
		This._RSRequeryOne(PrimaryDocView.FrmID)
		*------------------------------------------------------------------------------

	    *20.06.2006 12:12 -&gt; Îáíîâëÿåì ñâÿçàííûå äàííûå
	    This._RefreshRelatedObjects()
		*------------------------------------------------------------------------------

	CASE tcMsg == [FILLCORR]

		*08.09.2006 10:38 -&gt;Çàïîëíåíèå êîððåêòèðóþùåãî äîêóìåíòà
		oMgrPD.Operate([FORM],[FILLCORR],PrimaryDocView.FrmID)
		*------------------------------------------------------------------------------

	    *08.09.2006 15:18 -&gt;Îáíîâëÿåì ñâÿçàííûå äàííûå
	    This._RefreshRelatedObjects()
		*------------------------------------------------------------------------------

	CASE tcMsg == [TRANCORR]

		*08.09.2006 10:38 -&gt;Çàïîëíåíèå êîððåêòèðóþùåãî äîêóìåíòà
		oMgrPD.Operate([FORM],[TRANCORR],PrimaryDocView.FrmID)
		*------------------------------------------------------------------------------

	    *08.09.2006 15:18 -&gt;Îáíîâëÿåì ñâÿçàííûå äàííûå
	    This._RefreshRelatedObjects()
		*------------------------------------------------------------------------------

	CASE tcMsg == [FRMACT]
	
		*06.12.2005 13:57 -&gt;Ôîðìèðîâàíèå íàêëàäíîé ïî ðåçóëüòàòàì ïðîäàæ
		This._FrmAct()
		*------------------------------------------------------------------------------
		
	CASE tcMsg == [DOCTOXML]
		
		*02.04.2007 13:51 -&gt;Âûãðóçêà äîêóìåíòà â XML
		This._DocToXML()
		*------------------------------------------------------------------------------
		
	CASE tcMsg == [DOCFROMXML]
		
		*02.04.2007 13:57 -&gt;Çàãðóçêà äîêóìåíòà èç XML
		This._DocFromXML()
		*------------------------------------------------------------------------------
	CASE tcMsg == [TO1C]
		
		*29.10.2010 13:57 -&gt;Âûãðóçêà â 1Ñ
		This._ExportTo1C()
		*------------------------------------------------------------------------------
	CASE tcMsg == [FROM_GARANT]
		
		*29.10.2010 13:57 -&gt;Çàãðóçêà äàííûõ èç ãàðàíòà
		
		this._rsrequeryone(This._FromGarant(),.t. )
		*------------------------------------------------------------------------------
	CASE tcMsg == [GANNT_SMT]
		*21.11.2006 16:19 -&gt;Çàïóñêàåì ôîðìó äëÿ ïðîñìîòðà ñìåòû ÷åðåç Ãàííòà
		oApp.DoFormObj([frmressmeta;prom_proj.vcx;PrimaryDoc.app],PrimaryDocView.FrmID)
		this._rsrequeryone(PrimaryDocView.FrmID,.t.)
		*------------------------------------------------------------------------------
	CASE tcMsg == [GANNT]

		*21.11.2006 16:19 -&gt;Çàïóñêàåì ôîðìó äëÿ ïðîñìîòðà äîêóìåíòîâ ÷åðåç Ãàííòà
		oApp.DoFormObj([frmresuprom;prom_proj.vcx;PrimaryDoc.app],PrimaryDocView.FrmID)
		*------------------------------------------------------------------------------
		this._rsrequeryone(PrimaryDocView.FrmID,.t.)
	CASE tcMsg == [FIN_GANNT]

		*21.11.2006 16:19 -&gt;Çàïóñêàåì ôîðìó äëÿ ïðîñìîòðà äèàãðàììû ôèíàíñîâ
		SELECT FrmId FROM PrimaryDocView WHERE PrimaryDocView._Mark INTO TABLE TMP\listadd
		USE IN SELECT([listadd])
		oApp.DoFormObj([frmresfin;prom_proj.vcx;PrimaryDoc.app],PrimaryDocView.FrmID)
		*------------------------------------------------------------------------------
		USE IN SELECT([listadd])
		this._rsrequeryone(PrimaryDocView.FrmID,.t.)
		*
	CASE tcMsg == [MAKE_SMT]
		*21.07.2011 16:19 -&gt;Çàïóñêàåì ôîðìó ïîäãîòîâêè ñìåòû
		oApp.DoFormObj([frmMakeSmt;prom_proj.vcx;PrimaryDoc.app],PrimaryDocView.FrmID)
		*------------------------------------------------------------------------------
		this._rsrequeryone(PrimaryDocView.FrmID,.t.)
		*
	CASE tcMsg == [CHILD_FRM]
		*21.07.2011 16:19 -&gt;Çàïóñêàåì ôîðìó äëÿ ïðîñìîòðà äî÷åðíèõ äîêóìåíòîâ
		*** çäåñü íàäî áóäåò îïðåäåëèòü ThisForm.nScrFrmID
		LOCAL cNamePar
		cNamePar = ALLTRIM(NVL(PrimaryDocView.FTShortNM,''))+' îò '+TTOC(PrimaryDocView.FrmDate) +' #:'+ALLTRIM(PrimaryDocView.FrmNum)+' ('+ALLT(PrimaryDocView.FrmReason)+')'
		oApp.ExecuteScrFormById(81,PrimaryDocView.FrmID,cNamePar)

	CASE tcMsg == [FRM_TO_CHILD]
		*21.07.2011 16:19 -&gt;ñîõðàíÿåì êîä ôîðìû äëÿ ïåðåäà÷è åå â êà÷åñòâå äî÷åðíåé
		PUBLIC nPublFrmId
		nPublFrmId = PrimaryDocView.FrmID
			MESSAGEBOX('Äîêóìåíò ãîòîâ ê èñïîëüçîâàíèþ â äðóãîì ...',0+64,'Îïðåäåëåí äî÷åðíèé äîêóìåíò ...')

	CASE tcMsg == [FRM_TO_CHILD_ACC]
		*21.07.2011 16:19 -&gt;ïðèíèìàåì êîä ôîðìû
		IF VARTYPE(nPublFrmId)='N'
			nInFrmId = PrimaryDocView.FrmID
			this._addchilddoc(nInFrmId,nPublFrmId)
			RELEASE nPublFrmId
			MESSAGEBOX('Îïðåäåëåí äî÷åðíèé äîêóìåíò äëÿ äàííîãî',0+64,'Îïðåäåëèòå äî÷åðíèé äîêóìåíò ...')
			ELSE
			MESSAGEBOX('Íå îïðåäåëåí äî÷åðíèé äîêóìåíò äëÿ äàííîãî',0+64,'Îïðåäåëèòå äî÷åðíèé äîêóìåíò ...')
		ENDIF
	CASE tcMsg == [FRM_TO_LINK_ACC]
		*21.07.2011 16:19 -&gt;ïðèíèìàåì êîä ôîðìû
		IF VARTYPE(nPublFrmId)='N'
			nInFrmId = PrimaryDocView.FrmID
			this._addLinkDoc(nInFrmId,nPublFrmId)
			RELEASE nPublFrmId
			MESSAGEBOX('Îïðåäåëåí ñâÿçàííîãî äîêóìåíò äëÿ äàííîãî',0+64,'Îïðåäåëèòå ñâÿçàííîãî äîêóìåíò ...')
			ELSE
			MESSAGEBOX('Íå îïðåäåëåí ñâÿçàííû äîêóìåíò äëÿ äàííîãî',0+64,'Îïðåäåëèòå ñâÿçàííûé äîêóìåíò ...')
		ENDIF
	CASE tcMsg == [MAKE_DAYLY]
		*21.07.2011 16:19 -&gt;Çàïóñêàåì ôîðìó ïîäãîòîâêè åæåäíåâíîé çàÿâêè ïî ìåíþ
		oApp.DoFormObj([frmMakeDayly;prom_proj.vcx;PrimaryDoc.app],PrimaryDocView.FrmID,PrimaryDocView.StatusId,PrimaryDocView.PIspOUID)
		*------------------------------------------------------------------------------
		this._rsrequeryone(PrimaryDocView.FrmID,.t.)
		*
ENDCASE
*------------------------------------------------------------------------------

*10.12.2004 13:58 -&gt;Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT(tcMsg)
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE _info
*!*		*********************************************************************************************
*!*		*[SCRFRMQRYPAR] &amp;&amp; [EDIT] - èçìåíåíèå ïîðÿäêà âõîæäåíèÿ ïàðàìåòðîâ							*
*!*		*********************************************************************************************
*!*		CASE lcEntityName == [SCRFRMQRYPAR] AND lcRequestedOperation == [EDIT]

*!*			*08.07.2004 14:28 -&gt;Ñïèñîê äîïîëíèòåëüíûõ ïàðàìåòðîâ
*!*			* tuParam1 - èäåíòèôèêàòîð ýêðàííîé ôîðìû
*!*			*------------------------------------------------------------------------------

*!*			*19.05.2004 19:44 -&gt;Âûïîëíèì îïåðàöèþ
		llOperateResult = oApp.DoModalFormRetValObj([frmqmsindexedit;prom_proj.vcx;prom_proj.app],PrimaryDocView.FrmID)
*		RETURN llOperateResult
		*------------------------------------------------------------------------------

this._rsrequery(PrimaryDocView.FrmID)

*oMgrPD.Operate([FORM],[INFO],FrmPartFrmView.FrmID)
ENDPROC
PROCEDURE _inherit
*------------------------------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRIMARYDOC_V1.VCX
* Class.Module....: GRDDOCSVIEW._Inherit
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Íàñëåäîâàíèå äîêóìåíòà
*------------------------------------------------------------------------------

*12.05.2004 03:25 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	luResInheriting
*------------------------------------------------------------------------------
SELECT FrmId FROM FrmPartFrmView WHERE FrmPartFrmView._Mark INTO TABLE TMP\listadd
USE IN listadd
*12.05.2004 03:26 -&gt; Âûïîëíÿåì îïåðàöèþ íàñëåäîâàíèÿ äîêóìåíòà
luResInheriting = oMgrPD.Operate([FORM],[INHERIT],FrmPartFrmView.FrmID)
*------------------------------------------------------------------------------

*12.05.2004 03:26 -&gt; Îáðàáàòûâàåì ðåçóëüòàò êîïèðîâàíèÿ
IF TYPE([luResInheriting])==[N] AND !EMPTY(luResInheriting)
	USE IN SELECT([lvFrmPartFrmEdit])
	USE lvFrmPartFrmEdit IN 0 NODATA
	   INSERT INTO lvFrmPartFrmEdit ;
	         (FrmId,;
	          cntFrmID,;
	          cntFrmincludeSum,;
	          CntFrmIncludeSumVAT,;
	          cntfrmsumsplitprocid) ;
	       VALUES ;
	         (PrimaryDocView.FrmID,;
	          luResInheriting,;
	          0,;
	          0 ,;
	          1 )
		llResult = TABLEUPDATE(1,.T.,[lvFrmPartFrmEdit])
	USE IN SELECT([lvFrmPartFrmEdit])

	
	*22.12.2004 15:16 -&gt; Îáíîâëÿåì çàïèñü
	This._RSRequeryOne(luResInheriting)
	*------------------------------------------------------------------------------

ENDIF
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE _mark
REPLACE FrmPartFrmView._mark WITH !FrmPartFrmView._mark
IF !EOF()
	SKIP 1
ENDIF


ENDPROC
PROCEDURE _naklout
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: primarydoc_v1.vcx
* Class.Module....: grdFormView._NaklOut
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Ôîðìèðîâàíèå ðàñõîäíîé íàêëàäíîé ïî ðåçóëüòàòàì ïðîäàæ
*------------------------------------------------------------------------------

*06.12.2005 12:03 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	luResAddingNaklOut
*------------------------------------------------------------------------------

*06.12.2005 12:04 -&gt;Âûïîëíÿåì îïåðàöèþ íàñëåäîâàíèÿ äîêóìåíòà
luResAddingNaklOut = oMgrPD.Operate([FORM],[NAKLOUT])
*------------------------------------------------------------------------------

*12.05.2004 03:26 -&gt; Îáðàáàòûâàåì ðåçóëüòàò êîïèðîâàíèÿ
IF TYPE([luResAddingNaklOut])==[N] AND luResAddingNaklOut&gt;0
	
	*22.12.2004 15:16 -&gt; Îáíîâëÿåì çàïèñè
	This._RSRequery()
	*------------------------------------------------------------------------------

ELSE
	MESSAGEBOX([Íàêëàäíûå íå ñôîðìèðîâàíû],48,[Ïðåäóïðåæäåíèå])
ENDIF
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE _paydocmake
*12.05.2004 03:25 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	luResInheriting,lnthisFrm
*------------------------------------------------------------------------------
lnthisFrm = PrimaryDocView.FrmID
SELECT distinct PrimaryDocView.FrmID as cntFrmID ,;
PrimaryDocView.FrmSum as FrmIncSum ,;
PrimaryDocView.FrmVatSum AS PartSumVat ,;
PrimaryDocView.PEmiOuId as PIspOuID ,;
PrimaryDocView.PIspOuId as PEmiOuID ,;
PrimaryDocView.PEmiCltId as PIspCltID ,;
PrimaryDocView.PIspCltId as PEmiCltID ,;
PrimaryDocView.PEmiAccID as PIspSaccID ,;
PrimaryDocView.PIspAccID as PEmiSaccID ,;
FrmTypePay.FrmTypeID ;
FROM PrimaryDocView ;
INNER JOIN Basis!FrmTypePay ON PrimaryDocView.FrmTypeID = FrmTypePay.IncludeFrmTypeID AND FrmTypePay.IsDefault ;
WHERE PrimaryDocView._Mark OR PrimaryDocView.FrmID =  lnthisFrm ;
ORDER BY 4,5,6,7,8,9,10 ;
INTO TABLE TMP\listadd

USE IN listadd
*12.05.2004 03:26 -&gt; Âûïîëíÿåì îïåðàöèþ íàñëåäîâàíèÿ äîêóìåíòà
luResInheriting = oMgrPD.Operate([FORM],[TOPAY],PrimaryDocView.FrmID)
*------------------------------------------------------------------------------
USE IN SELECT('listadd')
ERASE TMP\listadd.dbf

*12.05.2004 03:26 -&gt; Îáðàáàòûâàåì ðåçóëüòàò êîïèðîâàíèÿ
IF TYPE([luResInheriting])==[N] AND !EMPTY(luResInheriting)
	
	*22.12.2004 15:16 -&gt; Îáíîâëÿåì çàïèñü
	This._RSRequeryOne(luResInheriting)
	*------------------------------------------------------------------------------

ENDIF
*------------------------------------------------------------------------------

RETURN






LOCAL lnrecord,lcwhere, controlSumm,lnFrmId,lcntDoc
lcwhere  = ''
lnrecord = RECNO('PrimaryDocView')
lcntDoc = 0
WAIT WINDOW "ôîðìèðóåì ïëàòåæíûå äîêóìåíòû" NOWAIT
* îïðåäåëÿåì: ðàáîòàåì ñ òåêóùèì èëè ñ ïîìå÷åíûìè
SELECT _mark FROM PrimaryDocView INTO CURSOR MakePay WHERE _mark
USE IN MakePay
IF _tally&gt;0 AND MESSAGEBOX('Ðàáîòàåì ñ òåêóùåé çàïèñüþ (äà) èëè ñ î÷åðåäüþ (íåò)?',4+32+256)=7
lcwhere = ' WHERE PrimaryDocView._mark '
ELSE
LOCAL lnFrmID
lnFrmID = PrimaryDocView.FrmID
lcwhere = ' WHERE PrimaryDocView.FrmID = lnFrmID '
ENDIF

*îïðåäåëÿåì ñóììó äîêóìåíòà
*îïðåäåëÿåì íäñ äîêóìåíòà
*îïðåäåëÿåì êëèåíòà
*îïðåäåëÿåì êëèåíòà
*îïðåäåëÿåì îòäåë
*îïðåäåëÿåì îòäåë
*îïðåäåëÿåì òèï äîêóìåíòà
*îïðåäåëÿåì ñòàòóñ äîêóìåíòà
*îïðåäåëÿåì ðàññ÷åòíûé ñ÷åò
SELECT PrimaryDocView.FrmID as cntFrmID ,;
PrimaryDocView.FrmSum as cntFrmincludeSum ,;
PrimaryDocView.FrmVatSum AS FrmpartFrmSumVatRate ,;
PrimaryDocView.PointEmiOu as PointIspOuID ,;
PrimaryDocView.PointIspOu as PointEmiOuID ,;
PrimaryDocView.PointEmiCl as PointIspCltID ,;
PrimaryDocView.PointIspCl as PointEmiCltID ,;
PrimaryDocView.PEmiAccID as PointIspCltsaccID ,;
PrimaryDocView.PIspAccID as PointEmiCltsaccID ,;
FrmTypePay.FrmTypeID ;
FROM PrimaryDocView ;
INNER JOIN Basis!FrmTypePay ON PrimaryDocView.FrmTypeID = FrmTypePay.IncludeFrmTypeID AND FrmTypePay.IsDefault ;
&amp;lcwhere  ;
ORDER BY 4,5,6,7,8,9,10 ;
INTO CURSOR TmpPay

USE IN SELECT([lvFrmEdit])
USE lvFrmEdit IN 0 NODATA
USE IN SELECT([lvFrmPartFrmEdit])
USE lvFrmPartFrmEdit IN 0 NODATA
SELECT TmpPay
controllSumm = - 100
SCAN &amp;&amp;FOR .f.
IF !controllSumm = NVL(TmpPay.PointIspOuID,0)+ NVL(TmpPay.PointEmiOuID,0)+ NVL(TmpPay.PointIspCltID,0)+ NVL(TmpPay.PointEmiCltID,0)+ NVL(TmpPay.PointIspCltsaccID,0)+ NVL(TmpPay.PointEmiCltsaccID,0)
	controllSumm = NVL(TmpPay.PointIspOuID,0)+ NVL(TmpPay.PointEmiOuID,0)+ NVL(TmpPay.PointIspCltID,0)+ NVL(TmpPay.PointEmiCltID,0)+ NVL(TmpPay.PointIspCltsaccID,0)+ NVL(TmpPay.PointEmiCltsaccID,0)
INSERT INTO lvFrmEdit ;
(FrmTypeID,;
PointIspOuID,;
PointEmiOuID,;
PointIspCltID,;
PointEmiCltID,;
PointIspCltsaccID ,;
PointEmiCltsaccID ,;
FrmDate,;
FrmDateAcc,;
FrmStatusId,;
FrmCurTypeId) ;
VALUES ;
(TmpPay.FrmTypeID,;
TmpPay.PointIspOuID,;
TmpPay.PointEmiOuID,;
TmpPay.PointIspCltID,;
TmpPay.PointEmiCltID,;
TmpPay.PointIspCltsaccID ,;
TmpPay.PointEmiCltsaccID ,;
DATETIME(),;
DATETIME(),;
1,;
1)
	llResult = TABLEUPDATE(1,.T.,[lvFrmEdit])
	lnFrmId = spGetLastIncrementedID('lvFrmEdit')
	lcntDoc = lcntDoc +1
ENDIF
INSERT INTO lvFrmPartFrmEdit ;
(FrmId,;
cntFrmID,;
cntFrmincludeSum,;
CntFrmIncludeSumVAT,;
cntfrmsumsplitprocid) ;
VALUES ;
(lnFrmId,;
TmpPay.cntFrmID,;
TmpPay.cntFrmincludeSum,;
TmpPay.FrmpartFrmSumVatRate ,;
1 )
	llResult = TABLEUPDATE(1,.T.,[lvFrmPartFrmEdit])
	SELECT TmpPay
ENDS

USE IN SELECT([lvFrmEdit])
USE IN SELECT([lvFrmPartFrmEdit])

USE IN TmpPay
WAIT WINDOW "Ñôîðìèðîâàíî äîêóìåíòîâ: "+ STR(lcntDoc ,5)
GO lnrecord IN PrimaryDocView
* ôîðìèðóåì ïëàòåæíûå äîêóìåíòû
* âîçâðàùàåì ðåçóëüòàò
RETURN .t.
ENDPROC
PROCEDURE _print1doc
this._prndoc()
ENDPROC
PROCEDURE _prndoc
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRIMARYDOC_V1.VCX
* Class.Module....: GRDDOCSVIEW._PRNDOC
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Ïå÷àòü äîêóìåíòà.
*-------------------------------------------------------

*21.05.2004 22:39 -&gt;Âûïîëíèì ìåòîä ìåíåäæåðà äëÿ ïå÷àòè òåêóùåãî äîêóìåíòà
oMgrPD.Operate([FORM],[PRNDOC],FrmPartFrmView.FrmID)
*------------------------------------------------------------------------------

************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************

ENDPROC
PROCEDURE _prnrep
*21.05.2004 22:39 -&gt;Âûïîëíèì ìåòîä ìåíåäæåðà äëÿ ïå÷àòè îò÷¸òà
* oApp.ExecuteScrFormReportByID(ThisForm.nScrFrmID)
*------------------------------------------------------------------------------

*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: grdFormView._PrnRep
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Ïå÷àòü îò÷¸òà
*-------------------------------------------------------
*21.05.2004 22:39 -&gt;Âûïîëíèì ìåòîä ìåíåäæåðà äëÿ ïå÷àòè îò÷¸òà
PUBLIC tmpPrimDoc
tmpPrimDoc = DBF('PrimaryDocView')
oApp.ExecuteScrFormReportByID(ThisForm.nScrFrmID, [FrmID], PrimaryDocView.FrmID)
RELEASE tmpPrimDoc
*------------------------------------------------------------------------------

************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE _readdatain
This._DeviceDriverFunc([READDATAIN])
ENDPROC
PROCEDURE _readdatainv
This._DeviceDriverFunc([READDATAINV])
ENDPROC
PROCEDURE _readdataout
This._DeviceDriverFunc([READDATAOUT])
ENDPROC
PROCEDURE _rsrequery
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRIMARYDOC_V1.VCX
* Class.Module....: GRDPARTFRM._RSREQUERY
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;tnFrmID&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Ïåðå÷èòûâàíèå ñîäåðæèìîãî äîêóìåíòà
*-------------------------------------------------------
LPARAMETERS	tnFrmID

*21.04.2004 14:37 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcUniqueName, ;
		lcUniqueFilePath
*------------------------------------------------------------------------------

WITH THIS

*21.04.2004 14:33 -&gt;Ñîõðàíèì äàííûå î RecordSource
.SourceKeep()
*------------------------------------------------------------------------------

*21.04.2004 14:33 -&gt;Îòêëþ÷èì RecordSource
.SourceReset()
*------------------------------------------------------------------------------

*21.04.2004 14:34 -&gt;Çàêðîåì Alias è óäàëèì âðåìåííóþ òàáëèöó
lcUniqueFilePath = DBF([FrmPartFrmView])
***
USE IN FrmPartFrmView
***
IF FILE(lcUniqueFilePath)
	ERASE (lcUniqueFilePath)
ENDIF
*------------------------------------------------------------------------------

*05.05.2004 01:35 -&gt;Ïåðå÷èòàåì Alias
IF TYPE([tnFrmID])==[N] AND !EMPTY(tnFrmID)
	
	*02.12.2004 16:48 -&gt;Ñîõðàíèì èäåíòèôèêàòîð äîêóìåíòà â ñâîéñòâå Grid-à
	.nFrmID = tnFrmID
	*------------------------------------------------------------------------------

	*21.04.2004 14:05 -&gt;Âûïîëíèì õðàíèìóþ ïðîöåäóðó äëÿ ïîëó÷åíèÿ äàííûõ
	lcUniqueName = spFrmPartFrmViewQMS([BYFRMID],tnFrmID)
	*------------------------------------------------------------------------------

ELSE
	
	*02.12.2004 16:48 -&gt;Ñîõðàíèì èäåíòèôèêàòîð äîêóìåíòà â ñâîéñòâå Grid-à
	.nFrmID = 0
	*------------------------------------------------------------------------------

	*21.04.2004 14:05 -&gt;Âûïîëíèì õðàíèìóþ ïðîöåäóðó äëÿ ïîëó÷åíèÿ òàáëèöû
	lcUniqueName = spFrmPartFrmViewQMS([NODATA])
	*------------------------------------------------------------------------------
	
ENDIF	
*------------------------------------------------------------------------------

*21.04.2004 14:08 -&gt;Òåïåðü îòêðîåì äàííûé Alias
USE (lcUniqueName) IN 0 ALIAS FrmPartFrmView
CURSORSETPROP([BUFFERING],3,[FrmPartFrmView])
*------------------------------------------------------------------------------

*05.05.2004 01:36 -&gt;Âîññòàíàâëèâàåì Alias
.SourceRecall()
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE _rsrequeryone
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: grdFormView._RSRequeryOne
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;tnFrmID,tlNoRefreshRelatedObjects&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Ïåðå÷èòûâàíèå îäíîé çàïèñè
*------------------------------------------------------------------------------
LPARAMETERS tnFrmID,tlNoRefreshRelatedObjects
IF VARTYPE(tnFrmId)&lt;&gt;'N'
	RETURN
ENDIF
*22.12.2004 15:10 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcOldAlias, ;
		lcUniqueFileName, ;
		llOldRefreshRelatedObjectsOnRSRecNoChange,;
		lnRecNo
LOCAL ARRAY laReplaceArray[1]
***
lcOldAlias = ALIAS()
*------------------------------------------------------------------------------
lnRecNo = RECNO('FrmPartFrmView')
*12.05.2004 03:27 -&gt;Âûïîëíÿåì çàïðîñ ñòðîêè
lcUniqueFileName = spFrmPartFrmViewQMS([BYFRMPARTFRMID],tnFrmID,tnFrmID)
*------------------------------------------------------------------------------

*22.12.2004 15:47 -&gt;Åñëè óêàçàí ôëàã "Íå îáíîâëÿòü ñâÿçàííûå îáúåêòû" - çàáëîêèðóåì îáíîâëåíèå
IF tlNoRefreshRelatedObjects
	llOldRefreshRelatedObjectsOnRSRecNoChange = This._RefreshRelatedObjectsOnRSRecNoChange
	This._RefreshRelatedObjectsOnRSRecNoChange = .F.
ENDIF
*------------------------------------------------------------------------------

*12.05.2004 03:35 -&gt;Îòêëþ÷àåì èñòî÷íèê äàííûõ
This.SourceKeep()
This.SourceReset()
*------------------------------------------------------------------------------

*22.12.2004 15:05 -&gt;Äîáàâëÿåì/îáíîâëÿåì/óäàëÿåì çàïèñü
USE (lcUniqueFileName) IN 0 ALIAS PrimaryDocViewReq
SELECT PrimaryDocViewReq
***
IF RECCOUNT([PrimaryDocViewReq]) == 1

	*22.12.2004 15:10 -&gt;Îáíîâëÿåì çàïèñü
	SCATTER TO laReplaceArray
	SELECT FrmPartFrmView
	LOCATE FOR FrmPartFrmView.FrmID = tnFrmID
	IF !FOUND()
		APPEND BLANK IN FrmPartFrmView
	ENDIF
	GATHER FROM laReplaceArray
	TABLEUPDATE(.T.)
	*------------------------------------------------------------------------------
	
ELSE

	SELECT FrmPartFrmView
	LOCATE FOR FrmPartFrmView.FrmID = tnFrmID
	IF FOUND()
		*22.12.2004 15:11 -&gt;Óäàëÿåì çàïèñü
		DELETE IN FrmPartFrmView
		TABLEUPDATE(.T.)
		*------------------------------------------------------------------------------
	ENDIF
	GO lnRecNo
ENDIF
*------------------------------------------------------------------------------

*12.05.2004 03:37 -&gt;Âîññòàíàâëèâàåì èñòî÷íèê äàííûõ
This.SourceRecall()
*------------------------------------------------------------------------------

*22.12.2004 15:09 -&gt;Óäàëÿåì ðåçóëüòàò çàïðîñà
USE IN PrimaryDocViewReq
ERASE ([tmp\]+lcUniqueFileName+[.dbf])
*------------------------------------------------------------------------------

*22.12.2004 15:35 -&gt;Âîññòàíîâèì òåêóùèé Alias
IF !EMPTY(lcOldAlias) AND USED(lcOldAlias) AND lcOldAlias#ALIAS()
	SELECT(lcOldAlias)
ENDIF
*------------------------------------------------------------------------------

*22.12.2004 15:47 -&gt;Åñëè óêàçàí ôëàã "Íå îáíîâëÿòü ñâÿçàííûå îáúåêòû" - ðàçáëîêèðóåì îáíîâëåíèå
IF tlNoRefreshRelatedObjects
	This._RefreshRelatedObjectsOnRSRecNoChange = llOldRefreshRelatedObjectsOnRSRecNoChange
	this._refreshrelatedobjects()
ENDIF
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE DblClick
IF RECNO(this.RecordSource)&gt;RECCOUNT(this.RecordSource)
DODEFAULT()
ELSE
This.HandleMsg([EDIT])

ENDIF

ENDPROC
PROCEDURE grdtotal
DODEFAULT()
SELECT (this.RecordSource)
LOCATE ALL FOR FrmId = -1
IF FOUND()
	REPLACE PemiNM WITH 'Èòîãè:--&gt;&gt;&gt;&gt;&gt;'
ENDIF
ENDPROC
PROCEDURE handlekey
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.HANDLEKEY
* Called by.......:
* Parameters......: &lt;tnKeyCode, tnShiftAltCtrl&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Îáðàáîòêà íàæàòèÿ ïîëüçîâàòåëåì êëàâèøè.
*-------------------------------------------------------
LPARAMETERS	tnKeyCode, tnShiftAltCtrl

WITH This

*12.04.2004 11:24 -&gt;Îáðàáîòàåì ãîðÿ÷èå êëàâèøè
DO CASE
	CASE (tnKeyCode = 32 AND tnShiftAltCtrl = 2) 		&amp;&amp; Ctrl + Space
	
		*05.05.2004 16:47 -&gt;Ïîìåòèì/ñíèìåì ïîìåòêó ñ òåêóùåé çàïèñè
		This.HandleMsg([MARK])
		RETURN.T.
		*------------------------------------------------------------------------------
		
	OTHERWISE
		
		*04.05.2004 17:00 -&gt;Âûïîëíèì ìåòîä áàçîâîãî êëàññà äëÿ âñåõ äðóãèõ ñî÷åòàíèé êëàâèø	
		RETURN DODEFAULT(tnKeyCode,tnShiftAltCtrl)
		*------------------------------------------------------------------------------
		
ENDCASE
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE Init
*07.12.2004 14:31 -&gt;Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------

*22.04.2004 16:30 -&gt;"Îáíóëèì" ìàññèâ ôóíêöèé
This.aCstFuncProp = .NULL.
*------------------------------------------------------------------------------
*** - 11.04.2009 11:45:43 Ãëóõîâ Â.Þ. (C) - &gt;
*!*	this.SetAll("dynamicbackcolor", ;
*!*				"IIF(RECNO()%2 = 0,RGB(255,255,0), RGB(255,255,255))", "Column")

*** - 31.03.2009 12:09:30 Ãëóõîâ Â.Þ. (C) - &gt;
this.GridLines = 2

this.cl2.DynamicBackColor = [IIF(FrmPartFrmView.StatusID=1,RGB(0,255,255),IIF(FrmPartFrmView.StatusID=2,RGB(0,255,0),IIF(FrmPartFrmView.StatusID=3,RGB(255,255,0),IIF(FrmPartFrmView.StatusID=4,RGB(255,0,0),RGB(255,255,255)))))]
this.cl2.DynamicForeColor = [IIF(FrmPartFrmView.StatusID=1,RGB(0,255,255),IIF(FrmPartFrmView.StatusID=2,RGB(0,255,0),IIF(FrmPartFrmView.StatusID=3,RGB(255,255,0),IIF(FrmPartFrmView.StatusID=4,RGB(255,0,0),RGB(255,255,255)))))]

*** - 23.05.2009 08:09:25 Ãëóõîâ Â.Þ. (C) - &gt; äîêóìåíò ïîìå÷åí
this.clFrmDate.DynamicBackColor = [IIF(FrmPartFrmView._mark,RGB(255,213,170),RGB(255,255,255))] &amp;&amp; äîêóìåíò ïîìå÷åí
this.clShortNM.DynamicBackColor = [IIF(FrmPartFrmView._mark,RGB(255,213,170),RGB(255,255,255))] &amp;&amp; äîêóìåíò ïîìå÷åí
this.clFrmNum.DynamicBackColor = [IIF(FrmPartFrmView._mark,RGB(255,213,170),RGB(255,255,255))] &amp;&amp; äîêóìåíò ïîìå÷åí

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>23</reserved2>
		<reserved3>lcstfuncpropinitiated
nfrmid
^acstfuncprop[1,0] 
*_inherit Íàñëåäîâàíèå äîêóìåíòà
*_naklout Ôîðìèðîâàíèå íàêëàäíîé ïî ðåçóëüòàòàì ïðîäàæ
*_mark ïîìåòêà çàïèñè
*_paydocmake ôîðìèðîâàíèå ïëàòåæíîãî äîêóìåíòà
*_devicedriverfunc Âûïîëíåíèå ôóíêöèè äðàéâåðà
*_readdatain 
*_readdataout 
*_readdatainv 
*_frmact 
*_doctoxml âûãðóçêà äîêóìåíòà â XML
*_docfromxml çàãðóçêà äîêóìåíòà èç XML
*_print1doc Ïå÷àòü îäíîãî äîêóìåíòà áåç âûâîäà îêíà íàñòðîåê
*_exportto1c Âûãðóçêà äàííûõ â 1Ñ
*_fromgarant1 Çàãðóçêà ñìåò èç Ãàðàíòà ïåðâûé ðàáî÷èé âàðèàíò : ñìåòà áåç ïîäðîáíîñòåé
*_fromgarant Çàãðóçêà ñìåò èç Ãàðàíòà â âèäå äåðåâà
*_addchilddoc äîáàëÿåì äî÷åðíèé äîêóìåíò äëÿ òåêóùíãî
*_addlinkdoc Äåëàåì ñâÿçàííûé äî÷åðíèé äîêóìåíò
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7/>
		<reserved8>..\include\primarydoc_v1_grdformview.h</reserved8>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1EA0UUAUR</uniqueid>
		<timestamp>1080984675</timestamp>
		<class>header</class>
		<classloc/>
		<baseclass>header</baseclass>
		<objname>Header1</objname>
		<parent>grdpartfrmqms.Cl1</parent>
		<properties>Caption = " "
Name = "Header1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
This.Parent.Parent.Sort(This.Parent.Name)
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1EA0UUAUS</uniqueid>
		<timestamp>1080984675</timestamp>
		<class>header</class>
		<classloc/>
		<baseclass>header</baseclass>
		<objname>Header1</objname>
		<parent>grdpartfrmqms.Cl2</parent>
		<properties>Caption = " "
Name = "Header1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
This.Parent.Parent.Sort(This.Parent.Name)
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1EA0UUAV6</uniqueid>
		<timestamp>1080984675</timestamp>
		<class>header</class>
		<classloc/>
		<baseclass>header</baseclass>
		<objname>Header1</objname>
		<parent>grdpartfrmqms.ClShortNM</parent>
		<properties>Alignment = 2
Caption = "Äîê."
Name = "Header1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
This.Parent.Parent.Sort(This.Parent.Name)
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1EA0UUAV7</uniqueid>
		<timestamp>1080978372</timestamp>
		<class>txtgrd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>textbox</baseclass>
		<objname>Text1</objname>
		<parent>grdpartfrmqms.ClShortNM</parent>
		<properties>BorderStyle = 0
ControlSource = "FrmPartFrmView.FTShortNM"
Margin = 0
ReadOnly = .T.
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "Text1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1EA0UUAV8</uniqueid>
		<timestamp>1080985859</timestamp>
		<class>header</class>
		<classloc/>
		<baseclass>header</baseclass>
		<objname>Header1</objname>
		<parent>grdpartfrmqms.ClFrmDate</parent>
		<properties>Alignment = 2
Caption = "Äàòà v1"
Name = "Header1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
This.Parent.Parent.Sort(This.Parent.Name)
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1EA0UUAV9</uniqueid>
		<timestamp>1080978372</timestamp>
		<class>txtgrd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>textbox</baseclass>
		<objname>Text1</objname>
		<parent>grdpartfrmqms.ClFrmDate</parent>
		<properties>BorderStyle = 0
ControlSource = "FrmPartFrmView.FrmDate"
Margin = 0
ReadOnly = .T.
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "Text1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1EA0UUAVA</uniqueid>
		<timestamp>1080984675</timestamp>
		<class>header</class>
		<classloc/>
		<baseclass>header</baseclass>
		<objname>Header1</objname>
		<parent>grdpartfrmqms.ClFrmNum</parent>
		<properties>Alignment = 2
Caption = "Íîìåð"
Name = "Header1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
This.Parent.Parent.Sort(This.Parent.Name)
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1EA0UUAVB</uniqueid>
		<timestamp>1080993102</timestamp>
		<class>txtgrd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>textbox</baseclass>
		<objname>Text1</objname>
		<parent>grdpartfrmqms.ClFrmNum</parent>
		<properties>BorderStyle = 0
ControlSource = "FrmPartFrmView.FSID"
Margin = 0
ReadOnly = .T.
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "Text1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1EA0UUAVC</uniqueid>
		<timestamp>1080984675</timestamp>
		<class>header</class>
		<classloc/>
		<baseclass>header</baseclass>
		<objname>Header1</objname>
		<parent>grdpartfrmqms.ClPemiNM</parent>
		<properties>Alignment = 2
Caption = "???"
Name = "Header1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
This.Parent.Parent.Sort(This.Parent.Name)
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1EA0UUAVD</uniqueid>
		<timestamp>1080978372</timestamp>
		<class>txtgrd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>textbox</baseclass>
		<objname>Text1</objname>
		<parent>grdpartfrmqms.ClPemiNM</parent>
		<properties>BorderStyle = 0
ControlSource = "FrmPartFrmView.PemiNM"
Margin = 0
ReadOnly = .T.
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "Text1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1EA0UUAVE</uniqueid>
		<timestamp>1080984675</timestamp>
		<class>header</class>
		<classloc/>
		<baseclass>header</baseclass>
		<objname>Header1</objname>
		<parent>grdpartfrmqms.ClPIspNM</parent>
		<properties>Alignment = 2
Caption = "???"
Name = "Header1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
This.Parent.Parent.Sort(This.Parent.Name)
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1EA0UUAVF</uniqueid>
		<timestamp>1080978372</timestamp>
		<class>txtgrd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>textbox</baseclass>
		<objname>Text1</objname>
		<parent>grdpartfrmqms.ClPIspNM</parent>
		<properties>BorderStyle = 0
ControlSource = "FrmPartFrmView.PIspNM"
Margin = 0
ReadOnly = .T.
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "Text1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2HJ0RR1D4</uniqueid>
		<timestamp>1080984675</timestamp>
		<class>header</class>
		<classloc/>
		<baseclass>header</baseclass>
		<objname>Header1</objname>
		<parent>grdpartfrmqms.ClDevCltNM</parent>
		<properties>Caption = "Âûäàë"
Name = "Header1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
This.Parent.Parent.Sort(This.Parent.Name)
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2HJ0RR1D5</uniqueid>
		<timestamp>1080978531</timestamp>
		<class>txtgrd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>textbox</baseclass>
		<objname>Text1</objname>
		<parent>grdpartfrmqms.ClDevCltNM</parent>
		<properties>BorderStyle = 0
ControlSource = "FrmPartFrmView.DevCltNM"
Enabled = .F.
Margin = 0
Visible = .T.
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "Text1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2HJ0RR1D8</uniqueid>
		<timestamp>1080984675</timestamp>
		<class>header</class>
		<classloc/>
		<baseclass>header</baseclass>
		<objname>Header1</objname>
		<parent>grdpartfrmqms.ClFrmDateAcc</parent>
		<properties>Caption = "Äàòà ïðîâ."
Name = "Header1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
This.Parent.Parent.Sort(This.Parent.Name)
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2HJ0RR1D9</uniqueid>
		<timestamp>1080978531</timestamp>
		<class>txtgrd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>textbox</baseclass>
		<objname>Text1</objname>
		<parent>grdpartfrmqms.ClFrmDateAcc</parent>
		<properties>BorderStyle = 0
ControlSource = "FrmPartFrmView.FrmDateAcc"
Enabled = .F.
Margin = 0
Visible = .T.
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "Text1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2HJ0RR1DC</uniqueid>
		<timestamp>1080984675</timestamp>
		<class>header</class>
		<classloc/>
		<baseclass>header</baseclass>
		<objname>Header1</objname>
		<parent>grdpartfrmqms.ClExEmiCltNM</parent>
		<properties>Caption = "Ïðèíÿë"
Name = "Header1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
This.Parent.Parent.Sort(This.Parent.Name)
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2HJ0RR1DD</uniqueid>
		<timestamp>1080984675</timestamp>
		<class>txtgrd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>textbox</baseclass>
		<objname>Text1</objname>
		<parent>grdpartfrmqms.ClExEmiCltNM</parent>
		<properties>BorderStyle = 0
ControlSource = "FrmPartFrmView.ExEmiCltNM"
Enabled = .F.
Margin = 0
Visible = .T.
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "Text1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2HJ0RR1GD</uniqueid>
		<timestamp>1080985859</timestamp>
		<class>header</class>
		<classloc/>
		<baseclass>header</baseclass>
		<objname>Header1</objname>
		<parent>grdpartfrmqms.ClFrmNote</parent>
		<properties>Caption = "Íàèìåíîâàíèå "
Name = "Header1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
This.Parent.Parent.Sort(This.Parent.Name)
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2HJ0RR1GE</uniqueid>
		<timestamp>1080984675</timestamp>
		<class>txtgrd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>textbox</baseclass>
		<objname>Text1</objname>
		<parent>grdpartfrmqms.ClFrmNote</parent>
		<properties>BorderStyle = 0
ControlSource = "FrmPartFrmView.FrmNote"
Margin = 0
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "Text1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2HJ0RR1GF</uniqueid>
		<timestamp>1080985859</timestamp>
		<class>header</class>
		<classloc/>
		<baseclass>header</baseclass>
		<objname>Header1</objname>
		<parent>grdpartfrmqms.ClFrmReason</parent>
		<properties>Caption = "Îïèñàíèå"
Name = "Header1"
</properties>
		<protected/>
		<methods>PROCEDURE DblClick
This.Parent.Parent.Sort(This.Parent.Name)
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2HJ0RR1GH</uniqueid>
		<timestamp>1080984675</timestamp>
		<class>txtgrd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>textbox</baseclass>
		<objname>Text1</objname>
		<parent>grdpartfrmqms.ClFrmReason</parent>
		<properties>BorderStyle = 0
ControlSource = "FrmPartFrmView.FrmReason"
Margin = 0
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "Text1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>grdpartfrmqms</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1></reserved1>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
</VFPData>
