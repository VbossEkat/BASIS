<?xml version = "1.0" encoding="UTF-8" standalone="yes"?>
<VFPData>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>Class</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname/>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>VERSION =   3.00</reserved1>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1A610IJYB</uniqueid>
		<timestamp>961372348</timestamp>
		<class>frmprimarydocview</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>form</baseclass>
		<objname>frmprimarydocviewtvr</objname>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18I0M4ORT</uniqueid>
		<timestamp>1025986977</timestamp>
		<class>frmedit</class>
		<classloc>baseform_v1.vcx</classloc>
		<baseclass>form</baseclass>
		<objname>frmparttimeedit___</objname>
		<parent/>
		<properties>Height = 377
Width = 419
DoCreate = .T.
AutoCenter = .T.
WindowState = 0
cmode = 
cmeasureunitlist = 
frmprctype = 1
nouid = 0
Name = "frmparttimeedit"
cstmsghandler.Top = 25
cstmsghandler.Left = 10
cstmsghandler.Name = "cstmsghandler"
cstresizable.Top = 25
cstresizable.Left = 32
cstresizable.Name = "cstresizable"
Img1.ZOrderSet = 0
Img1.Name = "Img1"
cstdatawork.Top = 25
cstdatawork.Left = 54
cstdatawork.Name = "cstdatawork"
</properties>
		<protected/>
		<methods>PROCEDURE _handlecntcancelsaveevent
*------------------------------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRIMARYDOC_V1.VCX
* Class.Module....: FRMPRIMARYDOCPARTTVREDIT._HANDLECNTCANCELSAVEEVENT
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;tcMessage&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;~&gt;
*------------------------------------------------------------------------------
LPARAMETERS	tcMessage

LOCAL	llResSave, resCnt

WITH This

	* Ïðîâåðÿåì íà íàëè÷èå òîâàðà â ýòîì çàêàçå ...
*17.05.2004 02:07 -&gt;Ïðîèçâîäèì ñîõðàíåíèÿ/îòìåíÿåì èçìåíåíèÿ
IF tcMessage == [OK]
	IF .cMode = [ADD]
		resCnt = .controlrenta()
		IF TYPE('resCnt')='N' OR !resCnt
			*12.05.2004 00:36 -&gt;Îòìåíèì èçìåíåíèÿ
			.cstDataWork.Restore([lvPriceEdit])
			.cstDataWork.Restore([lvFrmPartTvrEdit])
			** 20081022 Óáðàíî ïîñëå èçìåíåíèé â òðèããåðå íà äîáàâëåíèå òîâ.ïîçèöèè
			*.cstDataWork.Restore([lvJrnUsageEdit])
			.uRetVal = resCnt
			.Hide()
			RETURN
		ENDIF
	ENDIF

	*13.06.2006 18:01 -&gt; Ñîõðàíÿåì öåíó ïðîäàæè
	.SavePriceSale()
	*------------------------------------------------------------------------------
	
	.uRetVal = .T.
	
	IF .cMode = [DELE]
		DELETE IN lvFrmPartTvrEdit
		DELETE IN lvJrnUsageEdit
	ENDIF
	llResSave = .cstDataWork.Save([lvFrmPartTvrEdit])

	*21.01.2004 20:01 -&gt;Îáðàáàòûâàåì ðåçóëüòàòû ñîõðàíåíèÿ
	IF llResSave

		*12.05.2004 03:18 -&gt;Çàïèñûâàåì â .uRetVal èäåíòèôèêàòîð äîáàâëåííîãî äîêóìåíòà
		IF .cMode = [ADD]
			** 20081022 Óáðàíî ïîñëå èçìåíåíèé â òðèããåðå íà äîáàâëåíèå òîâ.ïîçèöèè
			*.uRetVal = .cstDataWork.GetLastID([lvFrmPartTvrEdit])
	*REPLACE FrmPartTvrID WITH .uRetVal IN lvJrnUsageEdit
		ENDIF
		*------------------------------------------------------------------------------
		
	ELSE

		*01.04.2004 18:42 -&gt;Ïîïûòàåìñÿ îáðàáîòàòü îøèáêó ñîõðàíåíèÿ
		IF .cstDataWork.HandleSaveFail() &amp;&amp;åñëè îøèáêà îáðàáîòàíà
			RETURN .T.	&amp;&amp;âîçâðàùàåìñÿ ê ðåäàêòèðîâàíèþ
		ELSE

			*01.04.2004 18:40 -&gt;Ñîîáùàåì îá îøèáêå
			MESSAGEBOX([Â ïðîöåññå ñîõðàíåíèÿ ïðîèçîøëà îøèáêà. Èçìåíåíèÿ ñîõðàíåíû íå áóäóò.],16,[Îøèáêà...])
			*------------------------------------------------------------------------------

			*01.04.2004 18:40 -&gt;Îòìåíÿåì èçìåíåíèÿ
			.cstDataWork.Restore([lvFrmPartTvrEdit])
			.cstDataWork.Restore([lvJrnUsageEdit])
			.uRetVal = .F.
			.Hide()	
			*------------------------------------------------------------------------------

		ENDIF	
		*------------------------------------------------------------------------------

	ENDIF
	*------------------------------------------------------------------------------

	llResSave = .cstDataWork.Save([lvJrnUsageEdit])

	*21.01.2004 20:01 -&gt;Îáðàáàòûâàåì ðåçóëüòàòû ñîõðàíåíèÿ
	IF llResSave

		*12.05.2004 03:18 -&gt;Çàïèñûâàåì â .uRetVal èäåíòèôèêàòîð äîáàâëåííîãî äîêóìåíòà
		IF .cMode # [ADD]
			.uRetVal = .T.
		ENDIF
		***	
		.Hide()
		*------------------------------------------------------------------------------
		
	ELSE
	
		*01.04.2004 18:42 -&gt;Ïîïûòàåìñÿ îáðàáîòàòü îøèáêó ñîõðàíåíèÿ
		IF .cstDataWork.HandleSaveFail() &amp;&amp;åñëè îøèáêà îáðàáîòàíà
			RETURN .T.	&amp;&amp;âîçâðàùàåìñÿ ê ðåäàêòèðîâàíèþ
		ELSE
			
			*01.04.2004 18:40 -&gt;Ñîîáùàåì îá îøèáêå
			MESSAGEBOX([Â ïðîöåññå ñîõðàíåíèÿ ïðîèçîøëà îøèáêà. Èçìåíåíèÿ ñîõðàíåíû íå áóäóò.],16,[Îøèáêà...])
			*------------------------------------------------------------------------------
			
			*01.04.2004 18:40 -&gt;Îòìåíÿåì èçìåíåíèÿ
			.cstDataWork.Restore([lvFrmPartTvrEdit])
			.cstDataWork.Restore([lvJrnUsageEdit])
			.uRetVal = .F.
			.Hide()	
			*------------------------------------------------------------------------------
			
		ENDIF	
		*------------------------------------------------------------------------------
		
	ENDIF
	*------------------------------------------------------------------------------

ELSE

	*12.05.2004 00:36 -&gt;Îòìåíèì èçìåíåíèÿ
	.cstDataWork.Restore([lvPriceEdit])
	.cstDataWork.Restore([lvFrmPartTvrEdit])
	.cstDataWork.Restore([lvJrnUsageEdit])
	.uRetVal = .F.
	.Hide()
	*------------------------------------------------------------------------------
	
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatepricemsu
WITH THIS

*15.06.2006 16:56 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL   lnOldMsuID, ;
		lnNewMsuID, ;
		lnCfMsu
***
lnOldMsuID = OLDVAL([MsuId],[lvFrmPartTvrEdit])
lnNewMsuID = EVAL([lvFrmPartTvrEdit.MsuId])
*------------------------------------------------------------------------------

*15.06.2006 16:59 -&gt; Åäèíèöà èçìåðåíèÿ íå èçìåíèëàñü
IF lnOldMsuID = lnNewMsuID
	RETURN
ENDIF
*------------------------------------------------------------------------------

*15.06.2006 16:59 -&gt; Îïðåäåëÿåì êîýôôèöèåíò äëÿ íîâîé ÅÈ ïî îòíîøåíèþ ê ñòàðîé
lnCfMsu = spGetCfMsu(lnOldMsuID, lnNewMsuID)
lnCfMsu = IIF(lnCfMsu = 0, 1, lnCfMsu)
*------------------------------------------------------------------------------

*15.06.2006 17:01 -&gt; Ïåðåñ÷èòûâàåì öåíû è êîëè÷åñòâî â ñîîòâåòñòâèè ñ êîýôôèöèåíòîì
.cntTvrBuy.txtTvrPrcBuy.Value = ROUND(.cntTvrBuy.txtTvrPrcBuy.Value * lnCfMsu, 4)
.cntTvrSale.txtTvrPrcSale.Value = ROUND(.cntTvrSale.txtTvrPrcSale.Value * lnCfMsu, 4)
.txtQnt.Value = ROUND(.txtQnt.Value / lnCfMsu, 3)
***
IF TYPE([.txtQntNetto]) == [O] AND !ISNULL(.txtQntNetto)
.txtQntNetto.Value = ROUND(.txtQntNetto.Value / lnCfMsu, 3)
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatesum
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateSum
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàññ÷åò ñóìì
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:25 -&gt; Ðàñ÷¸ò ñóììû ïîñòóïëåíèÿ
.CalculateSumBuy()
*------------------------------------------------------------------------------

*23.09.2005 12:25 -&gt; Ðàñ÷¸ò ñóììû ïðîäàæè
.CalculateSumSale()
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatesumbuy
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateSumBuy
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàñ÷¸ò ñóììû ïîñòóïëåíèÿ
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:25 -&gt; Ðàñ÷¸ò ñóììû ïîñòóïëåíèÿ
IF TYPE([.cntTvrBuy]) == [O] AND !ISNULL(.cntTvrBuy)
	.cntTvrBuy.txtTvrPrcSumBuy.Value = ROUND(.cntTvrBuy.txtTvrPrcBuy.Value * .txtQnt.Value,2)
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatesumsale
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateSumSale
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàñ÷¸ò ñóììû ïðîäàæè
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:25 -&gt; Ðàñ÷¸ò ñóììû ïðîäàæè
IF TYPE([.cntTvrSale]) == [O] AND !ISNULL(.cntTvrSale)
	.cntTvrSale.txtTvrPrcSumSale.Value = ROUND(.cntTvrSale.txtTvrPrcSale.Value * .txtQnt.Value,2)
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatetime
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: FRMPRIMARYDOCPARTTVRSERVICEEDIT.CALCULATETIME
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;tuValue&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Ïåðåñ÷¸ò âðåìåíè èñïîëüçîâàíèÿ ðåñóðñà
* Last Editor.....: Âëàäèìèð Áîÿðñêèõ
* Last Edit.......: September 13, 2007
*------------------------------------------------------------------------------
LPARAMETERS tuValue

*13.09.2007 13:49 -&gt; Åñëè òèï åä.èçì. íå âðåìÿ - âûéäåì
IF lvTovarInfo.MsuType # 5
	RETURN
ENDIF
*------------------------------------------------------------------------------

*13.09.2007 13:43 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL   luRetVal
*------------------------------------------------------------------------------

*13.09.2007 13:43 -&gt; Õðàíèìàÿ ïðîöåäóðà, êîòîðàÿ ïîëó÷àåò ëèáî êîëè÷åñòâî ðåñóðñà, ëèáî êîíå÷íóþ äàòó
luRetVal = spGetResourceUsage(lvFrmPartTvrEdit.MsuID, lvJrnUsageEdit.UseStart, tuValue)
*------------------------------------------------------------------------------

*13.09.2007 13:45 -&gt; Èçìåíåíèå êîíå÷íîé äàòû
IF TYPE([luRetVal]) == [T]
	REPLACE UseEnd WITH luRetVal IN lvJrnUsageEdit
	ThisForm.cntJrnUsage.cntTxtCtlCalendarEndDate.txtText.Refresh()
ENDIF
*------------------------------------------------------------------------------

*13.09.2007 13:33 -&gt; Èçìåíåíèå êîëè÷åñòâà ðåñóðñà
IF TYPE([luRetVal]) == [N]
	REPLACE TvrQnt WITH luRetVal IN lvFrmPartTvrEdit
	ThisForm.txtQnt.Refresh()
ENDIF
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatevatsum
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateVatSum
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàññ÷åò ñóììû ÍÄÑ
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:18 -&gt; Ðàññ÷åò ÍÄÑ ïîñòóïëåíèÿ
.CalculateVatSumBuy()
*------------------------------------------------------------------------------

*23.09.2005 12:19 -&gt; Ðàññ÷åò ÍÄÑ ïðîäàæè
.CalculateVatSumSale()
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatevatsumbuy
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateVatSumBuy
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàññ÷åò ÍÄÑ ïîñòóïëåíèÿ
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:16 -&gt; Ðàññ÷åò ÍÄÑ ïîñòóïëåíèÿ
IF TYPE([.cntTvrBuy])==[O] AND !ISNULL(.cntTvrBuy)
	IF .cntTvrVat.txtTvrVATRate.Value # 0
		.cntTvrBuy.txtTvrVATSumBuy.Value = ROUND(.cntTvrBuy.txtTvrPrcSumBuy.Value * .cntTvrVat.txtTvrVATRate.Value / (100 + .cntTvrVat.txtTvrVATRate.Value),2)
	ELSE
		.cntTvrBuy.txtTvrVATSumBuy.Value = 0
	ENDIF
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatevatsumsale
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateVatSumSale
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàññ÷åò ÍÄÑ ïðîäàæè
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:17 -&gt; Ðàññ÷åò ÍÄÑ ïðîäàæè
IF TYPE([.cntTvrSale])==[O] AND !ISNULL(.cntTvrSale)
	IF .cntTvrVat.txtTvrVATRate.Value # 0
		.cntTvrSale.txtTvrVATSumSale.Value = ROUND(.cntTvrSale.txtTvrPrcSumSale.Value * .cntTvrVat.txtTvrVATRate.Value / (100 + .cntTvrVat.txtTvrVATRate.Value),2)
	ELSE
		.cntTvrSale.txtTvrVATSumSale.Value = 0
	ENDIF
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE cntenable
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.cntEnable
* Called by.......: &lt;frmPrimaryDocPartTvrEdit.Init&gt;
* Parameters......: &lt;tcObjectName - èìÿ îáúåêòà-êîíòåéíåðà,
*					 tnTop - âûñîòà îáúåêòà-êîíòåéíåðà&gt;
* Returns.........: &lt;lnNewTop&gt;
* Notes...........: Ðàçìåùåíèå íà ôîðìå êîíòåéíåðîâ ñîäåðæàùèõ öåíû, ñóììû, ÍÄÑ
*------------------------------------------------------------------------------
LPARAMETERS tcObjectName, tnTop

WITH This

*01.09.2005 12:23 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL lnNewTop
*------------------------------------------------------------------------------

*01.09.2005 12:00 -&gt; Íàñòðîèì âíåøíèé âèä îáúåêòà
.&amp;tcObjectName..Visible = .T.
***
.&amp;tcObjectName..Left = 5
.&amp;tcObjectName..Top = tnTop
***
lnNewTop = .&amp;tcObjectName..Top + .&amp;tcObjectName..Height + 5
*------------------------------------------------------------------------------

*01.09.2005 12:23 -&gt; Âîçâðàùàåì ðåçóëüòàò
RETURN lnNewTop
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE controlrenta
LOCAL lcUniqueName , lResultCnt, lResultCnt1
*21.04.2004 14:34 -&gt;Çàêðîåì Alias è óäàëèì âðåìåííóþ òàáëèöó

	*21.04.2004 14:05 -&gt;Âûïîëíèì õðàíèìóþ ïðîöåäóðó äëÿ ïîëó÷åíèÿ äàííûõ
	lcUniqueName = spFrmPartTvrJrnView([BYFRMID],lvFrmPartTvrEdit.FrmID)
	*------------------------------------------------------------------------------
*lvLocateUsedResu
*21.04.2004 14:08 -&gt;Òåïåðü îòêðîåì äàííûé Alias
USE (lcUniqueName) IN 0 ALIAS tmpPartResView
SELECT tmpPartResView
* èùåì ïîçèöèè ýòîãî òîâàðà, êîòîðûå åùå íå âåðíóëè
LOCATE ALL FOR tmpPartResView.TvrIDCalc = lvFrmPartTvrEdit.TvrIDCalc AND (ISNULL(tmpPartResView.UseEnd) OR empty(tmpPartResView.UseEnd))
lResultCnt  = FOUND()

IF lResultCnt
		* ïîçèöèÿ åñòü â ýòîì çàêàçå
		_PARAM = tmpPartResView.FrmPartTvr
		USE lvJrnUsageEdit IN 0 ALIAS lvJrnUsageEditNew
		CURSORSETPROP([BUFFERING],3,[lvJrnUsageEditNew])
		IF ISNULL(lvJrnUsageEditNew.UseEnd) OR empty(lvJrnUsageEditNew.UseEnd)
			* åñëè äàòà è âðåìÿ - ïóñòûå: âåðíóòü
			REPLACE UseEnd WITH DATETIME() IN lvJrnUsageEditNew
			lResultCnt1 = TABLEUPDATE(1,.t.,'lvJrnUsageEditNew')
			IF lResultCnt1
				lResultCnt  = _PARAM
			ENDIF
		ENDIF
		USE IN lvJrnUsageEditNew
	ELSE
		* èùåì åå â äðóãèõ çàêàçàõ
		_PARAM = lvFrmPartTvrEdit.TvrIDCalc
		USE lvLocateUsedResu  IN 0 ALIAS tmpPartResView1
		SELECT tmpPartResView1
		LOCATE ALL FOR tmpPartResView1.TvrIDCalc = lvFrmPartTvrEdit.TvrIDCalc ;
						 AND !tmpPartResView1.FrmId=lvFrmPartTvrEdit.FrmID
		lResultCnt  = .t.
		IF FOUND()
		   * åñëè íàøëè : äîáàâëÿòü íåëüçÿ
		   MESSAGEBOX('Ýòà ïîçèöèÿ óæå åñòü â îòêðûòîì çàêàçå:'+CHR(13)+'¹'+tmpPartResView1.FrmNum+;
		   			  ' îò '+ TTOC(tmpPartResView1.FrmDate),0+48,'Ïîçèöèÿ óæå èñïîëüçóåòñÿ')
			lResultCnt  = .f.
		ENDIF
		USE IN tmpPartResView1
ENDIF
USE IN tmpPartResView

IF FILE(lcUniqueName)
	ERASE (lcUniqueName)
ENDIF
*------------------------------------------------------------------------------
RETURN lResultCnt
ENDPROC
PROCEDURE Destroy
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.Destroy
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........:
*------------------------------------------------------------------------------
WITH This

*12.01.2006 11:48 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL   lcIndependetFNM, ;
		lcDependetFNM
***
lcIndependetFNM = LEFT(.cMeasureUnitList,AT([;],.cMeasureUnitList)-1)
lcDependetFNM	= RIGHT(.cMeasureUnitList,LEN(.cMeasureUnitList)-AT([;],.cMeasureUnitList))
*------------------------------------------------------------------------------

*11.01.2006 17:05 -&gt;Çàêðîåì ñïðàâî÷íèê áàçîâûõ ÅÈ
USE IN SELECT([lvTvrMsuList])
*------------------------------------------------------------------------------

*12.01.2006 11:53 -&gt;Óäàëèì ñïðàâî÷íèêè
IF FILE([tmp\]+lcIndependetFNM+[.dbf])
ERASE ([tmp\]+lcIndependetFNM+[.dbf])
ENDIF
***
IF FILE([tmp\]+lcDependetFNM+[.dbf])
ERASE ([tmp\]+lcDependetFNM+[.dbf])
ENDIF
*------------------------------------------------------------------------------

*11.01.2006 17:05 -&gt;Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE Init
*------------------------------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRIMARYDOC_V1.VCX
* Class.Module....: FRMPRIMARYDOCPARTTVREDIT.INIT
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;tcCommand,tuParam1&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;~&gt;
*------------------------------------------------------------------------------
LPARAMETERS	tcCommand,tuParam1

*17.05.2004 01:26 -&gt;Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------

WITH This

*12.05.2004 03:12 -&gt;Ñîõðàíèì êîìàíäó (ðåæèì ðàáîòû ñ äàííûìè)
.cMode = UPPER(ALLTRIM(tcCommand))
*------------------------------------------------------------------------------

*12.05.2004 00:33 -&gt;Çàãðóçèì äàííûå â Alias äëÿ ðåäàêòèðîâàíèÿ
DO CASE

	CASE .cMode==[ADD]
		
		*12.05.2004 00:32 -&gt;Äîáàâèì ïóñòóþ çàïèñü
		APPEND BLANK IN lvFrmPartTvrEdit
		** 20081022 Óáðàíî ïîñëå èçìåíåíèé â òðèããåðå íà äîáàâëåíèå òîâ.ïîçèöèè
		*APPEND BLANK IN lvJrnUsageEdit
		*------------------------------------------------------------------------------

		*12.05.2004 02:39 -&gt;Çàïèøåì èäåíòèôèêàòîð ðîäèòåëüñêîãî äîêóìåíòà
		REPLACE FrmID WITH tuParam1 IN lvFrmPartTvrEdit
		REPLACE TvrAttr WITH BITSET(lvFrmPartTvrEdit.TvrAttr,2) IN lvFrmPartTvrEdit
		*------------------------------------------------------------------------------
		** 20081022 Óáðàíî ïîñëå èçìåíåíèé â òðèããåðå íà äîáàâëåíèå òîâ.ïîçèöèè
		*REPLACE UseStart WITH DATETIME() IN lvJrnUsageEdit
		
	CASE INLIST(.cMode,[EDIT],[INFO],[DELE])
		
		*12.05.2004 00:31 -&gt;Çàãðóçèì äàííûå ñóùåñòâóþùåé çàïèñè
		_PARAM = tuParam1
		***
		REQUERY([lvFrmPartTvrEdit])
		REQUERY([lvJrnUsageEdit])
		*------------------------------------------------------------------------------

ENDCASE
*------------------------------------------------------------------------------

*01.09.2005 15:28 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnTop, ;
		lnOldTop
***
lnTop = .shpQnt.Top + .shpQnt.Height + 5
lnOldTop = lnTop
*------------------------------------------------------------------------------

*19.08.2005 12:16 -&gt; Çàêðîåì Alias
USE IN IIF(USED([lvFrmTypeInfoByFrm]),[lvFrmTypeInfoByFrm],0)
*------------------------------------------------------------------------------

*19.08.2005 12:12 -&gt; Îòêðîåì Alias ñ èíôîðìàöèåé î òèïå äîêóìåíòà
_PARAM = lvFrmPartTvrEdit.FrmID
***
USE lvFrmTypeInfoByFrm IN 0
*------------------------------------------------------------------------------

*07.08.2006 10:09 -&gt;Îïðåäåëèì OU ïî ID ôîðìû
USE lvFrmEdit IN 0
***
DO CASE
	CASE lvFrmTypeInfoByFrm.FrmTypeDirection = 2
		.nOUID = lvFrmEdit.PointIspOUID
	CASE INLIST(lvFrmTypeInfoByFrm.FrmTypeDirection,1,3)
		.nOUID = lvFrmEdit.PointEmiOUID
ENDCASE
*------------------------------------------------------------------------------

*15.06.2006 15:45 -&gt; Ñîõðàíÿåì òèï ïðàéñà äëÿ äîêóìåíòà
.FrmPrcType = IIF(ISNULL(lvFrmTypeInfoByFrm.FrmPrcTypeID),1,lvFrmTypeInfoByFrm.FrmPrcTypeID)
*------------------------------------------------------------------------------

*15.08.2007 17:40 -&gt; Ïîêàæåì êîíòåéíåð ñ èñïîëüçîâàíèåì ðåñóðñà
lnTop = .CntEnable([cntJrnUsage],lnTop)
*------------------------------------------------------------------------------
	
*01.09.2005 15:24 -&gt; Äîáàâëÿåì êîíòåéíåð ñ öåíîé ïîñòóïëåíèÿ
IF lvFrmTypeInfoByFrm.ContainPriceBuy
*	lnTop = .CntEnable([cntTvrBuy],lnTop)
*	lnTop = .CntEnable([cntTvrBuy],0)
ENDIF
*------------------------------------------------------------------------------
*01.09.2005 15:25 -&gt; Äîáàâëÿåì êîíòåéíåð ñ öåíîé ïðîäàæè
IF lvFrmTypeInfoByFrm.ContainPriceSale
*	lnTop = .CntEnable([cntTvrSale],lnTop)
ENDIF
*------------------------------------------------------------------------------

*01.09.2005 15:29 -&gt; Íà ôîðìå ïðîèçîøëè èçìåíåíèÿ
IF lnTop # lnOldTop
	*{
	*lnTop = .CntEnable([cntTvrVat],lnTop)
	***
	.cntCancelSaveHandled.Top = 88 &amp;&amp;lnTop
	.Height = .cntCancelSaveHandled.Top + .cntCancelSaveHandled.Height + 5
	*}
ENDIF
*------------------------------------------------------------------------------

*01.09.2005 16:11 -&gt; Ïðîñ÷èòàåì ñóììû è ÍÄÑ
.CalculateSum()
.CalculateVatSum()
*------------------------------------------------------------------------------

*19.08.2005 12:15 -&gt; Íàñòðîèì âíåøíèé âèä ôîðìû
DO CASE
	CASE .cMode = [ADD]
		.Caption = [Äîáàâëåíèå]
		.Icon = FULLPATH([frmprimarydocadd.ico])
	CASE .cMode = [EDIT]
		.Caption = [Ðåäàêòèðîâàíèå]
		.Icon = FULLPATH([frmprimarydocedit.ico])
	CASE .cMode = [INFO]
		.Caption = [Ïðîñìîòð]
		.Icon = FULLPATH([frmprimarydocinfo.ico])
		ThisForm.cntCancelSaveHandled.cmdOk.Enabled = .F.
	CASE .cMode = [DELE]
		.Caption = [Óäàëåíèå]
		.Icon = FULLPATH([frmprimarydocdele.ico])
		ThisForm.cntCancelSaveHandled.cmdOk.Caption = [Óäàëèòü]
ENDCASE
***
.Caption = .Caption + [ îáîðóäîâàíèÿ â ïðîêàò]
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE Load
*------------------------------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRIMARYDOC_V1.VCX
* Class.Module....: FRMPRIMARYDOCPARTTVREDIT.LOAD
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;~&gt;
*------------------------------------------------------------------------------

*17.05.2004 01:32 -&gt;Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------

*17.05.2004 01:32 -&gt;Îòêðîåì ÁÄ è óñòàíîâèì å¸ â êà÷åñòâå òåêóùåé
IF !DBUSED([BASIS])
	OPEN DATABASE BASIS
ENDIF
***
SET DATABASE TO BASIS
*------------------------------------------------------------------------------

*16.08.2007 12:07 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
PRIVATE _PARAM
*------------------------------------------------------------------------------

*17.05.2004 01:32 -&gt;Îòêðîåì Alias äëÿ ðåäàêòèðîâàíèÿ áåç äàííûõ
USE lvFrmPartTvrEdit IN 0 NODATA
USE lvJrnUsageEdit IN 0 NODATA
*------------------------------------------------------------------------------

*17.05.2004 01:34 -&gt; Îòêðûâàåì ñïðàâî÷íèê óñëóã
_PARAM = 3	&amp;&amp; Óñëóãà
USE lvTovarListParam IN 0 ALIAS TovarList
*------------------------------------------------------------------------------

*16.08.2007 12:08 -&gt; Îòêðûâàåì ñïðàâî÷íèê ðåñóðñîâ
_PARAM = 8	&amp;&amp; Ðåñóðñ
USE lvTovarListParam IN 0 ALIAS ResourceList
*------------------------------------------------------------------------------
USE lvServByTvrView IN 0 NODATA
*17.05.2004 01:34 -&gt; Îòêðûâàåì îñòàëüíûå ñïðàâî÷íèêè
USE lvCurTypeList IN 0
***
This.cMeasureUnitList = spGetBaseMsuList(0)
USE (LEFT(This.cMeasureUnitList,AT([;],This.cMeasureUnitList)-1)) IN 0 ALIAS lvTvrMsuList
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE Resize
NODEFAULT
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>18</reserved2>
		<reserved3>cmode
cmeasureunitlist
frmprctype Íîìåð ïðàéñà äëÿ ýòîãî äîêóìåíòà
nouid èäåíòèôèêàòîð ïîäðàçäåëåíèÿ, ïî êîòîðîìó áóäåò ïðîèñõîäèòü äâèæåíèå òîâàðà
*cntenable 
*calculatesum &lt;public&gt; Ðàññ÷åò ñóìì
*calculatevatsumbuy &lt;public&gt; Ðàññ÷åò ÍÄÑ ïîñòóïëåíèÿ
*calculatevatsumsale &lt;public&gt; Ðàññ÷åò ÍÄÑ ïðîäàæè
*calculatevatsum &lt;public&gt; Ðàññ÷åò ñóììû ÍÄÑ
*calculatesumbuy &lt;public&gt; Ðàññ÷åò ñóììû ïîñòóïëåíèÿ
*calculatesumsale &lt;public&gt; Ðàññ÷åò ñóììû ïðîäàæè
*calculatepricemsu ðàññ÷åò öåíû åäèíèöû èçìåðåíèÿ
*savepricesale 
*calculatetime 
*controlrenta Ïðîâåðÿåì íàëè÷èå ýòîãî òîâàðà â ýòîé íàêëàäíîé
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7>ðåäàêò ïîçèöèè ïî âðåìåííîìó èñïîëüçîâàíèþ</reserved7>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1MV0RE0B8</uniqueid>
		<timestamp>1025986895</timestamp>
		<class>cnttvrsale</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>CntTvrSale</objname>
		<parent>frmparttimeedit___</parent>
		<properties>Top = 0
Left = 5
Height = 0
Enabled = .F.
Visible = .F.
TabIndex = 16
ZOrderSet = 1
Name = "CntTvrSale"
ShpSale.Name = "ShpSale"
lblTvrPrcSale.Name = "lblTvrPrcSale"
txtTvrPrcSale.Name = "txtTvrPrcSale"
txtTvrPrcSumSale.Name = "txtTvrPrcSumSale"
txtTvrVATSumSale.Name = "txtTvrVATSumSale"
lblTvrPrcSumSale.Name = "lblTvrPrcSumSale"
lblTvrVATSumSale.Name = "lblTvrVATSumSale"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25O11OEHM</uniqueid>
		<timestamp>1025986895</timestamp>
		<class>cntjrnusage</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntJrnUsage</objname>
		<parent>frmparttimeedit___</parent>
		<properties>Top = 0
Left = 5
Height = 0
Enabled = .F.
Visible = .F.
TabIndex = 14
ZOrderSet = 2
Name = "cntJrnUsage"
shpJrnUsage.Name = "shpJrnUsage"
lblFrom.Name = "lblFrom"
cntTxtCtlCalendarStartDate.txtText.Name = "txtText"
cntTxtCtlCalendarStartDate.cmdShow.Name = "cmdShow"
cntTxtCtlCalendarStartDate.Name = "cntTxtCtlCalendarStartDate"
lblTo.Name = "lblTo"
cntTxtCtlCalendarEndDate.txtText.Name = "txtText"
cntTxtCtlCalendarEndDate.cmdShow.Name = "cmdShow"
cntTxtCtlCalendarEndDate.Name = "cntTxtCtlCalendarEndDate"
lblTimeUsage.Name = "lblTimeUsage"
chkTypeUsage.Alignment = 0
chkTypeUsage.Name = "chkTypeUsage"
lblTypeUsage.Name = "lblTypeUsage"
</properties>
		<protected/>
		<methods>PROCEDURE cntTxtCtlCalendarEndDate.cmdShow.Click
DODEFAULT()
*13.09.2007 13:14 -&gt; Ïåðåñ÷¸ò âðåìåíè èñïîëüçîâàíèÿ ðåñóðñà
ThisForm.CalculateTime(This.Parent.txtText.Value)

ENDPROC
PROCEDURE cntTxtCtlCalendarEndDate.txtText._handleanychange
*13.09.2007 13:14 -&gt; Ïåðåñ÷¸ò âðåìåíè èñïîëüçîâàíèÿ ðåñóðñà
ThisForm.CalculateTime(This.Value)
*------------------------------------------------------------------------------
ENDPROC
PROCEDURE cntTxtCtlCalendarEndDate.txtText.showcalendar
LPARAMETERS tnRow, tnCol
DODEFAULT(tnRow, tnCol)
*13.09.2007 13:14 -&gt; Ïåðåñ÷¸ò âðåìåíè èñïîëüçîâàíèÿ ðåñóðñà
ThisForm.CalculateTime(This.Value)
*------------------------------------------------------------------------------
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1MV0RE0B7</uniqueid>
		<timestamp>1025986895</timestamp>
		<class>cnttvrvat</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>CntTvrVat</objname>
		<parent>frmparttimeedit___</parent>
		<properties>Top = 0
Left = 5
Height = 0
Enabled = .F.
Visible = .F.
TabIndex = 17
ZOrderSet = 3
Name = "CntTvrVat"
shpVat.Name = "shpVat"
lblTvrVATRate.Name = "lblTvrVATRate"
txtTvrVATRate.Name = "txtTvrVATRate"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2760QT4T3</uniqueid>
		<timestamp>1025986895</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblTLU</objname>
		<parent>frmparttimeedit___</parent>
		<properties>FontBold = .T.
Caption = "Øòðèõ-êîä:"
Enabled = .F.
Left = 104
Top = 8
Visible = .F.
TabIndex = 12
ZOrderSet = 6
Name = "lblTLU"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18A02DMUV</uniqueid>
		<timestamp>1025986895</timestamp>
		<class>shp</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>shape</baseclass>
		<objname>shpTvr</objname>
		<parent>frmparttimeedit___</parent>
		<properties>Top = 141
Left = 5
Height = 45
Width = 413
SpecialEffect = 0
ZOrderSet = 7
Name = "shpTvr"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25P0Y3LJR</uniqueid>
		<timestamp>1025986895</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblResource</objname>
		<parent>frmparttimeedit___</parent>
		<properties>FontBold = .T.
Caption = "Ðåñóðñ:"
Left = 10
Top = 156
TabIndex = 7
ZOrderSet = 8
Name = "lblResource"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18I0M4ORT</uniqueid>
		<timestamp>1025986895</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblTvr</objname>
		<parent>frmparttimeedit___</parent>
		<properties>FontBold = .T.
Caption = "Óñëóãà:"
Enabled = .F.
Left = 10
Top = 193
Visible = .F.
TabIndex = 8
ZOrderSet = 9
Name = "lblTvr"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25P0Y3LJB</uniqueid>
		<timestamp>1025986895</timestamp>
		<class>cntidctlgrid</class>
		<classloc>comidctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntIdCtlGridResource</objname>
		<parent>frmparttimeedit___</parent>
		<properties>Comment = "â äàëüíåéøåì èñïîëüçîâàòü lvFrmPartTvrEdit.TvrId"
Top = 153
Left = 60
Width = 348
Height = 23
TabIndex = 2
ZOrderSet = 10
_rsaliasname = ResourceList
_rsfieldnameid = TvrID
_rsfieldnametext = TvrNM
_controlsourcetype = 1
_controlsource = lvFrmPartTvrEdit.TvrIdCalc
Name = "cntIdCtlGridResource"
txtText.Height = 23
txtText.Left = 0
txtText.Top = 0
txtText.Width = 300
txtText._highlightobject = .parent.parent.lblResource
txtText.Name = "txtText"
cmdShow.Top = 0
cmdShow.Left = 303
cmdShow.Name = "cmdShow"
cmdClear.Top = 0
cmdClear.Left = 326
cmdClear.Name = "cmdClear"
CmdTree.Name = "CmdTree"
Olecommprox1.Top = 0
Olecommprox1.Left = 36
Olecommprox1.Height = 16
Olecommprox1.Width = 38
Olecommprox1.Name = "Olecommprox1"
</properties>
		<protected/>
		<methods>PROCEDURE _handleanychange
DODEFAULT()
_PARAM= this.value
REQUERY('lvServByTvrView')
thisform.cntIdCtlGridTvr.setvalue(lvServByTvrView.TvrId)
IF NOT EMPTY(_PARAM)
thisform.cntcancelsavehandled.cmdOk.Click()
		thisform.Hide()

ENDIF

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18A02PAKD</uniqueid>
		<timestamp>1025986895</timestamp>
		<class>cntidctlgrid</class>
		<classloc>comidctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntIdCtlGridTvr</objname>
		<parent>frmparttimeedit___</parent>
		<properties>Comment = "â äàëüíåéøåì èñïîëüçîâàòü lvFrmPartTvrEdit.TvrIdCalc"
Top = 190
Left = 60
Width = 348
Height = 23
Enabled = .F.
Visible = .F.
TabIndex = 3
ZOrderSet = 11
_controlsource = lvFrmPartTvrEdit.TvrId
_controlsourcetype = 1
_rsaliasname = lvServByTvrView
_rsfieldnameid = TvrID
_rsfieldnametext = TvrNM
_grdinfoparams = oMgrTovar;TVR;INFO
_grdaddparams = oMgrTovar;TVR;FASTADD;0;lvTvrInCntViewRepl
Name = "cntIdCtlGridTvr"
txtText.Enabled = .F.
txtText.Height = 23
txtText.Left = 0
txtText.Top = 0
txtText.Width = 300
txtText._highlightobject = .parent.parent.lblTvr
txtText.Name = "txtText"
cmdShow.Top = 0
cmdShow.Left = 303
cmdShow.Enabled = .F.
cmdShow.Name = "cmdShow"
cmdClear.Top = 0
cmdClear.Left = 326
cmdClear.Enabled = .F.
cmdClear.Name = "cmdClear"
CmdTree.Name = "CmdTree"
Olecommprox1.Top = 0
Olecommprox1.Left = 36
Olecommprox1.Height = 16
Olecommprox1.Width = 38
Olecommprox1.Name = "Olecommprox1"
</properties>
		<protected/>
		<methods>PROCEDURE _refreshrelatedobjects
*------------------------------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRINARYDOC_V1.VCX
* Class.Module....: CNTIDCTLGRIDTVR._RefreshRelatedObjects
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Îáðàáîòêà èçìåíåíèÿ çíà÷åíèÿ ýëåìåíòà.
*------------------------------------------------------------------------------

*19.08.2005 12:31 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnTvrID, ;
		lcMsuTNM, ;
		lcIndependetFNM, ;
		lcDependetFNM, ;
		_PARAM, ;
		_PARAM_PRCTYPE
		
***
lnTvrID = This.Value
*------------------------------------------------------------------------------

WITH ThisForm

*17.04.2004 14:52 -&gt;Ïîëó÷èì èíôîðìàöèþ î âûáðàííîì òîâàðå
USE IN IIF(USED([lvTovarInfo]),[lvTovarInfo],0)
***
_PARAM = lnTvrID
_PARAM_PRCTYPE = .FrmPrcType
USE lvTovarInfo IN 0
*------------------------------------------------------------------------------

*11.01.2006 17:05 -&gt;Çàêðîåì ñïðàâî÷íèê áàçîâûõ ÅÈ
USE IN SELECT([lvTvrMsuList])

*16.01.2006 14:38 -&gt;Îïðåäåëèì íàçâàíèÿ òàáëèö ñî ñïðàâî÷íèêàìè
lcIndependetFNM = LEFT(.cMeasureUnitList,AT([;],.cMeasureUnitList)-1)
lcDependetFNM	= RIGHT(.cMeasureUnitList,LEN(.cMeasureUnitList)-AT([;],.cMeasureUnitList))
*------------------------------------------------------------------------------

*12.01.2006 11:53 -&gt;Óäàëèì ñïðàâî÷íèêè
IF FILE([tmp\]+lcIndependetFNM+[.dbf])
ERASE ([tmp\]+lcIndependetFNM+[.dbf])
ENDIF
***
IF FILE([tmp\]+lcDependetFNM+[.dbf])
ERASE ([tmp\]+lcDependetFNM+[.dbf])
ENDIF
*------------------------------------------------------------------------------

.cMeasureUnitList = spGetBaseMsuList(lvTovarInfo.MsuID)
lcMsuTNM = RIGHT(.cMeasureUnitList,LEN(.cMeasureUnitList)-AT([;],.cMeasureUnitList))
USE (lcMsuTNM) IN 0 ALIAS [lvTvrMsuList]
*------------------------------------------------------------------------------

*17.04.2004 14:53 -&gt;Óñòàíàâëèâàåì åäèíèöó èçìåðåíèÿ ïî óìîë÷àíèþ
IF .cMode==[ADD] AND lvTovarInfo.MsuID # 0 &amp;&amp; AND .cntIdCtlGridMsu.Value = 0
	.cntIdCtlGridMsu.SetValue(lvTovarInfo.MsuID)
ENDIF	
*------------------------------------------------------------------------------

*17.04.2004 15:06 -&gt; Óñòàíîâèì âåëè÷èíó ÍÄÑ ïî óìîë÷àíèþ
IF .cntTvrVat.txtTvrVATRate.Value # lvTovarInfo.tvrVATRate
	.cntTvrVat.txtTvrVATRate.Value = lvTovarInfo.tvrVATRate
ENDIF	
*------------------------------------------------------------------------------

*01.09.2005 17:26 -&gt; Óñòàíàâëèâàåì öåíû
*!*	IF TYPE([ThisForm.cntTvrBuy]) == [O] AND !ISNULL(.cntTvrBuy)
*!*		.cntTvrBuy.SetPrice(.nOUID,lnTvrID)
*!*	ENDIF
***
IF TYPE([ThisForm.cntTvrSale]) == [O] AND !ISNULL(.cntTvrSale) AND TYPE([.FrmPrcType]) == [N]
	IF .FrmPrcType = 0 OR EMPTY(.FrmPrcType) OR ISNULL(.FrmPrcType)
		MESSAGEBOX([Ïðàéñ äëÿ äàííîãî äîêóìåíòà íå íàéäåí.],48,[Ïðåäóïðåæäåíèå])
	ELSE
		.cntTvrSale.SetPrice(lnTvrID,.FrmPrcType)
	ENDIF
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18A02DMUV</uniqueid>
		<timestamp>1025986895</timestamp>
		<class>shp</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>shape</baseclass>
		<objname>shpQnt</objname>
		<parent>frmparttimeedit___</parent>
		<properties>Top = 234
Left = 5
Height = 61
Width = 413
Enabled = .F.
Visible = .F.
SpecialEffect = 0
ZOrderSet = 12
Name = "shpQnt"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18I0M4ORT</uniqueid>
		<timestamp>1025986895</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblQnt</objname>
		<parent>frmparttimeedit___</parent>
		<properties>FontBold = .T.
Caption = "Êîëè÷åñòâî:"
Enabled = .F.
Left = 10
Top = 270
Visible = .F.
TabIndex = 10
ZOrderSet = 13
Name = "lblQnt"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_R020K4VL1</uniqueid>
		<timestamp>1025986895</timestamp>
		<class>txt</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>textbox</baseclass>
		<objname>txtQnt</objname>
		<parent>frmparttimeedit___</parent>
		<properties>Comment = " â äàëüíåéøåì èñïîëüçîâàòü TvrQntNetto"
ControlSource = "lvFrmPartTvrEdit.TvrQnt"
Enabled = .F.
Left = 140
TabIndex = 5
Top = 267
Visible = .F.
ZOrderSet = 14
_highlightobject = .parent.lblQnt
_convertcommatopoint = .T.
_usedbfieldproperty = .T.
Name = "txtQnt"
</properties>
		<protected/>
		<methods>PROCEDURE _handleanychange
*17.01.2006 09:52 -&gt;Ðàññ÷èòàåì ñóììû
ThisForm.CalculateSum()
*------------------------------------------------------------------------------

*13.09.2007 13:14 -&gt; Ïåðåñ÷¸ò âðåìåíè èñïîëüçîâàíèÿ ðåñóðñà
*ThisForm.CalculateTime(This.Value)
*------------------------------------------------------------------------------
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18A02PAKD</uniqueid>
		<timestamp>1025986895</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblMsu</objname>
		<parent>frmparttimeedit___</parent>
		<properties>FontBold = .T.
Caption = "Åäèíèöà èçìåðåíèÿ:"
Enabled = .F.
Left = 10
Top = -29
Visible = .F.
TabIndex = 9
ZOrderSet = 15
Name = "lblMsu"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18M0216E7</uniqueid>
		<timestamp>1025986895</timestamp>
		<class>cntcancelsavehandled</class>
		<classloc>baseform_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntCancelSaveHandled</objname>
		<parent>frmparttimeedit___</parent>
		<properties>Top = 351
Left = 212
TabIndex = 11
ZOrderSet = 16
Name = "cntCancelSaveHandled"
cmdCancel.Name = "cmdCancel"
cmdOk.Name = "cmdOk"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18A02DMUV</uniqueid>
		<timestamp>1025986895</timestamp>
		<class>cntidctlgrid</class>
		<classloc>comidctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntIdCtlGridMsu</objname>
		<parent>frmparttimeedit___</parent>
		<properties>Top = 113
Left = 140
Enabled = .F.
Visible = .F.
TabIndex = 4
ZOrderSet = 17
_controlsource = lvFrmPartTvrEdit.MsuId
_controlsourcetype = 1
_rsaliasname = lvTvrMsuList
_rsfieldnameid = MsuID
_rsfieldnametext = MsuNM
Name = "cntIdCtlGridMsu"
txtText.Enabled = .F.
txtText._highlightobject = .parent.parent.lblMsu
txtText.Name = "txtText"
cmdShow.Enabled = .F.
cmdShow.Name = "cmdShow"
cmdClear.Enabled = .F.
cmdClear.Name = "cmdClear"
CmdTree.Name = "CmdTree"
Olecommprox1.Top = 0
Olecommprox1.Left = 36
Olecommprox1.Height = 16
Olecommprox1.Width = 38
Olecommprox1.Name = "Olecommprox1"
</properties>
		<protected/>
		<methods>PROCEDURE _refreshrelatedobjects
*30.09.2005 12:25 -&gt; Ðàñ÷¸ò öåíû åäèíèöû èçìåðåíèÿ
ThisForm.CalculatePriceMsu()
ThisForm.CalculateSum()
*------------------------------------------------------------------------------
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2760QT4T4</uniqueid>
		<timestamp>1025986895</timestamp>
		<class>comtxtctlcalclentluidbytlu</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cnmbytlu</objname>
		<parent>frmparttimeedit___</parent>
		<properties>Top = 5
Left = 175
Width = 233
Height = 23
TabIndex = 1
ZOrderSet = 18
Name = "cnmbytlu"
txtText.Height = 23
txtText.Left = 0
txtText.Top = 0
txtText.Width = 169
txtText.NullDisplay = "Øòðèõêîä íåîïðåäåëåííûé"
txtText.Name = "txtText"
lblLen.Left = 171
lblLen.Top = 3
lblLen.Name = "lblLen"
cmdFind.Top = 0
cmdFind.Left = 188
cmdFind.Name = "cmdFind"
cmdClear.Top = 0
cmdClear.Left = 211
cmdClear.Name = "cmdClear"
</properties>
		<protected/>
		<methods>PROCEDURE _handleanychange
*15.06.2006 16:50 -&gt; Îáíîâèì òîâàð è ïåðåéäåì â ïîëå ðåäàêòèðîâàíèÿ êîëè÷åñòâà
WITH Thisform
	**.cntIdCtlGridTvr.SetValue(This.nTvrID)
	.cntIdCtlGridResource.SetValue(This.nTvrID)
	CLEAR TYPEAHEAD
	.cntIdCtlGridTvr.SetFocus()
ENDWITH
*------------------------------------------------------------------------------
ENDPROC
PROCEDURE Refresh
PARAMETERS tnTvrID
IF PCOUNT()=1

	*15.06.2006 16:47 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
	PRIVATE	_PARAM
	***
	_PARAM = tnTvrID
	*------------------------------------------------------------------------------

	*19.08.2005 11:37 -&gt; Íàéä¸ì ØÊ ïî èäåíòèôèêàòîðó òîâàðà
	IF USED([lvTovarLookUpByID])
		REQUERY([lvTovarLookUpByID])
	ELSE
		USE lvTovarLookUpByID IN 0
	ENDIF
	***
	IF RECCOUNT([lvTovarLookUpByID]) &gt; 0
		This.txtText.Value = lvTovarLookUpByID.TLU
	ELSE
		This.txtText.Value = .NULL.
	ENDIF
	*------------------------------------------------------------------------------
	
ENDIF

*15.06.2006 16:49 -&gt; Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2760QT4T7</uniqueid>
		<timestamp>1025986895</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>LblTvrId</objname>
		<parent>frmparttimeedit___</parent>
		<properties>FontBold = .T.
Caption = "Êîä èëè Íîìåð"
Left = 6
Top = 8
TabIndex = 13
ZOrderSet = 19
Name = "LblTvrId"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>frmparttimeedit___</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
Arial, 1, 9, 6, 15, 12, 32, 3, 0
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18I0M4ORT</uniqueid>
		<timestamp>1025997722</timestamp>
		<class>frmedit</class>
		<classloc>baseform_v1.vcx</classloc>
		<baseclass>form</baseclass>
		<objname>frmparttimeedit</objname>
		<parent/>
		<properties>Height = 270
Width = 590
DoCreate = .T.
WindowState = 0
cmode = 
cmeasureunitlist = 
frmprctype = 1
nouid = 0
frmdirection = 1
withbarcode = 0
Name = "frmparttimeedit"
cstmsghandler.Name = "cstmsghandler"
cstresizable.Name = "cstresizable"
Img1.ZOrderSet = 7
Img1.Name = "Img1"
cstdatawork.Name = "cstdatawork"
</properties>
		<protected/>
		<methods>PROCEDURE _handlecntcancelsaveevent
*------------------------------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRIMARYDOC_V1.VCX
* Class.Module....: FRMPRIMARYDOCPARTTVREDIT._HANDLECNTCANCELSAVEEVENT
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;tcMessage&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;~&gt;
*------------------------------------------------------------------------------
LPARAMETERS	tcMessage

LOCAL	llResSave

WITH This

*17.05.2004 02:07 -&gt;Ïðîèçâîäèì ñîõðàíåíèÿ/îòìåíÿåì èçìåíåíèÿ
IF tcMessage == [OK]
	
	*13.06.2006 18:01 -&gt; Ñîõðàíÿåì öåíó ïðîäàæè
	.SavePriceSale()
	*------------------------------------------------------------------------------
	.uRetVal = .T.
	
	IF .cMode = [DELE]
		DELETE IN lvFrmPartTvrEdit
	ENDIF

	llResSave = .cstDataWork.Save([lvFrmPartTvrEdit])
	*21.01.2004 20:01 -&gt;Îáðàáàòûâàåì ðåçóëüòàòû ñîõðàíåíèÿ
	IF llResSave
	
		*12.05.2004 03:18 -&gt;Çàïèñûâàåì â .uRetVal èäåíòèôèêàòîð äîáàâëåííîãî äîêóìåíòà
		IF .cMode = [ADD]
			.uRetVal = .cstDataWork.GetLastID([lvFrmPartTvrEdit])
			_PARAM = .uRetVal
			REQUERY([lvJrnUsageEditPart])
		ELSE
			.cstDataWork.Save([lvJrnUsageEditPart])
			.uRetVal = .T.
		ENDIF
		***	
		.Hide()
		*------------------------------------------------------------------------------
		
	ELSE
	
		*01.04.2004 18:42 -&gt;Ïîïûòàåìñÿ îáðàáîòàòü îøèáêó ñîõðàíåíèÿ
		IF .cstDataWork.HandleSaveFail() &amp;&amp;åñëè îøèáêà îáðàáîòàíà
			RETURN .T.	&amp;&amp;âîçâðàùàåìñÿ ê ðåäàêòèðîâàíèþ
		ELSE
			
			*01.04.2004 18:40 -&gt;Ñîîáùàåì îá îøèáêå
			MESSAGEBOX([Â ïðîöåññå ñîõðàíåíèÿ ïðîèçîøëà îøèáêà. Èçìåíåíèÿ ñîõðàíåíû íå áóäóò.],16,[Îøèáêà...])
			*------------------------------------------------------------------------------
			
			*01.04.2004 18:40 -&gt;Îòìåíÿåì èçìåíåíèÿ
			.cstDataWork.Restore([lvFrmPartTvrEdit])
			.cstDataWork.Restore([lvJrnUsageEditPart])
			.uRetVal = .F.
			.Hide()	
			*------------------------------------------------------------------------------
			
		ENDIF	
		*------------------------------------------------------------------------------
		
	ENDIF
	*------------------------------------------------------------------------------

ELSE

	*12.05.2004 00:36 -&gt;Îòìåíèì èçìåíåíèÿ
	.cstDataWork.Restore([lvPriceEdit])
	.cstDataWork.Restore([lvJrnUsageEditPart])
	.cstDataWork.Restore([lvFrmPartTvrEdit])
	.uRetVal = .F.
	.Hide()
	*------------------------------------------------------------------------------
	
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatepricemsu
WITH THIS

*15.06.2006 16:56 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL   lnOldMsuID, ;
		lnNewMsuID, ;
		lnCfMsu
*** lnOldMsuID = OLDVAL([MsuId],[lvFrmPartTvrEdit])
lnOldMsuID  = pnOldMsuID
lnNewMsuID = EVAL([lvFrmPartTvrEdit.MsuId])
*------------------------------------------------------------------------------

*15.06.2006 16:59 -&gt; Åäèíèöà èçìåðåíèÿ íå èçìåíèëàñü
IF lnOldMsuID = lnNewMsuID
	RETURN
ENDIF
*------------------------------------------------------------------------------

*15.06.2006 16:59 -&gt; Îïðåäåëÿåì êîýôôèöèåíò äëÿ íîâîé ÅÈ ïî îòíîøåíèþ ê ñòàðîé
lnCfMsu = spGetCfMsu(lnOldMsuID, lnNewMsuID)
lnCfMsu = IIF(lnCfMsu = 0, 1, lnCfMsu)
*------------------------------------------------------------------------------

*15.06.2006 17:01 -&gt; Ïåðåñ÷èòûâàåì öåíû è êîëè÷åñòâî â ñîîòâåòñòâèè ñ êîýôôèöèåíòîì
.cntTvrBuy.txtTvrPrcBuy.Value = ROUND(.cntTvrBuy.txtTvrPrcBuy.Value * lnCfMsu, 4)
.cntTvrSale.txtTvrPrcSale.Value = ROUND(.cntTvrSale.txtTvrPrcSale.Value * lnCfMsu, 4)
.txtQnt.Value = ROUND(.txtQnt.Value / lnCfMsu, 3)
***
IF TYPE([.txtQntNetto]) == [O] AND !ISNULL(.txtQntNetto)
.txtQntNetto.Value = ROUND(.txtQntNetto.Value / lnCfMsu, 3)
ENDIF
*------------------------------------------------------------------------------
pnOldMsuID = lnNewMsuID
ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatesum
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateSum
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàññ÷åò ñóìì
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:25 -&gt; Ðàñ÷¸ò ñóììû ïîñòóïëåíèÿ
.CalculateSumBuy()
*------------------------------------------------------------------------------

*23.09.2005 12:25 -&gt; Ðàñ÷¸ò ñóììû ïðîäàæè
.CalculateSumSale()
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatesumbuy
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateSumBuy
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàñ÷¸ò ñóììû ïîñòóïëåíèÿ
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:25 -&gt; Ðàñ÷¸ò ñóììû ïîñòóïëåíèÿ
IF TYPE([.cntTvrBuy]) == [O] AND !ISNULL(.cntTvrBuy)
	.cntTvrBuy.txtTvrPrcSumBuy.Value = ROUND(.cntTvrBuy.txtTvrPrcBuy.Value * .txtQnt.Value,2)
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatesumsale
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateSumSale
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàñ÷¸ò ñóììû ïðîäàæè
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:25 -&gt; Ðàñ÷¸ò ñóììû ïðîäàæè
IF TYPE([.cntTvrSale]) == [O] AND !ISNULL(.cntTvrSale)
	.cntTvrSale.txtTvrPrcSumSale.Value = ROUND(.cntTvrSale.txtTvrPrcSale.Value * .txtQnt.Value,2)
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatevatsum
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateVatSum
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàññ÷åò ñóììû ÍÄÑ
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:18 -&gt; Ðàññ÷åò ÍÄÑ ïîñòóïëåíèÿ
.CalculateVatSumBuy()
*------------------------------------------------------------------------------

*23.09.2005 12:19 -&gt; Ðàññ÷åò ÍÄÑ ïðîäàæè
.CalculateVatSumSale()
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatevatsumbuy
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateVatSumBuy
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàññ÷åò ÍÄÑ ïîñòóïëåíèÿ
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:16 -&gt; Ðàññ÷åò ÍÄÑ ïîñòóïëåíèÿ
IF TYPE([.cntTvrBuy])==[O] AND !ISNULL(.cntTvrBuy)
	IF .cntTvrVat.txtTvrVATRate.Value # 0
		.cntTvrBuy.txtTvrVATSumBuy.Value = ROUND(.cntTvrBuy.txtTvrPrcSumBuy.Value * .cntTvrVat.txtTvrVATRate.Value / (100 + .cntTvrVat.txtTvrVATRate.Value),2)
	ELSE
		.cntTvrBuy.txtTvrVATSumBuy.Value = 0
	ENDIF
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE calculatevatsumsale
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.CalculateVatSumSale
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public&gt; Ðàññ÷åò ÍÄÑ ïðîäàæè
*------------------------------------------------------------------------------
WITH This

*23.09.2005 12:17 -&gt; Ðàññ÷åò ÍÄÑ ïðîäàæè
IF TYPE([.cntTvrSale])==[O] AND !ISNULL(.cntTvrSale)
	IF .cntTvrVat.txtTvrVATRate.Value # 0
		.cntTvrSale.txtTvrVATSumSale.Value = ROUND(.cntTvrSale.txtTvrPrcSumSale.Value * .cntTvrVat.txtTvrVATRate.Value / (100 + .cntTvrVat.txtTvrVATRate.Value),2)
	ELSE
		.cntTvrSale.txtTvrVATSumSale.Value = 0
	ENDIF
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE cntenable
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.cntEnable
* Called by.......: &lt;frmPrimaryDocPartTvrEdit.Init&gt;
* Parameters......: &lt;tcObjectName - èìÿ îáúåêòà-êîíòåéíåðà,
*					 tnTop - âûñîòà îáúåêòà-êîíòåéíåðà&gt;
* Returns.........: &lt;lnNewTop&gt;
* Notes...........: Ðàçìåùåíèå íà ôîðìå êîíòåéíåðîâ ñîäåðæàùèõ öåíû, ñóììû, ÍÄÑ
*------------------------------------------------------------------------------
LPARAMETERS tcObjectName, tnTop

WITH This

*01.09.2005 12:23 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL lnNewTop
*------------------------------------------------------------------------------

*01.09.2005 12:00 -&gt; Íàñòðîèì âíåøíèé âèä îáúåêòà
.&amp;tcObjectName..Visible = .T.
***
*!*	.&amp;tcObjectName..Left = 5
*!*	.&amp;tcObjectName..Top = tnTop
*!*	***
*!*	lnNewTop = .&amp;tcObjectName..Top + .&amp;tcObjectName..Height + 5
*!*	*------------------------------------------------------------------------------

*01.09.2005 12:23 -&gt; Âîçâðàùàåì ðåçóëüòàò
RETURN lnNewTop
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE Destroy
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Tovar_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.Destroy
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........:
*------------------------------------------------------------------------------
WITH This

*12.01.2006 11:48 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL   lcIndependetFNM, ;
		lcDependetFNM
***
lcIndependetFNM = LEFT(.cMeasureUnitList,AT([;],.cMeasureUnitList)-1)
lcDependetFNM	= RIGHT(.cMeasureUnitList,LEN(.cMeasureUnitList)-AT([;],.cMeasureUnitList))
*------------------------------------------------------------------------------

*11.01.2006 17:05 -&gt;Çàêðîåì ñïðàâî÷íèê áàçîâûõ ÅÈ
USE IN SELECT([lvTvrMsuList])
*------------------------------------------------------------------------------

*12.01.2006 11:53 -&gt;Óäàëèì ñïðàâî÷íèêè
IF FILE([tmp\]+lcIndependetFNM+[.dbf])
ERASE ([tmp\]+lcIndependetFNM+[.dbf])
ENDIF
***
IF FILE([tmp\]+lcDependetFNM+[.dbf])
ERASE ([tmp\]+lcDependetFNM+[.dbf])
ENDIF
*------------------------------------------------------------------------------

*11.01.2006 17:05 -&gt;Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------
RELEASE pnOldMsuID
ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE Init
*------------------------------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRIMARYDOC_V1.VCX
* Class.Module....: FRMPRIMARYDOCPARTTVREDIT.INIT
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;tcCommand,tuParam1&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;~&gt;
*------------------------------------------------------------------------------
LPARAMETERS	tcCommand,tuParam1

*17.05.2004 01:26 -&gt;Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------

WITH This

*12.05.2004 03:12 -&gt;Ñîõðàíèì êîìàíäó (ðåæèì ðàáîòû ñ äàííûìè)
.cMode = UPPER(ALLTRIM(tcCommand))
*------------------------------------------------------------------------------
*12.05.2004 00:33 -&gt;Çàãðóçèì äàííûå â Alias äëÿ ðåäàêòèðîâàíèÿ
DO CASE

	CASE .cMode==[ADD]
		
		*12.05.2004 00:32 -&gt;Äîáàâèì ïóñòóþ çàïèñü
		APPEND BLANK IN lvFrmPartTvrEdit
		*------------------------------------------------------------------------------

		*12.05.2004 02:39 -&gt;Çàïèøåì èäåíòèôèêàòîð ðîäèòåëüñêîãî äîêóìåíòà
		REPLACE FrmID WITH tuParam1 IN lvFrmPartTvrEdit
		*------------------------------------------------------------------------------
		.cntTvrVat.txtTvrVATRate.Value = oApp.nNds
	CASE INLIST(.cMode,[EDIT],[INFO],[DELE])
		
		*12.05.2004 00:31 -&gt;Çàãðóçèì äàííûå ñóùåñòâóþùåé çàïèñè
		_PARAM = tuParam1
		***
		REQUERY([lvFrmPartTvrEdit])
		REQUERY([lvJrnUsageEditPart])
		*------------------------------------------------------------------------------
		
ENDCASE
*------------------------------------------------------------------------------
PUBLIC pnOldMsuID
pnOldMsuID  = lvFrmPartTvrEdit.MsuId
*01.09.2005 15:28 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnTop, ;
		lnOldTop
***
lnTop = 0
lnOldTop = lnTop
*------------------------------------------------------------------------------

*19.08.2005 12:16 -&gt; Çàêðîåì Alias
USE IN IIF(USED([lvFrmTypeInfoByFrm]),[lvFrmTypeInfoByFrm],0)
*------------------------------------------------------------------------------

*19.08.2005 12:12 -&gt; Îòêðîåì Alias ñ èíôîðìàöèåé î òèïå äîêóìåíòà
_PARAM = lvFrmPartTvrEdit.FrmID
***
USE lvFrmTypeInfoByFrm IN 0
*------------------------------------------------------------------------------

*07.08.2006 10:09 -&gt;Îïðåäåëèì OU ïî ID ôîðìû
USE lvFrmEdit IN 0
***
DO CASE
	CASE lvFrmTypeInfoByFrm.FrmTypeDirection = 2
		.nOUID = lvFrmEdit.PointIspOUID
	CASE INLIST(lvFrmTypeInfoByFrm.FrmTypeDirection,1,3)
		.nOUID = lvFrmEdit.PointEmiOUID
ENDCASE
.frmdirection = lvFrmTypeInfoByFrm.FrmTypeDirection
*------------------------------------------------------------------------------

*15.06.2006 15:45 -&gt; Ñîõðàíÿåì òèï ïðàéñà äëÿ äîêóìåíòà
.FrmPrcType = IIF(ISNULL(lvFrmTypeInfoByFrm.FrmPrcTypeID),1,lvFrmTypeInfoByFrm.FrmPrcTypeID)
*------------------------------------------------------------------------------

*01.09.2005 15:24 -&gt; Äîáàâëÿåì êîíòåéíåð ñ öåíîé ïîñòóïëåíèÿ
IF lvFrmTypeInfoByFrm.ContainPriceBuy
	*lnTop =
	.CntEnable([cntTvrBuy],lnTop)
ENDIF
*------------------------------------------------------------------------------
*01.09.2005 15:25 -&gt; Äîáàâëÿåì êîíòåéíåð ñ öåíîé ïðîäàæè
IF lvFrmTypeInfoByFrm.ContainPriceSale
	*lnTop =
	.CntEnable([cntTvrSale],lnTop)
ENDIF
*------------------------------------------------------------------------------
.CntEnable([cntTvrVat],lnTop)
*01.09.2005 15:29 -&gt; Íà ôîðìå ïðîèçîøëè èçìåíåíèÿ
IF lnTop # lnOldTop
	*{
	lnTop = .CntEnable([cntTvrVat],lnTop)
	***
	.cntCancelSaveHandled.Top = lnTop
	.cmdPrice.Top = lnTop
	.Height = .cntCancelSaveHandled.Top + .cntCancelSaveHandled.Height + 5
	*}
ENDIF
*------------------------------------------------------------------------------

*01.09.2005 16:11 -&gt; Ïðîñ÷èòàåì ñóììû è ÍÄÑ
.CalculateSum()
.CalculateVatSum()
*------------------------------------------------------------------------------

*19.08.2005 12:15 -&gt; Íàñòðîèì âíåøíèé âèä ôîðìû
DO CASE
	CASE .cMode = [ADD]
		.Caption = [Äîáàâëåíèå]
		.Icon = FULLPATH([frmprimarydocadd.ico])
		** ïðîâåðêà íà ïðåäïî÷òåíèå ðàáîòàòü ñî øòðèõ-êîäîì
		.withBarCode = VAL(oRes.GetParam([SET],[WITHBAR]))
		IF  .withBarCode = 0
			.cntIdCtlGridTvr.SetFocus()
			KEYBOARD '{ALT+DNARROW}'
		ENDIF
		*.cntcdCtlGridTvr.cmdShow.Click()
	CASE .cMode = [EDIT]
		.Caption = [Ðåäàêòèðîâàíèå]
		.Icon = FULLPATH([frmprimarydocedit.ico])
	CASE .cMode = [INFO]
		.Caption = [Ïðîñìîòð]
		.Icon = FULLPATH([frmprimarydocinfo.ico])
		ThisForm.cntCancelSaveHandled.cmdOk.Enabled = .F.
	CASE .cMode = [DELE]
		.Caption = [Óäàëåíèå]
		.Icon = FULLPATH([frmprimarydocdele.ico])
		ThisForm.cntCancelSaveHandled.cmdOk.Caption = [Óäàëèòü]
ENDCASE
***
.Caption = .Caption + [ òîâàðíîé ïîçèöèè äîêóìåíòà]
*------------------------------------------------------------------------------
ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE Load
*------------------------------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRIMARYDOC_V1.VCX
* Class.Module....: FRMPRIMARYDOCPARTTVREDIT.LOAD
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;~&gt;
*------------------------------------------------------------------------------

*17.05.2004 01:32 -&gt;Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------

*17.05.2004 01:32 -&gt;Îòêðîåì ÁÄ è óñòàíîâèì å¸ â êà÷åñòâå òåêóùåé
IF !DBUSED([BASIS])
	OPEN DATABASE BASIS
ENDIF
***
SET DATABASE TO BASIS
*------------------------------------------------------------------------------

*17.05.2004 01:32 -&gt;Îòêðîåì Alias äëÿ ðåäàêòèðîâàíèÿ áåç äàííûõ
USE lvFrmPartTvrEdit IN 0 NODATA
USE lvJrnUsageEditPart IN 0 NODATA
*------------------------------------------------------------------------------

*17.05.2004 01:34 -&gt; Îòêðûâàåì ñïðàâî÷íèêè
USE lvTovarList IN 0 ALIAS TovarList
USE lvTovarList IN 0 ALIAS TovarListOnly
SELECT TovarListOnly
SET FILTER TO INLIST(TovarListOnly.TvrTypeId,1,7)

*SELECT * FROM TovarList WHERE TovarList.TvrTypeId NOT IN (1,7) INTO CURSOR TovarListOnly

USE lvCurTypeList IN 0
USE lvtvrsetbmps IN 0
***
This.cMeasureUnitList = spGetBaseMsuList(0)
USE (LEFT(This.cMeasureUnitList,AT([;],This.cMeasureUnitList)-1)) IN 0 ALIAS lvTvrMsuList
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE Refresh
DODEFAULT()
*!*		IF this.cMode = [ADD]
*!*			this.cntIdCtlGridTvr.SetFocus()
*!*			this.cntcdCtlGridTvr.cmdShow.Click()
*!*		ENDIF

ENDPROC
PROCEDURE Resize
NODEFAULT
ENDPROC
PROCEDURE savepricesale
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: PrimaryDoc_v1.vcx
* Class.Module....: frmPrimaryDocPartTvrEdit.SavePriceSale
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Ñîõðàíåíèå öåíû ïðîäàæè
*------------------------------------------------------------------------------
WITH This
*08.06.2006 10:06 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	llDataWasChanged, ;
		llResSave
***
llResSave = .F.
*------------------------------------------------------------------------------

*07.06.2006 17:10 -&gt; Êîëè÷åñòâî çàïèñåé î öåíàõ îòëè÷íî îò íóëÿ
IF .cntTvrSale.Visible AND RECCOUNT([lvPriceEdit]) # 0

	*07.06.2006 16:26 -&gt; Ïðîèçâåäåì ñîõðàíåíèå öåíû ïðîäàæè
	IF .cMode # [DELE]

		*07.06.2006 16:27 -&gt; Ïðîâåðèì èçìåíèëèñü ëè äàííûå
		llDataWasChanged = .cstDataWork.DataChanged([lvPriceEdit],.T.)
		*------------------------------------------------------------------------------

		*07.06.2006 16:29 -&gt; Âûïîëíÿåì ñîõðàíåíèå åñëè ïîëüçîâàòåëü ðàçðåøèò ñîõðàíåíèå
		IF llDataWasChanged AND MESSAGEBOX([Ñîõðàíèòü öåíó ïðîäàæè â ïðàéñå?],4+32,[Ñîõðàíåíèå])=6

			*07.06.2006 16:47 -&gt; Ïîïûòàåìñÿ ñîõðàíèòü öåíó
			llResSave = .cstDataWork.Save([lvPriceEdit])
			*------------------------------------------------------------------------------

		ENDIF	
		*------------------------------------------------------------------------------

	ENDIF
	*------------------------------------------------------------------------------
	
	*02.04.2004 17:00 -&gt; Îêàòèì èçìåíåíèÿ
	IF !llResSave
		.cstDataWork.Restore([lvPriceEdit])
	ENDIF
	*------------------------------------------------------------------------------

	*07.06.2006 16:48 -&gt; Çàêðîåì Alias äëÿ ðåäàêòèðîâàíèÿ öåí è îòêðîåì ñíîâà áåç äàííûõ
	USE IN SELECT([lvPriceEdit])
	***
	USE lvPriceEdit IN 0 NODATA
	*------------------------------------------------------------------------------

ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>23</reserved2>
		<reserved3>cmode
cmeasureunitlist
frmprctype Íîìåð ïðàéñà äëÿ ýòîãî äîêóìåíòà
nouid èäåíòèôèêàòîð ïîäðàçäåëåíèÿ, ïî êîòîðîìó áóäåò ïðîèñõîäèòü äâèæåíèå òîâàðà
frmdirection Íàïðàâëåíèå äîêóìåíòà
withbarcode Ïðåäïî÷òåíèå â ðàáîòå ñî øòðèõ-êîäîì
*cntenable 
*calculatesum &lt;public&gt; Ðàññ÷åò ñóìì
*calculatevatsumbuy &lt;public&gt; Ðàññ÷åò ÍÄÑ ïîñòóïëåíèÿ
*calculatevatsumsale &lt;public&gt; Ðàññ÷åò ÍÄÑ ïðîäàæè
*calculatevatsum &lt;public&gt; Ðàññ÷åò ñóììû ÍÄÑ
*calculatesumbuy &lt;public&gt; Ðàññ÷åò ñóììû ïîñòóïëåíèÿ
*calculatesumsale &lt;public&gt; Ðàññ÷åò ñóììû ïðîäàæè
*calculatepricemsu ðàññ÷åò öåíû åäèíèöû èçìåðåíèÿ
*savepricesale 
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7>Ðåäàêòèðîóåì ÷àñòü ôîðìû - òîâàð</reserved7>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1MV0RE0B8</uniqueid>
		<timestamp>1025997722</timestamp>
		<class>cnttvrsale</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>CntTvrSale</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 127
Left = 0
Width = 587
Height = 33
Visible = .F.
TabIndex = 6
ZOrderSet = 0
Name = "CntTvrSale"
ShpSale.Top = 0
ShpSale.Left = 0
ShpSale.Height = 33
ShpSale.Width = 587
ShpSale.Name = "ShpSale"
lblTvrPrcSale.Caption = "Öåíà îòãðóçêè:"
lblTvrPrcSale.Name = "lblTvrPrcSale"
txtTvrPrcSale.Left = 124
txtTvrPrcSale.Top = 5
txtTvrPrcSale.Name = "txtTvrPrcSale"
txtTvrPrcSumSale.Left = 282
txtTvrPrcSumSale.Top = 5
txtTvrPrcSumSale.Name = "txtTvrPrcSumSale"
txtTvrVATSumSale.Left = 484
txtTvrVATSumSale.Top = 5
txtTvrVATSumSale.Name = "txtTvrVATSumSale"
lblTvrPrcSumSale.Name = "lblTvrPrcSumSale"
lblTvrVATSumSale.Left = 414
lblTvrVATSumSale.Top = 8
lblTvrVATSumSale.Name = "lblTvrVATSumSale"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1MV0RE0B7</uniqueid>
		<timestamp>1025997722</timestamp>
		<class>cnttvrvat</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>CntTvrVat</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 189
Left = 1
Width = 187
Height = 33
Visible = .F.
TabIndex = 9
ZOrderSet = 1
Name = "CntTvrVat"
shpVat.Top = 0
shpVat.Left = 0
shpVat.Height = 33
shpVat.Width = 188
shpVat.Name = "shpVat"
lblTvrVATRate.Name = "lblTvrVATRate"
txtTvrVATRate.Left = 81
txtTvrVATRate.Top = 5
txtTvrVATRate.Name = "txtTvrVATRate"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1MV0RE0BB</uniqueid>
		<timestamp>1025997723</timestamp>
		<class>cnttvrbuy</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>CntTvrBuy</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 97
Left = 0
Width = 588
Height = 33
Visible = .F.
TabIndex = 5
ZOrderSet = 3
Name = "CntTvrBuy"
ShpBuy.Top = 0
ShpBuy.Left = 0
ShpBuy.Height = 33
ShpBuy.Width = 588
ShpBuy.Name = "ShpBuy"
lblTvrPrcBuy.Caption = "Ñåáåñòîèìîñòü:"
lblTvrPrcBuy.Name = "lblTvrPrcBuy"
txtTvrPrcBuy.Left = 124
txtTvrPrcBuy.Top = 5
txtTvrPrcBuy.Name = "txtTvrPrcBuy"
lblTvrPrcSumBuy.Name = "lblTvrPrcSumBuy"
txtTvrPrcSumBuy.Left = 282
txtTvrPrcSumBuy.Top = 5
txtTvrPrcSumBuy.Name = "txtTvrPrcSumBuy"
lblTvrVATSumBuy.Left = 414
lblTvrVATSumBuy.Top = 7
lblTvrVATSumBuy.Name = "lblTvrVATSumBuy"
txtTvrVATSumBuy.Left = 484
txtTvrVATSumBuy.Top = 4
txtTvrVATSumBuy.Name = "txtTvrVATSumBuy"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18A02DMUV</uniqueid>
		<timestamp>1025997723</timestamp>
		<class>shp</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>shape</baseclass>
		<objname>shpTvr</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 5
Left = 0
Height = 61
Width = 589
SpecialEffect = 0
ZOrderSet = 8
Name = "shpTvr"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1025997723</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblTLU</objname>
		<parent>frmparttimeedit</parent>
		<properties>FontBold = .T.
Caption = "Øòðèõ-êîä:"
Left = 99
Top = 13
TabIndex = 17
ZOrderSet = 9
Name = "lblTLU"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1LE0P5JD7</uniqueid>
		<timestamp>1025997723</timestamp>
		<class>comtxtctlcalclentluidbytlu</class>
		<classloc>primarydoc_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>comTxtCtlCalcLenTLUIDByTLU</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 10
Left = 170
Width = 286
Height = 23
TabIndex = 1
ZOrderSet = 10
Name = "comTxtCtlCalcLenTLUIDByTLU"
txtText.Height = 23
txtText.Left = 0
txtText.Top = 0
txtText.Width = 171
txtText.NullDisplay = "Øòðèõêîä íåîïðåäåëåííûé"
txtText.Name = "txtText"
lblLen.Left = 171
lblLen.Top = 3
lblLen.Name = "lblLen"
cmdFind.Top = 0
cmdFind.Left = 197
cmdFind.Name = "cmdFind"
cmdClear.Top = 0
cmdClear.Left = 220
cmdClear.Name = "cmdClear"
</properties>
		<protected/>
		<methods>PROCEDURE _handleanychange
*15.06.2006 16:50 -&gt; Îáíîâèì òîâàð è ïåðåéäåì â ïîëå ðåäàêòèðîâàíèÿ êîëè÷åñòâà
WITH Thisform
	.cntIdCtlGridTvr.SetValue(This.nTvrID)
	CLEAR TYPEAHEAD
	.txtQnt.SetFocus()
ENDWITH
*------------------------------------------------------------------------------
ENDPROC
PROCEDURE Refresh
PARAMETERS tnTvrID
IF this.ntvrid=0 AND (PCOUNT()=0 OR tnTvrID = -3 )
		This.txtText.Value = lvFrmPartTvrEdit.FrmPartTvrNote
ENDIF

IF PCOUNT()&gt;0 &amp;&amp; AND tnTvrID &lt;&gt; -3

	*15.06.2006 16:47 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
	PRIVATE	_PARAM
	***
	_PARAM = IIF(this.ntvrid=0,tnTvrID,this.ntvrid)
	*------------------------------------------------------------------------------

	*19.08.2005 11:37 -&gt; Íàéä¸ì ØÊ ïî èäåíòèôèêàòîðó òîâàðà
	IF USED([lvTovarLookUpByID])
		REQUERY([lvTovarLookUpByID])
	ELSE
		USE lvTovarLookUpByID IN 0
	ENDIF
	***
	IF RECCOUNT([lvTovarLookUpByID]) &gt; 0
		This.txtText.Value = lvTovarLookUpByID.TLU
	ELSE
		This.txtText.Value = .NULL.
	ENDIF
	*------------------------------------------------------------------------------
	
ENDIF

*15.06.2006 16:49 -&gt; Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_30W0NTI5L</uniqueid>
		<timestamp>1025997723</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblJrnUseStart</objname>
		<parent>frmparttimeedit</parent>
		<properties>FontBold = .T.
Caption = "Íà÷àëî:"
Left = 7
Top = 165
TabIndex = 14
ZOrderSet = 10
Name = "lblJrnUseStart"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18I0M4ORT</uniqueid>
		<timestamp>1025997723</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblTvr</objname>
		<parent>frmparttimeedit</parent>
		<properties>FontBold = .T.
Caption = "Òîâàð, ðàáîòà:"
Left = 10
Top = 41
TabIndex = 19
ZOrderSet = 11
Name = "lblTvr"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1025997723</timestamp>
		<class>cntidctlgrid</class>
		<classloc>comidctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntIdCtlGridTvr</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 38
Left = 96
Width = 487
Height = 23
TabIndex = 2
ZOrderSet = 12
_controlsource = lvFrmPartTvrEdit.TvrId
_controlsourcetype = 1
_rsaliasname = TovarList
_rsfieldnameid = TvrID
_rsfieldnametext = TvrNM
_grdinfoparams = oMgrTovar;TVR;INFO
_grdaddparams = oMgrTovar;TVR;FASTADD;0;lvTvrInCntViewRepl
_selectobjectt = frmidctltreetvr;primarydoc_v1;primarydoc.app
Name = "cntIdCtlGridTvr"
txtText.Height = 22
txtText.Left = 0
txtText.Top = 0
txtText.Width = 415
txtText._highlightobject = .parent.parent.lblTvr
txtText.Name = "txtText"
cmdShow.Top = 0
cmdShow.Left = 441
cmdShow.Name = "cmdShow"
cmdClear.Top = 0
cmdClear.Left = 464
cmdClear.Name = "cmdClear"
CmdTree.Top = 0
CmdTree.Left = 417
CmdTree.Enabled = .T.
CmdTree.Visible = .T.
CmdTree.Name = "CmdTree"
Olecommprox1.Top = 0
Olecommprox1.Left = 36
Olecommprox1.Height = 16
Olecommprox1.Width = 38
Olecommprox1.Name = "Olecommprox1"
</properties>
		<protected/>
		<methods>PROCEDURE _refreshrelatedobjects
*------------------------------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: PRINARYDOC_V1.VCX
* Class.Module....: CNTIDCTLGRIDTVR._RefreshRelatedObjects
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Îáðàáîòêà èçìåíåíèÿ çíà÷åíèÿ ýëåìåíòà.
*------------------------------------------------------------------------------

*19.08.2005 12:31 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnTvrID, ;
		lcMsuTNM, ;
		lcIndependetFNM, ;
		lcDependetFNM, ;
		_PARAM, ;
		_PARAM_PRCTYPE
		
***
lnTvrID = This.Value
*------------------------------------------------------------------------------

WITH ThisForm

*06.09.2005 17:18 -&gt; Çàïèñûâàåì èäåíòèôèêàòîð òîâàðà
.comTxtCtlCalcLenTLUIDByTLU.nTvrID = lnTvrID
.comTxtCtlCalcLenTLUIDByTLU.Refresh(lnTvrID)
.LblTvrId.Caption = ALLTRIM(STR(lnTvrID,10,0))
*------------------------------------------------------------------------------

*17.04.2004 14:52 -&gt;Ïîëó÷èì èíôîðìàöèþ î âûáðàííîì òîâàðå
USE IN IIF(USED([lvTovarInfo]),[lvTovarInfo],0)
***
_PARAM = lnTvrID
_PARAM_PRCTYPE = .FrmPrcType
USE lvTovarInfo IN 0
*------------------------------------------------------------------------------

*11.01.2006 17:05 -&gt;Çàêðîåì ñïðàâî÷íèê áàçîâûõ ÅÈ
USE IN SELECT([lvTvrMsuList])

*16.01.2006 14:38 -&gt;Îïðåäåëèì íàçâàíèÿ òàáëèö ñî ñïðàâî÷íèêàìè
lcIndependetFNM = LEFT(.cMeasureUnitList,AT([;],.cMeasureUnitList)-1)
lcDependetFNM	= RIGHT(.cMeasureUnitList,LEN(.cMeasureUnitList)-AT([;],.cMeasureUnitList))
*------------------------------------------------------------------------------

*12.01.2006 11:53 -&gt;Óäàëèì ñïðàâî÷íèêè
IF FILE([tmp\]+lcIndependetFNM+[.dbf])
ERASE ([tmp\]+lcIndependetFNM+[.dbf])
ENDIF
***
IF FILE([tmp\]+lcDependetFNM+[.dbf])
ERASE ([tmp\]+lcDependetFNM+[.dbf])
ENDIF
*------------------------------------------------------------------------------

.cMeasureUnitList = spGetBaseMsuList(lvTovarInfo.MsuID)
lcMsuTNM = RIGHT(.cMeasureUnitList,LEN(.cMeasureUnitList)-AT([;],.cMeasureUnitList))
USE (lcMsuTNM) IN 0 ALIAS [lvTvrMsuList]
*------------------------------------------------------------------------------

*17.04.2004 14:53 -&gt;Óñòàíàâëèâàåì åäèíèöó èçìåðåíèÿ ïî óìîë÷àíèþ
IF .cMode==[ADD] AND lvTovarInfo.MsuID # 0 &amp;&amp; AND .cntIdCtlGridMsu.Value = 0
	.cntIdCtlGridMsu.SetValue(lvTovarInfo.MsuID)
ENDIF	
*------------------------------------------------------------------------------

*17.04.2004 15:06 -&gt; Óñòàíîâèì âåëè÷èíó ÍÄÑ ïî óìîë÷àíèþ
IF .cMode==[ADD] OR .cntTvrVat.txtTvrVATRate.Value =0
		***IF .cntTvrVat.txtTvrVATRate.Value # lvTovarInfo.tvrVATRate
	.cntTvrVat.txtTvrVATRate.Value = lvTovarInfo.tvrVATRate
ENDIF	
*------------------------------------------------------------------------------

*01.09.2005 17:26 -&gt; Óñòàíàâëèâàåì öåíû
IF TYPE([ThisForm.cntTvrBuy]) == [O] AND !ISNULL(.cntTvrBuy)
	.cntTvrBuy.SetPrice(.nOUID,lnTvrID)
ENDIF
***
IF TYPE([ThisForm.cntTvrSale]) == [O] AND !ISNULL(.cntTvrSale) AND TYPE([.FrmPrcType]) == [N]
	IF .FrmPrcType = 0 OR EMPTY(.FrmPrcType) OR ISNULL(.FrmPrcType)
		MESSAGEBOX([Ïðàéñ äëÿ äàííîãî äîêóìåíòà íå íàéäåí.],48,[Ïðåäóïðåæäåíèå])
	ELSE
		.cntTvrSale.SetPrice(lnTvrID,.FrmPrcType)
	ENDIF
ENDIF
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE cmdShow.Click
this.Parent._rsaliasname = 'TovarListOnly'
SELECT TovarListOnly
LOCATE ALL FOR TovarListOnly.TvrId = lvFrmPartTvrEdit.TvrId
DODEFAULT()
this.Parent._rsaliasname = 'TovarList'

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18I0M4ORT</uniqueid>
		<timestamp>1025997723</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblQnt</objname>
		<parent>frmparttimeedit</parent>
		<properties>FontBold = .T.
Caption = "Êîëè÷åñòâî:"
Left = 412
Top = 73
TabIndex = 21
ZOrderSet = 13
Name = "lblQnt"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_R020K4VL1</uniqueid>
		<timestamp>1025990772</timestamp>
		<class>txt</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>textbox</baseclass>
		<objname>txtQnt</objname>
		<parent>frmparttimeedit</parent>
		<properties>ControlSource = "lvFrmPartTvrEdit.TvrQnt"
Left = 486
TabIndex = 4
Top = 70
ZOrderSet = 14
_highlightobject = .parent.lblQnt
_convertcommatopoint = .T.
_usedbfieldproperty = .T.
Name = "txtQnt"
</properties>
		<protected/>
		<methods>PROCEDURE _handleanychange
*17.01.2006 09:52 -&gt;Ðàññ÷èòàåì ñóììû
ThisForm.CalculateSum()
*------------------------------------------------------------------------------
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18A02PAKD</uniqueid>
		<timestamp>1025997723</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblMsu</objname>
		<parent>frmparttimeedit</parent>
		<properties>FontBold = .T.
Caption = "Åäèíèöà èçìåðåíèÿ:"
Left = 4
Top = 72
TabIndex = 20
ZOrderSet = 15
Name = "lblMsu"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_30W0PUMX0</uniqueid>
		<timestamp>1025997723</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblNote</objname>
		<parent>frmparttimeedit</parent>
		<properties>FontBold = .T.
Caption = "Ïðèìå÷àíèå:"
Left = 5
Top = 228
TabIndex = 18
ZOrderSet = 16
Name = "lblNote"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18A02DMUV</uniqueid>
		<timestamp>1025997723</timestamp>
		<class>cntidctlgrid</class>
		<classloc>comidctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntIdCtlGridMsu</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 69
Left = 125
Width = 252
Height = 24
TabIndex = 3
ZOrderSet = 16
_controlsource = lvFrmPartTvrEdit.MsuId
_controlsourcetype = 1
_rsaliasname = lvTvrMsuList
_rsfieldnameid = MsuID
_rsfieldnametext = MsuNM
Name = "cntIdCtlGridMsu"
txtText._highlightobject = .parent.parent.lblMsu
txtText.Name = "txtText"
cmdShow.Name = "cmdShow"
cmdClear.Name = "cmdClear"
CmdTree.Name = "CmdTree"
Olecommprox1.Top = 0
Olecommprox1.Left = 36
Olecommprox1.Height = 16
Olecommprox1.Width = 38
Olecommprox1.Name = "Olecommprox1"
</properties>
		<protected/>
		<methods>PROCEDURE _refreshrelatedobjects
*30.09.2005 12:25 -&gt; Ðàñ÷¸ò öåíû åäèíèöû èçìåðåíèÿ
ThisForm.CalculatePriceMsu()
ThisForm.CalculateSum()
*------------------------------------------------------------------------------
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_30W0PUMWW</uniqueid>
		<timestamp>1025990772</timestamp>
		<class>edt</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>editbox</baseclass>
		<objname>edtNote</objname>
		<parent>frmparttimeedit</parent>
		<properties>Height = 47
Left = 83
TabIndex = 12
Top = 223
Width = 504
ZOrderSet = 17
ControlSource = "lvFrmPartTvrEdit.FrmPartTvrNote"
_highlightobject = .parent.lblNote
Name = "edtNote"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18M0216E7</uniqueid>
		<timestamp>1025997723</timestamp>
		<class>cntcancelsavehandled</class>
		<classloc>baseform_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntCancelSaveHandled</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 193
Left = 379
TabIndex = 11
ZOrderSet = 17
Name = "cntCancelSaveHandled"
cmdCancel.Name = "cmdCancel"
cmdOk.Name = "cmdOk"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_26Q0OOOIP</uniqueid>
		<timestamp>1025997723</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>LblTvrId</objname>
		<parent>frmparttimeedit</parent>
		<properties>FontBold = .T.
Caption = "Êîä òîâàðà"
Left = 10
Top = 13
TabIndex = 16
ZOrderSet = 18
Name = "LblTvrId"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_30W0NTI5O</uniqueid>
		<timestamp>1025997723</timestamp>
		<class>comtxtctlcalendar</class>
		<classloc>comtxtctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntTxtCtlJrnUseStart</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 162
Left = 58
Width = 176
Height = 23
TabIndex = 7
ZOrderSet = 11
_allowresize = .T.
_allowresizecontent = .T.
Name = "cntTxtCtlJrnUseStart"
txtText.ControlSource = "lvJrnUsageEditPart.UseStart"
txtText.Height = 23
txtText.Left = 0
txtText.Top = 0
txtText.Width = 149
txtText._highlightobject = .parent.parent.lblJrnUseStart
txtText.Name = "txtText"
cmdShow.Top = 0
cmdShow.Left = 153
cmdShow.Name = "cmdShow"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1VG0YR07S</uniqueid>
		<timestamp>1025990772</timestamp>
		<class>cmd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>commandbutton</baseclass>
		<objname>cmdPrice</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 193
Left = 275
Caption = "Ïîëó÷èòü öåíó"
TabIndex = 10
ToolTipText = "Îïðåäåëÿåì ïîñëåäíþþ öåíó ïîñòóïëåíèÿ"
ZOrderSet = 20
Name = "cmdPrice"
</properties>
		<protected/>
		<methods>PROCEDURE Click
WITH This.Parent
	.cntTvrBuy.SetPrice(.nOUID,.comTxtCtlCalcLenTLUIDByTLU.nTvrID,.T.)
ENDWITH

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_30W0NTI5V</uniqueid>
		<timestamp>1025997723</timestamp>
		<class>lbl</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>label</baseclass>
		<objname>lblJrnUseEnd</objname>
		<parent>frmparttimeedit</parent>
		<properties>FontBold = .T.
Caption = "Îêîí÷àíèå:"
Left = 341
Top = 165
TabIndex = 15
ZOrderSet = 12
Name = "lblJrnUseEnd"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_30W0NTI5Y</uniqueid>
		<timestamp>1025997723</timestamp>
		<class>comtxtctlcalendar</class>
		<classloc>comtxtctl_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cntTxtCtlJrnUseEnd</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 162
Left = 410
Width = 176
Height = 23
TabIndex = 8
ZOrderSet = 13
_allowresize = .T.
_allowresizecontent = .T.
Name = "cntTxtCtlJrnUseEnd"
txtText.ControlSource = "lvJrnUsageEditPart.UseEnd"
txtText.Height = 23
txtText.Left = 0
txtText.Top = 0
txtText.Width = 148
txtText._highlightobject = .parent.parent.lblJrnUseEnd
txtText.Name = "txtText"
cmdShow.Top = 0
cmdShow.Left = 152
cmdShow.Name = "cmdShow"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_30W0NTI65</uniqueid>
		<timestamp>1025990772</timestamp>
		<class>cmd</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>commandbutton</baseclass>
		<objname>cmdToday</objname>
		<parent>frmparttimeedit</parent>
		<properties>Top = 161
Left = 270
Height = 25
Width = 48
Caption = "\&lt;Ñåé÷àñ"
TabIndex = 13
Name = "cmdToday"
</properties>
		<protected/>
		<methods>PROCEDURE Click
This.Parent.cntTxtCtlJrnUseStart.txtText.Value= DATETIME()
This.Parent.cntTxtCtlJrnUseEnd.txtText.Value= DATETIME()

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>frmparttimeedit</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25I136UUP</uniqueid>
		<timestamp>1026649732</timestamp>
		<class>frmview</class>
		<classloc>baseform_v1.vcx</classloc>
		<baseclass>form</baseclass>
		<objname>frmresuprom</objname>
		<parent/>
		<properties>Top = 0
Left = 0
Height = 634
Width = 1082
DoCreate = .T.
Caption = "Ïëàí - ãðàôèê âûïîëíåíèÿ ðàáîò ïî äîãîâîðó"
HalfHeightCaption = .T.
WindowState = 2
resuparent = 0
ndefclt = 0
ntimeclearnum = 0
nwkdays = 0
nfrmid = 0
_memberdata =      409&lt;VFPData&gt;&lt;memberdata name="ndefclt" type="property" display="nDefClt"/&gt;&lt;memberdata name="lonlytime" type="property" display="lOnlyTime"/&gt;&lt;memberdata name="ntimeclearnum" type="property" display="nTimeClearNum"/&gt;&lt;memberdata name="nwkdays" type="property" display="nWkdays"/&gt;&lt;memberdata name="nfrmid" type="property" display="nFrmId"/&gt;&lt;memberdata name="loaddata1" type="method" display="LoadData1"/&gt;&lt;/VFPData&gt;

nscrfrmid = 0
Name = "frmresuprom"
cstmsghandler.Name = "cstmsghandler"
cstresizable.Name = "cstresizable"
Img1.ZOrderSet = 2
Img1.Name = "Img1"
</properties>
		<protected/>
		<methods>PROCEDURE Activate
DODEFAULT()
_VFP.AutoYield = .f.
ENDPROC
PROCEDURE Deactivate
DODEFAULT()
_VFP.AutoYield = .t.
ENDPROC
PROCEDURE Destroy
DODEFAULT()
_VFP.AutoYield = .t.
pnScrFrmID = null
RELEASE pnScrFrmID

ENDPROC
PROCEDURE Init
LPARAMETERS	nFrmId
IF PCOUNT()&lt;1
	nFrmId = -1
ENDIF

*05.05.2004 01:57 -&gt;Ìîäèôèöèðóåì èìÿ ôîðìû ñ ó÷åòîì åå èäåíòèôèêàòîðà
This.Name = This.Name + [_GANT] &amp;&amp; + ALLTRIM(STR(tnScrFrmID))
*------------------------------------------------------------------------------

*04.05.2004 23:30 -&gt;Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------

WITH This
*04.05.2004 23:16 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
PRIVATE	_PARAM	
*------------------------------------------------------------------------------
.nFrmId = nFrmId
*.nFrmId = 67573
*04.05.2004 23:13 -&gt;Ñîõðàíèì èäåíòèôèêàòîð ôîðìû â ñâîéñòâå ôîðìû

*******************************************************************************
*Ïîëó÷èì èíôîðìàöèþ î äîêóìåíòàõ, îòîáðàæàåìûõ íà äàííîé ôîðìå.
*******************************************************************************


.g2ANTT1.nTypeTime = VAL(oRes.GetParam([SET],[TYPETIME],0))

.g2ANTT1.lExpandResu = (VAL(oRes.GetParam([SET],[EXPANDRESU],1))=1)
.g2ANTT1.loaddata()
ENDWITH

************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE loaddata1
with thisform.G2antt1
	.BeginUpdate
	.MarkSearchColumn = .F.
	.ShowFocusRect = .F.
	.Columns.Add("Tasks")
	with .Columns.Add("C")
		.HeaderAlignment = 1
		.Def(0) = .T.
		.PartialCheck = .T.
		.AllowSizing = .F.
		.Width = 18
	endwith
	with .Chart
		.PaneWidth(0) = 96
		.AllowCreateBar = 1
		.FirstVisibleDate = {^2005-6-20}
		.DrawLevelSeparator = .F.
		.LevelCount = 3
		.Level(1).DrawGridLines = .F.
		.AllowInsideZoom = .T.
		.DrawDateTicker = .T.
		.DateTickerLabel = "&lt;%mmm%&gt; &lt;%d%&gt;&lt;br&gt;&lt;b&gt;&lt;%hh%&gt;:&lt;%nn%&gt;&lt;/b&gt;"
		.MarkSelectDateColor = 0x7ffff8ee
		with .DefaultInsideZoomFormat
			.OwnerLabel = "&lt;%mmm%&gt; &lt;%d%&gt;"
			.BackColor = RGB(238,248,255)
			.BackColorChart = .BackColor
			.InsideCount = 4
			.InsideLabel = "&lt;b&gt;&lt;%hh%&gt;&lt;/b&gt;"
		endwith
		.InsideZooms.Add({^2005-6-22})
		.DrawGridLines = 2
	endwith
	with .Items
		h = .AddItem("Project 1")
		.AddBar(h,"Summary",{^2005-6-21},{^2005-7-1})
		h1 = .InsertItem(h,0,"Task 1")
		.AddBar(h1,"Task",{^2005-6-21},{^2005-6-28})
		.CellMerge(h1,0) = 1
		.DefineSummaryBars(h,"",h1,"")
		h1 = .InsertItem(h,0,"Task 2")
		.AddBar(h1,"Task",{^2005-6-23},{^2005-7-1},"E")
		.CellMerge(h1,0) = 1
		.DefineSummaryBars(h,"",h1,"E")
		.ItemBar(h1,"E",21) = 5
		h1 = .InsertItem(h,0,"Task 3")
		.AddBar(h1,"Task",{^2005-6-25},{^2005-6-27},"E")
		.CellMerge(h1,0) = 1
		.DefineSummaryBars(h,"",h1,"E")
		.ExpandItem(h) = .T.
		.CellState(h,1) = 1
		h = .AddItem("Project 2")
		.AddBar(h,"Summary",{^2005-6-26},{^2005-7-6})
		h1 = .InsertItem(h,0,"Task 1")
		.AddBar(h1,"Task",{^2005-6-26},{^2005-7-2})
		.CellMerge(h1,0) = 1
		.DefineSummaryBars(h,"",h1,"")
		h1 = .InsertItem(h,0,"Task 2")
		.AddBar(h1,"Task",{^2005-6-28},{^2005-7-6},"E")
		.CellMerge(h1,0) = 1
		.DefineSummaryBars(h,"",h1,"E")
		.ItemBar(h1,"E",21) = 5
		h1 = .InsertItem(h,0,"Task 3")
		.AddBar(h1,"Task",{^2005-6-30},{^2005-7-2},"E")
		.CellMerge(h1,0) = 1
		.DefineSummaryBars(h,"",h1,"E")
		.ExpandItem(h) = .T.
		.CellState(h,1) = 1
	endwith
	.EndUpdate
endwith

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>16</reserved2>
		<reserved3>resuparent Ðîäèòåëü ðåñóðñîâ ïî äåðåâó òîâàðîâ
ndefclt êëèåíò ïî-óìîë÷àíèþ
lonlytime Ïîêàçûâàòü íà áàðàõ òîëüêî âðåìÿ èëè åùå èíô î êëèåíòå
ntimeclearnum Âðåìÿ â ÷àñàõ ìåæäó óáîðêàìè íîìåðîâ
nwkdays êîëè÷åñòâî äíåé äëÿ çàãðóçêè ñ òåêóùåé äàòû
nfrmid Id ôîðìû äëÿ ïëàíà
*addxml äîáàâëÿåì äîï íàñòðîéêè
*loaddata1 
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7>Ïðîñìîòð ðåñóðñîâ ÷åðåç Ãàííòà äëÿ ïðîì. ïðîåêòîâ</reserved7>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1026649732</timestamp>
		<class>g2antt</class>
		<classloc>gannt.vcx</classloc>
		<baseclass>olecontrol</baseclass>
		<objname>G2ANTT1</objname>
		<parent>frmresuprom</parent>
		<properties>Top = 0
Left = 1
Height = 600
Width = 1080
ZOrderSet = 3
dbtablename = Basis!rv_ResursJrn
_handledcustommsglist = 
_handledcustommsgpromptlist = 
cname0 = Ðàáîòû, ñîáûòèÿ
ncountunits = 15
Name = "G2ANTT1"
</properties>
		<protected/>
		<methods>PROCEDURE _add
LPARAMETERS item, datestart, dateend
LOCAL lPartFrmId ,lPartFrmId1 ,tnTvrID,lnMsuID,lnPrice ,_PARAM1,_PARAM2,llResult,lnQnt,lRetValPut, lFreeChoise
nitem = item
WITH this
.Enabled = .F.

		PUBLIC nMakerOuId,nDefClt1,nIspCltID,nTvrId,cRezult
		nDefClt1 = thisform.nDefClt

		SELECT rv_ResursLst
		LOCATE ALL FOR BarId = nitem
		nTvrId = rv_ResursLst.TvrId
		lFreeChoise = !FOUND()
		IF lFreeChoise
				GO top
				LOCATE ALL FOR ItemId = nitem
		ENDIF
		nMakerOuId = rv_ResursLst.MakerOuId
		*** - 29.09.2009 17:45:17 Ãëóõîâ Â.Þ. (C) - &gt;
		** îïðåäåëÿåì åñòü ëè çàåçäû ïî ïóòåâêàì äëÿ ýòîãî òîâàðà-ðåñóðñà
		_PARAM = rv_ResursLst.ServID
		USE BASIS!lvmatrixhotel IN 0 ALIAS matrixhotel
		USE IN SELECT('lvmatrixhotel')
		SELECT * FROM matrixhotel INTO TABLE tmp\lvmatrixhotel
		USE IN SELECT('matrixhotel')
		IF RECCOUNT('lvmatrixhotel')&gt;0
			USE IN SELECT('lvmatrixhotel')
			PUBLIC lRetValm[1,2]
			lRetValPut = oApp.DoModalFormRetValObj([frmhotelput;primarydoc_v1.vcx;primarydoc.app]) &amp;&amp;,rv_ResursLst.ServID)
			IF lRetValPut
				lnPrice = lRetValm[1,2]
				lnQnt   = lRetValm[1,1]
	  	 		 lnQnt   = IIF(TYPE('datestart')='T',lnQnt*24*60*60, lnQnt  )
	      		 dateend   = datestart+   lnQnt
			ENDIF
	        RELEASE lRetValm
		ENDIF
		USE IN SELECT('lvmatrixhotel')
		ERASE tmp\lvmatrixhotel.dbf
		
		IF lFreeChoise
				SELECT rv_ResursLst
				LOCATE ALL FOR ItemId = nitem
				IF !FOUND()
			        RELEASE nMakerOuId,nDefClt1,lRetValm,nTvrId,cRezult
					RETURN 0
				ENDIF
				cRezult = spFreeRec(rv_ResursLst.TvrParId,datestart+1,dateend-1 )
				* ñîçäàåì ñïèñîê ðåñóðñîâ, êîòîðûå äîñòóïíû â ýòîò ïåðèîä
				IF EMPTY(cRezult)
					RETURN 0
				ENDIF
			ELSE
				lBarCnt = ._find(rv_ResursLst.TvrId,datestart, dateend,0)
				IF lBarCnt &gt;0
					RETURN 0
				ENDIF
		ENDIF

	    dStart = datestart
	    dEnd   = dateend
luResAdding = oMgrPD.Operate([FORM],[ADDSCHET],ThisForm.nScrFrmID,datestart, dateend )  &amp;&amp; DATETIME(), DATETIME())
IF !EMPTY(cRezult)
				SELECT rv_ResursLst
				GO TOP
				LOCATE ALL FOR TvrId = nTvrId
				nitem = rv_ResursLst.BarId
				nMakerOuId = rv_ResursLst.MakerOuId
				cRezult = 'TMP\'+cRezult +'.dbf'
				ERASE (cRezult)
ENDIF
datestart = dStart
dateend   = dEnd
RELEASE nMakerOuId,nDefClt1,lRetValm,nTvrId,cRezult
.Enabled = .T.
SET DATABASE TO BASIS
IF TYPE('luResAdding')='L'
RETURN 0
ENDIF
		lPartFrmId1  = luResAdding

		SELECT rv_ResursLst
		SCATTER MEMVAR
		** ñ÷èòàåì âðåìÿ â ìèíóòàõ
		nTime = (dateend - datestart)
		*** - 14.03.2009 11:46:58 Ãëóõîâ Â.Þ. (C) - Ïðàâà ïðèíàäëåæàò
		IF TYPE('datestart')='T'
		   nTime = nTime /60 /60  &amp;&amp; ïðèâåëè ê ÷àñàì
**		   nTime = nTime /60 /60/24  &amp;&amp; ïðèâåëè ê ñóòêàì
		  ELSE
		   nTime  = nTime * 24  &amp;&amp; ïðèâåëè ê ÷àñàì
**		   nTime  = nTime   &amp;&amp; ïðèâåëè ê ñóòêàì
		ENDIF
		** îïðåäåëÿåì êîä óñëóãè è öåíó
		_PARAM1 = m.ServID &amp;&amp;22023 &amp;&amp;tnTvrID
		_PARAM2 = 1
		***
		USE IN SELECT([lvPriceTvr])
		USE lvPriceTvr IN 0
IF lRetValPut
	nTime  = 1
	ELSE
	lnPrice = lvPriceTvr.Price
		ENDIF
		USE lvOrderTvrEdit IN 0 NODATA
		APPEND BLANK IN lvOrderTvrEdit
		REPLACE ;
			FrmID WITH luResAdding  , ;
			TvrId WITH m.ServID, ; &amp;&amp; (ïðîæèâàíèå â íîìåðå)
			TvrIDCalc WITH m.TvrId, ; &amp;&amp;(êîä ðåñóðñà)
			MsuId WITH m.MsuID, ;
			TvrQnt WITH nTime  , ;
			TvrPrcSale WITH lnPrice  ;
		IN lvOrderTvrEdit
		RELEASE lnPrice
		**SET STEP ON
		llResult = TABLEUPDATE(1,.T.,[lvOrderTvrEdit])
		*------------------------------------------------------------------------------
		IF llResult
			lPartFrmId = spGetLastIncrementedID([lvOrderTvrEdit])
			**lPartFrmId = spGetLastIncrementedID([JrnUsege])
		ELSE
		   RETURN 0
		ENDIF

USE IN SELECT('lvJrnUsageEditPartTvr')
		_PARAM = lPartFrmId
			
			**FrmPartTvrId WITH lPartFrmId ,;

USE lvJrnUsageEditPartTvr IN 0
SELECT lvJrnUsageEditPartTvr
		REPLACE ;
			UseStart WITH datestart, ;
			UseEnd WITH dateend, ;
			UsePlan WITH .t. ;
		IN lvJrnUsageEditPartTvr
		llResult = TABLEUPDATE(1,.T.,[lvJrnUsageEditPartTvr])
		IF llResult
			.lnbarid= lvJrnUsageEditPartTvr.JrnUseId
			lPartFrmId = .lnbarid
	    	INSERT INTO rv_ResursJrn (JrnUseId,ItemId, FrmId,BarId,UseStart,UseEnd,PointIspCl,FrmIsPayed) ;
	    					  VALUES (lPartFrmId,item,luResAdding,lPartFrmId,datestart,dateend,pPointIspCltID,.f.)  &amp;&amp; äëÿ îòîáðàæåíèÿ
		ELSE
		   RETURN 0
		ENDIF
		*** lvFrmEdit.PointIspCltID
	lresult = spDiscRecount(lPartFrmId1, nIspCltID,null,null)
RELEASE nIspCltID
ENDWITH 		
RETURN luResAdding
ENDPROC
PROCEDURE _dele
LOCAL luRes , lFrmId
WITH this
	SELECT rv_ResursJrn
	LOCATE ALL FOR rv_ResursJrn.JrnUseId = .lnbarid
	IF FOUND() AND 	(rv_ResursJrn.FrmStatusI&lt;3 AND !rv_ResursJrn.FrmIsPayed)
	   lFrmId = rv_ResursJrn.FrmID
	   luRes = oMgrPD.Operate([FORM],[DELE],rv_ResursJrn.FrmID)
	
	  IF luRes
		SELECT rv_ResursJrn
		LOCATE ALL FOR rv_ResursJrn.FrmID = lFrmId
	   DO while FOUND()
		   .Items.RemoveBar(rv_ResursJrn.itemid , rv_ResursJrn.JrnUseId)
			DELETE next 1 IN rv_ResursJrn
			LOCATE ALL FOR rv_ResursJrn.FrmID = lFrmId
	   ENDDO
	  ENDIF
ENDIF
ENDWITH

ENDPROC
PROCEDURE _edit
*LPARAMETERS lnJrnUseId, h
LOCAL luRes, lstr, datestart, dateend,stringWk,test1
luResAdding  =.f.
SELECT rv_ResursJrn
LOCATE ALL FOR rv_ResursJrn.JrnUseId = .lnbarid
** åñëè äîêóìåíò íå çàêðûò äëÿ ðàáîòû
IF !FOUND()
RETURN
ENDIF
IF rv_ResursJrn.FrmStatusI &gt;3 &amp;&amp;!rv_ResursJrn.FrmIsPayed òàê áûëî
	  	MESSAGEBOX('Ñòàóñ äîêóìåíòà íå ïîçâîëÿåò åãî ðåäàêòèðîâàòü.'+CHR(13)+;
	  			   'Åãî ìåíÿòü íåëüçÿ.',0+32,'Îòìåíà ðåäàêòèðîâàíèÿ äîêóìåíòîâ')
ENDIF

WITH this.Items
LOCAL h, lnJrnUseId
h = rv_ResursJrn.ItemId
lnJrnUseId = rv_ResursJrn.JrnUseId
datestart = .ItemBar(h, lnJrnUseId,1)
dateend   = .ItemBar(h, lnJrnUseId,2)
	ENDWITH
PUBLIC barCltName, nFrmStatusI,dStart,dend
nFrmStatusI   = rv_ResursJrn.FrmStatusI
barCltName  =''
this.Enabled = .F.
dStart = IIF(VARTYPE(datestart)='C',CTOT(datestart),datestart)
dEnd   = IIF(VARTYPE(dateend)='C',CTOT(dateend),dateend)
luRes = oMgrPD.Operate([FORM],[EDIT],rv_ResursJrn.FrmID)
datestart = TTOC(dStart)
dateend   = TTOC(dEnd)
this.Enabled = .t.
IF luRes
REPLACE rv_ResursJrn.FrmStatusI WITH nFrmStatusI NEXT 1 IN rv_ResursJrn
this.BeginUpdate()
WITH this.Items
.RemoveBar(h, lnJrnUseId)
	                .AddBar( h, this.namebar(rv_ResursJrn.FrmStatusI,rv_ResursJrn.FrmIsPayed) , datestart, dateend, lnJrnUseId, ALLTRIM(barCltName) )
stringWk = "Items.ItemBar("+ ALLTRIM(STR(h,10,0))+" , "+ ALLTRIM(STR(lnJrnUseId,10,0))+" , 12) =`" +IIF(rv_ResursJrn.FrmIsPayed,"1","0")+"`"   &amp;&amp; exBarPercent
this.executeTemplate(stringWk)
				    stringWk = "Items.ItemBar("+ ALLTRIM(STR(h,16,0))+" , "+ ALLTRIM(STR(lnJrnUseId,10,0))+" ,  6) = `" ;
				    						   +  "Çàñåëåíèå:"+ IIF(VARTYPE(datestart)='C',datestart,TTOC(NVL(datestart,{})))+ ;
				    							  "      Âûåçä:        "+ IIF(VARTYPE(dateend)='C',dateend,TTOC(NVL(dateend,{})))+"`"    &amp;&amp; exBarToolTip
				    This.ExecuteTemplate(stringWk)
	  ENDWITH
this.EndUpdate()
ENDIF
RELEASE barCltName, nFrmStatusI,dStart,dend
RETURN luRes

ENDPROC
PROCEDURE _handlecustommsg
LPARAMETERS tcMsg
DODEFAULT(tcMsg)
DO CASE
	CASE tcMsg = [GUESTIN]
		*16.09.2007 18:10 -&gt;Ìåíÿåì ñòàòóñ íà 3 - ãîñòü çàñåëåí
		LOCAL lnFrmID, lRetVal, lnUserClt
		lRetVal  = .f.
		SELECT rv_ResursJrn
		LOCATE ALL FOR rv_ResursJrn.JrnUseId = this.lnbarid
		
		IF FOUND() AND rv_ResursJrn.FrmStatusI &lt; 3 AND MESSAGEBOX('Çàñåëÿòü ãîñòÿ â íîìåð?',4+32+256,'Èçìåíåíèå äàííûõ î ïðîæèâàíèè ...')=6
			lnFrmID = rv_ResursJrn.FrmID
			_PARAM = lnFrmID
			lnUserClt = spUserClt()
			USE lvFrmEdit IN 0
			CURSORSETPROP([BUFFERING],3,[lvFrmEdit])
			REPLACE FrmStatusID WITH 3, ExecEmiCltID WITH lnUserClt IN lvFrmEdit
			**oApp.nUserKod
			lRetVal = TABLEUPDATE(1,.T.,[lvFrmEdit])
			USE IN lvFrmEdit
		ENDIF
		*------------------------------------------------------------------------------
		IF lRetVal
REPLACE rv_ResursJrn.FrmStatusI  WITH 3 NEXT 1 IN rv_ResursJrn
this.BeginUpdate()
WITH this.Items
LOCAL h, lnJrnUseId
h = rv_ResursJrn.ItemId
lnJrnUseId = rv_ResursJrn.JrnUseId
datestart = .ItemBar(h, lnJrnUseId,1)
dateend   = .ItemBar(h, lnJrnUseId,2)
.RemoveBar(h, lnJrnUseId)
		                .AddBar( h, this.namebar(3,rv_ResursJrn.FrmIsPayed) , datestart, dateend, lnJrnUseId, ALLTRIM(rv_ResursJrn.CltNm) )
stringWk = "Items.ItemBar("+ ALLTRIM(STR(h,10,0))+" , "+ ALLTRIM(STR(lnJrnUseId,10,0))+" , 12) =`" ;
						   +IIF(rv_ResursJrn.FrmIsPayed,"1","0")+"`"   &amp;&amp; exBarPercent
this.executeTemplate(stringWk)
					    stringWk = "Items.ItemBar("+ ALLTRIM(STR(h,16,0))+" , "+ ALLTRIM(STR(lnJrnUseId,10,0))+" ,  6) = `" ;
					    						   +  "Çàñåëåíèå:"+ IIF(VARTYPE(datestart)='C',datestart,TTOC(NVL(datestart,{})))+ ;
													  "      Âûåçä:        "+ IIF(VARTYPE(dateend)='C',dateend,TTOC(NVL(dateend,{})))+"`"    &amp;&amp; exBarToolTip
					    This.ExecuteTemplate(stringWk)
		  ENDWITH
this.EndUpdate()
		ENDIF
	CASE tcMsg = [PAYORD]
LOCAL nPayVarNum
nPayVarNum = ALLT(oRes.GetParam([RST],[PAYTYPE]))
		*16.09.2007 18:10 -&gt;Îïëàòà ñ÷åòà êëèåíòà
		LOCAL lnFrmID
		SELECT rv_ResursJrn
		LOCATE ALL FOR rv_ResursJrn.JrnUseId = this.lnbarid
		IF FOUND()
			lnFrmID = rv_ResursJrn.FrmID
			IF rv_ResursJrn.FrmIsPayed
				IF MESSAGEBOX('Äîêóìåíò óæå îïëà÷åí, îôîðìèòü âîçâðàò äåíåã (âûáåðèòå Äà)',4+32+256,'Îôîðìëåíèå âîçâðàòà çàêàçà')=6
			**+ CHR(13) + ;
			**		 								   'èëè ñäåëàòü Äîïëàòó (âûáåðèòå Íåò)?'
				lRetVal = oApp.DoModalFormRetValObj([FrmPayment;payment.vcx],lnFrmID  ,nPayVarNum,IIF(rv_ResursJrn.FrmIsPayed,2,1) ,0)
				  ELSE
				 	RETURN
				 ENDIF
			 ELSE
				lRetVal = oApp.DoModalFormRetValObj([FrmPayment;payment.vcx],lnFrmID  ,nPayVarNum,IIF(rv_ResursJrn.FrmIsPayed,1,1) ,0)
			ENDIF
			*------------------------------------------------------------------------------
			IF lRetVal
	         REPLACE rv_ResursJrn.FrmIsPayed WITH IIF(rv_ResursJrn.FrmIsPayed,!lRetVal,lRetVal) NEXT 1 IN rv_ResursJrn
	         this.BeginUpdate()
	          WITH this.Items
					        stringWk = "Items.ItemBar("+ ALLTRIM(STR(rv_ResursJrn.ItemId ,10,0))+" , "+ ALLTRIM(STR(rv_ResursJrn.JrnUseId,10,0))+" , 12) = 1" &amp;&amp; exBarPercent
					        This.ExecuteTemplate(stringWk)
			  ENDWITH
	         this.EndUpdate()
	         ENDIF
		ENDIF
ENDCASE


ENDPROC
PROCEDURE _info
WITH this
	SELECT rv_ResursJrn
	LOCATE ALL FOR rv_ResursJrn.JrnUseId = .lnbarid
	IF FOUND()
	   luRes = oMgrPD.Operate([FORM],[INFO],rv_ResursJrn.FrmID)
ENDIF
ENDWITH

ENDPROC
PROCEDURE AddLink
*** ActiveX Control Event ***
LPARAMETERS linkkey
LOCAL nFrmId1,nFrmId2,nPointIspCl1,nPointIspCl2,_PARAM
SELECT rv_ResursJrn
WITH This
	LOCATE ALL FOR rv_ResursJrn.JrnUseId = .lnbaridu
	IF FOUND()
		IF NVL(rv_ResursJrn.FrmIsPayed,.f.)
			  	MESSAGEBOX('Îäèí èç äîêóìåíòîâ óæå îïëà÷åí.'+CHR(13)+;
	  			   'Åãî ìåíÿòü íåëüçÿ.',0+32,'Îòìåíà îáúåäèíåíèÿ äîêóìåíòîâ')
	  			   RETURN .f.
		ENDIF
	    nFrmId2 = rv_ResursJrn.FrmID
		nPointIspCl2 = rv_ResursJrn.PointIspCl
		ELSE
	  			   RETURN .f.
	ENDIF

	LOCATE ALL FOR rv_ResursJrn.JrnUseId = .lnbarid
	IF FOUND()
		IF NVL(rv_ResursJrn.FrmIsPayed,.f.)
			  	MESSAGEBOX('Îäèí èç äîêóìåíòîâ óæå îïëà÷åí.'+CHR(13)+;
	  			   'Åãî ìåíÿòü íåëüçÿ.',0+32,'Îòìåíà îáúåäèíåíèÿ äîêóìåíòîâ')
	  			   RETURN .f.
		ENDIF
	   nFrmId1 = rv_ResursJrn.FrmID
	   nPointIspCl1 = rv_ResursJrn.PointIspCl
		ELSE
	  			   RETURN .f.
	ENDIF

	IF nFrmId1 = nFrmId2
	  	MESSAGEBOX('Ýòè äîêóìåíòû óæå îáúåäåíåíû.',0+32,'Îòìåíà îáúåäèíåíèÿ äîêóìåíòîâ')
	  			   RETURN .f.
	ENDIF

	IF nPointIspCl1 &lt;&gt; nPointIspCl2
	  	MESSAGEBOX('Ó äîêóìåíòîâ ðàçíûå êëèåíòû.'+CHR(13)+;
	  			   'Ñäåëàéòå îäíîãî êëèåíòà.',0+32,'Îòìåíà îáúåäèíåíèÿ äîêóìåíòîâ')
	  			   RETURN .f.
	ENDIF


	IF   	MESSAGEBOX('Îáúåäèíÿòü ýòè äâà äîêóìåíòà?',4+0+32,'Îáúåäèíåíèå äîêóìåíòîâ') &lt;&gt; 6
	RETURN .f.
	ENDIF

*** - 18.03.2009 20:15:36 Ãëóõîâ Â.Þ. (C) - Ïðàâà ïðèíàäëåæàò
llResult = spFormJoin(nFrmId1,nFrmId2)

		IF !llResult
		   RETURN .f.
		ENDIF
*------------------------------------------------------------------------------
llResult = spDiscRecount(nFrmId2, rv_ResursJrn.PointIspCl,null,null)
REPLACE ALL FOR rv_ResursJrn.FrmId = nFrmId1 rv_ResursJrn.FrmID WITH nFrmId2 IN rv_ResursJrn
IF MESSAGEBOX('Äîêóìåíò èçìåíåí. Ðàñïå÷àòàòü åãî?',4+32,'Ïîäãîòîâêà ê ïå÷àòè ...')=6
	.lnbarid= .lnbaridu
	._prndoc()
ENDIF
ENDWITH

DODEFAULT(linkkey)

ENDPROC
PROCEDURE addxml
LOCAL s
WITH this
.BeginUpdate
.SingleSel = .F.
s = "gBJJgBAIDAAGAAEAAQhYAf8Pf4hh0QihCJo2AEZjQAjEZFEaIEaEEaAIAkcbk0olUrlktl0vmExmUzmk1m03nE5nU7nk9n0/oFBoVDolFo1HpFJpVLplNp1PqFRqVTq"
s=s+"lVq1XrFZrVbrldr1fsFhsVjslls1ntFptVrtltt1vuFxuVzul1u13vF5vV7vl9v1BAmBhOCwMKwuDw2ExWJxmIx2HyGLx+SyONyuTy2UzWZzmYz2X0Gbx1kUigUAAMwzG"
s=s+"eo1Ws1ZV2Go1IAL+1ACZMxm2+52W63Ov2Op1fC13F0un4nJ1vE2BV2XD2e/4vK4fL63V1bMTKZ5/d2pf3vh6Xj2ff3e63G683S5vF0mmAD4+Xx+bA+wAeP5/H6a/9+h8P2"
s=s+"eIAGZAiHHYZkDQQ7TuH/Ap4GUUzjPgiCJn+AD7GBAMNQJBD8wFDwAFlEUExJBaHQdCDixM+UARYABuxg/8ZQ5DUQRpEEbQKf8DxPBDiPe08KRdDEZHVIwANU1YRSWAALSdJ"
s=s+"snxpHcFO3HsrOI48Ky1IkKQpERZAA9sjHVC77ynEsqwbBE1RVNKHgAQ04yQ1skvDOJDRkZc9ABJYRT5Jk+z/P0pR49sgQHAsaUVApx0aAD+mvOclSZIkYG7MsMxNTUqyw+F"
s=s+"FwVRNQwRSwACFUwADvVNHv9IlNu5V02u5UjzVMIUQxHMYABzXdUVVRpxgBXM60DX9MQHTjWrJE0uzfGkXRdXNa0FYMjxBM8vxJM7iWXN8KSlbs31zWlT1Ja0eWxM9tNbbkL"
s=s+"UhY1mQtaU62hI9hyZUl0x5H6x3ZLVvwtekyWlYlHXNBF0R5dTszdC1vR1cELVJO9JABLODVvMF8x9deGS1fE3yJXYc4pgOKUDfGE31ZN+Srd13U/VdI1y9uCWBPRl2NE1sW"
s=s+"xbeWv9l2f6DSNSXdkTaNtd1WyrncR567mgaHGJLanMLY2laVc2FOjW1JpTuX2sV0YhmMtQpXLct1msZRBLmU421exYbN93XgAFixA9s61ztkzbc4u47LHmb6O8ExSPs0j6N"
s=s+"Otyv1hSy8BCm6bHs7eUDXMXb5DOLuJyG5v9CjzWLCkszrqZLS2+/NtbwEQdFN9sPbLPEYFU/Fxj1TV2U7WyahslSdM8O9SPGkieK+8iW33fe1JXNUjvqrnWlo1A2lUnieO+"
s=s+"/k1lGMs7RjDwvNiciedUtT6Nd3B+RlaxQJBmx8luULWLLPqxjZ769S/UQe1svPUi6M+D5DzN5a2athyHX9H6f43VIjE3yMTbqrlbB5l3OYgU+ssL7X+rtc+2Nj7AD5vwRkk"
s=s+"SCyAoFvvg6/FaiZIIuHbGv9DRxEuQeRjC2FkKH/pvRcs4+b+4MFgH+mmISDIhrHN0dqI5uIjRLGYbOJp2YnRRihAaIsQYiRXIdFVKsSImRKiegOKUYIpxZiwg2MsWokxpjF"
s=s+"Gs7UY4vxvNmWSKwAEHoRjrHRFMZkToMd3HqOcf4lRBN1IKLMg4vGzjnHeRUeY+yNj5GeIkhpJSFkpF+RKKZFoRj9I6PcZJKSElBIGUUR44ljkBJCT0gI1RclZIeN0YZLRal"
s=s+"RKqLsq5XRslhIiWUqY0S1l9HCV8YyyEWB8SuYpHiQEiJIAAkpKJmk4QoX8pJFE3zSKCQEA="
.Images(s)
s="gBJJgBAICAAGAAEAAQhYAf8Pf4hh0QihCJo2AEZjQAjEZFEaIEaEEaAIAkcbk0olUrlktl0vmExmUzmk1m03nE5nU7nk9n0/oFBoVDolFo1HpFJpVLplNp1PqFRqVTqlVq1XrF"
s=s+"ZrVbrldr1fsFhsVjslls1ntFptVrtltt1vuFxuVzul1u13vF5vV7vl9v1/wGBwWDwmFw2HxGJxWLxmNx2PyGRyWTymVy2XzGZzWbzmdz2f0Gh0WjwEWH0r08ekEikgAkso184iG"
s=s+"kicPjcU2+zjW43e6jO8jL+b79X8bfif48bfAffgP43IT8b4XE3O23vW3++2r/6vcjUB"
.Images(s)

*!*		.DrawGridLines = -1
*!*		.BackColor = RGB(255,255,255)
*!*		.MarkSearchColumn = .F.
*!*		.ShowFocusRect = .F.
*!*		.HasLines = .F.
*!*		.Indent = 24
*!*		.DefaultItemHeight = 20
*!*		.AllowChartScrollPage = .T.
*!*		.ScrollPartCaption(2,2048) = "&lt;img&gt;4&lt;/img&gt;"
*!*		.ScrollPartCaption(2,32) = "&lt;img&gt;5&lt;/img&gt;"
*!*		   WITH .VisualAppearance
*!*			.Add(1,"gBFLBCJwBAEHhEJAEGg4BOEIQAAYAQGKIYBkAKBQAGaAoDDMOILQiMQxDPBMKgBBCLIxiGK4DhiGoZQ0HKCRZDeI4DDSNcgjCLIZw8GYCIRjaL5UkPGSZJpmSRwAiWPIpSrLMrgLLMdR1HCBaQiehoaiEMg1CTTVQSCKoYSjBKqarjGbKGoqSozUxNMAggI=")
*!*			.Add(2,"XP: Header 1 1")
*!*		   ENDWITH
*!*				.HTMLPicture("excel") = "gAAAABgYAEAgBEChSohIAC0KFEKEEKIEKgkNhQAAkZjkCgkejshkUjkklk0nlEplUrlRofQSADbMhEABwl8xmYAI0KaoPawANgYYwAeIDIIARE3mU0A08n1AoVEo1IBVDYrjo7NrFQoaoqoAK5+IYAXE3N1iAB2tCcfcwQFosswpsCns/fDVmlBobQm4GHVMi0KJQBBcceE3VAscJ3XgADAAucFgWDwt1ADNVa6bgUtoAcxSxeWxuPyMfAGUjhwfkwGmdQ5kxbXAL/f+jyGByeEjhQzrwEJ1OOy2m20uC3SszpvE/A4m40+6TfLOOqmEZSBCCYAu80jLY35xjPCf/UyU1zocYECGmrxzDOxxKAmOJx2m0aGdOgl4HX7PNkDcsK8iMnQzoNmCOQ4v88rUCI9jlOYxzbv+57Cui4EBIU/jtLwjg1mBBCMjgYjsvIbgjsW20NO2ABIPYFj2RamEYgAW4PnMO4ICQxb6n+UD2DsE0IMfEJ+phFZMAeoYBIVJaOw0kQwPY2wuSK9r3iA+T6PqYD2MTFEIuLACayqzDNG49gyROO4QhkIoACsESKhxKpsTiAB4PYVgOGOjSFAYWShkKEiKkoaChipKpMhOioMUAAAbhEo6NoFP6hgiECj0qAB7Uwjk9T5TQ2A3Ph4A1PhYI+KtBgAcEqj9VdBIqjLTGJKo3BsipVzsWE6TsOEq0mABcz2AFapgAhYqGdliGhKoXUWAB6WJYc+E4HiK2MAFPz6gVroqBznNMZAJz4UwFiEABnXVdd2Xbd133heN5Xnel63oHwo3zfV935ft83gHxAYFgeCYLgxACjgGD4Xg+E3fgOBX9iV84jhWI4IKOI4phGN4Ri2EYxjWM45kePYfgd/ZJkWUY/kuQZJfmWZPi+UZXlWK5nmF9ZvneKj4H2f6DoGh6Fl2UY7hOiaVoWg5do2WZ/hmB5/iekGdoGD6VoGnZDn2A6ZrGg6pruaY9rGlkBoJAa3quoa/om06HuOuZriusbiPm8bOPm6bLhOo4FvOhanfG27tvO071wGt7Jl+PajwWl7fvvHaTvOlbXtW2X6H138huWBblwGDYhhHO6vxGpbv0mI9OZ2wdhoeY9D012cl2PU4LfHXXj0upYGH3ed73/dXt4Pj+R5PkXfHkeH8hXnoF6IAen6voev6XseolnuJW0wBoUA6FAf6IP+iH/oj+gI="
*!*				.HTMLPicture("word") = "gAAAABgYAEAgBEChSohIAC0KFEKEEKIEKgkNhQAAkZjkCgkejshkUjkklk0nlEplUrlRofQSADbMhEABwl8xmYAI0KaoPawANgYYwAeIDIIARE3mU0A08n1AoVEo1IBVDYrjo7NrFQoaoqoAK5+IYAXE3N1iAB2tCcfcwQFosswpsCns/fDVmlBobQm4GHVMi0KPwCDMceE3VAscJ3NQBCYAucFgWDwt1ADNVa6bgUtoAcxSxeWxuPyMfAGUjhwfkwGmdQ5kxa1AL/f+jyGByeEjhQzrwEJ1OOy2m20uC3SszpvE/A4m40+6TfLOOqmEZGBux93mkZbG/OMZ4T/6mSmudDjAgQ01YADDDOxxKAmOJx2m0aGdOgl4HXx/NkDcsK8aMnQzoNmCOQ4v88jUCI9blOYxzbv+57Cui4EBIU/gAO0jg1mBBCMjwYTHvGbgjsW20NQ4SD1hY9cWJhGAAFuD5zDuCAkMW+p/lA9Y7BNCDHoyOB+phDhMAeoYBIVJaOw0kQwPW2wuSK9j3DiID5Po+pgPWxMUQi4sAJrKrMM0bhkqGDQQoqEIZCKAArBEiocSqbE5gAeD1nRNKNIUBhZKGQoSIqKB7KGKkqkyE6KgxQIABuESjo2gVAKGCIQKPSwAHtTKOT4odNjwfqhn4fihgAAaBCrQgAHBKoSHxNU2TImFKAAe8+gohRaTwWE7Twb88VvXKhmJKoYVoFFZAAaEqhdRgABhZligATgeIrY6YVBPyBWwioIOc0wwWYUwFiEABnXVdd2Xbd133heN5Xnel63oHxjXzfV935ft83gHxAYFgeCYLgxAGNgGD4Xg+E3fgOGYjgWHXdiGJX7geKXbi2JYXjV2Ytf2RGNjOFY7hmP3XkOR4xieTZPhpnBbmWaZnm2amdlmSZdnGb59mWYYTmeO5nnWS6BmxAZvgegZPoRnEBmmo5tnei5Zo4W6VpGaYhpuO6fqee6hrV84nluEXVrOf6pqeCX1hGy5doet7UZ2A6ts23axqW+bnrOM7juO0Z9rW65vwOC53tGxbXr24YEH136HiXJ7NfOQ8jtOO8dfeIGNzPGdDheA8/dvG7X0fS3njmOh90F5dZiXX9h13a9t2/a3fHcdn8hXeoF34AeD4ffeL4HjeElnlJW01VIEA6FAf34P9+H/fj+gIA=="

*!*	.SelBackColor = 16777216
*!*	.SelForeColor = RGB(0,0,128)
**'Uncomment it if you are running Windows XP
** .BackColorHeader = 33554432
WITH .Chart
			*!*		.AllowCreateBar = .F.
			*!*		.NonworkingDaysColor = RGB(196,196,128)
			*!*		.NonworkingDaysPattern = 6
			*!*			*!*		.FirstVisibleDate = "Feb 24 2006"
			*!*		.BackColor = RGB(255,255,255)
			*!*		.DrawGridLines = 2
			*!*		WITH .Bars.Add("End")
			*!*			.Pattern = 2
			*!*			.Color = RGB(255,128,128)
			*!*		ENDWITH
	
	
			*!*		exYear         0  Indicates the year. Values: ..., 2001, 2002, 2003, ...
			*!*	    exHalfYear     1  A date between January 1st and June 31 indicates the first half of the year, and from July 1 to December 31, indicates the second half of the year. Values: 1 and 2
			*!*	    exQuarterYear  2  A date between January 1st and March 31 indicates the first quarter of the year, a date between April 1st and June 30 indicates the second quarter of the year, a date between July 1st and September 30 indicates the third quarter of the year, and if a date between October 1st and December 31 indicates the forth quarter of the year. Values: 1, 2, 3 and 4
			*!*	    exMonth       16  Indicates the month. Values: 1 ( January ), 2 ( February ), ..., and 12 ( December ). Use the MonthNames property to specify the name of the months.
			*!*	    exThirdMonth  17  The first ten days in a month indicates the first third of the month, the next 10 days indicates the second third of the month, and the last 10 days in the month indicates the last third of the month. Values: 1, 2 and 3.
			*!*	    exWeek        256  Indicates the week in the year. Values: 1,2,...,53. Use the WeekDays property to specify the name of the days in the week.
			*!*	    exDay         4096  Indicates the day of the date. Values: 1,2,..,31
			*!*	    exHour        65536  Indicates the hour.
			*!*	    exMinute      1048576  Indicates the minute.
			*!*	    exSecond      16777216  Indicates the second.

		.Label(0) = ""  &amp;&amp; exYear
		.Label(1) = ""  &amp;&amp; exHalfYear
		.Label(2) = ""  &amp;&amp; exQuarterYear
		.Label(16) = ""  &amp;&amp; exMonth
		.Label(17) = ""  &amp;&amp; exThirdMonth
*!*		.Label(256) = ""  &amp;&amp; exWeek
*!*		.Label(4096  ) = ""  &amp;&amp; exDay
*!*		.Label(65536  ) = ""  &amp;&amp; exHour
		.Label(1048576) = ""  &amp;&amp; exMinute
		.Label(16777216) = ""  &amp;&amp; exSecond
		*!*		.OverviewBackColor = RGB(255,255,255)
		*!*		.OverviewVisible = .T.
		*!*		.AllowOverviewZoom = 1
	***.OverviewZoomCaption = "Year|  ?Year|  ?Year|&lt;img&gt;3&lt;/img&gt;|Third|&lt;img&gt;2&lt;/img&gt;|&lt;img&gt;1&lt;/img&gt;|Hour|Min|Sec"
	*.OverviewZoomCaption =    "Year|1\2Year|1\4Year|&lt;img&gt;11&lt;/img&gt;|Third|&lt;img&gt;11&lt;/img&gt;|&lt;img&gt;10&lt;/img&gt;|&lt;img&gt;9&lt;/img&gt;|Min|Sec"
*!*		.OverviewZoomUnit = 24
ENDWITH
.EndUpdate
ENDWITH


ENDPROC
PROCEDURE BarResize
*** ActiveX Control Event ***
LPARAMETERS item, key
IF this.linload
RETURN .t.
ENDIF
IF !TYPE('key')= 'N'
		  thisform.CmdReload.Click()
RETURN .f.
ENDIF
LOCAL  lStart, lEnd, stringWk, lChange,lnResursId, lBarCnt,lresult ,llResult

with this.Items
SET DATABASE TO BASIS
_PARAM = key
USE IN SELECT('rv_JurnalUseEdit')
USE rv_JurnalUseEdit IN 0
*** - 19.03.2009 10:56:41 Ãëóõîâ Â.Þ. (C) - Ïðàâà ïðèíàäëåæàò
*** îáúåêò íå íàøëè
IF !RECCOUNT('rv_JurnalUseEdit')=1
=MESSAGEBOX('Îøèáî÷íûé êîä îáúåêòà. '+CHR(13)+'Ñîõðàíåíèå íå ïðîèçîøëî ...',0+16, 'Ïðîáëåìà')
		     USE IN SELECT('rv_JurnalUseEdit')
		  thisform.CmdReload.Click()
RETURN .f.
ENDIF
SELECT rv_ResursJrn
LOCATE FOR rv_ResursJrn.BarId = key
lChange = .f.
lStart = NVL(rv_JurnalUseEdit.UseStart ,{})
lEnd   = NVL(rv_JurnalUseEdit.UseEnd,{})
lnResursId = rv_ResursJrn.ResursID
*!*	    *** äîêóìåíò îïëà÷åí,íî äëèòåëüíîñòü òà æå, èëè àêöåïòîâàí
*!*	     IF rv_ResursJrn.FrmStatusI&gt;3 OR (rv_ResursJrn.FrmIsPayed AND (.ItemBar(item,key,2)-.ItemBar(item,key,1))&lt;&gt;(lEnd-lStart) )    &amp;&amp; òàê áûëî rv_ResursJrn.FrmStatusI&gt;2 OR rv_ResursJrn.FrmIsPayed
*** äîêóìåíò îïëà÷åí èëè àêöåïòîâàí
IF rv_ResursJrn.FrmStatusI&gt;3 OR rv_ResursJrn.FrmIsPayed    &amp;&amp; òàê áûëî rv_ResursJrn.FrmStatusI&gt;2 OR rv_ResursJrn.FrmIsPayed
=MESSAGEBOX('Äîêóìåíò àêöåïòîâàí èëè îïëà÷åí.'+CHR(13)+'Èçìåíÿòü íåëüçÿ.'+CHR(13)+'Îáðàòèòåñü ê àäìèíèñòðàòîðó.',0+32+4096, 'Íåäîïóñòèìîå äåéñòâèå ...',5000)
		  thisform.CmdReload.Click()
		  RETURN .f.
ELSE
	     lStart = .ItemBar(item,key,1)
	     lEnd   = .ItemBar(item,key,2)
	     IF VARTYPE(lStart)='C' OR VARTYPE(lEnd)='C'
		  thisform.CmdReload.Click()
	     	RETURN .f.
	     ENDIF
	    *** ïîìåíÿëè ñòàðò è îí â çàïðåòíîì ïåðèîäå ÈËÈ îêîí÷àíèå â çàïðåòíîì ïåðèîäå ÈËÈ íîâîå íà÷àëî â çàïðåòíîì ïåðèîäå
	     IF (thisform.tOgrDate &gt; rv_JurnalUseEdit.UseStart  AND rv_JurnalUseEdit.UseStart  &lt;&gt; lStart) OR  thisform.tOgrDate &gt; lEnd OR  (thisform.tOgrDate &gt; lStart AND rv_JurnalUseEdit.UseStart  &lt;&gt; lStart)
			MESSAGEBOX('Æåëàåìàÿ äàòà íàõîäèòñÿ â çàêðûòîì ïåðèîäå.',0+32,'Âíåñåíèå èçìåíåíèé çàïðåùåíî ...')
		thisform.CmdReload.Click()
			RETURN .f.
		 ENDIF
	     IF MESSAGEBOX('Èçìåíèòü ñðîêè ïðîæèâàíèÿ?',4+32+256,'Èçìåíåíèå äàííûõ î ïðîæèâàíèè ...')=6
			     lBarCnt = this._find(lnResursId,lStart,lEnd,Key)
					IF lBarCnt &gt;0
					  thisform.CmdReload.Click()
							RETURN .f.
					ENDIF
			     lChange = .t.
		     ELSE
		  thisform.CmdReload.Click()
		       RETURN .f.
	     ENDIF
ENDIF
					IF this.chart.UnitScale =&lt; 4096
						DO CASE
							CASE this.nTypeTime = 0 &amp;&amp; C 12 äî 12
								lStart = CTOT(DTOC(lStart )+ ' 12:00:00')
								lEnd   = CTOT(DTOC(lEnd   )  + ' 12:00:00')
							CASE this.nTypeTime = 1 &amp;&amp; C 14 äî 12
								lStart = CTOT(DTOC(lStart )+ ' 14:00:00')
								lEnd   = CTOT(DTOC(lEnd   )  + ' 12:00:00')
							CASE this.nTypeTime = 2 &amp;&amp; C òåêóùåãî ÷àñà äî òåêóùåãî ÷àñà
								lEnd   = CTOT(DTOC(lEnd   )  + ' '+TTOC(lStart ,2))
						ENDCASE
				    ENDIF
				    IF (lStart &lt;DATETIME() AND MESSAGEBOX('Íà÷àëî ïðîæèâàíèÿ â ïðîøåäøåì ïåðèîäå.'+CHR(13)+'Èçìåíèòü ñðîêè ïðîæèâàíèÿ?',4+32+256,'Èçìåíåíèå äàííûõ î ïðîæèâàíèè ...')=7)
				  thisform.CmdReload.Click()
				    	RETURN .f.
				    ENDIF
				    this.BeginUpdate()
				    stringWk = "Items.ItemBar("+ ALLTRIM(STR(item,16,0))+" , "+ ALLTRIM(STR(key,10,0))+" , 1) = `" + TTOC(lStart)+"`"
				    this.executeTemplate(stringWk)
				    stringWk = "Items.ItemBar("+ ALLTRIM(STR(item,16,0))+" , "+ ALLTRIM(STR(key,10,0))+" , 2) = `" + TTOC(lEnd)+"`"
				    this.executeTemplate(stringWk)
				    stringWk = "Items.ItemBar("+ ALLTRIM(STR(item,16,0))+" , "+ ALLTRIM(STR(key,10,0))+" , 6) = `" +  "Çàñåëåíèå:"+ TTOC(NVL(lStart,{}))+ ;
	    																			  "      Âûåçä:        "+ TTOC(NVL(lEnd,{}))+"`"    &amp;&amp; exBarToolTip
				    this.ExecuteTemplate(stringWk)
				    this.EndUpdate
IF !(rv_ResursJrn.FrmStatusI&gt;2 OR rv_ResursJrn.FrmIsPayed) AND lChange
REPLACE  UseStart WITH  lStart , ;
	 UseEnd   WITH  lEnd IN rv_JurnalUseEdit
		llResult = TABLEUPDATE(1,.T.,[rv_JurnalUseEdit])
			IF !llResult
	            =MESSAGEBOX('Îøèáêà ïðè ñîõðàíåíèè íà ñåðâåðå [rv_JurnalUseEdit]. '+CHR(13)+'Ñîõðàíåíèå íå ïðîèçîøëî ...',0+16+4096, 'Ïðîáëåìà',900)
		  thisform.CmdReload.Click()
			   RETURN .f.
			ENDIF		
		lresult = spDiscRecount(rv_ResursJrn.FrmId, rv_ResursJrn.PointIspCl,null,null)
	       REPLACE  UseStart WITH  lStart , ;
	 UseEnd   WITH  lEnd IN rv_ResursJrn
		IF MESSAGEBOX('Äîêóìåíò èçìåíåí. Ðàñïå÷àòàòü åãî?',4+32,'Ïîäãîòîâêà ê ïå÷àòè ...')=6
			this.lnbarid= key
			this._prndoc()
		ENDIF
	
ENDIF
endwith


ENDPROC
PROCEDURE barsprop
DODEFAULT()
With this.Chart.Bars
	.Item("Task").Height = 17 &amp;&amp;13
	.Item("Task").Pattern = 1 &amp;&amp;1
	.Item("Task").StartColor =  RGB(138,244,244)   &amp;&amp; - íåãàðàíòèðîâàííîå áðîíèðîâàíèå  -  îæèäàþùàÿ áðîíü
	.Item("Task").Color = RGB(138,244,244)
	.Item("Task").EndColor =  RGB(138,244,244)
	.Item("Task").StartShape = 17  &amp;&amp;61447  &amp;&amp; exShapeIconFrameLeft
	.Item("Task").EndShape = 8 &amp;&amp;61448  &amp;&amp; exShapeIconFrameRight

.Copy("Task", "preTask")   &amp;&amp; - íåãàðàíòèðîâàííîå áðîíèðîâàíèå  (æåëòûé)
		.Item("preTask").StartColor =  RGB(0,128,192)
		.Item("preTask").Color =       RGB(0,128,192)
		.Item("preTask").EndColor =    RGB(0,128,192)
.Copy("Task", "garTask")  &amp;&amp; - ãàðàíòèðîâàííîå áðîíèðîâàíèå (ðàçìåùåííàÿ) (òåìíî-ñèíèé)
		.Item("garTask").StartColor =  RGB(255,255,0)
		.Item("garTask").Color =       RGB(255,255,0)
		.Item("garTask").EndColor =    RGB(255,255,0)
.Copy("Task", "LiveTask")  &amp;&amp;  - ïðîæèâàíèå  (LiveTask) òåìíî-çåëåíûé
		.Item("LiveTask").StartColor =  RGB(0,255,64)
		.Item("LiveTask").Color = RGB(0,255,64)
		.Item("LiveTask").EndColor =  RGB(0,255,64)
.Copy("Task", "errTask")  &amp;&amp;  - ïðîæèâàíèå  (LiveTask) îðàíüæåâûé
		.Item("errTask").StartColor =  RGB(255,128,0)
		.Item("errTask").Color = RGB(255,128,0)
		.Item("errTask").EndColor =  RGB(255,128,0)

		.Item("Task").HistogramPattern = 32
		.Item("Task").HistogramColor = RGB(138,244,244)
		.Item("preTask").HistogramPattern = 32
		.Item("preTask").HistogramColor =       RGB(255,255,0)
		.Item("garTask").HistogramPattern = 32
		.Item("garTask").HistogramColor =       RGB(0,0,255)
		.Item("LiveTask").HistogramPattern = 1
		.Item("LiveTask").HistogramColor = RGB(0,255,0)
		.Item("errTask").HistogramPattern = 32
		.Item("errTask").HistogramColor = RGB(255,0,0)


	.Add('preTask%PRed')
	.Add('garTask%PRed')
	.Add('LiveTask%PRed')
	.Add('Task%PRed')
	.Add('errTask%PRed')
ENDWITH


ENDPROC
PROCEDURE Click
*** ActiveX Control Event ***
With this
	local h, c, hit, llResult
.lnitemid = .ItemFromPoint(-1, -1, c, hit)
If (.lnitemid  # 0)
.lnbarid = .Chart.BarFromPoint(-1, -1)
If Empty(NVL(.lnbarid,0))
RETURN .f.
EndIf
EndIf
ENDWITH

ENDPROC
PROCEDURE CreateBar
*** ActiveX Control Event ***
LPARAMETERS item, datestart, dateend
LOCAL lPartFrmId ,newBar,llResult
IF dateend-datestart&lt;150
RETURN
ENDIF
IF thisform.tOgrDate &gt; dateend OR thisform.tOgrDate &gt; datestart
	MESSAGEBOX('Æåëàåìàÿ äàòà íàõîäèòñÿ â çàêðûòîì ïåðèîäå.',0+32,'Âíåñåíèå èçìåíåíèé çàïðåùåíî ...')
	RETURN
ENDIF
*IF (HOUR(datestart)=14 AND HOUR(dateend)=12) OR MESSAGEBOX('Ïðèâîäèòü âðåìÿ çàñåëåíèÿ ê 14 ÷àñàì,'+CHR(13)+;
*			  ' à âðåìÿ ñäà÷è ê 12 ÷àñàì?',4+32+256,'Êîððåêòèðîâêà âðåìåíè çàåçäà-âûåçäà')=6
IF this.chart.UnitScale =&lt; 4096
	DO CASE
		CASE this.lCopy
		CASE this.nTypeTime = 0 &amp;&amp; C 12 äî 12
			datestart = CTOT(DTOC(datestart)+ ' 12:00:00')
			dateend   = CTOT(DTOC(dateend)  + ' 12:00:00')
		CASE this.nTypeTime = 1 &amp;&amp; C 14 äî 12
			datestart = CTOT(DTOC(datestart)+ ' 14:00:00')
			dateend   = CTOT(DTOC(dateend)  + ' 12:00:00')
		CASE this.nTypeTime = 2 &amp;&amp; C òåêóùåãî ÷àñà äî òåêóùåãî ÷àñà
			dateend   = CTOT(DTOC(dateend)  + ' '+TTOC(datestart,2))
	ENDCASE
ENDIF
*ENDIF
IF (datestart &lt;DATETIME() AND MESSAGEBOX('Íà÷àëî ïðîæèâàíèÿ â ïðîøåäøåì ïåðèîäå.'+CHR(13)+'Äîáàâëÿòü ïðîæèâàíèå?',4+32+256,'Èçìåíåíèå äàííûõ î ïðîæèâàíèè ...')=7)
	RETURN .f.
ENDIF

PUBLIC barCltName,nFrmStatusI,pPointIspCltID,dStart,dEnd,nitem
with this
	barCltName =''
	lPartFrmId = ._add(item, datestart, dateend)
	datestart = dStart
	dateend   = dEnd
	IF lPartFrmId &gt;0	
	    .BeginUpdate()
		with .Items
			.AddBar( nitem, this.namebar(nFrmStatusI,.f.), datestart, dateend,this.lnbarid, ALLTRIM(barCltName) )
		    stringWk = "Items.ItemBar("+ALLTRIM(STR(nitem,16,0))+" , "+ ALLTRIM(STR(lPartFrmId,10,0))+" , 6) = `" +  "Çàñåëåíèå:"+ TTOC(datestart)+ ;
		    																			  "      Âûåçä:        "+ TTOC(dateend)+"`"    &amp;&amp; exBarToolTip
		    This.ExecuteTemplate(stringWk)
	 	ENDWITH
	    .EndUpdate
		spDiscRecount(lPartFrmId ,pPointIspCltID,null,null)
		IF MESSAGEBOX('Äîêóìåíò äîáàâëåí. Äîïîëíèòü åãî?',4+32,'Âíåñåíèå äîïîëíèòåëüíîé èíôîðìàöèè ...')=6
			._edit()
		ENDIF
		IF MESSAGEBOX('Äîêóìåíò äîáàâëåí. Ðàñïå÷àòàòü åãî?',4+32,'Ïîäãîòîâêà ê ïå÷àòè ...')=6
			._prndoc()
		ENDIF
	ENDIF
ENDWITH
RELEASE barCltName,typeNewFrm,pPointIspCltID,dStart,dEnd

ENDPROC
PROCEDURE DblClick
*** ActiveX Control Event ***
LPARAMETERS shift, x, y

With this
	local h, c, hit, llResult,lTvrId
.lnitemid = .ItemFromPoint(-1, -1, c, hit)
If (.lnitemid  # 0)
.lnbarid = .Chart.BarFromPoint(-1, -1)
If Empty(NVL(.lnbarid,0))
*** Êëèêè íà ïàíåëè ñëåâà
				SELECT rv_ResursLst
				LOCATE ALL FOR BarId = .lnitemid
				lTvrId = rv_ResursLst.TvrId
				IF !FOUND()
		          				lTvrId = null
				ENDIF
		           IF !ISNULL(lTvrId) AND MESSAGEBOX('Ïðîøëà óáîðêà ýòîãî íîìåðà?',4+64,'Îòìå÷àåì óáîðêó íîìåðà ...')=6
						SET DATABASE TO Basis
						llResult = ClearNumber(lTvrId , DATETIME())
						IF llResult
							replace rv_ResursLst.clearnum WITH 0 NEXT 1 IN rv_ResursLst
							this.Items.CellValue(.lnitemid,0) = ALLTRIM(rv_ResursLst.TvrNm)
							WAIT WINDOW 'Îòìåòêà îá óáîðêå íîìåðà ñäåëàíà ...' TIMEOUT .7
						ENDIF
		           ENDIF
RETURN .f.
EndIf
EndIf
*** Êëèêè íà ïàíåëè ñïðàâà
ENDWITH
DODEFAULT()
ENDPROC
PROCEDURE histogramset
DODEFAULT()
this.Chart.HistogramHeight = 10  &amp;&amp;120


ENDPROC
PROCEDURE Init
WAIT WINDOW 'Ãîòîâèì øàõìàòêó ê ðàáîòå ...' NOWAIT
DODEFAULT()
LOCAL s
WITH this
	WITH .VisualAppearance
		*** Ïðîãðåññ-áàð
		s = 'gBFLBCJwBAEHhEJAEGg4BBIDg6AADACAxRDAMgBQKAAzQFAYaQNBgABhGYZYJACCIDEYeSzRNCsOw8GSEZAgOJ4eiWJIkDD'
		s = s+'KADQTAoYBKFoZJTgQYJOjCJULIRkSZ0CgmOY3UBHMjwSBEEigNIxToOU4jFimCROQwQRK1BDwbQSFCEUDnaagABiHQYRBQMa'
		s = s+'vfYlSr+fx/LLtF7Xdb5fD8Py+b5vY7TdTofR9XxfxLDaz4ep+HreR63WbNej1PI+LyPC7DZrhRp4MCdTBXLbdcTqPg8DovM5z'
		s = s+'TrudpzHrdNxXWapZDxOw4bx6S6TVrEeR0XAeJx2fbBZTdPC5DabSzjXLEazfGvBCyrXq+aZ3G6aJzWbZBbjaM7zbLuW'
		s = s+'zbFJoGwMZck0Zgrh2KpEHUdpdG0RgjiWJJCHMM5Xm4NoCm2RJPF0OJZkuFwbC0bphGSLRcAwdYbgWDIyDgDBSkWegrE2cwYiy'
		s = s+'AAKjMeJDCoTZjACJw3EuYoUlwLxKEMdI7CiTYSnSHw2EuMh4lgLoJlMYI4CaTYCliGQ1gsQhclcLIJGMWIxCUTRSkSEw1AsAh'
		s = s+'IlUK5InMUIuCMDQijCCg0gqIgclMKhIEMSIoCCTQCiCBQzkocgQk4KYIDMOIkB+TJigwfAzEoEZgkwKAHHMLIfB2DByG4YIY1'
		s = s+'OaB0DGSYBkiRgmAbGoWBtU5UGsMZJGGKJDCSJxiEwaQwgkIYgkIJBGFMCIQVWMg8GEMIImEfJBCMRZinCCwWGjEg9CKBYCniC'
		s = s+'QVmkYRcj8IZFR+BgVGmYRUj4IJFBqDBRC8SAhECPAgEScpsgAE4LiGfBNC4R5hDKNATAuMZ8EuLhEjKaB+BKC4RnQSQuAeQQg'
		s = s+'jcHpEHKWB6BGLIhBkZRCFYZYVGgWoPnWMRuFwFwll0dxeFeNZ1H8YBYDYFYHGIWI2EGEBkhkRhZhgZoZkYeYgGiGhGhmKBqhq'
		s = s+'Ro5jAbIbEaWY4G6G5HAWQRwlwVwdkkcsxkmUh1B0ZxhlodwdmeAJFHiHhHhmaB6h6R45nAfIfEeWZ4H6H5HnoAIAgweASAaAg'
		s = s+'gigMgOgQIQoFIFoGCGKByB6CAiCiEgmgoIoojILoMCMKJSDaDgjiicg+hAJApBIRoSCSKQyE6FAlCkUhWhYJYpHIXoYnUCYWG'
		s = s+'eGhmjmNhvhwZw5lYd4eGeOZ2H+IBoDoFoHiIaI6DaD4kGkOhWheJhpjodofigamsiiKoqkqOowiyKx6l6HkLwVxrAFEKGILA1giibDMNkdAGgBEBA'
		.Add(54,s)
	ENDWITH
.SingleSel = .F.
.BeginUpdate()
.Enabled = .f.
.DefaultItemHeight = 24
.Chart.AllowLinkBars =0
.Chart.PaneWidth(0) = 180
.Chart.AllowLinkBars= .T.
.Chart.ShowLinks= .T.

.BackColor= RGB(232,233,236)
*.Chart.BackColor = RGB(232,233,236)    &amp;&amp;205,211,216)
.Chart.SelBackColor = RGB(210,210,210)    &amp;&amp;205,211,216)
*!*			.Chart.BackColor = 16777215
*!*			.Chart.SelBackColor = 16119285

.Columns.Item(0).Width  = 180
*.Columns.Add("Ïðèìå÷àíèå").Width  = 20
.histogramset()
.EndUpdate()
.Enabled = .t.
ENDWITH
WAIT CLEAR

** ñîçäàòü áàð÷èêè:
*!*		   - íåãàðàíòèðîâàííîå áðîíèðîâàíèå  -  îæèäàþùàÿ áðîíü  (Task) 28
*!*		   - íåãàðàíòèðîâàííîå áðîíèðîâàíèå (ðàçìåùåííàÿ) (preTask)     29
*!*		   - ãàðàíòèðîâàííîå áðîíèðîâàíèå (ðàçìåùåííàÿ)    (garTask)   30 (èëè 22)
*!*		   - ïðîæèâàíèå  (LiveTask) (äîêóìåíò - ñ÷åò ãîñòÿ)             22

*!*		   - îáñëóæèâàíèå â íîìåðå
*!*		   - äîáàâëåíèå ÷åðåç ðåñóðñ "Ïîèñê ñâîáîäíîãî"
ENDPROC
PROCEDURE loaddata
*!*	thisform.LoadData1()
*!*	RETURN
LOCAL lcUniqueName,lcUniqueFilePath,dStartDate,dEndDate, lnCountRec , Lfirst
LOCAL ARRAY items(1,2)
LOCAL lnDefItem, lnDefParId, lnDefTvrId,lnDefResursId,lnBarId ,lnBarId, stringWk, nRecResursLst, nTvrParId
this.linload=.t.
* Çàãðóæàåì òàáëèöó ñ äàííûìè
lcUniqueName  = spGetProjectList(thisform.nFrmId,0,0)

* Òàáëèöà äëÿ äèàãðàììû
USE IN SELECT('rv_ResursLst')
USE (lcUniqueName) IN 0 ALIAS rv_ResursLst
SELECT rv_ResursLst
CALCULATE MIN(rv_ResursLst.UseStart) TO dStartDate
CALCULATE MAX(rv_ResursLst.UseEnd) TO dEndDate
SELECT rv_ResursLst
*BROWSE
lnCountRec  = RECCOUNT()
GO TOP
*SELECT DISTINCT FrmTypeID,FrmTypeNM,FrmTypeShortNM FROM rv_ResursLst INTO CURSOR tmpFrmType
this.Chart.FirstVisibleDate = dStartDate-1
SET DATE GERMAN
this.BeginUpdate()
Lfirst = .t.	
WITH this.Items
STORE -99999 TO lnFrmTypeId ,lnDefParId ,lnDefResursId ,lnBarId
SCAN
		   IF rv_ResursLst.FrmTypeId &lt;&gt; lnFrmTypeId
		   	IF lnFrmTypeId &lt;&gt; -99999
		   	.ExpandItem(lnDefParId) = .T.
		   	ENDIF
		   	lnDefParId  = .AddItem(ALLTRIM(rv_ResursLst.FrmTypeNM))
		   	*this.namebar(3,.F.)
		   	.AddBar(lnDefParId  , 'Project Summary',TTOC(dStartDate),TTOC(dEndDate))
		   	lnFrmTypeId = rv_ResursLst.FrmTypeId
		   ENDIF
		*   SET STEP ON
	       IF (lnFrmTypeId = 8 AND Lfirst) OR lnFrmTypeId &lt;&gt; 8
	        .DefaultItem = .InsertItem( lnDefParId , "", ALLTRIM(rv_ResursLst.TvrNm))
	        lnDefItem = .DefaultItem
		       IF lnFrmTypeId = 8
		       		Lfirst = .f.	
		       ENDIF
	       ENDIF
		   REPLACE ItemId WITH .DefaultItem NEXT 1 IN rv_ResursLst
		   .AddBar(.DefaultItem , this.namebar(rv_ResursLst.FrmTypeId,.F.) , TTOC(rv_ResursLst.UseStart),;
					TTOC(rv_ResursLst.UseEnd),rv_ResursLst.JrnUseId,STR(rv_ResursLst.TvrSumSale))
					*lnDefItem rv_ResursLst.JrnUseId
* IF lnFrmTypeId &lt;&gt; 8
*!*	    		cmd = 'LOCAL DefItem'+ALLTRIM(STR(RECNO(),10,0))
*!*	    		&amp;cmd
*!*	    		cmd = 'DefItem'+ALLTRIM(STR(RECNO(),10,0))+ '= lnDefItem '
*!*	    		&amp;cmd
*!*	    		cmd = '.DefineSummaryBars(lnDefParId ,"",DefItem'+ALLTRIM(STR(RECNO(),10,0))+',"")'
*!*	    		&amp;cmd
	*ENDIF
			.DefineSummaryBars(lnDefParId ,"",rv_ResursLst.JrnUseId,"") &amp;&amp; .DefaultItem
ENDSCAN
	IF lnFrmTypeId &lt;&gt; -99999
	.ExpandItem(lnDefParId) = .T.
	ENDIF
ENDWITH

RETURN


** Äîáàâëÿåì ðåñóðñû
SELECT rv_ResursLst
STORE -99999 TO lnDefTvrId ,lnDefParId ,lnDefResursId ,lnBarId
SCAN
	IF rv_ResursLst.Loaded = 0
REPLACE Loaded WITH 1 NEXT 1 IN rv_ResursLst
nRecResursLst = RECNO('rv_ResursLst')
nTvrParId = rv_ResursLst.TvrParId
GO TOP
LOCATE ALL FOR rv_ResursLst.TvrId = nTvrParId AND rv_ResursLst.BarId&lt;&gt;0
IF FOUND()
	   lnDefItem = rv_ResursLst.BarId
	   lnDefParId = NVL(rv_ResursLst.TvrParId,0)
	   GO nRecResursLst
ELSE
		GO nRecResursLst
	    IF !lnDefParId = NVL(rv_ResursLst.TvrParId,0)
		   .DefaultItem = .AddItem(ALLTRIM(rv_ResursLst.ParNM))
		   lnDefItem = .DefaultItem
		   lnDefParId = NVL(rv_ResursLst.TvrParId,0)
		ENDIF
	ENDIF
.DefaultItem = .InsertItem( lnDefItem , "" , "")  &amp;&amp;lText)
	* îòìå÷àåì íîìåðà, êîòîðûå íàäî ÷èñòèòü
IF thisForm.nTimeClearNum &gt;0
			IF rv_ResursLst.clearnum=1
				.CellValueFormat(.DefaultItem,0) = 1
			ENDIF
			.CellValue(.DefaultItem,0) = ALLTRIM(rv_ResursLst.TvrNm)+ IIF(rv_ResursLst.clearnum=1,' &lt;b&gt;&lt;fgcolor=FF0000&gt;&lt;bgcolor=00FF00&gt; óá &lt;/bgcolor&gt;&lt;/fgcolor&gt;&lt;/b&gt;','')
		ELSE
			.CellValue(.DefaultItem,0) = ALLTRIM(rv_ResursLst.TvrNm)
	ENDIF
.CellValue(.DefaultItem , 1) = ALLTRIM(rv_ResursLst.TvrNote)
lnBarId = .DefaultItem
	SELECT rv_ResursLst
	GO nRecResursLst
	REPLACE ItemId WITH lnDefItem ,BarId WITH lnBarId
	ENDIF
ENDSCAN
SELECT rv_ResursJrn
STORE -99999 TO lnDefTvrId ,lnDefParId ,lnDefResursId ,lnBarId

** Äîáàâëÿåì çàíÿòîñòü ðåñóðñà
SCAN
	SELECT rv_ResursLst
	LOCATE ALL FOR rv_ResursLst.TvrId = rv_ResursJrn.ResursID
	IF !FOUND()
	 SELECT rv_ResursJrn
LOOP
	ENDIF
SELECT rv_ResursJrn
	lnDefItem = rv_ResursLst.BarId  &amp;&amp; ñèñòåìíûé êîä ðåñóðñà
	lnBarId = rv_ResursJrn.JrnUseId
.AddBar(lnDefItem , this.namebar(rv_ResursJrn.FrmStatusI,rv_ResursJrn.FrmIsPayed) , TTOC(rv_ResursJrn.UseStart),;
					TTOC(rv_ResursJrn.UseEnd),rv_ResursJrn.JrnUseId, ;
					IIF(thisform.lOnlyTime = .f.,ALLTRIM(rv_ResursJrn.CltNM),'-'))
					
					
	** âàðèàíò ñ óêàçàíèåì âðåìåíè çàñåëåíèÿ-âûñåëåíèÿ " ñ:"+ SUBSTR(NVL(TTOC(rv_ResursJrn.UseStart),""),12)+ ;
																		 "... äî:"+ SUBSTR(NVL(TTOC(rv_ResursJrn.UseEnd),""),12)
**  1                                   2                                                  3                             4                     5                          6                          7                            8
	.DefaultItem = lnDefItem
stringWk = "Items.ItemBar("+ ALLTRIM(STR(lnDefItem ,10,0))+" , "+ ALLTRIM(STR(rv_ResursJrn.JrnUseId,10,0))+" , 12) =" + ALLTRIM(STR(this.prcworkdate(TTOD(rv_ResursJrn.UseStart),TTOD(rv_ResursJrn.UseEnd)),5,2))   &amp;&amp; exBarPercent
this.executeTemplate(stringWk)
*** Îïðåäåëÿåì ToolTip íà êàæäûé áàð
stringWk = "Items.ItemBar(0 , "+ ALLTRIM(STR(rv_ResursJrn.JrnUseId,10,0))+" , 6) = `" +  "Ñ÷åò ¹"+NVL(ALLTRIM(rv_ResursJrn.FrmNum),"á/í")+" îò "+ ;
																				 SUBSTR(TTOC(rv_ResursJrn.FrmDate),1,16)+ ;
																				 " Çàñåëåíèå:"+ NVL(TTOC(rv_ResursJrn.UseStart),"")+ ;
																				 "      Âûåçä:        "+ NVL(TTOC(rv_ResursJrn.UseEnd),"")+"`"    &amp;&amp; exBarToolTip
IF !ISNULL(stringWk)
	    ThisForm.G2ANTT1.ExecuteTemplate(stringWk)
ENDIF

	IF rv_ResursJrn.FrmIsPayed
			stringWk = "Items.ItemBar("+ ALLTRIM(STR(lnDefItem ,10,0))+" , "+ ALLTRIM(STR(rv_ResursJrn.JrnUseId,10,0))+" , 12) = `1`" &amp;&amp; exBarPercent
	    ELSE
			stringWk = "Items.ItemBar("+ ALLTRIM(STR(lnDefItem ,10,0))+" , "+ ALLTRIM(STR(rv_ResursJrn.JrnUseId,10,0))+" , 12) = `0`" &amp;&amp; exBarPercent
	ENDIF
ThisForm.G2ANTT1.ExecuteTemplate(stringWk)
*!*		IF rv_ResursJrn.FrmIsPayed
*!*				stringWk = "Items.ItemBar("+ ALLTRIM(STR(lnDefItem ,10,0))+" , "+ ALLTRIM(STR(rv_ResursJrn.JrnUseId,10,0))+" , 10) = `.f.`" &amp;&amp; íåëüçÿ äâèãàòü
*!*			    ThisForm.G2ANTT1.ExecuteTemplate(stringWk)
*!*				stringWk = "Items.ItemBar("+ ALLTRIM(STR(lnDefItem ,10,0))+" , "+ ALLTRIM(STR(rv_ResursJrn.JrnUseId,10,0))+" , 11) = `.f.`" &amp;&amp; íåëüçÿ ìåíÿòü
*!*			    ThisForm.G2ANTT1.ExecuteTemplate(stringWk)
*!*			   ELSE
*!*				stringWk = "Items.ItemBar("+ ALLTRIM(STR(lnDefItem ,10,0))+" , "+ ALLTRIM(STR(rv_ResursJrn.JrnUseId,10,0))+" , 22) = `"+TTOC(thisform.tOgrDate)+"`" &amp;&amp; íåëüçÿ ìåíÿòü
*!*			    ThisForm.G2ANTT1.ExecuteTemplate(stringWk)
*!*		ENDIF
	SELECT rv_ResursJrn
	REPLACE ItemId WITH lnDefItem ,BarId WITH lnBarId
ENDSCAN
*endwith
for each h in this.Items
	this.Items.DefaultItem = h
	this.Items.ExpandItem(0) = thisform.g2ANTT1.lExpandResu
next
this.EndUpdate()	
this.linload=.f.



ENDPROC
PROCEDURE MouseDown
*** ActiveX Control Event ***
LPARAMETERS button, shift, x, y

With this
	local h, c, hit, llResult
.lnitemidu = .ItemFromPoint(-1, -1, c, hit)
If (.lnitemidu # 0)
.lnbaridu = .Chart.BarFromPoint(-1, -1)
If Empty(NVL(.lnbaridu,0))
RETURN .f.
EndIf
EndIf
ENDWITH


DODEFAULT(button, shift, x, y)

ENDPROC
PROCEDURE MouseUp
*** ActiveX Control Event ***
LPARAMETERS button, shift, x, y
With this
	local h, c, hit, llResult ,nDefCltTmp
.lnitemid = .ItemFromPoint(-1, -1, c, hit)
If (.lnitemid # 0)
.lnbarid = .Chart.BarFromPoint(-1, -1)
*** thisform.wkStile.optCopy.Value=1 AND
		IF ISNULL(.lnbarid) AND !ISNULL(.lnbaridu) ;
			AND (.lnitemid&lt;&gt;.lnitemidu) ;
			AND MESSAGEBOX('Ñêîïèðîâàòü áðîíü?',4+0+32,'Êîïîâàíèå äîêóìåíòîâ') = 6
		     SELECT rv_ResursJrn
		     LOCATE FOR rv_ResursJrn.BarId = .lnbaridu
		     IF !FOUND()
		     	RETURN .f.
		     ENDIF
		     lStart = NVL(rv_ResursJrn.UseStart ,{})
		     lEnd   = NVL(rv_ResursJrn.UseEnd,{})
		    .lCopy=.t.
		    nDefCltTmo = thisform.nDefClt
		    thisform.nDefClt = rv_ResursJrn.PointIspCl
			.createBar(.lnitemid,lStart ,lEnd   )
		    thisform.nDefClt = nDefCltTmo
			.lCopy=.f.
		ENDIF
If Empty(NVL(.lnbarid,0))
RETURN .f.
EndIf
EndIf
ENDWITH


DODEFAULT(button, shift, x, y)

ENDPROC
PROCEDURE namebar
LPARAMETERS lnFrmTypeId,llFrmIsPayed
** StartDate, EndDate, ControlDate
cntPar =  PCOUNT()
IF cntPar &lt;2
llFrmIsPayed = .f.
ENDIF
LOCAL lcNameBar
	DO CASE
	   CASE lnFrmTypeId = 3	&amp;&amp; - ìàòåðèàëû
	       lcNameBar = 'Task'
	   CASE lnFrmTypeId = 15	&amp;&amp; - ðàáîòû
	       lcNameBar = 'preTask'
	   CASE lnFrmTypeId = 8	&amp;&amp; - äåíüãè
	       lcNameBar = 'garTask'
	       llFrmIsPayed = .t.

	   OTHERWISE
	       lcNameBar = 'Task'
*	       lcNameBar = 'LiveTask'
	         ** 'PRed'   &amp;&amp;
ENDCASE
*IF llFrmIsPayed
lcNameBar= lcNameBar + '%PRed'	&amp;&amp; - ïðîèçâåäåíà îïëàòà
*ENDIF
RETURN lcNameBar
ENDPROC
PROCEDURE OversizeChanged
*** ActiveX Control Event ***
LPARAMETERS horizontal, newval
DODEFAULT(horizontal, newval)
ENDPROC
PROCEDURE OverviewZoom
*** ActiveX Control Event ***
DODEFAULT()
RETURN
SELECT rv_ResursJrn
LOCATE ALL FOR rv_ResursJrn.JrnUseId = this.lnbarid
this.beginUpdate()
WITH This.Chart



	IF FOUND() AND !EMPTY(rv_ResursJrn.UseStart)
		.FirstVisibleDate = rv_ResursJrn.UseStart-60*60
		ELSE
		.FirstVisibleDate = DATE()-2
	ENDIF
*WAIT WINDOW this.Chart.UnitScale
**** 256 - íåäåëè, 4096 - äíè, 65536 - ÷àñû

DO CASE
	CASE .UnitScale = 256  &amp;&amp; exWeek
	    .Zoom(.NextDate(.FirstVisibleDate,4096,-5), .NextDate(.FirstVisibleDate, 4096,25), .t.) &amp;&amp; exWeek
	CASE .UnitScale = 4096  &amp;&amp; exDay
	    .Zoom(.NextDate(.FirstVisibleDate,4096,-2), .NextDate(.FirstVisibleDate, 4096,20), .t.) &amp;&amp; exWeek
	CASE .UnitScale = 65536  &amp;&amp; exHour
	.Zoom(.NextDate(.FirstVisibleDate,65536,-3), .NextDate(.FirstVisibleDate, 65536,12), .t.) &amp;&amp; exWeek
	OTHERWISE
	.Zoom(.NextDate(.FirstVisibleDate,4096,-2), .NextDate(.FirstVisibleDate, 4096,7), .t.) &amp;&amp; exWeek
ENDCASE
	.UnitWidth = .PaneWidth(1)/ this.nCountUnits  &amp;&amp;55 &amp;&amp;70
ENDWITH
DODEFAULT()
this.EndUpdate()
RETURN


ENDPROC
PROCEDURE timescale
DODEFAULT()
LOCAL s
WITH this
.BeginUpdate
.SingleSel = .F.
s = "gBJJgBAIDAAGAAEAAQhYAf8Pf4hh0QihCJo2AEZjQAjEZFEaIEaEEaAIAkcbk0olUrlktl0vmExmUzmk1m03nE5nU7nk9n0/oFBoVDolFo1HpFJpVLplNp1PqFRqVTq"
s=s+"lVq1XrFZrVbrldr1fsFhsVjslls1ntFptVrtltt1vuFxuVzul1u13vF5vV7vl9v1BAmBhOCwMKwuDw2ExWJxmIx2HyGLx+SyONyuTy2UzWZzmYz2X0Gbx1kUigUAAMwzG"
s=s+"eo1Ws1ZV2Go1IAL+1ACZMxm2+52W63Ov2Op1fC13F0un4nJ1vE2BV2XD2e/4vK4fL63V1bMTKZ5/d2pf3vh6Xj2ff3e63G683S5vF0mmAD4+Xx+bA+wAeP5/H6a/9+h8P2"
s=s+"eIAGZAiHHYZkDQQ7TuH/Ap4GUUzjPgiCJn+AD7GBAMNQJBD8wFDwAFlEUExJBaHQdCDixM+UARYABuxg/8ZQ5DUQRpEEbQKf8DxPBDiPe08KRdDEZHVIwANU1YRSWAALSdJ"
s=s+"snxpHcFO3HsrOI48Ky1IkKQpERZAA9sjHVC77ynEsqwbBE1RVNKHgAQ04yQ1skvDOJDRkZc9ABJYRT5Jk+z/P0pR49sgQHAsaUVApx0aAD+mvOclSZIkYG7MsMxNTUqyw+F"
s=s+"FwVRNQwRSwACFUwADvVNHv9IlNu5V02u5UjzVMIUQxHMYABzXdUVVRpxgBXM60DX9MQHTjWrJE0uzfGkXRdXNa0FYMjxBM8vxJM7iWXN8KSlbs31zWlT1Ja0eWxM9tNbbkL"
s=s+"UhY1mQtaU62hI9hyZUl0x5H6x3ZLVvwtekyWlYlHXNBF0R5dTszdC1vR1cELVJO9JABLODVvMF8x9deGS1fE3yJXYc4pgOKUDfGE31ZN+Srd13U/VdI1y9uCWBPRl2NE1sW"
s=s+"xbeWv9l2f6DSNSXdkTaNtd1WyrncR567mgaHGJLanMLY2laVc2FOjW1JpTuX2sV0YhmMtQpXLct1msZRBLmU421exYbN93XgAFixA9s61ztkzbc4u47LHmb6O8ExSPs0j6N"
s=s+"Otyv1hSy8BCm6bHs7eUDXMXb5DOLuJyG5v9CjzWLCkszrqZLS2+/NtbwEQdFN9sPbLPEYFU/Fxj1TV2U7WyahslSdM8O9SPGkieK+8iW33fe1JXNUjvqrnWlo1A2lUnieO+"
s=s+"/k1lGMs7RjDwvNiciedUtT6Nd3B+RlaxQJBmx8luULWLLPqxjZ769S/UQe1svPUi6M+D5DzN5a2athyHX9H6f43VIjE3yMTbqrlbB5l3OYgU+ssL7X+rtc+2Nj7AD5vwRkk"
s=s+"SCyAoFvvg6/FaiZIIuHbGv9DRxEuQeRjC2FkKH/pvRcs4+b+4MFgH+mmISDIhrHN0dqI5uIjRLGYbOJp2YnRRihAaIsQYiRXIdFVKsSImRKiegOKUYIpxZiwg2MsWokxpjF"
s=s+"Gs7UY4vxvNmWSKwAEHoRjrHRFMZkToMd3HqOcf4lRBN1IKLMg4vGzjnHeRUeY+yNj5GeIkhpJSFkpF+RKKZFoRj9I6PcZJKSElBIGUUR44ljkBJCT0gI1RclZIeN0YZLRal"
s=s+"RKqLsq5XRslhIiWUqY0S1l9HCV8YyyEWB8SuYpHiQEiJIAAkpKJmk4QoX8pJFE3zSKCQEA="
.Images(s)
s="gBJJgBAICAAGAAEAAQhYAf8Pf4hh0QihCJo2AEZjQAjEZFEaIEaEEaAIAkcbk0olUrlktl0vmExmUzmk1m03nE5nU7nk9n0/oFBoVDolFo1HpFJpVLplNp1PqFRqVTqlVq1XrF"
s=s+"ZrVbrldr1fsFhsVjslls1ntFptVrtltt1vuFxuVzul1u13vF5vV7vl9v1/wGBwWDwmFw2HxGJxWLxmNx2PyGRyWTymVy2XzGZzWbzmdz2f0Gh0WjwEWH0r08ekEikgAkso184iG"
s=s+"kicPjcU2+zjW43e6jO8jL+b79X8bfif48bfAffgP43IT8b4XE3O23vW3++2r/6vcjUB"
.Images(s)

**'Uncomment it if you are running Windows XP
** .BackColorHeader = 33554432
WITH .Chart
.LevelCount = 2
** Çäåñü ìû îòêðûâàåì èëè çàêðûâàåì èêîíêè Zoom
		.Label(0) = ""  &amp;&amp; exYear
		.Label(1) = ""  &amp;&amp; exHalfYear
		.Label(2) = ""  &amp;&amp; exQuarterYear
*		.Label(16) = ""  &amp;&amp; exMonth
		.Label(17) = ""  &amp;&amp; exThirdMonth
*		.Label(256) = ""  &amp;&amp; exWeek
*		.Label(4096  ) = ""  &amp;&amp; exDay
		.Label(65536  ) = ""  &amp;&amp; exHour
		.Label(1048576) = ""  &amp;&amp; exMinute
		.Label(16777216) = ""  &amp;&amp; exSecond
		.Level(1).DrawGridLines = .t.
*	.OverviewZoomCaption =    "Year|1\2Year|1\4Year|&lt;img&gt;11&lt;/img&gt;|Third|&lt;img&gt;11&lt;/img&gt;|&lt;img&gt;10&lt;/img&gt;|&lt;img&gt;9&lt;/img&gt;|Min|Sec"
*	.OverviewZoomCaption =    "Ãîä|Ïîëóãîäèå|Êâàðòàë|Ìåñÿö|Äåñÿòêà|Íåäåëÿ|Äåíü|×àñ|Ìèí|Ñåê"
	.OverviewZoomCaption =    "Year|1\2Year|1\4Year|&lt;img&gt;11&lt;/img&gt;||&lt;img&gt;10&lt;/img&gt;|&lt;img&gt;9&lt;/img&gt;||Min|Sec"
	.LabelToolTip(4096) = "&lt;%dd%&gt; &lt;%m3%&gt;"
	.LabelToolTip(65536) = "&lt;%hh%&gt;:&lt;%nn%&gt; &lt;%dd%&gt; &lt;%m3%&gt;"
	.UnitWidth = .PaneWidth(1)/this.nCountUnits &amp;&amp;55 &amp;&amp;70
	
	.NonworkingHours = 16253183 - 524288 - 1048576 -2097152 + 256


	*.NonworkingDays = 0
	.NonworkingHoursColor = RGB(197,96,90)
	*.ShowNonworkingUnits = .F.
*.DrawDateTicker = .t.
ENDWITH
.EndUpdate
ENDWITH


ENDPROC
</methods>
		<objcode/>
		<ole>0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7////+////BQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAP7//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMBxZjk9VssBAwAAAMAAAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAghQAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBAAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAQAAAAAAAAAAgAAAP7////+//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9BAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACQAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADUxMzk3OTE1AQAAgAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAABDAGwAYQBzADEfSM0lLVlHgD91LFaPU7dJTAEBAAAEAAQAEAAQAP////8hAP//////////Qk02AAAAAAAAADYAAAAoAAAAQABNH0jNJS1ZR4A/dSxWj1O3SUwBAQAABAAEABAAEAD/////IQD//////////0JNNgAAAAAAAAA2AAAAKAAAAEAAAAAQAAAAAQAgAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAGUAbAAgAEMAbABhAHMAcwAJAHsANgA1AEQANQA0ADAAQwAxAC0AOAA1ADkARQAtADQAOQBGADUALQBCADMANQBCAC0ANwAwADgAMgAxADgAMwAxAEYANwBBADcAfQAgAEMAOgBcAFcASQBOAEQATwBXAFMAXABzAHkAcwB0AGUAbQAzADIAXABiAHQAeABwAHAAYQBuAGUAbAAuAGQAbABsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE0fSM0lLVlHgD91LFaPU7dJTAEBAAAEAAQAEAAQAP////8hAP//////////Qk02AAAAAAAAADYAAAAoAAAAQAAAABAAAAABACAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEJNPgAAAAAAAAA+AAAAKAAAAEAAAAAQAAAAAQABAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAn28AAAM+AAAJAANS4wuRj84RneMAqgBLuFEBzAAAvALcfAEABUFyaWFsCwD//wsA//8DAAAAAAATAOvr6wATAAgAAIATAAUAAIATAAgAAIALAP//AwAAAAAAAwADAAAAAwASAAAAAwD/////AwAAAAAACwD//wsA//8DAAAAAAALAAAAAwD/////AwD/////AwAAAAAAAwD/////AwAWAAAAAwAAAAAACwAAAAMAAAAAAAsA//8TAA4AAIATAA0AAIADAAAAAAADAAIAAAALAAAACwAAAAsA//8JAAAAAAAAAAAAAAAAAAAAAAADADAAAAADAAAAAAATADFl/wATAA8AAIATAAgAAIADAP////8TAA8AAIATAAgAAIAJAANS4wuRj84RneMAqgBLuFEBzAAAvAJEQgEABUFyaWFsEwAAAAAACwAAAAgABgAAAA0ACgAAAAsA//8DABIAAAALAP//CABkAAAAYQBiAGMAZABlAGYAZwBoAGkAagBrAGwAbQBuAG8AcABxAHIAcwB0AHUAdgB3AHgAeQB6AEwEOQQyBDQEMAQ1BDcEOgQ7BDgEPwQ+BDwERARGBEIESwRJBDEEPQRDBEoEQQQAAAgAZAAAAEEAQgBDAEQARQBGAEcASABJAEoASwBMAE0ATgBPAFAAUQBSAFMAVABVAFYAVwBYAFkAWgAsBBkEEgQUBBAEFQQXBBoEGwQYBB8EHgQcBCQEJgQiBCsEKQQRBB0EIwQqBCEEAAALAP//CAACAAAAAAADAPQBAAADAIgTAAADAMQAAAADAAMAAAATABAAAIALAAAABQAAAAAAAADgPwsAAAALAP//EwAPAACACQAAAAAAAAAAAAAAAAAAAAAAAwAwAAAACwD//wMAAAAAAAsAAAAIAAIAAAAAABMAEAAAgBMAEAAAgBMADwAAgAMAEgAAAAMAoP///wsA//8DAAAAAAALAAAAAwAozpd8AwAAAAAACwD//wsAAAALAAAAEwAxZf8AAwAAAAAACwAAAAMAAAAAAAgAAgAAAAAAAwD/////AwD/////AwD/////AwD/////CwAAAAkAA1LjC5GPzhGd4wCqAEu4UQEAAACQAZBfAQAFQXJpYWwLAP//AwD///8AAwAAAAAACwD//w==</ole>
		<ole2>OLEObject = C:\Windows\system32\ExG2antt.dll
</ole2>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1026001568</timestamp>
		<class>commandbutton</class>
		<classloc/>
		<baseclass>commandbutton</baseclass>
		<objname>cmdReload</objname>
		<parent>frmresuprom</parent>
		<properties>Top = 603
Left = 250
Height = 25
Width = 100
Caption = "Îáíîâèò äàííûå"
ZOrderSet = 4
Name = "cmdReload"
</properties>
		<protected/>
		<methods>PROCEDURE Click
thisform.lOnlyTime = .f.
IF MESSAGEBOX('Ïîêàçûâàòü òîëüêî âðåìÿ çàñåëåíèÿ áåç èìåí ãîñòåé?',4+64,'Âûáåðèòå, ÷òî ïîêàçûâàòü î çàñåëåíèè')=6
	thisform.lOnlyTime = .t.
ENDIF
with thisform.G2antt1
	.BeginUpdate
	.Items.RemoveAllItems()
	.LoadData()
	with .Items
	for each h in thisform.G2antt1.Items
		.DefaultItem = h
		.ExpandItem(0) = thisform.g2ANTT1.lExpandResu
	next
	endwith
	.EndUpdate
endwith

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25L0SGZE5</uniqueid>
		<timestamp>1026001568</timestamp>
		<class>commandbutton</class>
		<classloc/>
		<baseclass>commandbutton</baseclass>
		<objname>cmdToday</objname>
		<parent>frmresuprom</parent>
		<properties>Top = 603
Left = 352
Height = 25
Width = 78
FontBold = .T.
FontSize = 10
Caption = "Ñåãîäíÿ"
ZOrderSet = 5
Name = "cmdToday"
</properties>
		<protected/>
		<methods>PROCEDURE Click
with thisform.G2antt1
	.BeginUpdate
WITH .Chart
		IF .UnitScale =&lt; 4096
				.FirstVisibleDate = DATE()-2
			ELSE
				.FirstVisibleDate = DATETIME()-4*60*60
		ENDIF
ENDWITH
	.EndUpdate
endwith

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1026649732</timestamp>
		<class>shape</class>
		<classloc/>
		<baseclass>shape</baseclass>
		<objname>Shape1</objname>
		<parent>frmresuprom</parent>
		<properties>Top = 601
Left = 433
Height = 13
Width = 85
BackColor = 138,244,244
ZOrderSet = 6
Name = "Shape1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1026649732</timestamp>
		<class>shape</class>
		<classloc/>
		<baseclass>shape</baseclass>
		<objname>Shape2</objname>
		<parent>frmresuprom</parent>
		<properties>Top = 619
Left = 433
Height = 13
Width = 85
BackColor = 0,128,192
ZOrderSet = 7
Name = "Shape2"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0OUJQ9</uniqueid>
		<timestamp>1026649732</timestamp>
		<class>shape</class>
		<classloc/>
		<baseclass>shape</baseclass>
		<objname>Shape4</objname>
		<parent>frmresuprom</parent>
		<properties>Top = 601
Left = 791
Height = 13
Width = 85
BackColor = 255,255,0
ZOrderSet = 8
Name = "Shape4"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25X0QUXS4</uniqueid>
		<timestamp>1026649732</timestamp>
		<class>label</class>
		<classloc/>
		<baseclass>label</baseclass>
		<objname>Label2</objname>
		<parent>frmresuprom</parent>
		<properties>AutoSize = .T.
FontSize = 8
Caption = "- èòîãè"
Height = 16
Left = 522
Top = 601
Width = 37
ZOrderSet = 9
Name = "Label2"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25X0QUXS5</uniqueid>
		<timestamp>1026649732</timestamp>
		<class>label</class>
		<classloc/>
		<baseclass>label</baseclass>
		<objname>Label3</objname>
		<parent>frmresuprom</parent>
		<properties>AutoSize = .T.
FontSize = 8
Caption = "- ðàáîòû è ìàòåðèàëû"
Height = 16
Left = 522
Top = 618
Width = 117
ZOrderSet = 10
Name = "Label3"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1026649732</timestamp>
		<class>label</class>
		<classloc/>
		<baseclass>label</baseclass>
		<objname>Label4</objname>
		<parent>frmresuprom</parent>
		<properties>AutoSize = .T.
FontSize = 8
Caption = "- äåíåæíûå ñðåäñòâà"
Height = 16
Left = 880
Top = 601
Width = 113
ZOrderSet = 11
Name = "Label4"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2DL11LO1J</uniqueid>
		<timestamp>1026649732</timestamp>
		<class>label</class>
		<classloc/>
		<baseclass>label</baseclass>
		<objname>Label1</objname>
		<parent>frmresuprom</parent>
		<properties>AutoSize = .T.
FontSize = 8
Caption = "- îïëàòà ïðèíÿòà"
Height = 16
Left = 880
Top = 618
Width = 90
ZOrderSet = 12
Name = "Label1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2LT0Y9P5S</uniqueid>
		<timestamp>1026649732</timestamp>
		<class>olecontrol</class>
		<classloc/>
		<baseclass>olecontrol</baseclass>
		<objname>PrintGantt</objname>
		<parent>frmresuprom</parent>
		<properties>Top = 600
Left = 1044
Height = 13
Width = 25
ZOrderSet = 13
Name = "PrintGantt"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole>0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7////+/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHCQajk9VssBAwAAAAACAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgEAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAA4AAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAGIAAAAAAAAAAwAAAP7///8GAAAABAAAAAUAAAAHAAAA/v////7///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8rDetNvW4iSpg1SKuc3ICIAAgAALkDAAC5AwAACAAeAAAAHQQ+BDwENQRABD0EPgQ5BCAARAQ+BD0ENAQgAAAAOAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAIAIAAAAQ2FwdGlvbgAXAAAASAAAAAAOAAAAze7s5fDt7ukg9O7t5CAQAAAAUGFnZU9yaWVudGF0aW9uAAkLAP//AwABAAAAAwACAAAAAwAAAAAAAwABAAAAAwACAAAACQADUuMLkY/OEZ3jAKoAS7hRAQEAAJABoIYBAA9UaW1lcyBOZXcgUm9tYW4LAP//CABIAAAALQAxACwAMQAwADAALAAxADAAMQAsADEAMAAyACwALQAxACwAMQAwADMALAAtADEALAAxADAANAAsAC0AMQAsADEAMAA1AAAACAACAAAAAAAIABIAAAA8ACUAcABhAGcAZQAlAD4AAAAAAABJCgAAAAIAAAAJAAAAQXNTY3JlZW4ABQAAAEwBAAAAcgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwABAAAACwD//0IAAAAMALhcFwC4jhQA/////wEAEABgYRcAH8wCAAAAAADAAAAAAAAARi0ANQAGAEgAAAEMAA==</ole>
		<ole2>OLEObject = C:\Windows\system32\ExPrint.dll
</ole2>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2LT0Y9P5W</uniqueid>
		<timestamp>1026123630</timestamp>
		<class>commandbutton</class>
		<classloc/>
		<baseclass>commandbutton</baseclass>
		<objname>Command1</objname>
		<parent>frmresuprom</parent>
		<properties>Top = 603
Left = 3
Height = 25
Width = 73
Caption = "Íà ïå÷àòü"
ZOrderSet = 14
Name = "Command1"
</properties>
		<protected/>
		<methods>PROCEDURE Click
with thisform.PrintGantt
	** thisform.g2ANTT1.Chart.EndPrintDate
	thisform.g2ANTT1.Chart.StartPrintDate = thisform.g2ANTT1.Chart.FirstVisibleDate
	thisform.g2ANTT1.Chart.EndPrintDate   = thisform.g2ANTT1.Chart.FirstVisibleDate + 100*24*60*60

	**thisform.g2ANTT1.Chart.FirstVisibleDate
	.Caption = 'Ðàáîòû è îïëàòû ïî ñîñòîÿíèþ íà '+ TTOC(DATETIME())+ '. C '+TTOC(thisform.g2ANTT1.Chart.StartPrintDate)+' ïî '+TTOC(thisform.g2ANTT1.Chart.EndPrintDate)
	.PrintExt = thisform.G2antt1.Object
	.Preview
endwith
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2MN0O16AU</uniqueid>
		<timestamp>1026649732</timestamp>
		<class>shape</class>
		<classloc/>
		<baseclass>shape</baseclass>
		<objname>Shape6</objname>
		<parent>frmresuprom</parent>
		<properties>Top = 619
Left = 794
Height = 13
Width = 42
BackColor = 0,128,192
ZOrderSet = 15
Name = "Shape6"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2MN0O16AV</uniqueid>
		<timestamp>1026649732</timestamp>
		<class>shape</class>
		<classloc/>
		<baseclass>shape</baseclass>
		<objname>Shape7</objname>
		<parent>frmresuprom</parent>
		<properties>Top = 619
Left = 830
Height = 13
Width = 43
BackColor = 255,255,0
ZOrderSet = 16
Name = "Shape7"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2DL11LO1L</uniqueid>
		<timestamp>1026649732</timestamp>
		<class>shape</class>
		<classloc/>
		<baseclass>shape</baseclass>
		<objname>Shape3</objname>
		<parent>frmresuprom</parent>
		<properties>Top = 624
Left = 791
Height = 3
Width = 85
BorderStyle = 0
BackColor = 255,0,0
ZOrderSet = 17
Name = "Shape3"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>frmresuprom</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
Arial, 1, 10, 6, 16, 13, 34, 3, 0
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25I136UUP</uniqueid>
		<timestamp>1031316584</timestamp>
		<class>frmview</class>
		<classloc>baseform_v1.vcx</classloc>
		<baseclass>form</baseclass>
		<objname>frmresfin</objname>
		<parent/>
		<properties>Top = 0
Left = 0
Height = 634
Width = 1082
DoCreate = .T.
Caption = "Ôèíàíñîâûé ïëàí-ãðàôèê âûïîëíåíèÿ äîãîâîðà"
HalfHeightCaption = .T.
WindowState = 2
resuparent = 0
ndefclt = 0
ntimeclearnum = 0
nwkdays = 0
nfrmid = 0
czoom = dd
_memberdata =      529&lt;VFPData&gt;&lt;memberdata name="ndefclt" type="property" display="nDefClt"/&gt;&lt;memberdata name="lonlytime" type="property" display="lOnlyTime"/&gt;&lt;memberdata name="ntimeclearnum" type="property" display="nTimeClearNum"/&gt;&lt;memberdata name="nwkdays" type="property" display="nWkdays"/&gt;&lt;memberdata name="nfrmid" type="property" display="nFrmId"/&gt;&lt;memberdata name="loaddata1" type="method" display="LoadData1"/&gt;&lt;memberdata name="czoom" type="property" display="cZoom"/&gt;&lt;memberdata name="reloader" type="method" display="ReLoader"/&gt;&lt;/VFPData&gt;

nscrfrmid = 0
Name = "frmresfin"
cstmsghandler.Name = "cstmsghandler"
cstresizable.Name = "cstresizable"
Img1.ZOrderSet = 2
Img1.Name = "Img1"
</properties>
		<protected/>
		<methods>PROCEDURE Activate
DODEFAULT()
_VFP.AutoYield = .f.
ENDPROC
PROCEDURE Deactivate
DODEFAULT()
_VFP.AutoYield = .t.
ENDPROC
PROCEDURE Destroy
DODEFAULT()
_VFP.AutoYield = .t.
pnScrFrmID = null
RELEASE pnScrFrmID

ENDPROC
PROCEDURE Init
LPARAMETERS	nFrmId
IF PCOUNT()&lt;1
	nFrmId = -1
ENDIF

*05.05.2004 01:57 -&gt;Ìîäèôèöèðóåì èìÿ ôîðìû ñ ó÷åòîì åå èäåíòèôèêàòîðà
This.Name = This.Name + [_GANT] &amp;&amp; + ALLTRIM(STR(tnScrFrmID))
*------------------------------------------------------------------------------

*04.05.2004 23:30 -&gt;Âûïîëíèì ìåòîä ðîäèòåëüñêîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------

WITH This
*04.05.2004 23:16 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
PRIVATE	_PARAM	
*------------------------------------------------------------------------------
.nFrmId = nFrmId
*.nFrmId = 67573
*04.05.2004 23:13 -&gt;Ñîõðàíèì èäåíòèôèêàòîð ôîðìû â ñâîéñòâå ôîðìû

*******************************************************************************
*Ïîëó÷èì èíôîðìàöèþ î äîêóìåíòàõ, îòîáðàæàåìûõ íà äàííîé ôîðìå.
*******************************************************************************


.g2ANTT1.nTypeTime = VAL(oRes.GetParam([SET],[TYPETIME],0))

.g2ANTT1.lExpandResu = (VAL(oRes.GetParam([SET],[EXPANDRESU],1))=1)
.g2ANTT1.loaddata()
ENDWITH

************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE loaddata1
with thisform.G2antt1
	.BeginUpdate
	.MarkSearchColumn = .F.
	.ShowFocusRect = .F.
	.Columns.Add("Tasks")
	with .Columns.Add("C")
		.HeaderAlignment = 1
		.Def(0) = .T.
		.PartialCheck = .T.
		.AllowSizing = .F.
		.Width = 18
	endwith
	with .Chart
		.PaneWidth(0) = 96
		.AllowCreateBar = 1
		.FirstVisibleDate = {^2005-6-20}
		.DrawLevelSeparator = .F.
		.LevelCount = 3
		.Level(1).DrawGridLines = .F.
		.AllowInsideZoom = .T.
		.DrawDateTicker = .T.
		.DateTickerLabel = "&lt;%mmm%&gt; &lt;%d%&gt;&lt;br&gt;&lt;b&gt;&lt;%hh%&gt;:&lt;%nn%&gt;&lt;/b&gt;"
		.MarkSelectDateColor = 0x7ffff8ee
		with .DefaultInsideZoomFormat
			.OwnerLabel = "&lt;%mmm%&gt; &lt;%d%&gt;"
			.BackColor = RGB(238,248,255)
			.BackColorChart = .BackColor
			.InsideCount = 4
			.InsideLabel = "&lt;b&gt;&lt;%hh%&gt;&lt;/b&gt;"
		endwith
		.InsideZooms.Add({^2005-6-22})
		.DrawGridLines = 2
	endwith
	with .Items
		h = .AddItem("Project 1")
		.AddBar(h,"Summary",{^2005-6-21},{^2005-7-1})
		h1 = .InsertItem(h,0,"Task 1")
		.AddBar(h1,"Task",{^2005-6-21},{^2005-6-28})
		.CellMerge(h1,0) = 1
		.DefineSummaryBars(h,"",h1,"")
		h1 = .InsertItem(h,0,"Task 2")
		.AddBar(h1,"Task",{^2005-6-23},{^2005-7-1},"E")
		.CellMerge(h1,0) = 1
		.DefineSummaryBars(h,"",h1,"E")
		.ItemBar(h1,"E",21) = 5
		h1 = .InsertItem(h,0,"Task 3")
		.AddBar(h1,"Task",{^2005-6-25},{^2005-6-27},"E")
		.CellMerge(h1,0) = 1
		.DefineSummaryBars(h,"",h1,"E")
		.ExpandItem(h) = .T.
		.CellState(h,1) = 1
		h = .AddItem("Project 2")
		.AddBar(h,"Summary",{^2005-6-26},{^2005-7-6})
		h1 = .InsertItem(h,0,"Task 1")
		.AddBar(h1,"Task",{^2005-6-26},{^2005-7-2})
		.CellMerge(h1,0) = 1
		.DefineSummaryBars(h,"",h1,"")
		h1 = .InsertItem(h,0,"Task 2")
		.AddBar(h1,"Task",{^2005-6-28},{^2005-7-6},"E")
		.CellMerge(h1,0) = 1
		.DefineSummaryBars(h,"",h1,"E")
		.ItemBar(h1,"E",21) = 5
		h1 = .InsertItem(h,0,"Task 3")
		.AddBar(h1,"Task",{^2005-6-30},{^2005-7-2},"E")
		.CellMerge(h1,0) = 1
		.DefineSummaryBars(h,"",h1,"E")
		.ExpandItem(h) = .T.
		.CellState(h,1) = 1
	endwith
	.EndUpdate
endwith

ENDPROC
PROCEDURE reloader
with thisform.G2antt1
	.BeginUpdate
	.Items.RemoveAllItems()
	.LoadData()
	with .Items
	for each h in thisform.G2antt1.Items
		.DefaultItem = h
		.ExpandItem(0) = .t.
	next
	endwith
	.EndUpdate
endwith

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>16</reserved2>
		<reserved3>resuparent Ðîäèòåëü ðåñóðñîâ ïî äåðåâó òîâàðîâ
ndefclt êëèåíò ïî-óìîë÷àíèþ
lonlytime Ïîêàçûâàòü íà áàðàõ òîëüêî âðåìÿ èëè åùå èíô î êëèåíòå
ntimeclearnum Âðåìÿ â ÷àñàõ ìåæäó óáîðêàìè íîìåðîâ
nwkdays êîëè÷åñòâî äíåé äëÿ çàãðóçêè ñ òåêóùåé äàòû
nfrmid Id ôîðìû äëÿ ïëàíà
czoom Ìàñøòàá âûáîðêè äàííûõ
*addxml äîáàâëÿåì äîï íàñòðîéêè
*loaddata1 
*reloader Ïåðåãðóçêà äàííûõ 
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7>Ïðîñìîòð Ôèíàíñîâ ÷åðåç Ãàííòà äëÿ ïðîì. ïðîåêòîâ</reserved7>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1031316584</timestamp>
		<class>g2antt</class>
		<classloc>gannt.vcx</classloc>
		<baseclass>olecontrol</baseclass>
		<objname>G2ANTT1</objname>
		<parent>frmresfin</parent>
		<properties>Top = 0
Left = 1
Height = 600
Width = 1080
ZOrderSet = 3
dbtablename = Basis!rv_ResursJrn
_handledcustommsglist = 
_handledcustommsgpromptlist = 
cname0 = Ðàáîòû, ñîáûòèÿ
ncountunits = 24
cbarfont = Aryal CYR:10:0
citemfont = Aryal CYR:10:1
cpoditemfont = Aryal CYR:8:0
ccolumnfont = Aryal CYR:11:1
Name = "G2ANTT1"
</properties>
		<protected/>
		<methods>PROCEDURE _add
LPARAMETERS item, datestart, dateend
LOCAL lPartFrmId ,lPartFrmId1 ,tnTvrID,lnMsuID,lnPrice ,_PARAM1,_PARAM2,llResult,lnQnt,lRetValPut, lFreeChoise
nitem = item
WITH this
.Enabled = .F.

		PUBLIC nMakerOuId,nDefClt1,nIspCltID,nTvrId,cRezult
		nDefClt1 = thisform.nDefClt

		SELECT rv_ResursLst
		LOCATE ALL FOR BarId = nitem
		nTvrId = rv_ResursLst.TvrId
		lFreeChoise = !FOUND()
		IF lFreeChoise
				GO top
				LOCATE ALL FOR ItemId = nitem
		ENDIF
		nMakerOuId = rv_ResursLst.MakerOuId
		*** - 29.09.2009 17:45:17 Ãëóõîâ Â.Þ. (C) - &gt;
		** îïðåäåëÿåì åñòü ëè çàåçäû ïî ïóòåâêàì äëÿ ýòîãî òîâàðà-ðåñóðñà
		_PARAM = rv_ResursLst.ServID
		USE BASIS!lvmatrixhotel IN 0 ALIAS matrixhotel
		USE IN SELECT('lvmatrixhotel')
		SELECT * FROM matrixhotel INTO TABLE tmp\lvmatrixhotel
		USE IN SELECT('matrixhotel')
		IF RECCOUNT('lvmatrixhotel')&gt;0
			USE IN SELECT('lvmatrixhotel')
			PUBLIC lRetValm[1,2]
			lRetValPut = oApp.DoModalFormRetValObj([frmhotelput;primarydoc_v1.vcx;primarydoc.app]) &amp;&amp;,rv_ResursLst.ServID)
			IF lRetValPut
				lnPrice = lRetValm[1,2]
				lnQnt   = lRetValm[1,1]
	  	 		 lnQnt   = IIF(TYPE('datestart')='T',lnQnt*24*60*60, lnQnt  )
	      		 dateend   = datestart+   lnQnt
			ENDIF
	        RELEASE lRetValm
		ENDIF
		USE IN SELECT('lvmatrixhotel')
		ERASE tmp\lvmatrixhotel.dbf
		
		IF lFreeChoise
				SELECT rv_ResursLst
				LOCATE ALL FOR ItemId = nitem
				IF !FOUND()
			        RELEASE nMakerOuId,nDefClt1,lRetValm,nTvrId,cRezult
					RETURN 0
				ENDIF
				cRezult = spFreeRec(rv_ResursLst.TvrParId,datestart+1,dateend-1 )
				* ñîçäàåì ñïèñîê ðåñóðñîâ, êîòîðûå äîñòóïíû â ýòîò ïåðèîä
				IF EMPTY(cRezult)
					RETURN 0
				ENDIF
			ELSE
				lBarCnt = ._find(rv_ResursLst.TvrId,datestart, dateend,0)
				IF lBarCnt &gt;0
					RETURN 0
				ENDIF
		ENDIF

	    dStart = datestart
	    dEnd   = dateend
luResAdding = oMgrPD.Operate([FORM],[ADDSCHET],ThisForm.nScrFrmID,datestart, dateend )  &amp;&amp; DATETIME(), DATETIME())
IF !EMPTY(cRezult)
				SELECT rv_ResursLst
				GO TOP
				LOCATE ALL FOR TvrId = nTvrId
				nitem = rv_ResursLst.BarId
				nMakerOuId = rv_ResursLst.MakerOuId
				cRezult = 'TMP\'+cRezult +'.dbf'
				ERASE (cRezult)
ENDIF
datestart = dStart
dateend   = dEnd
RELEASE nMakerOuId,nDefClt1,lRetValm,nTvrId,cRezult
.Enabled = .T.
SET DATABASE TO BASIS
IF TYPE('luResAdding')='L'
RETURN 0
ENDIF
		lPartFrmId1  = luResAdding

		SELECT rv_ResursLst
		SCATTER MEMVAR
		** ñ÷èòàåì âðåìÿ â ìèíóòàõ
		nTime = (dateend - datestart)
		*** - 14.03.2009 11:46:58 Ãëóõîâ Â.Þ. (C) - Ïðàâà ïðèíàäëåæàò
		IF TYPE('datestart')='T'
		   nTime = nTime /60 /60  &amp;&amp; ïðèâåëè ê ÷àñàì
**		   nTime = nTime /60 /60/24  &amp;&amp; ïðèâåëè ê ñóòêàì
		  ELSE
		   nTime  = nTime * 24  &amp;&amp; ïðèâåëè ê ÷àñàì
**		   nTime  = nTime   &amp;&amp; ïðèâåëè ê ñóòêàì
		ENDIF
		** îïðåäåëÿåì êîä óñëóãè è öåíó
		_PARAM1 = m.ServID &amp;&amp;22023 &amp;&amp;tnTvrID
		_PARAM2 = 1
		***
		USE IN SELECT([lvPriceTvr])
		USE lvPriceTvr IN 0
IF lRetValPut
	nTime  = 1
	ELSE
	lnPrice = lvPriceTvr.Price
		ENDIF
		USE lvOrderTvrEdit IN 0 NODATA
		APPEND BLANK IN lvOrderTvrEdit
		REPLACE ;
			FrmID WITH luResAdding  , ;
			TvrId WITH m.ServID, ; &amp;&amp; (ïðîæèâàíèå â íîìåðå)
			TvrIDCalc WITH m.TvrId, ; &amp;&amp;(êîä ðåñóðñà)
			MsuId WITH m.MsuID, ;
			TvrQnt WITH nTime  , ;
			TvrPrcSale WITH lnPrice  ;
		IN lvOrderTvrEdit
		RELEASE lnPrice
		**SET STEP ON
		llResult = TABLEUPDATE(1,.T.,[lvOrderTvrEdit])
		*------------------------------------------------------------------------------
		IF llResult
			lPartFrmId = spGetLastIncrementedID([lvOrderTvrEdit])
			**lPartFrmId = spGetLastIncrementedID([JrnUsege])
		ELSE
		   RETURN 0
		ENDIF

USE IN SELECT('lvJrnUsageEditPartTvr')
		_PARAM = lPartFrmId
			
			**FrmPartTvrId WITH lPartFrmId ,;

USE lvJrnUsageEditPartTvr IN 0
SELECT lvJrnUsageEditPartTvr
		REPLACE ;
			UseStart WITH datestart, ;
			UseEnd WITH dateend, ;
			UsePlan WITH .t. ;
		IN lvJrnUsageEditPartTvr
		llResult = TABLEUPDATE(1,.T.,[lvJrnUsageEditPartTvr])
		IF llResult
			.lnbarid= lvJrnUsageEditPartTvr.JrnUseId
			lPartFrmId = .lnbarid
	    	INSERT INTO rv_ResursJrn (JrnUseId,ItemId, FrmId,BarId,UseStart,UseEnd,PointIspCl,FrmIsPayed) ;
	    					  VALUES (lPartFrmId,item,luResAdding,lPartFrmId,datestart,dateend,pPointIspCltID,.f.)  &amp;&amp; äëÿ îòîáðàæåíèÿ
		ELSE
		   RETURN 0
		ENDIF
		*** lvFrmEdit.PointIspCltID
	lresult = spDiscRecount(lPartFrmId1, nIspCltID,null,null)
RELEASE nIspCltID
ENDWITH 		
RETURN luResAdding
ENDPROC
PROCEDURE _dele
LOCAL luRes , lFrmId
WITH this
	SELECT rv_ResursJrn
	LOCATE ALL FOR rv_ResursJrn.JrnUseId = .lnbarid
	IF FOUND() AND 	(rv_ResursJrn.FrmStatusI&lt;3 AND !rv_ResursJrn.FrmIsPayed)
	   lFrmId = rv_ResursJrn.FrmID
	   luRes = oMgrPD.Operate([FORM],[DELE],rv_ResursJrn.FrmID)
	
	  IF luRes
		SELECT rv_ResursJrn
		LOCATE ALL FOR rv_ResursJrn.FrmID = lFrmId
	   DO while FOUND()
		   .Items.RemoveBar(rv_ResursJrn.itemid , rv_ResursJrn.JrnUseId)
			DELETE next 1 IN rv_ResursJrn
			LOCATE ALL FOR rv_ResursJrn.FrmID = lFrmId
	   ENDDO
	  ENDIF
ENDIF
ENDWITH

ENDPROC
PROCEDURE _edit
*LPARAMETERS lnJrnUseId, h
LOCAL luRes, lstr, datestart, dateend,stringWk,test1
luResAdding  =.f.
SELECT rv_ResursJrn
LOCATE ALL FOR rv_ResursJrn.JrnUseId = .lnbarid
** åñëè äîêóìåíò íå çàêðûò äëÿ ðàáîòû
IF !FOUND()
RETURN
ENDIF
IF rv_ResursJrn.FrmStatusI &gt;3 &amp;&amp;!rv_ResursJrn.FrmIsPayed òàê áûëî
	  	MESSAGEBOX('Ñòàóñ äîêóìåíòà íå ïîçâîëÿåò åãî ðåäàêòèðîâàòü.'+CHR(13)+;
	  			   'Åãî ìåíÿòü íåëüçÿ.',0+32,'Îòìåíà ðåäàêòèðîâàíèÿ äîêóìåíòîâ')
ENDIF

WITH this.Items
LOCAL h, lnJrnUseId
h = rv_ResursJrn.ItemId
lnJrnUseId = rv_ResursJrn.JrnUseId
datestart = .ItemBar(h, lnJrnUseId,1)
dateend   = .ItemBar(h, lnJrnUseId,2)
	ENDWITH
PUBLIC barCltName, nFrmStatusI,dStart,dend
nFrmStatusI   = rv_ResursJrn.FrmStatusI
barCltName  =''
this.Enabled = .F.
dStart = IIF(VARTYPE(datestart)='C',CTOT(datestart),datestart)
dEnd   = IIF(VARTYPE(dateend)='C',CTOT(dateend),dateend)
luRes = oMgrPD.Operate([FORM],[EDIT],rv_ResursJrn.FrmID)
datestart = TTOC(dStart)
dateend   = TTOC(dEnd)
this.Enabled = .t.
IF luRes
REPLACE rv_ResursJrn.FrmStatusI WITH nFrmStatusI NEXT 1 IN rv_ResursJrn
this.BeginUpdate()
WITH this.Items
.RemoveBar(h, lnJrnUseId)
	                .AddBar( h, this.namebar(rv_ResursJrn.FrmStatusI,rv_ResursJrn.FrmIsPayed) , datestart, dateend, lnJrnUseId, ALLTRIM(barCltName) )
stringWk = "Items.ItemBar("+ ALLTRIM(STR(h,10,0))+" , "+ ALLTRIM(STR(lnJrnUseId,10,0))+" , 12) =`" +IIF(rv_ResursJrn.FrmIsPayed,"1","0")+"`"   &amp;&amp; exBarPercent
this.executeTemplate(stringWk)
				    stringWk = "Items.ItemBar("+ ALLTRIM(STR(h,16,0))+" , "+ ALLTRIM(STR(lnJrnUseId,10,0))+" ,  6) = `" ;
				    						   +  "Çàñåëåíèå:"+ IIF(VARTYPE(datestart)='C',datestart,TTOC(NVL(datestart,{})))+ ;
				    							  "      Âûåçä:        "+ IIF(VARTYPE(dateend)='C',dateend,TTOC(NVL(dateend,{})))+"`"    &amp;&amp; exBarToolTip
				    This.ExecuteTemplate(stringWk)
	  ENDWITH
this.EndUpdate()
ENDIF
RELEASE barCltName, nFrmStatusI,dStart,dend
RETURN luRes

ENDPROC
PROCEDURE _handlecustommsg
LPARAMETERS tcMsg
DODEFAULT(tcMsg)
DO CASE
	CASE tcMsg = [GUESTIN]
		*16.09.2007 18:10 -&gt;Ìåíÿåì ñòàòóñ íà 3 - ãîñòü çàñåëåí
		LOCAL lnFrmID, lRetVal, lnUserClt
		lRetVal  = .f.
		SELECT rv_ResursJrn
		LOCATE ALL FOR rv_ResursJrn.JrnUseId = this.lnbarid
		
		IF FOUND() AND rv_ResursJrn.FrmStatusI &lt; 3 AND MESSAGEBOX('Çàñåëÿòü ãîñòÿ â íîìåð?',4+32+256,'Èçìåíåíèå äàííûõ î ïðîæèâàíèè ...')=6
			lnFrmID = rv_ResursJrn.FrmID
			_PARAM = lnFrmID
			lnUserClt = spUserClt()
			USE lvFrmEdit IN 0
			CURSORSETPROP([BUFFERING],3,[lvFrmEdit])
			REPLACE FrmStatusID WITH 3, ExecEmiCltID WITH lnUserClt IN lvFrmEdit
			**oApp.nUserKod
			lRetVal = TABLEUPDATE(1,.T.,[lvFrmEdit])
			USE IN lvFrmEdit
		ENDIF
		*------------------------------------------------------------------------------
		IF lRetVal
REPLACE rv_ResursJrn.FrmStatusI  WITH 3 NEXT 1 IN rv_ResursJrn
this.BeginUpdate()
WITH this.Items
LOCAL h, lnJrnUseId
h = rv_ResursJrn.ItemId
lnJrnUseId = rv_ResursJrn.JrnUseId
datestart = .ItemBar(h, lnJrnUseId,1)
dateend   = .ItemBar(h, lnJrnUseId,2)
.RemoveBar(h, lnJrnUseId)
		                .AddBar( h, this.namebar(3,rv_ResursJrn.FrmIsPayed) , datestart, dateend, lnJrnUseId, ALLTRIM(rv_ResursJrn.CltNm) )
stringWk = "Items.ItemBar("+ ALLTRIM(STR(h,10,0))+" , "+ ALLTRIM(STR(lnJrnUseId,10,0))+" , 12) =`" ;
						   +IIF(rv_ResursJrn.FrmIsPayed,"1","0")+"`"   &amp;&amp; exBarPercent
this.executeTemplate(stringWk)
					    stringWk = "Items.ItemBar("+ ALLTRIM(STR(h,16,0))+" , "+ ALLTRIM(STR(lnJrnUseId,10,0))+" ,  6) = `" ;
					    						   +  "Çàñåëåíèå:"+ IIF(VARTYPE(datestart)='C',datestart,TTOC(NVL(datestart,{})))+ ;
													  "      Âûåçä:        "+ IIF(VARTYPE(dateend)='C',dateend,TTOC(NVL(dateend,{})))+"`"    &amp;&amp; exBarToolTip
					    This.ExecuteTemplate(stringWk)
		  ENDWITH
this.EndUpdate()
		ENDIF
	CASE tcMsg = [PAYORD]
LOCAL nPayVarNum
nPayVarNum = ALLT(oRes.GetParam([RST],[PAYTYPE]))
		*16.09.2007 18:10 -&gt;Îïëàòà ñ÷åòà êëèåíòà
		LOCAL lnFrmID
		SELECT rv_ResursJrn
		LOCATE ALL FOR rv_ResursJrn.JrnUseId = this.lnbarid
		IF FOUND()
			lnFrmID = rv_ResursJrn.FrmID
			IF rv_ResursJrn.FrmIsPayed
				IF MESSAGEBOX('Äîêóìåíò óæå îïëà÷åí, îôîðìèòü âîçâðàò äåíåã (âûáåðèòå Äà)',4+32+256,'Îôîðìëåíèå âîçâðàòà çàêàçà')=6
			**+ CHR(13) + ;
			**		 								   'èëè ñäåëàòü Äîïëàòó (âûáåðèòå Íåò)?'
				lRetVal = oApp.DoModalFormRetValObj([FrmPayment;payment.vcx],lnFrmID  ,nPayVarNum,IIF(rv_ResursJrn.FrmIsPayed,2,1) ,0)
				  ELSE
				 	RETURN
				 ENDIF
			 ELSE
				lRetVal = oApp.DoModalFormRetValObj([FrmPayment;payment.vcx],lnFrmID  ,nPayVarNum,IIF(rv_ResursJrn.FrmIsPayed,1,1) ,0)
			ENDIF
			*------------------------------------------------------------------------------
			IF lRetVal
	         REPLACE rv_ResursJrn.FrmIsPayed WITH IIF(rv_ResursJrn.FrmIsPayed,!lRetVal,lRetVal) NEXT 1 IN rv_ResursJrn
	         this.BeginUpdate()
	          WITH this.Items
					        stringWk = "Items.ItemBar("+ ALLTRIM(STR(rv_ResursJrn.ItemId ,10,0))+" , "+ ALLTRIM(STR(rv_ResursJrn.JrnUseId,10,0))+" , 12) = 1" &amp;&amp; exBarPercent
					        This.ExecuteTemplate(stringWk)
			  ENDWITH
	         this.EndUpdate()
	         ENDIF
		ENDIF
ENDCASE


ENDPROC
PROCEDURE _info
WITH this
	SELECT rv_ResursJrn
	LOCATE ALL FOR rv_ResursJrn.JrnUseId = .lnbarid
	IF FOUND()
	   luRes = oMgrPD.Operate([FORM],[INFO],rv_ResursJrn.FrmID)
ENDIF
ENDWITH

ENDPROC
PROCEDURE AddLink
*** ActiveX Control Event ***
LPARAMETERS linkkey
LOCAL nFrmId1,nFrmId2,nPointIspCl1,nPointIspCl2,_PARAM
SELECT rv_ResursJrn
WITH This
	LOCATE ALL FOR rv_ResursJrn.JrnUseId = .lnbaridu
	IF FOUND()
		IF NVL(rv_ResursJrn.FrmIsPayed,.f.)
			  	MESSAGEBOX('Îäèí èç äîêóìåíòîâ óæå îïëà÷åí.'+CHR(13)+;
	  			   'Åãî ìåíÿòü íåëüçÿ.',0+32,'Îòìåíà îáúåäèíåíèÿ äîêóìåíòîâ')
	  			   RETURN .f.
		ENDIF
	    nFrmId2 = rv_ResursJrn.FrmID
		nPointIspCl2 = rv_ResursJrn.PointIspCl
		ELSE
	  			   RETURN .f.
	ENDIF

	LOCATE ALL FOR rv_ResursJrn.JrnUseId = .lnbarid
	IF FOUND()
		IF NVL(rv_ResursJrn.FrmIsPayed,.f.)
			  	MESSAGEBOX('Îäèí èç äîêóìåíòîâ óæå îïëà÷åí.'+CHR(13)+;
	  			   'Åãî ìåíÿòü íåëüçÿ.',0+32,'Îòìåíà îáúåäèíåíèÿ äîêóìåíòîâ')
	  			   RETURN .f.
		ENDIF
	   nFrmId1 = rv_ResursJrn.FrmID
	   nPointIspCl1 = rv_ResursJrn.PointIspCl
		ELSE
	  			   RETURN .f.
	ENDIF

	IF nFrmId1 = nFrmId2
	  	MESSAGEBOX('Ýòè äîêóìåíòû óæå îáúåäåíåíû.',0+32,'Îòìåíà îáúåäèíåíèÿ äîêóìåíòîâ')
	  			   RETURN .f.
	ENDIF

	IF nPointIspCl1 &lt;&gt; nPointIspCl2
	  	MESSAGEBOX('Ó äîêóìåíòîâ ðàçíûå êëèåíòû.'+CHR(13)+;
	  			   'Ñäåëàéòå îäíîãî êëèåíòà.',0+32,'Îòìåíà îáúåäèíåíèÿ äîêóìåíòîâ')
	  			   RETURN .f.
	ENDIF


	IF   	MESSAGEBOX('Îáúåäèíÿòü ýòè äâà äîêóìåíòà?',4+0+32,'Îáúåäèíåíèå äîêóìåíòîâ') &lt;&gt; 6
	RETURN .f.
	ENDIF

*** - 18.03.2009 20:15:36 Ãëóõîâ Â.Þ. (C) - Ïðàâà ïðèíàäëåæàò
llResult = spFormJoin(nFrmId1,nFrmId2)

		IF !llResult
		   RETURN .f.
		ENDIF
*------------------------------------------------------------------------------
llResult = spDiscRecount(nFrmId2, rv_ResursJrn.PointIspCl,null,null)
REPLACE ALL FOR rv_ResursJrn.FrmId = nFrmId1 rv_ResursJrn.FrmID WITH nFrmId2 IN rv_ResursJrn
IF MESSAGEBOX('Äîêóìåíò èçìåíåí. Ðàñïå÷àòàòü åãî?',4+32,'Ïîäãîòîâêà ê ïå÷àòè ...')=6
	.lnbarid= .lnbaridu
	._prndoc()
ENDIF
ENDWITH

DODEFAULT(linkkey)

ENDPROC
PROCEDURE addxml
LOCAL s
WITH this
.BeginUpdate
.SingleSel = .F.
s = "gBJJgBAIDAAGAAEAAQhYAf8Pf4hh0QihCJo2AEZjQAjEZFEaIEaEEaAIAkcbk0olUrlktl0vmExmUzmk1m03nE5nU7nk9n0/oFBoVDolFo1HpFJpVLplNp1PqFRqVTq"
s=s+"lVq1XrFZrVbrldr1fsFhsVjslls1ntFptVrtltt1vuFxuVzul1u13vF5vV7vl9v1BAmBhOCwMKwuDw2ExWJxmIx2HyGLx+SyONyuTy2UzWZzmYz2X0Gbx1kUigUAAMwzG"
s=s+"eo1Ws1ZV2Go1IAL+1ACZMxm2+52W63Ov2Op1fC13F0un4nJ1vE2BV2XD2e/4vK4fL63V1bMTKZ5/d2pf3vh6Xj2ff3e63G683S5vF0mmAD4+Xx+bA+wAeP5/H6a/9+h8P2"
s=s+"eIAGZAiHHYZkDQQ7TuH/Ap4GUUzjPgiCJn+AD7GBAMNQJBD8wFDwAFlEUExJBaHQdCDixM+UARYABuxg/8ZQ5DUQRpEEbQKf8DxPBDiPe08KRdDEZHVIwANU1YRSWAALSdJ"
s=s+"snxpHcFO3HsrOI48Ky1IkKQpERZAA9sjHVC77ynEsqwbBE1RVNKHgAQ04yQ1skvDOJDRkZc9ABJYRT5Jk+z/P0pR49sgQHAsaUVApx0aAD+mvOclSZIkYG7MsMxNTUqyw+F"
s=s+"FwVRNQwRSwACFUwADvVNHv9IlNu5V02u5UjzVMIUQxHMYABzXdUVVRpxgBXM60DX9MQHTjWrJE0uzfGkXRdXNa0FYMjxBM8vxJM7iWXN8KSlbs31zWlT1Ja0eWxM9tNbbkL"
s=s+"UhY1mQtaU62hI9hyZUl0x5H6x3ZLVvwtekyWlYlHXNBF0R5dTszdC1vR1cELVJO9JABLODVvMF8x9deGS1fE3yJXYc4pgOKUDfGE31ZN+Srd13U/VdI1y9uCWBPRl2NE1sW"
s=s+"xbeWv9l2f6DSNSXdkTaNtd1WyrncR567mgaHGJLanMLY2laVc2FOjW1JpTuX2sV0YhmMtQpXLct1msZRBLmU421exYbN93XgAFixA9s61ztkzbc4u47LHmb6O8ExSPs0j6N"
s=s+"Otyv1hSy8BCm6bHs7eUDXMXb5DOLuJyG5v9CjzWLCkszrqZLS2+/NtbwEQdFN9sPbLPEYFU/Fxj1TV2U7WyahslSdM8O9SPGkieK+8iW33fe1JXNUjvqrnWlo1A2lUnieO+"
s=s+"/k1lGMs7RjDwvNiciedUtT6Nd3B+RlaxQJBmx8luULWLLPqxjZ769S/UQe1svPUi6M+D5DzN5a2athyHX9H6f43VIjE3yMTbqrlbB5l3OYgU+ssL7X+rtc+2Nj7AD5vwRkk"
s=s+"SCyAoFvvg6/FaiZIIuHbGv9DRxEuQeRjC2FkKH/pvRcs4+b+4MFgH+mmISDIhrHN0dqI5uIjRLGYbOJp2YnRRihAaIsQYiRXIdFVKsSImRKiegOKUYIpxZiwg2MsWokxpjF"
s=s+"Gs7UY4vxvNmWSKwAEHoRjrHRFMZkToMd3HqOcf4lRBN1IKLMg4vGzjnHeRUeY+yNj5GeIkhpJSFkpF+RKKZFoRj9I6PcZJKSElBIGUUR44ljkBJCT0gI1RclZIeN0YZLRal"
s=s+"RKqLsq5XRslhIiWUqY0S1l9HCV8YyyEWB8SuYpHiQEiJIAAkpKJmk4QoX8pJFE3zSKCQEA="
.Images(s)
s="gBJJgBAICAAGAAEAAQhYAf8Pf4hh0QihCJo2AEZjQAjEZFEaIEaEEaAIAkcbk0olUrlktl0vmExmUzmk1m03nE5nU7nk9n0/oFBoVDolFo1HpFJpVLplNp1PqFRqVTqlVq1XrF"
s=s+"ZrVbrldr1fsFhsVjslls1ntFptVrtltt1vuFxuVzul1u13vF5vV7vl9v1/wGBwWDwmFw2HxGJxWLxmNx2PyGRyWTymVy2XzGZzWbzmdz2f0Gh0WjwEWH0r08ekEikgAkso184iG"
s=s+"kicPjcU2+zjW43e6jO8jL+b79X8bfif48bfAffgP43IT8b4XE3O23vW3++2r/6vcjUB"
.Images(s)

*!*		.DrawGridLines = -1
*!*		.BackColor = RGB(255,255,255)
*!*		.MarkSearchColumn = .F.
*!*		.ShowFocusRect = .F.
*!*		.HasLines = .F.
*!*		.Indent = 24
*!*		.DefaultItemHeight = 20
*!*		.AllowChartScrollPage = .T.
*!*		.ScrollPartCaption(2,2048) = "&lt;img&gt;4&lt;/img&gt;"
*!*		.ScrollPartCaption(2,32) = "&lt;img&gt;5&lt;/img&gt;"
*!*		   WITH .VisualAppearance
*!*			.Add(1,"gBFLBCJwBAEHhEJAEGg4BOEIQAAYAQGKIYBkAKBQAGaAoDDMOILQiMQxDPBMKgBBCLIxiGK4DhiGoZQ0HKCRZDeI4DDSNcgjCLIZw8GYCIRjaL5UkPGSZJpmSRwAiWPIpSrLMrgLLMdR1HCBaQiehoaiEMg1CTTVQSCKoYSjBKqarjGbKGoqSozUxNMAggI=")
*!*			.Add(2,"XP: Header 1 1")
*!*		   ENDWITH
*!*				.HTMLPicture("excel") = "gAAAABgYAEAgBEChSohIAC0KFEKEEKIEKgkNhQAAkZjkCgkejshkUjkklk0nlEplUrlRofQSADbMhEABwl8xmYAI0KaoPawANgYYwAeIDIIARE3mU0A08n1AoVEo1IBVDYrjo7NrFQoaoqoAK5+IYAXE3N1iAB2tCcfcwQFosswpsCns/fDVmlBobQm4GHVMi0KJQBBcceE3VAscJ3XgADAAucFgWDwt1ADNVa6bgUtoAcxSxeWxuPyMfAGUjhwfkwGmdQ5kxbXAL/f+jyGByeEjhQzrwEJ1OOy2m20uC3SszpvE/A4m40+6TfLOOqmEZSBCCYAu80jLY35xjPCf/UyU1zocYECGmrxzDOxxKAmOJx2m0aGdOgl4HX7PNkDcsK8iMnQzoNmCOQ4v88rUCI9jlOYxzbv+57Cui4EBIU/jtLwjg1mBBCMjgYjsvIbgjsW20NO2ABIPYFj2RamEYgAW4PnMO4ICQxb6n+UD2DsE0IMfEJ+phFZMAeoYBIVJaOw0kQwPY2wuSK9r3iA+T6PqYD2MTFEIuLACayqzDNG49gyROO4QhkIoACsESKhxKpsTiAB4PYVgOGOjSFAYWShkKEiKkoaChipKpMhOioMUAAAbhEo6NoFP6hgiECj0qAB7Uwjk9T5TQ2A3Ph4A1PhYI+KtBgAcEqj9VdBIqjLTGJKo3BsipVzsWE6TsOEq0mABcz2AFapgAhYqGdliGhKoXUWAB6WJYc+E4HiK2MAFPz6gVroqBznNMZAJz4UwFiEABnXVdd2Xbd133heN5Xnel63oHwo3zfV935ft83gHxAYFgeCYLgxACjgGD4Xg+E3fgOBX9iV84jhWI4IKOI4phGN4Ri2EYxjWM45kePYfgd/ZJkWUY/kuQZJfmWZPi+UZXlWK5nmF9ZvneKj4H2f6DoGh6Fl2UY7hOiaVoWg5do2WZ/hmB5/iekGdoGD6VoGnZDn2A6ZrGg6pruaY9rGlkBoJAa3quoa/om06HuOuZriusbiPm8bOPm6bLhOo4FvOhanfG27tvO071wGt7Jl+PajwWl7fvvHaTvOlbXtW2X6H138huWBblwGDYhhHO6vxGpbv0mI9OZ2wdhoeY9D012cl2PU4LfHXXj0upYGH3ed73/dXt4Pj+R5PkXfHkeH8hXnoF6IAen6voev6XseolnuJW0wBoUA6FAf6IP+iH/oj+gI="
*!*				.HTMLPicture("word") = "gAAAABgYAEAgBEChSohIAC0KFEKEEKIEKgkNhQAAkZjkCgkejshkUjkklk0nlEplUrlRofQSADbMhEABwl8xmYAI0KaoPawANgYYwAeIDIIARE3mU0A08n1AoVEo1IBVDYrjo7NrFQoaoqoAK5+IYAXE3N1iAB2tCcfcwQFosswpsCns/fDVmlBobQm4GHVMi0KPwCDMceE3VAscJ3NQBCYAucFgWDwt1ADNVa6bgUtoAcxSxeWxuPyMfAGUjhwfkwGmdQ5kxa1AL/f+jyGByeEjhQzrwEJ1OOy2m20uC3SszpvE/A4m40+6TfLOOqmEZGBux93mkZbG/OMZ4T/6mSmudDjAgQ01YADDDOxxKAmOJx2m0aGdOgl4HXx/NkDcsK8aMnQzoNmCOQ4v88jUCI9blOYxzbv+57Cui4EBIU/gAO0jg1mBBCMjwYTHvGbgjsW20NQ4SD1hY9cWJhGAAFuD5zDuCAkMW+p/lA9Y7BNCDHoyOB+phDhMAeoYBIVJaOw0kQwPW2wuSK9j3DiID5Po+pgPWxMUQi4sAJrKrMM0bhkqGDQQoqEIZCKAArBEiocSqbE5gAeD1nRNKNIUBhZKGQoSIqKB7KGKkqkyE6KgxQIABuESjo2gVAKGCIQKPSwAHtTKOT4odNjwfqhn4fihgAAaBCrQgAHBKoSHxNU2TImFKAAe8+gohRaTwWE7Twb88VvXKhmJKoYVoFFZAAaEqhdRgABhZligATgeIrY6YVBPyBWwioIOc0wwWYUwFiEABnXVdd2Xbd133heN5Xnel63oHxjXzfV935ft83gHxAYFgeCYLgxAGNgGD4Xg+E3fgOGYjgWHXdiGJX7geKXbi2JYXjV2Ytf2RGNjOFY7hmP3XkOR4xieTZPhpnBbmWaZnm2amdlmSZdnGb59mWYYTmeO5nnWS6BmxAZvgegZPoRnEBmmo5tnei5Zo4W6VpGaYhpuO6fqee6hrV84nluEXVrOf6pqeCX1hGy5doet7UZ2A6ts23axqW+bnrOM7juO0Z9rW65vwOC53tGxbXr24YEH136HiXJ7NfOQ8jtOO8dfeIGNzPGdDheA8/dvG7X0fS3njmOh90F5dZiXX9h13a9t2/a3fHcdn8hXeoF34AeD4ffeL4HjeElnlJW01VIEA6FAf34P9+H/fj+gIA=="

*!*	.SelBackColor = 16777216
*!*	.SelForeColor = RGB(0,0,128)
**'Uncomment it if you are running Windows XP
** .BackColorHeader = 33554432
WITH .Chart
			*!*		.AllowCreateBar = .F.
			*!*		.NonworkingDaysColor = RGB(196,196,128)
			*!*		.NonworkingDaysPattern = 6
			*!*			*!*		.FirstVisibleDate = "Feb 24 2006"
			*!*		.BackColor = RGB(255,255,255)
			*!*		.DrawGridLines = 2
			*!*		WITH .Bars.Add("End")
			*!*			.Pattern = 2
			*!*			.Color = RGB(255,128,128)
			*!*		ENDWITH
	
	
			*!*		exYear         0  Indicates the year. Values: ..., 2001, 2002, 2003, ...
			*!*	    exHalfYear     1  A date between January 1st and June 31 indicates the first half of the year, and from July 1 to December 31, indicates the second half of the year. Values: 1 and 2
			*!*	    exQuarterYear  2  A date between January 1st and March 31 indicates the first quarter of the year, a date between April 1st and June 30 indicates the second quarter of the year, a date between July 1st and September 30 indicates the third quarter of the year, and if a date between October 1st and December 31 indicates the forth quarter of the year. Values: 1, 2, 3 and 4
			*!*	    exMonth       16  Indicates the month. Values: 1 ( January ), 2 ( February ), ..., and 12 ( December ). Use the MonthNames property to specify the name of the months.
			*!*	    exThirdMonth  17  The first ten days in a month indicates the first third of the month, the next 10 days indicates the second third of the month, and the last 10 days in the month indicates the last third of the month. Values: 1, 2 and 3.
			*!*	    exWeek        256  Indicates the week in the year. Values: 1,2,...,53. Use the WeekDays property to specify the name of the days in the week.
			*!*	    exDay         4096  Indicates the day of the date. Values: 1,2,..,31
			*!*	    exHour        65536  Indicates the hour.
			*!*	    exMinute      1048576  Indicates the minute.
			*!*	    exSecond      16777216  Indicates the second.

		.Label(0) = ""  &amp;&amp; exYear
		.Label(1) = ""  &amp;&amp; exHalfYear
		.Label(2) = ""  &amp;&amp; exQuarterYear
		.Label(16) = ""  &amp;&amp; exMonth
		.Label(17) = ""  &amp;&amp; exThirdMonth
*!*		.Label(256) = ""  &amp;&amp; exWeek
*!*		.Label(4096  ) = ""  &amp;&amp; exDay
*!*		.Label(65536  ) = ""  &amp;&amp; exHour
		.Label(1048576) = ""  &amp;&amp; exMinute
		.Label(16777216) = ""  &amp;&amp; exSecond
		*!*		.OverviewBackColor = RGB(255,255,255)
		*!*		.OverviewVisible = .T.
		*!*		.AllowOverviewZoom = 1
	***.OverviewZoomCaption = "Year|  ?Year|  ?Year|&lt;img&gt;3&lt;/img&gt;|Third|&lt;img&gt;2&lt;/img&gt;|&lt;img&gt;1&lt;/img&gt;|Hour|Min|Sec"
	*.OverviewZoomCaption =    "Year|1\2Year|1\4Year|&lt;img&gt;11&lt;/img&gt;|Third|&lt;img&gt;11&lt;/img&gt;|&lt;img&gt;10&lt;/img&gt;|&lt;img&gt;9&lt;/img&gt;|Min|Sec"
*!*		.OverviewZoomUnit = 24
ENDWITH
.EndUpdate
ENDWITH


ENDPROC
PROCEDURE BarResize
*** ActiveX Control Event ***
LPARAMETERS item, key
IF this.linload
RETURN .t.
ENDIF
IF !TYPE('key')= 'N'
		  thisform.CmdReload.Click()
RETURN .f.
ENDIF
LOCAL  lStart, lEnd, stringWk, lChange,lnResursId, lBarCnt,lresult ,llResult

with this.Items
SET DATABASE TO BASIS
_PARAM = key
USE IN SELECT('rv_JurnalUseEdit')
USE rv_JurnalUseEdit IN 0
*** - 19.03.2009 10:56:41 Ãëóõîâ Â.Þ. (C) - Ïðàâà ïðèíàäëåæàò
*** îáúåêò íå íàøëè
IF !RECCOUNT('rv_JurnalUseEdit')=1
=MESSAGEBOX('Îøèáî÷íûé êîä îáúåêòà. '+CHR(13)+'Ñîõðàíåíèå íå ïðîèçîøëî ...',0+16, 'Ïðîáëåìà')
		     USE IN SELECT('rv_JurnalUseEdit')
		  thisform.CmdReload.Click()
RETURN .f.
ENDIF
SELECT rv_ResursJrn
LOCATE FOR rv_ResursJrn.BarId = key
lChange = .f.
lStart = NVL(rv_JurnalUseEdit.UseStart ,{})
lEnd   = NVL(rv_JurnalUseEdit.UseEnd,{})
lnResursId = rv_ResursJrn.ResursID
*!*	    *** äîêóìåíò îïëà÷åí,íî äëèòåëüíîñòü òà æå, èëè àêöåïòîâàí
*!*	     IF rv_ResursJrn.FrmStatusI&gt;3 OR (rv_ResursJrn.FrmIsPayed AND (.ItemBar(item,key,2)-.ItemBar(item,key,1))&lt;&gt;(lEnd-lStart) )    &amp;&amp; òàê áûëî rv_ResursJrn.FrmStatusI&gt;2 OR rv_ResursJrn.FrmIsPayed
*** äîêóìåíò îïëà÷åí èëè àêöåïòîâàí
IF rv_ResursJrn.FrmStatusI&gt;3 OR rv_ResursJrn.FrmIsPayed    &amp;&amp; òàê áûëî rv_ResursJrn.FrmStatusI&gt;2 OR rv_ResursJrn.FrmIsPayed
=MESSAGEBOX('Äîêóìåíò àêöåïòîâàí èëè îïëà÷åí.'+CHR(13)+'Èçìåíÿòü íåëüçÿ.'+CHR(13)+'Îáðàòèòåñü ê àäìèíèñòðàòîðó.',0+32+4096, 'Íåäîïóñòèìîå äåéñòâèå ...',5000)
		  thisform.CmdReload.Click()
		  RETURN .f.
ELSE
	     lStart = .ItemBar(item,key,1)
	     lEnd   = .ItemBar(item,key,2)
	     IF VARTYPE(lStart)='C' OR VARTYPE(lEnd)='C'
		  thisform.CmdReload.Click()
	     	RETURN .f.
	     ENDIF
	    *** ïîìåíÿëè ñòàðò è îí â çàïðåòíîì ïåðèîäå ÈËÈ îêîí÷àíèå â çàïðåòíîì ïåðèîäå ÈËÈ íîâîå íà÷àëî â çàïðåòíîì ïåðèîäå
	     IF (thisform.tOgrDate &gt; rv_JurnalUseEdit.UseStart  AND rv_JurnalUseEdit.UseStart  &lt;&gt; lStart) OR  thisform.tOgrDate &gt; lEnd OR  (thisform.tOgrDate &gt; lStart AND rv_JurnalUseEdit.UseStart  &lt;&gt; lStart)
			MESSAGEBOX('Æåëàåìàÿ äàòà íàõîäèòñÿ â çàêðûòîì ïåðèîäå.',0+32,'Âíåñåíèå èçìåíåíèé çàïðåùåíî ...')
		thisform.CmdReload.Click()
			RETURN .f.
		 ENDIF
	     IF MESSAGEBOX('Èçìåíèòü ñðîêè ïðîæèâàíèÿ?',4+32+256,'Èçìåíåíèå äàííûõ î ïðîæèâàíèè ...')=6
			     lBarCnt = this._find(lnResursId,lStart,lEnd,Key)
					IF lBarCnt &gt;0
					  thisform.CmdReload.Click()
							RETURN .f.
					ENDIF
			     lChange = .t.
		     ELSE
		  thisform.CmdReload.Click()
		       RETURN .f.
	     ENDIF
ENDIF
					IF this.chart.UnitScale =&lt; 4096
						DO CASE
							CASE this.nTypeTime = 0 &amp;&amp; C 12 äî 12
								lStart = CTOT(DTOC(lStart )+ ' 12:00:00')
								lEnd   = CTOT(DTOC(lEnd   )  + ' 12:00:00')
							CASE this.nTypeTime = 1 &amp;&amp; C 14 äî 12
								lStart = CTOT(DTOC(lStart )+ ' 14:00:00')
								lEnd   = CTOT(DTOC(lEnd   )  + ' 12:00:00')
							CASE this.nTypeTime = 2 &amp;&amp; C òåêóùåãî ÷àñà äî òåêóùåãî ÷àñà
								lEnd   = CTOT(DTOC(lEnd   )  + ' '+TTOC(lStart ,2))
						ENDCASE
				    ENDIF
				    IF (lStart &lt;DATETIME() AND MESSAGEBOX('Íà÷àëî ïðîæèâàíèÿ â ïðîøåäøåì ïåðèîäå.'+CHR(13)+'Èçìåíèòü ñðîêè ïðîæèâàíèÿ?',4+32+256,'Èçìåíåíèå äàííûõ î ïðîæèâàíèè ...')=7)
				  thisform.CmdReload.Click()
				    	RETURN .f.
				    ENDIF
				    this.BeginUpdate()
				    stringWk = "Items.ItemBar("+ ALLTRIM(STR(item,16,0))+" , "+ ALLTRIM(STR(key,10,0))+" , 1) = `" + TTOC(lStart)+"`"
				    this.executeTemplate(stringWk)
				    stringWk = "Items.ItemBar("+ ALLTRIM(STR(item,16,0))+" , "+ ALLTRIM(STR(key,10,0))+" , 2) = `" + TTOC(lEnd)+"`"
				    this.executeTemplate(stringWk)
				    stringWk = "Items.ItemBar("+ ALLTRIM(STR(item,16,0))+" , "+ ALLTRIM(STR(key,10,0))+" , 6) = `" +  "Çàñåëåíèå:"+ TTOC(NVL(lStart,{}))+ ;
	    																			  "      Âûåçä:        "+ TTOC(NVL(lEnd,{}))+"`"    &amp;&amp; exBarToolTip
				    this.ExecuteTemplate(stringWk)
				    this.EndUpdate
IF !(rv_ResursJrn.FrmStatusI&gt;2 OR rv_ResursJrn.FrmIsPayed) AND lChange
REPLACE  UseStart WITH  lStart , ;
	 UseEnd   WITH  lEnd IN rv_JurnalUseEdit
		llResult = TABLEUPDATE(1,.T.,[rv_JurnalUseEdit])
			IF !llResult
	            =MESSAGEBOX('Îøèáêà ïðè ñîõðàíåíèè íà ñåðâåðå [rv_JurnalUseEdit]. '+CHR(13)+'Ñîõðàíåíèå íå ïðîèçîøëî ...',0+16+4096, 'Ïðîáëåìà',900)
		  thisform.CmdReload.Click()
			   RETURN .f.
			ENDIF		
		lresult = spDiscRecount(rv_ResursJrn.FrmId, rv_ResursJrn.PointIspCl,null,null)
	       REPLACE  UseStart WITH  lStart , ;
	 UseEnd   WITH  lEnd IN rv_ResursJrn
		IF MESSAGEBOX('Äîêóìåíò èçìåíåí. Ðàñïå÷àòàòü åãî?',4+32,'Ïîäãîòîâêà ê ïå÷àòè ...')=6
			this.lnbarid= key
			this._prndoc()
		ENDIF
	
ENDIF
endwith


ENDPROC
PROCEDURE barsprop
DODEFAULT()
With this.Chart.Bars
	.Item("Task").Height = 20
	.Item("Task").Pattern = 1&amp;&amp;1
	.Item("Task").StartColor =  RGB(138,244,244)   &amp;&amp; - íåãàðàíòèðîâàííîå áðîíèðîâàíèå  -  îæèäàþùàÿ áðîíü
	.Item("Task").Color = RGB(138,244,244)
	.Item("Task").EndColor =  RGB(138,244,244)
	.Item("Task").StartShape = 0 &amp;&amp;17  &amp;&amp;61447  &amp;&amp; exShapeIconFrameLeft
	.Item("Task").EndShape = 0&amp;&amp; 8 &amp;&amp;61448  &amp;&amp; exShapeIconFrameRight

.Copy("Task", "preTask")   &amp;&amp; - äåíüãè  (æåëòûé)
		.Item("preTask").StartColor =  RGB(0,128,192)
		.Item("preTask").Color =       RGB(0,128,192)
		.Item("preTask").EndColor =    RGB(0,128,192)
.Copy("Task", "garTask")  &amp;&amp; - èòîãè (òåìíî-ñèíèé)
		.Item("garTask").StartColor =  RGB(255,255,0)
		.Item("garTask").Color =       RGB(255,255,0)
		.Item("garTask").EndColor =    RGB(255,255,0)
.Copy("Task", "LiveTask")  &amp;&amp;  - ïðîæèâàíèå  (LiveTask) òåìíî-çåëåíûé
		.Item("LiveTask").StartColor =  RGB(0,255,64)
		.Item("LiveTask").Color = RGB(0,255,64)
		.Item("LiveTask").EndColor =  RGB(0,255,64)
.Copy("Task", "errTask")  &amp;&amp;  - ïðîæèâàíèå  (LiveTask) îðàíüæåâûé
		.Item("errTask").StartColor =  RGB(255,128,0)
		.Item("errTask").Color = RGB(255,128,0)
		.Item("errTask").EndColor =  RGB(255,128,0)
.Copy("Task", "GreenTask")  &amp;&amp;  - ïîëîæèòåëüíûé èòîã òåìíî-çåëåíûé
		.Item("GreenTask").StartColor =  RGB(0,255,64)
		.Item("GreenTask").Color = RGB(0,255,64)
		.Item("GreenTask").EndColor =  RGB(0,255,64)
.Copy("Task", "RedTask")  &amp;&amp;  - îòðèöàòåëüíûé èòîã êðàñíûé
		.Item("RedTask").StartColor =  RGB(255,0,0)
		.Item("RedTask").Color =		RGB(255,0,0)
		.Item("RedTask").EndColor =  	RGB(255,0,0)

		.Item("Task").HistogramPattern = 32
		.Item("Task").HistogramColor = RGB(138,244,244)
		.Item("preTask").HistogramPattern = 32
		.Item("preTask").HistogramColor =       RGB(255,255,0)
		.Item("garTask").HistogramPattern = 32
		.Item("garTask").HistogramColor =       RGB(0,0,255)
		.Item("LiveTask").HistogramPattern = 1
		.Item("LiveTask").HistogramColor = RGB(0,255,0)
		.Item("errTask").HistogramPattern = 32
		.Item("errTask").HistogramColor = RGB(255,0,0)
		.Item("GreenTask").HistogramPattern = 32
		.Item("GreenTask").HistogramColor = RGB(255,0,0)
		.Item("RedTask").HistogramPattern = 32
		.Item("RedTask").HistogramColor = RGB(255,0,0)


	.Add('preTask%PRed')
	.Add('garTask%PRed')
	.Add('LiveTask%PRed')
	.Add('Task%PRed')
	.Add('errTask%PRed')
	.Add('GreenTask%PRed')
	.Add('RedTask%PRed')
ENDWITH


ENDPROC
PROCEDURE Click
*** ActiveX Control Event ***
With this
	local h, c, hit, llResult
.lnitemid = .ItemFromPoint(-1, -1, c, hit)
If (.lnitemid  # 0)
.lnbarid = .Chart.BarFromPoint(-1, -1)
If Empty(NVL(.lnbarid,0))
RETURN .f.
EndIf
EndIf
ENDWITH

ENDPROC
PROCEDURE CreateBar
*** ActiveX Control Event ***
LPARAMETERS item, datestart, dateend
LOCAL lPartFrmId ,newBar,llResult
IF dateend-datestart&lt;150
RETURN
ENDIF
IF thisform.tOgrDate &gt; dateend OR thisform.tOgrDate &gt; datestart
	MESSAGEBOX('Æåëàåìàÿ äàòà íàõîäèòñÿ â çàêðûòîì ïåðèîäå.',0+32,'Âíåñåíèå èçìåíåíèé çàïðåùåíî ...')
	RETURN
ENDIF
*IF (HOUR(datestart)=14 AND HOUR(dateend)=12) OR MESSAGEBOX('Ïðèâîäèòü âðåìÿ çàñåëåíèÿ ê 14 ÷àñàì,'+CHR(13)+;
*			  ' à âðåìÿ ñäà÷è ê 12 ÷àñàì?',4+32+256,'Êîððåêòèðîâêà âðåìåíè çàåçäà-âûåçäà')=6
IF this.chart.UnitScale =&lt; 4096
	DO CASE
		CASE this.lCopy
		CASE this.nTypeTime = 0 &amp;&amp; C 12 äî 12
			datestart = CTOT(DTOC(datestart)+ ' 12:00:00')
			dateend   = CTOT(DTOC(dateend)  + ' 12:00:00')
		CASE this.nTypeTime = 1 &amp;&amp; C 14 äî 12
			datestart = CTOT(DTOC(datestart)+ ' 14:00:00')
			dateend   = CTOT(DTOC(dateend)  + ' 12:00:00')
		CASE this.nTypeTime = 2 &amp;&amp; C òåêóùåãî ÷àñà äî òåêóùåãî ÷àñà
			dateend   = CTOT(DTOC(dateend)  + ' '+TTOC(datestart,2))
	ENDCASE
ENDIF
*ENDIF
IF (datestart &lt;DATETIME() AND MESSAGEBOX('Íà÷àëî ïðîæèâàíèÿ â ïðîøåäøåì ïåðèîäå.'+CHR(13)+'Äîáàâëÿòü ïðîæèâàíèå?',4+32+256,'Èçìåíåíèå äàííûõ î ïðîæèâàíèè ...')=7)
	RETURN .f.
ENDIF

PUBLIC barCltName,nFrmStatusI,pPointIspCltID,dStart,dEnd,nitem
with this
	barCltName =''
	lPartFrmId = ._add(item, datestart, dateend)
	datestart = dStart
	dateend   = dEnd
	IF lPartFrmId &gt;0	
	    .BeginUpdate()
		with .Items
			.AddBar( nitem, this.namebar(nFrmStatusI,.f.), datestart, dateend,this.lnbarid, ALLTRIM(barCltName) )
		    stringWk = "Items.ItemBar("+ALLTRIM(STR(nitem,16,0))+" , "+ ALLTRIM(STR(lPartFrmId,10,0))+" , 6) = `" +  "Çàñåëåíèå:"+ TTOC(datestart)+ ;
		    																			  "      Âûåçä:        "+ TTOC(dateend)+"`"    &amp;&amp; exBarToolTip
		    This.ExecuteTemplate(stringWk)
	 	ENDWITH
	    .EndUpdate
		spDiscRecount(lPartFrmId ,pPointIspCltID,null,null)
		IF MESSAGEBOX('Äîêóìåíò äîáàâëåí. Äîïîëíèòü åãî?',4+32,'Âíåñåíèå äîïîëíèòåëüíîé èíôîðìàöèè ...')=6
			._edit()
		ENDIF
		IF MESSAGEBOX('Äîêóìåíò äîáàâëåí. Ðàñïå÷àòàòü åãî?',4+32,'Ïîäãîòîâêà ê ïå÷àòè ...')=6
			._prndoc()
		ENDIF
	ENDIF
ENDWITH
RELEASE barCltName,typeNewFrm,pPointIspCltID,dStart,dEnd

ENDPROC
PROCEDURE DblClick
*** ActiveX Control Event ***
LPARAMETERS shift, x, y

With this
	local h, c, hit, llResult,lTvrId
.lnitemid = .ItemFromPoint(-1, -1, c, hit)
If (.lnitemid  # 0)
.lnbarid = .Chart.BarFromPoint(-1, -1)
If Empty(NVL(.lnbarid,0))
*** Êëèêè íà ïàíåëè ñëåâà
				SELECT rv_ResursLst
				LOCATE ALL FOR BarId = .lnitemid
				lTvrId = rv_ResursLst.TvrId
				IF !FOUND()
		          				lTvrId = null
				ENDIF
		           IF !ISNULL(lTvrId) AND MESSAGEBOX('Ïðîøëà óáîðêà ýòîãî íîìåðà?',4+64,'Îòìå÷àåì óáîðêó íîìåðà ...')=6
						SET DATABASE TO Basis
						llResult = ClearNumber(lTvrId , DATETIME())
						IF llResult
							replace rv_ResursLst.clearnum WITH 0 NEXT 1 IN rv_ResursLst
							this.Items.CellValue(.lnitemid,0) = ALLTRIM(rv_ResursLst.TvrNm)
							WAIT WINDOW 'Îòìåòêà îá óáîðêå íîìåðà ñäåëàíà ...' TIMEOUT .7
						ENDIF
		           ENDIF
RETURN .f.
EndIf
EndIf
*** Êëèêè íà ïàíåëè ñïðàâà
ENDWITH
DODEFAULT()
ENDPROC
PROCEDURE histogramset
DODEFAULT()
this.Chart.HistogramHeight = 10  &amp;&amp;120


ENDPROC
PROCEDURE Init
WAIT WINDOW 'Ãîòîâèì øàõìàòêó ê ðàáîòå ...' NOWAIT
DODEFAULT()
LOCAL s
WITH this
	WITH .VisualAppearance
		*** Ïðîãðåññ-áàð
		s = 'gBFLBCJwBAEHhEJAEGg4BBIDg6AADACAxRDAMgBQKAAzQFAYaQNBgABhGYZYJACCIDEYeSzRNCsOw8GSEZAgOJ4eiWJIkDD'
		s = s+'KADQTAoYBKFoZJTgQYJOjCJULIRkSZ0CgmOY3UBHMjwSBEEigNIxToOU4jFimCROQwQRK1BDwbQSFCEUDnaagABiHQYRBQMa'
		s = s+'vfYlSr+fx/LLtF7Xdb5fD8Py+b5vY7TdTofR9XxfxLDaz4ep+HreR63WbNej1PI+LyPC7DZrhRp4MCdTBXLbdcTqPg8DovM5z'
		s = s+'TrudpzHrdNxXWapZDxOw4bx6S6TVrEeR0XAeJx2fbBZTdPC5DabSzjXLEazfGvBCyrXq+aZ3G6aJzWbZBbjaM7zbLuW'
		s = s+'zbFJoGwMZck0Zgrh2KpEHUdpdG0RgjiWJJCHMM5Xm4NoCm2RJPF0OJZkuFwbC0bphGSLRcAwdYbgWDIyDgDBSkWegrE2cwYiy'
		s = s+'AAKjMeJDCoTZjACJw3EuYoUlwLxKEMdI7CiTYSnSHw2EuMh4lgLoJlMYI4CaTYCliGQ1gsQhclcLIJGMWIxCUTRSkSEw1AsAh'
		s = s+'IlUK5InMUIuCMDQijCCg0gqIgclMKhIEMSIoCCTQCiCBQzkocgQk4KYIDMOIkB+TJigwfAzEoEZgkwKAHHMLIfB2DByG4YIY1'
		s = s+'OaB0DGSYBkiRgmAbGoWBtU5UGsMZJGGKJDCSJxiEwaQwgkIYgkIJBGFMCIQVWMg8GEMIImEfJBCMRZinCCwWGjEg9CKBYCniC'
		s = s+'QVmkYRcj8IZFR+BgVGmYRUj4IJFBqDBRC8SAhECPAgEScpsgAE4LiGfBNC4R5hDKNATAuMZ8EuLhEjKaB+BKC4RnQSQuAeQQg'
		s = s+'jcHpEHKWB6BGLIhBkZRCFYZYVGgWoPnWMRuFwFwll0dxeFeNZ1H8YBYDYFYHGIWI2EGEBkhkRhZhgZoZkYeYgGiGhGhmKBqhq'
		s = s+'Ro5jAbIbEaWY4G6G5HAWQRwlwVwdkkcsxkmUh1B0ZxhlodwdmeAJFHiHhHhmaB6h6R45nAfIfEeWZ4H6H5HnoAIAgweASAaAg'
		s = s+'gigMgOgQIQoFIFoGCGKByB6CAiCiEgmgoIoojILoMCMKJSDaDgjiicg+hAJApBIRoSCSKQyE6FAlCkUhWhYJYpHIXoYnUCYWG'
		s = s+'eGhmjmNhvhwZw5lYd4eGeOZ2H+IBoDoFoHiIaI6DaD4kGkOhWheJhpjodofigamsiiKoqkqOowiyKx6l6HkLwVxrAFEKGILA1giibDMNkdAGgBEBA'
		.Add(54,s)
	ENDWITH
.SingleSel = .F.
.BeginUpdate()
.Enabled = .f.
.DefaultItemHeight = 20
.Chart.AllowLinkBars =0
.Chart.PaneWidth(0) = 180
.Chart.AllowLinkBars= .T.
.Chart.ShowLinks= .T.

.BackColor= RGB(232,233,236)
*.Chart.BackColor = RGB(232,233,236)    &amp;&amp;205,211,216)
.Chart.SelBackColor = RGB(210,210,210)    &amp;&amp;205,211,216)
*!*			.Chart.BackColor = 16777215
*!*			.Chart.SelBackColor = 16119285

.Columns.Item(0).Width  = 180
*.Columns.Add("Ïðèìå÷àíèå").Width  = 20
.histogramset()
.EndUpdate()
.Enabled = .t.
ENDWITH
WAIT CLEAR

** ñîçäàòü áàð÷èêè:
*!*		   - íåãàðàíòèðîâàííîå áðîíèðîâàíèå  -  îæèäàþùàÿ áðîíü  (Task) 28
*!*		   - íåãàðàíòèðîâàííîå áðîíèðîâàíèå (ðàçìåùåííàÿ) (preTask)     29
*!*		   - ãàðàíòèðîâàííîå áðîíèðîâàíèå (ðàçìåùåííàÿ)    (garTask)   30 (èëè 22)
*!*		   - ïðîæèâàíèå  (LiveTask) (äîêóìåíò - ñ÷åò ãîñòÿ)             22

*!*		   - îáñëóæèâàíèå â íîìåðå
*!*		   - äîáàâëåíèå ÷åðåç ðåñóðñ "Ïîèñê ñâîáîäíîãî"
ENDPROC
PROCEDURE loaddata
*!*	thisform.LoadData1()
*!*	RETURN
LOCAL lcUniqueName,lcUniqueFilePath,dStartDate,dEndDate, lnCountRec , Lfirst
LOCAL ARRAY items(1,2)
LOCAL lnDefItem, lnDefParId, lnDefTvrId,lnDefResursId,lnBarId ,lnBarId, stringWk, nRecResursLst, nTvrParId ,nTotal,nTotalItem
this.linload=.t.
* Çàãðóæàåì òàáëèöó ñ äàííûìè
lcUniqueName  = spGetProjectList(thisform.nFrmId,0,1,thisform.cZoom) &amp;&amp; dd ww

* Òàáëèöà äëÿ äèàãðàììû
USE IN SELECT('rv_ResursLst')
USE (lcUniqueName) IN 0 ALIAS rv_ResursLst
SELECT rv_ResursLst
CALCULATE MIN(rv_ResursLst.UseStart) TO dStartDate
CALCULATE MAX(rv_ResursLst.UseEnd) TO dEndDate
SELECT rv_ResursLst
lnCountRec  = RECCOUNT()
GO TOP
*SELECT DISTINCT FrmTypeID,FrmTypeNM,FrmTypeShortNM FROM rv_ResursLst INTO CURSOR tmpFrmType
this.Chart.FirstVisibleDate = dStartDate-1
SET DATE GERMAN
this.BeginUpdate()
nTotal = 0
WITH this.Items
STORE -99999 TO lnFrmTypeId ,lnDefParId ,lnDefResursId ,lnBarId
SCAN
		
		   IF rv_ResursLst.FrmTypeId &lt;&gt; lnFrmTypeId
				Lfirst = .t.	
			   	IF lnFrmTypeId &lt;&gt; -99999
			   	.ExpandItem(lnDefParId) = .T.
			   	ENDIF
			   	lnFrmTypeId = rv_ResursLst.FrmTypeId
			   	IF !INLIST(rv_ResursLst.FrmTypeId,-1, 8)
				   	lnDefParId  = .AddItem(ALLTRIM(rv_ResursLst.FrmTypeNM))
					.ItemFont(lnDefParId) = this.oItemFont
		 		   this.Font = this.oBarFont
				   	.AddBar(lnDefParId  , 'Project Summary',TTOC(dStartDate),TTOC(dEndDate))
			   	ENDIF
		   ENDIF
		  * SET STEP ON
		   this.Font = this.oItemFont
	       IF INLIST(rv_ResursLst.FrmTypeId,-1, 8) AND Lfirst
			        .DefaultItem = .InsertItem( , "", IIF(rv_ResursLst.FrmTypeId= 8,'Ïîñòóïëåíèÿ äåíåã',ALLTRIM(rv_ResursLst.TvrNm)))
					.ItemFont(.DefaultItem) = this.oItemFont
					Lfirst = .f.
					IF 	rv_ResursLst.FrmTypeId = -1
			        nTotalItem = .InsertItem( , "", "Îáùèé")
					.ItemFont(nTotalItem) = this.oItemFont
					ENDIF
	       ENDIF
		   this.Font = this.oBarFont
	       IF !INLIST(rv_ResursLst.FrmTypeId,-1, 8)
		        .DefaultItem = .InsertItem( lnDefParId , "", ALLTRIM(rv_ResursLst.TvrNm))
				.ItemFont(.DefaultItem) = this.oPodItemFont
		        lnDefItem = .DefaultItem
	 		   this.Font.Bold = .f.
			   .AddBar(.DefaultItem , this.namebar(rv_ResursLst.FrmTypeId,.F.) , TTOC(rv_ResursLst.UseStart),;
	    					TTOC(rv_ResursLst.UseEnd+1),rv_ResursLst.JrnUseId,STR(rv_ResursLst.TvrSumSale))
			   .DefineSummaryBars(lnDefParId ,"",rv_ResursLst.JrnUseId,"") &amp;&amp; .DefaultItem
	   		ELSE
				IF rv_ResursLst.FrmTypeId = -1
					.AddBar(.DefaultItem , this.namebar(IIF(rv_ResursLst.TvrSumSale&gt;0,0,-1),.F.) , TTOC(rv_ResursLst.UseStart),;
				    					TTOC(rv_ResursLst.UseEnd+1),RECNO(),STR(rv_ResursLst.TvrSumSale))
	    		 ELSE
				    .AddBar(.DefaultItem , this.namebar(rv_ResursLst.FrmTypeId,.F.) , TTOC(rv_ResursLst.UseStart),;
	    					TTOC(rv_ResursLst.UseEnd+1),RECNO(),STR(rv_ResursLst.TvrSumSale))
	    		ENDIF
				IF rv_ResursLst.FrmTypeId =-1
				   nTotal = rv_ResursLst.TvrSumSale + nTotal
				   .AddBar(nTotalItem , this.namebar(IIF(nTotal&gt;0,0,-1),.F.) , TTOC(rv_ResursLst.UseStart),;
	    					TTOC(rv_ResursLst.UseEnd+1),RECNO()+10,STR(nTotal))
				ENDIF
	       ENDIF
		   REPLACE ItemId WITH .DefaultItem NEXT 1 IN rv_ResursLst
ENDSCAN
	IF lnFrmTypeId &lt;&gt; -99999
	.ExpandItem(lnDefParId) = .T.
	ENDIF
ENDWITH
this.Font = this.oDefFont

RETURN


ENDPROC
PROCEDURE MouseDown
*** ActiveX Control Event ***
LPARAMETERS button, shift, x, y

With this
	local h, c, hit, llResult
.lnitemidu = .ItemFromPoint(-1, -1, c, hit)
If (.lnitemidu # 0)
.lnbaridu = .Chart.BarFromPoint(-1, -1)
If Empty(NVL(.lnbaridu,0))
RETURN .f.
EndIf
EndIf
ENDWITH


DODEFAULT(button, shift, x, y)

ENDPROC
PROCEDURE MouseUp
*** ActiveX Control Event ***
LPARAMETERS button, shift, x, y
With this
	local h, c, hit, llResult ,nDefCltTmp
.lnitemid = .ItemFromPoint(-1, -1, c, hit)
If (.lnitemid # 0)
.lnbarid = .Chart.BarFromPoint(-1, -1)
*** thisform.wkStile.optCopy.Value=1 AND
		IF ISNULL(.lnbarid) AND !ISNULL(.lnbaridu) ;
			AND (.lnitemid&lt;&gt;.lnitemidu) ;
			AND MESSAGEBOX('Ñêîïèðîâàòü áðîíü?',4+0+32,'Êîïîâàíèå äîêóìåíòîâ') = 6
		     SELECT rv_ResursJrn
		     LOCATE FOR rv_ResursJrn.BarId = .lnbaridu
		     IF !FOUND()
		     	RETURN .f.
		     ENDIF
		     lStart = NVL(rv_ResursJrn.UseStart ,{})
		     lEnd   = NVL(rv_ResursJrn.UseEnd,{})
		    .lCopy=.t.
		    nDefCltTmo = thisform.nDefClt
		    thisform.nDefClt = rv_ResursJrn.PointIspCl
			.createBar(.lnitemid,lStart ,lEnd   )
		    thisform.nDefClt = nDefCltTmo
			.lCopy=.f.
		ENDIF
If Empty(NVL(.lnbarid,0))
RETURN .f.
EndIf
EndIf
ENDWITH


DODEFAULT(button, shift, x, y)

ENDPROC
PROCEDURE namebar
LPARAMETERS lnFrmTypeId,llFrmIsPayed
** StartDate, EndDate, ControlDate
cntPar =  PCOUNT()
IF cntPar &lt;2
llFrmIsPayed = .f.
ENDIF
LOCAL lcNameBar
	DO CASE
	   CASE lnFrmTypeId = 3	&amp;&amp; - ìàòåðèàëû
	       lcNameBar = 'Task'
	   CASE lnFrmTypeId = 15	&amp;&amp; - ðàáîòû
	       lcNameBar = 'preTask'
	   CASE lnFrmTypeId = 8	&amp;&amp; - äåíüãè
	       lcNameBar = 'garTask'
	       llFrmIsPayed = .t.

	   CASE lnFrmTypeId = 0	&amp;&amp; - ïîëîæèòåëüíûé ðåçóëüòàò - çåëåíûé
	       lcNameBar = 'GreenTask'
	       llFrmIsPayed = .t.

	   CASE lnFrmTypeId = -1	&amp;&amp; - îòðèöàòåëüíûé ðåçóëüòàò êðàñíû
	       lcNameBar = 'RedTask'
	       llFrmIsPayed = .t.

	   OTHERWISE
	       lcNameBar = 'Task'
*	       lcNameBar = 'LiveTask'
	         ** 'PRed'   &amp;&amp;
ENDCASE
*IF llFrmIsPayed
lcNameBar= lcNameBar + '%PRed'	&amp;&amp; - ïðîèçâåäåíà îïëàòà
*ENDIF
RETURN lcNameBar
ENDPROC
PROCEDURE OversizeChanged
*** ActiveX Control Event ***
LPARAMETERS horizontal, newval
DODEFAULT(horizontal, newval)
ENDPROC
PROCEDURE OverviewZoom
*** ActiveX Control Event ***
WAIT WINDOW NOWAIT 'Ïîëó÷àåì äàííûå ñ ñåðâåðà ...'
WITH This.Chart
DO CASE
	CASE .UnitScale = 256  &amp;&amp; exWeek
	   thisform.cZoom = 'ww'
	   this.nCountUnits  = 14
	   * .Zoom(.NextDate(.FirstVisibleDate,4096,-5), .NextDate(.FirstVisibleDate, 4096,25), .t.) &amp;&amp; exWeek
	CASE .UnitScale = 4096  &amp;&amp; exDay
	   thisform.cZoom = 'dd'
	   this.nCountUnits  = 24
	   * .Zoom(.NextDate(.FirstVisibleDate,4096,-2), .NextDate(.FirstVisibleDate, 4096,20), .t.) &amp;&amp; exWeek
	CASE .UnitScale = 65536  &amp;&amp; exHour
	CASE .UnitScale = 16  &amp;&amp; exMonth
	   thisform.cZoom = 'mm'
	   this.nCountUnits  = 12
	*.Zoom(.NextDate(.FirstVisibleDate,65536,-3), .NextDate(.FirstVisibleDate, 65536,12), .t.) &amp;&amp; exWeek
	OTHERWISE
	*.Zoom(.NextDate(.FirstVisibleDate,4096,-2), .NextDate(.FirstVisibleDate, 4096,7), .t.) &amp;&amp; exWeek
ENDCASE
.UnitWidth = .PaneWidth(1)/ this.nCountUnits  &amp;&amp;55 &amp;&amp;70
ENDWITH
thisform.ReLoader()

DODEFAULT()
WAIT CLEAR
RETURN


SELECT rv_ResursJrn
LOCATE ALL FOR rv_ResursJrn.JrnUseId = this.lnbarid
this.beginUpdate()
WITH This.Chart



	IF FOUND() AND !EMPTY(rv_ResursJrn.UseStart)
		.FirstVisibleDate = rv_ResursJrn.UseStart-60*60
		ELSE
		.FirstVisibleDate = DATE()-2
	ENDIF
*WAIT WINDOW this.Chart.UnitScale
**** 256 - íåäåëè, 4096 - äíè, 65536 - ÷àñû

DO CASE
	CASE .UnitScale = 256  &amp;&amp; exWeek
	    .Zoom(.NextDate(.FirstVisibleDate,4096,-5), .NextDate(.FirstVisibleDate, 4096,25), .t.) &amp;&amp; exWeek
	CASE .UnitScale = 4096  &amp;&amp; exDay
	    .Zoom(.NextDate(.FirstVisibleDate,4096,-2), .NextDate(.FirstVisibleDate, 4096,20), .t.) &amp;&amp; exWeek
	CASE .UnitScale = 65536  &amp;&amp; exHour
	.Zoom(.NextDate(.FirstVisibleDate,65536,-3), .NextDate(.FirstVisibleDate, 65536,12), .t.) &amp;&amp; exWeek
	OTHERWISE
	.Zoom(.NextDate(.FirstVisibleDate,4096,-2), .NextDate(.FirstVisibleDate, 4096,7), .t.) &amp;&amp; exWeek
ENDCASE
	.UnitWidth = .PaneWidth(1)/ this.nCountUnits  &amp;&amp;55 &amp;&amp;70
ENDWITH
DODEFAULT()
this.EndUpdate()
RETURN


ENDPROC
PROCEDURE timescale
DODEFAULT()
LOCAL s
WITH this
.BeginUpdate
.SingleSel = .F.
s = "gBJJgBAIDAAGAAEAAQhYAf8Pf4hh0QihCJo2AEZjQAjEZFEaIEaEEaAIAkcbk0olUrlktl0vmExmUzmk1m03nE5nU7nk9n0/oFBoVDolFo1HpFJpVLplNp1PqFRqVTq"
s=s+"lVq1XrFZrVbrldr1fsFhsVjslls1ntFptVrtltt1vuFxuVzul1u13vF5vV7vl9v1BAmBhOCwMKwuDw2ExWJxmIx2HyGLx+SyONyuTy2UzWZzmYz2X0Gbx1kUigUAAMwzG"
s=s+"eo1Ws1ZV2Go1IAL+1ACZMxm2+52W63Ov2Op1fC13F0un4nJ1vE2BV2XD2e/4vK4fL63V1bMTKZ5/d2pf3vh6Xj2ff3e63G683S5vF0mmAD4+Xx+bA+wAeP5/H6a/9+h8P2"
s=s+"eIAGZAiHHYZkDQQ7TuH/Ap4GUUzjPgiCJn+AD7GBAMNQJBD8wFDwAFlEUExJBaHQdCDixM+UARYABuxg/8ZQ5DUQRpEEbQKf8DxPBDiPe08KRdDEZHVIwANU1YRSWAALSdJ"
s=s+"snxpHcFO3HsrOI48Ky1IkKQpERZAA9sjHVC77ynEsqwbBE1RVNKHgAQ04yQ1skvDOJDRkZc9ABJYRT5Jk+z/P0pR49sgQHAsaUVApx0aAD+mvOclSZIkYG7MsMxNTUqyw+F"
s=s+"FwVRNQwRSwACFUwADvVNHv9IlNu5V02u5UjzVMIUQxHMYABzXdUVVRpxgBXM60DX9MQHTjWrJE0uzfGkXRdXNa0FYMjxBM8vxJM7iWXN8KSlbs31zWlT1Ja0eWxM9tNbbkL"
s=s+"UhY1mQtaU62hI9hyZUl0x5H6x3ZLVvwtekyWlYlHXNBF0R5dTszdC1vR1cELVJO9JABLODVvMF8x9deGS1fE3yJXYc4pgOKUDfGE31ZN+Srd13U/VdI1y9uCWBPRl2NE1sW"
s=s+"xbeWv9l2f6DSNSXdkTaNtd1WyrncR567mgaHGJLanMLY2laVc2FOjW1JpTuX2sV0YhmMtQpXLct1msZRBLmU421exYbN93XgAFixA9s61ztkzbc4u47LHmb6O8ExSPs0j6N"
s=s+"Otyv1hSy8BCm6bHs7eUDXMXb5DOLuJyG5v9CjzWLCkszrqZLS2+/NtbwEQdFN9sPbLPEYFU/Fxj1TV2U7WyahslSdM8O9SPGkieK+8iW33fe1JXNUjvqrnWlo1A2lUnieO+"
s=s+"/k1lGMs7RjDwvNiciedUtT6Nd3B+RlaxQJBmx8luULWLLPqxjZ769S/UQe1svPUi6M+D5DzN5a2athyHX9H6f43VIjE3yMTbqrlbB5l3OYgU+ssL7X+rtc+2Nj7AD5vwRkk"
s=s+"SCyAoFvvg6/FaiZIIuHbGv9DRxEuQeRjC2FkKH/pvRcs4+b+4MFgH+mmISDIhrHN0dqI5uIjRLGYbOJp2YnRRihAaIsQYiRXIdFVKsSImRKiegOKUYIpxZiwg2MsWokxpjF"
s=s+"Gs7UY4vxvNmWSKwAEHoRjrHRFMZkToMd3HqOcf4lRBN1IKLMg4vGzjnHeRUeY+yNj5GeIkhpJSFkpF+RKKZFoRj9I6PcZJKSElBIGUUR44ljkBJCT0gI1RclZIeN0YZLRal"
s=s+"RKqLsq5XRslhIiWUqY0S1l9HCV8YyyEWB8SuYpHiQEiJIAAkpKJmk4QoX8pJFE3zSKCQEA="
.Images(s)
s="gBJJgBAICAAGAAEAAQhYAf8Pf4hh0QihCJo2AEZjQAjEZFEaIEaEEaAIAkcbk0olUrlktl0vmExmUzmk1m03nE5nU7nk9n0/oFBoVDolFo1HpFJpVLplNp1PqFRqVTqlVq1XrF"
s=s+"ZrVbrldr1fsFhsVjslls1ntFptVrtltt1vuFxuVzul1u13vF5vV7vl9v1/wGBwWDwmFw2HxGJxWLxmNx2PyGRyWTymVy2XzGZzWbzmdz2f0Gh0WjwEWH0r08ekEikgAkso184iG"
s=s+"kicPjcU2+zjW43e6jO8jL+b79X8bfif48bfAffgP43IT8b4XE3O23vW3++2r/6vcjUB"
.Images(s)

**'Uncomment it if you are running Windows XP
** .BackColorHeader = 33554432
WITH .Chart
.LevelCount = 2
** Çäåñü ìû îòêðûâàåì èëè çàêðûâàåì èêîíêè Zoom
		.Label(0) = ""  &amp;&amp; exYear
		.Label(1) = ""  &amp;&amp; exHalfYear
		.Label(2) = ""  &amp;&amp; exQuarterYear
*		.Label(16) = ""  &amp;&amp; exMonth
		.Label(17) = ""  &amp;&amp; exThirdMonth
*		.Label(256) = ""  &amp;&amp; exWeek
*		.Label(4096  ) = ""  &amp;&amp; exDay
		.Label(65536  ) = ""  &amp;&amp; exHour
		.Label(1048576) = ""  &amp;&amp; exMinute
		.Label(16777216) = ""  &amp;&amp; exSecond
		.Level(1).DrawGridLines = .t.
*	.OverviewZoomCaption =    "Year|1\2Year|1\4Year|&lt;img&gt;11&lt;/img&gt;|Third|&lt;img&gt;11&lt;/img&gt;|&lt;img&gt;10&lt;/img&gt;|&lt;img&gt;9&lt;/img&gt;|Min|Sec"
*	.OverviewZoomCaption =    "Ãîä|Ïîëóãîäèå|Êâàðòàë|Ìåñÿö|Äåñÿòêà|Íåäåëÿ|Äåíü|×àñ|Ìèí|Ñåê"
	.OverviewZoomCaption =    "Year|1\2Year|1\4Year|&lt;img&gt;11&lt;/img&gt;||&lt;img&gt;10&lt;/img&gt;|&lt;img&gt;9&lt;/img&gt;||Min|Sec"
	.LabelToolTip(4096) = "&lt;%dd%&gt; &lt;%m3%&gt;"
	.LabelToolTip(65536) = "&lt;%hh%&gt;:&lt;%nn%&gt; &lt;%dd%&gt; &lt;%m3%&gt;"
	.UnitWidth = .PaneWidth(1)/this.nCountUnits &amp;&amp;55 &amp;&amp;70
	
	.NonworkingHours = 16253183 - 524288 - 1048576 -2097152 + 256


	*.NonworkingDays = 0
	.NonworkingHoursColor = RGB(197,96,90)
	*.ShowNonworkingUnits = .F.
*.DrawDateTicker = .t.
ENDWITH
.EndUpdate
ENDWITH


ENDPROC
</methods>
		<objcode/>
		<ole>0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7////+////BQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAP7//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKBoMDDti8sBAwAAAMAAAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAjhQAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBAAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAQAAAAAAAAAAgAAAP7////+//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9BAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACQAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADUxMzk3OTE1AQAAgAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAABDAGwAYQBzADEfSM0lLVlHgD91LFaPU7dJTAEBAAAEAAQAEAAQAP////8hAP//////////Qk02AAAAAAAAADYAAAAoAAAAQABNH0jNJS1ZR4A/dSxWj1O3SUwBAQAABAAEABAAEAD/////IQD//////////0JNNgAAAAAAAAA2AAAAKAAAAEAAAAAQAAAAAQAgAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAGUAbAAgAEMAbABhAHMAcwAJAHsANgA1AEQANQA0ADAAQwAxAC0AOAA1ADkARQAtADQAOQBGADUALQBCADMANQBCAC0ANwAwADgAMgAxADgAMwAxAEYANwBBADcAfQAgAEMAOgBcAFcASQBOAEQATwBXAFMAXABzAHkAcwB0AGUAbQAzADIAXABiAHQAeABwAHAAYQBuAGUAbAAuAGQAbABsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE0fSM0lLVlHgD91LFaPU7dJTAEBAAAEAAQAEAAQAP////8hAP//////////Qk02AAAAAAAAADYAAAAoAAAAQAAAABAAAAABACAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEJNPgAAAAAAAAA+AAAAKAAAAEAAAAAQAAAAAQABAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAn28AAAM+AAAJAANS4wuRj84RneMAqgBLuFEBzAAAvAJEQgEACUFyaWFsIENZUgsA//8LAP//AwAAAAAAEwDr6+sAEwAIAACAEwAFAACAEwAIAACACwD//wMAAAAAAAMAAwAAAAMAEgAAAAMA/////wMAAAAAAAsA//8LAP//AwAAAAAACwAAAAMA/////wMA/////wMAAAAAAAMA/////wMAFgAAAAMAAAAAAAsAAAADAAAAAAALAP//EwAOAACAEwANAACAAwAAAAAAAwACAAAACwAAAAsAAAALAP//CQAAAAAAAAAAAAAAAAAAAAAAAwAwAAAAAwAAAAAAEwAxZf8AEwAPAACAEwAIAACAAwD/////EwAPAACAEwAIAACACQADUuMLkY/OEZ3jAKoAS7hRAcwAALwCREIBAAlBcmlhbCBDWVITAAAAAAALAAAACAAGAAAADQAKAAAACwD//wMAEgAAAAsA//8IAGQAAABhAGIAYwBkAGUAZgBnAGgAaQBqAGsAbABtAG4AbwBwAHEAcgBzAHQAdQB2AHcAeAB5AHoATAQ5BDIENAQwBDUENwQ6BDsEOAQ/BD4EPAREBEYEQgRLBEkEMQQ9BEMESgRBBAAACABkAAAAQQBCAEMARABFAEYARwBIAEkASgBLAEwATQBOAE8AUABRAFIAUwBUAFUAVgBXAFgAWQBaACwEGQQSBBQEEAQVBBcEGgQbBBgEHwQeBBwEJAQmBCIEKwQpBBEEHQQjBCoEIQQAAAsA//8IAAIAAAAAAAMA9AEAAAMAiBMAAAMAxAAAAAMAAwAAABMAEAAAgAsAAAAFAAAAAAAAAOA/CwAAAAsA//8TAA8AAIAJAAAAAAAAAAAAAAAAAAAAAAADADAAAAALAP//AwAAAAAACwAAAAgAAgAAAAAAEwAQAACAEwAQAACAEwAPAACAAwASAAAAAwCg////CwD//wMAAAAAAAsAAAADACjOl3wDAAAAAAALAP//CwAAAAsAAAATADFl/wADAAAAAAALAAAAAwAAAAAACAACAAAAAAADAP////8DAP////8DAP////8DAP////8LAAAACQADUuMLkY/OEZ3jAKoAS7hRAcwAAJABREIBAAlBcmlhbCBDWVILAP//AwD///8AAwAAAAAACwD//w==</ole>
		<ole2>OLEObject = C:\Windows\system32\ExG2antt.dll
</ole2>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1027434663</timestamp>
		<class>commandbutton</class>
		<classloc/>
		<baseclass>commandbutton</baseclass>
		<objname>cmdReload</objname>
		<parent>frmresfin</parent>
		<properties>Top = 603
Left = 250
Height = 25
Width = 100
Caption = "Îáíîâèò äàííûå"
ZOrderSet = 4
Name = "cmdReload"
</properties>
		<protected/>
		<methods>PROCEDURE Click
thisform.ReLoader()
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25L0SGZE5</uniqueid>
		<timestamp>1026403974</timestamp>
		<class>commandbutton</class>
		<classloc/>
		<baseclass>commandbutton</baseclass>
		<objname>cmdToday</objname>
		<parent>frmresfin</parent>
		<properties>Top = 603
Left = 352
Height = 25
Width = 78
FontBold = .T.
FontSize = 10
Caption = "Ñåãîäíÿ"
ZOrderSet = 5
Name = "cmdToday"
</properties>
		<protected/>
		<methods>PROCEDURE Click
with thisform.G2antt1
	.BeginUpdate
WITH .Chart
		IF .UnitScale =&lt; 4096
				.FirstVisibleDate = DATE()-2
			ELSE
				.FirstVisibleDate = DATETIME()-4*60*60
		ENDIF
ENDWITH
	.EndUpdate
endwith

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1031316584</timestamp>
		<class>shape</class>
		<classloc/>
		<baseclass>shape</baseclass>
		<objname>Shape1</objname>
		<parent>frmresfin</parent>
		<properties>Top = 601
Left = 433
Height = 13
Width = 85
BackColor = 138,244,244
ZOrderSet = 6
Name = "Shape1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1031316584</timestamp>
		<class>shape</class>
		<classloc/>
		<baseclass>shape</baseclass>
		<objname>Shape2</objname>
		<parent>frmresfin</parent>
		<properties>Top = 619
Left = 433
Height = 13
Width = 85
BackColor = 0,128,192
ZOrderSet = 7
Name = "Shape2"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0OUJQ9</uniqueid>
		<timestamp>1031316584</timestamp>
		<class>shape</class>
		<classloc/>
		<baseclass>shape</baseclass>
		<objname>Shape4</objname>
		<parent>frmresfin</parent>
		<properties>Top = 601
Left = 791
Height = 13
Width = 85
BackColor = 255,255,0
ZOrderSet = 8
Name = "Shape4"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25X0QUXS4</uniqueid>
		<timestamp>1031316584</timestamp>
		<class>label</class>
		<classloc/>
		<baseclass>label</baseclass>
		<objname>Label2</objname>
		<parent>frmresfin</parent>
		<properties>AutoSize = .T.
FontSize = 8
Caption = "- èòîãè"
Height = 16
Left = 522
Top = 601
Width = 37
ZOrderSet = 9
Name = "Label2"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_25X0QUXS5</uniqueid>
		<timestamp>1031316584</timestamp>
		<class>label</class>
		<classloc/>
		<baseclass>label</baseclass>
		<objname>Label3</objname>
		<parent>frmresfin</parent>
		<properties>AutoSize = .T.
FontSize = 8
Caption = "- ðàáîòû è ìàòåðèàëû"
Height = 16
Left = 522
Top = 618
Width = 117
ZOrderSet = 10
Name = "Label3"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1ON0L3DWH</uniqueid>
		<timestamp>1031316584</timestamp>
		<class>label</class>
		<classloc/>
		<baseclass>label</baseclass>
		<objname>Label4</objname>
		<parent>frmresfin</parent>
		<properties>AutoSize = .T.
FontSize = 8
Caption = "- äåíåæíûå ñðåäñòâà"
Height = 16
Left = 880
Top = 601
Width = 113
ZOrderSet = 11
Name = "Label4"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2DL11LO1J</uniqueid>
		<timestamp>1031316584</timestamp>
		<class>label</class>
		<classloc/>
		<baseclass>label</baseclass>
		<objname>Label1</objname>
		<parent>frmresfin</parent>
		<properties>AutoSize = .T.
FontSize = 8
Caption = "- îïëàòà ïðèíÿòà"
Height = 16
Left = 880
Top = 618
Width = 90
ZOrderSet = 12
Name = "Label1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2LT0Y9P5S</uniqueid>
		<timestamp>1031316584</timestamp>
		<class>olecontrol</class>
		<classloc/>
		<baseclass>olecontrol</baseclass>
		<objname>PrintGantt</objname>
		<parent>frmresfin</parent>
		<properties>Top = 600
Left = 1044
Height = 13
Width = 25
ZOrderSet = 13
Name = "PrintGantt"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole>0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7////+/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKBKNTDti8sBAwAAAAACAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGAEAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAA4AAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAGkAAAAAAAAAAwAAAP7///8GAAAABAAAAAUAAAAHAAAA/v////7///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8rDetNvW4iSpg1SKuc3ICIAAgAALkDAAC5AwAACAAsAAAAHwQ7BDAEPQQ4BEAEPgQyBDAEPQQ4BDUEIABEBDgEOAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAIAIAAAAQ2FwdGlvbgAeAAAASAAAAAAVAAAAz+vg7ejw7uLg7ejlIPTo7eDt8e7iEAAAAFBhZ2VPcmllbnQ9BDAEPQRBBD4EMgQAAAsAAAADAAEAAAADAAIAAAADAAAAAAADAAEAAAADAAIAAAAJAANS4wuRj84RneMAqgBLuFEBAQAAkAGghgEAD1RpbWVzIE5ldyBSb21hbgsA//8IAEgAAAAtADEALAAxADAAMAAsADEAMAAxACwAMQAwADIALAAtADEALAAxADAAMwAsAC0AMQAsADEAMAA0ACwALQAxACwAMQAwADUAAAAIAAIAAAAAAAgAEgAAADwAJQBhdGlvbgAJAAAASQoAAAACAAAACQAAAEFzU2NyZWVuAAUAAABMAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABhAGcAZQAlAD4AAAADAAEAAAALAP///////wEAEABgYRcAH8wCAAAAAADAAAAAAAAARi0ANQAGAEgAAAEMAA==</ole>
		<ole2>OLEObject = C:\Windows\system32\ExPrint.dll
</ole2>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2LT0Y9P5W</uniqueid>
		<timestamp>1026643626</timestamp>
		<class>commandbutton</class>
		<classloc/>
		<baseclass>commandbutton</baseclass>
		<objname>Command1</objname>
		<parent>frmresfin</parent>
		<properties>Top = 603
Left = 3
Height = 25
Width = 73
Caption = "Íà ïå÷àòü"
ZOrderSet = 14
Name = "Command1"
</properties>
		<protected/>
		<methods>PROCEDURE Click
with thisform.PrintGantt
	** thisform.g2ANTT1.Chart.EndPrintDate
	thisform.g2ANTT1.Chart.StartPrintDate = thisform.g2ANTT1.Chart.FirstVisibleDate
	thisform.g2ANTT1.Chart.EndPrintDate   = thisform.g2ANTT1.Chart.FirstVisibleDate + 300*24*60*60

	**thisform.g2ANTT1.Chart.FirstVisibleDate
	.Caption = 'Ðàáîòû è îïëàòû ïî ñîñòîÿíèþ íà '+ TTOC(DATETIME())+ '. C '+TTOC(thisform.g2ANTT1.Chart.StartPrintDate)+' ïî '+TTOC(thisform.g2ANTT1.Chart.EndPrintDate)
	.PrintExt = thisform.G2antt1.Object
	.Preview
endwith
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2MN0O16AU</uniqueid>
		<timestamp>1031316584</timestamp>
		<class>shape</class>
		<classloc/>
		<baseclass>shape</baseclass>
		<objname>Shape6</objname>
		<parent>frmresfin</parent>
		<properties>Top = 619
Left = 794
Height = 13
Width = 42
BackColor = 0,128,192
ZOrderSet = 15
Name = "Shape6"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2MN0O16AV</uniqueid>
		<timestamp>1031316584</timestamp>
		<class>shape</class>
		<classloc/>
		<baseclass>shape</baseclass>
		<objname>Shape7</objname>
		<parent>frmresfin</parent>
		<properties>Top = 619
Left = 830
Height = 13
Width = 43
BackColor = 255,255,0
ZOrderSet = 16
Name = "Shape7"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2DL11LO1L</uniqueid>
		<timestamp>1031316584</timestamp>
		<class>shape</class>
		<classloc/>
		<baseclass>shape</baseclass>
		<objname>Shape3</objname>
		<parent>frmresfin</parent>
		<properties>Top = 624
Left = 791
Height = 3
Width = 85
BorderStyle = 0
BackColor = 255,0,0
ZOrderSet = 17
Name = "Shape3"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>frmresfin</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
Arial, 1, 10, 6, 16, 13, 34, 3, 0
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
</VFPData>
