<?xml version = "1.0" encoding="UTF-8" standalone="yes"?>
<VFPData>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>Class</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname/>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>VERSION =   3.00</reserved1>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_15P0MR0MM</uniqueid>
		<timestamp>0</timestamp>
		<class>checkbox</class>
		<classloc/>
		<baseclass>checkbox</baseclass>
		<objname>chk</objname>
		<parent/>
		<properties>AutoSize = .T.
Caption = "chk"
_highlightobject = 
_highlightobjectcolor = RGB(0,0,128)
_highlightself = .F.
_highlightselfcolor = RGB(0,0,128)
textchecked = 
textunchecked = 
textchange = .F.
Name = "chk"
</properties>
		<protected/>
		<methods>PROCEDURE GotFocus
This.HighLight(.T.)
ENDPROC
PROCEDURE highlight
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE.VCX
* Class.Module....: CHK.HIGHLIGHT
* Called by.......: &lt;.GotFocus();.LostFocus()&gt;
* Parameters......: &lt;.T. - âêëþ÷åíèå ïîäñâåòêè; .F. - âûêëþ÷åíèå ïîäñâåòêè&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;protected/nouser/default&gt; Âêëþ÷åíèå/âûêëþ÷åíèå ïîäñâåòêè öâåòîì
*					ñàìîãî textbox-à è îáúåêòà, óêàçàííîãî â ñâîéñòâå ._HighLightObject.
*-------------------------------------------------------
LPARAMETERS	tlHighLightOn

*26.12.2003 18:51 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	loHighLightObject
*------------------------------------------------------------------------------

WITH THIS

*20.01.2004 18:00 -&gt;Ïðîâåäåì îïåðàöèè ñ ñîáîé
IF ._HighLightSelf
	IF tlHighLightOn
		.ForeColor = EVAL(._HighLightSelfColor)
	ELSE
		.ResetToDefault([ForeColor])
	ENDIF	
ENDIF
*------------------------------------------------------------------------------

*20.01.2004 18:00 -&gt;Ïðîâåäåì îïåðàöèþ ñ ïîäñâå÷èâàåìûìè îáúåêòàìè
IF !EMPTY(._HighLightObject)
	IF [;]$(._HighLightObject)
		lnHighLightObjectCount = OCCURS([;],._HighLightObject)+1
		FOR lnHighLightObjectCounter = 1 TO lnHighLightObjectCount
			lnStartPosition   = IIF(lnHighLightObjectCounter=1,1,AT([;],._HighLightObject,lnHighLightObjectCounter-1)+1)
			lnEndPosition     = IIF(lnHighLightObjectCounter=lnHighLightObjectCount,LEN(._HighLightObject)+1,AT([;],._HighLightObject,lnHighLightObjectCounter))
			lcHighLightObject = ALLTRIM(SUBSTR(._HighLightObject,lnStartPosition,lnEndPosition-lnStartPosition))
			loHighLightObject = EVAL(lcHighLightObject)
			IF tlHighLightOn
				loHighLightObject.ForeColor = EVAL(._HighLightObjectColor)
			ELSE
				loHighLightObject.ResetToDefault([ForeColor])
			ENDIF	
		ENDFOR
	ELSE		
		loHighLightObject = EVAL(._HighLightObject)
		IF tlHighLightOn
			loHighLightObject.ForeColor = EVAL(._HighLightObjectColor)
		ELSE
			loHighLightObject.ResetToDefault([ForeColor])
		ENDIF	
	ENDIF		
ENDIF	
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE Init
DODEFAULT()
This.TextChangeMethod()
ENDPROC
PROCEDURE InteractiveChange
This.TextChangeMethod()
This._HandleAnyChange()
ENDPROC
PROCEDURE LostFocus
This.HighLight(.F.)
ENDPROC
PROCEDURE ProgrammaticChange
This.TextChangeMethod()
This._HandleAnyChange()
ENDPROC
PROCEDURE Refresh
DODEFAULT()
This.TextChangeMethod()
ENDPROC
PROCEDURE textchangemethod
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: CHK.TEXTCHANGEMETHOD
* Called by.......: &lt;.Init(); InteractiveChange(); ProgrammaticChange()&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;protected/nouser/default&gt; Èçìåíåíèå .Caption â
*					çàâèñèìîñòè	îò çíà÷åíèÿ ýëåìåíòà.
*-------------------------------------------------------
WITH This

*02.02.2004 11:27 -&gt;Ìåíÿåì .Caption, òîëüêî åñëè ðàçðåøåíî ôëàãîì .TextChange
IF .TextChange
	IF TYPE([This.Value])==[N]
		.Caption = IIF(.Value=1,.TextChecked,.TextUnChecked)
	ELSE
		.Caption = IIF(.Value,.TextChecked,.TextUnChecked)
	ENDIF	
ENDIF
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3>_highlightobject &lt;public/design&gt; Èìÿ îáúåêòà, êîòîðûé äîëæåí ïîäñâå÷èâàòüñÿ ïðè ïîëó÷åíèè îáúåêòîì ôîêóñà.
_highlightobjectcolor &lt;public/design&gt; Öâåò äëÿ ïîäñâåòêè îáúåêòà, çàäàííîãî ñâîéñòâîì ._HighLightObject. Ôîðìàò: ñèìâîëüíîå âûðàæåíèå, äàþùåå ïðè EVAL() ÷èñëåííîå âûðàæåíèå öâåòà â äèàïàçîíå îò 0 äî 16777215. Ïî óìîë÷àíèþ RGB(0,0,128).
_highlightself &lt;public/design&gt; Ôëàã ðàçðåøåíèÿ/çàïðåùåíèÿ ïîäñâåòêè îáúåêòà öâåòîì ïðè ïîëó÷åíèè ôîêóñà.
_highlightselfcolor &lt;public/design&gt; Öâåò äëÿ ïîäñâåòêè îáúåêòà öâåòîì ïðè ïîëó÷åíèè ôîêóñà. Ôîðìàò: ñèìâîëüíîå âûðàæåíèå, äàþùåå ïðè EVAL() ÷èñëåííîå âûðàæåíèå öâåòà â äèàïàçîíå îò 0 äî 16777215. Ïî óìîë÷àíèþ RGB(255,255,0).
textchecked &lt;public/design&gt; Òåêñò, îòîáðàæàþùèéñÿ â .Caption ýëåìåíòà, ïðè .Value=1.
textunchecked &lt;public/design&gt; Òåêñò, îòîáðàæàþùèéñÿ â .Caption ýëåìåíòà, ïðè .Value=0.
textchange &lt;public/design&gt; Ôëàã èçìåíÿòü/íå èçìåíÿòü çíà÷åíèå .Caption, íà òåêñò èç ñâîéñòâ .TextChecked/.TextUnChecked.
*_handleanychange &lt;public/user/nodefault&gt; Îáðàáîòêà èçìåíåíèÿ çíà÷åíèÿ îáúåêòà.
*highlight &lt;protected/nouser/default&gt; Âêëþ÷åíèå/âûêëþ÷åíèå ïîäñâåòêè öâåòîì ñàìîãî textbox-à è îáúåêòà, óêàçàííîãî â ñâîéñòâå ._HighLightObject.
*textchangemethod &lt;protected/nouser/default&gt; Èçìåíåíèå .Caption â çàâèñèìîñòè îò çíà÷åíèÿ ýëåìåíòà.
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>chk</objname>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1E21009K8</uniqueid>
		<timestamp>0</timestamp>
		<class>combobox</class>
		<classloc/>
		<baseclass>combobox</baseclass>
		<objname>cmb</objname>
		<parent/>
		<properties>Height = 23
Width = 100
_highlightobject = 
_highlightobjectcolor = RGB(0,0,128)
_highlightself = .T.
_highlightselfcolor = RGB(255,255,0)
Name = "cmb"
</properties>
		<protected>highlight
</protected>
		<methods>PROCEDURE GotFocus
This.HighLight(.T.)
ENDPROC
PROCEDURE highlight
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE.VCX
* Class.Module....: CMB.HIGHLIGHT
* Called by.......: &lt;.GotFocus();.LostFocus()
* Parameters......: &lt;.T. - âêëþ÷åíèå ïîäñâåòêè; .F. - âûêëþ÷åíèå ïîäñâåòêè&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;protected/nouser/default&gt; Âêëþ÷åíèå/âûêëþ÷åíèå ïîäñâåòêè öâåòîì
*					ñàìîãî combobox-à è îáúåêòà, óêàçàííîãî â ñâîéñòâå ._HighLightObject.
*-------------------------------------------------------
LPARAMETERS	tlHighLightOn

*26.12.2003 18:51 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	loHighLightObject
*------------------------------------------------------------------------------

WITH THIS

*20.01.2004 18:00 -&gt;Ïðîâåäåì îïåðàöèè ñ ñîáîé
IF ._HighLightSelf
	IF tlHighLightOn
		IF .ReadOnly
			.DisabledBackColor = EVAL(._HighLightSelfColor)
		ELSE	
			.BackColor = EVAL(._HighLightSelfColor)
		ENDIF
	ELSE
		IF .ReadOnly
			.ResetToDefault([DisabledBackColor])
		ELSE
			.ResetToDefault([BackColor])
		ENDIF	
	ENDIF	
ENDIF
*------------------------------------------------------------------------------

*20.01.2004 18:00 -&gt;Ïðîâåäåì îïåðàöèþ ñ ïîäñâå÷èâàåìûìè îáúåêòàìè
IF !EMPTY(._HighLightObject)
	IF [;]$(._HighLightObject)
		lnHighLightObjectCount = OCCURS([;],._HighLightObject)+1
		FOR lnHighLightObjectCounter = 1 TO lnHighLightObjectCount
			lnStartPosition   = IIF(lnHighLightObjectCounter=1,1,AT([;],._HighLightObject,lnHighLightObjectCounter-1)+1)
			lnEndPosition     = IIF(lnHighLightObjectCounter=lnHighLightObjectCount,LEN(._HighLightObject)+1,AT([;],._HighLightObject,lnHighLightObjectCounter))
			lcHighLightObject = ALLTRIM(SUBSTR(._HighLightObject,lnStartPosition,lnEndPosition-lnStartPosition))
			loHighLightObject = EVAL(lcHighLightObject)
			IF tlHighLightOn
				loHighLightObject.ForeColor = EVAL(._HighLightObjectColor)
			ELSE
				loHighLightObject.ResetToDefault([ForeColor])
			ENDIF	
		ENDFOR
	ELSE		
		loHighLightObject = EVAL(._HighLightObject)
		IF tlHighLightOn
			loHighLightObject.ForeColor = EVAL(._HighLightObjectColor)
		ELSE
			loHighLightObject.ResetToDefault([ForeColor])
		ENDIF	
	ENDIF		
ENDIF	
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE LostFocus
This.HighLight(.F.)
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3>_highlightobject &lt;public/design&gt; Èìÿ îáúåêòà, êîòîðûé äîëæåí ïîäñâå÷èâàòüñÿ ïðè ïîëó÷åíèè îáúåêòîì ôîêóñà.
_highlightobjectcolor &lt;public/design&gt; Öâåò äëÿ ïîäñâåòêè îáúåêòà, çàäàííîãî ñâîéñòâîì ._HighLightObject. Ôîðìàò: ñèìâîëüíîå âûðàæåíèå, äàþùåå ïðè EVAL() ÷èñëåííîå âûðàæåíèå öâåòà â äèàïàçîíå îò 0 äî 16777215. Ïî óìîë÷àíèþ RGB(0,0,128).
_highlightself &lt;public/design&gt; Ôëàã ðàçðåøåíèÿ/çàïðåùåíèÿ ïîäñâåòêè îáúåêòà öâåòîì ïðè ïîëó÷åíèè ôîêóñà.
_highlightselfcolor &lt;public/design&gt; Öâåò äëÿ ïîäñâåòêè îáúåêòà öâåòîì ïðè ïîëó÷åíèè ôîêóñà. Ôîðìàò: ñèìâîëüíîå âûðàæåíèå, äàþùåå ïðè EVAL() ÷èñëåííîå âûðàæåíèå öâåòà â äèàïàçîíå îò 0 äî 16777215. Ïî óìîë÷àíèþ RGB(255,255,0).
*highlight &lt;protected/nouser/default&gt; Âêëþ÷åíèå/âûêëþ÷åíèå ïîäñâåòêè öâåòîì ñàìîãî combobox-à è îáúåêòà, óêàçàííîãî â ñâîéñòâå ._HighLightObject.
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>cmb</objname>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_RZW0WEQKI</uniqueid>
		<timestamp>0</timestamp>
		<class>container</class>
		<classloc/>
		<baseclass>container</baseclass>
		<objname>cnt</objname>
		<parent/>
		<properties>_allowresize = .F.
_allowresizecontent = .F.
Name = "cnt"
</properties>
		<protected/>
		<methods>PROCEDURE getprop
LPARAMETERS tñPropertyName
RETURN EVAL([This.]+tcPropertyName)
ENDPROC
PROCEDURE setenabled
LPARAMETERS tlIsEnabled
This.SetAll([Enabled],tlIsEnabled)
This.Enabled = tlIsEnabled
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3>_allowresize &lt;public/design&gt; Ôëàã ðàçðåøåíèÿ/çàïðåùåíèÿ èçìåíåíèÿ ðàçìåðîâ îáúåêòà ïðè èçìåíåíèè ðàçìåðà ôîðìû.
_allowresizecontent &lt;public/design&gt; Ôëàã ðàçðåøåíèÿ/çàïðåùåíèÿ èçìåíåíèÿ ðàçìåðîâ äî÷åðíèõ îáúåêòîâ ïðè èçìåíåíèè ðàçìåðà ôîðìû.
*setenabled &lt;public/nouser/default&gt; Óñòàíîâêà çíà÷åíèÿ ñâîñòâà Enabled äëÿ âñåõ îáúåêòîâ âíóòðè êîíòåéíåðà è ñàìîãî êîíòåéíåðà. Çíà÷åíèå ñâîéñòâà (.T./.F.) ïåðåäàåòñÿ â êà÷åñòâå ïàðàìåòðà.
*getprop &lt;public/nouser/default&gt; ×òåíèå çíà÷åíèÿ protected ñâîéñòâà. Èìÿ ñâîéñòâà óêàçûâàåòñÿ â êà÷åñòâå ïàðàìåòðà.
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7>Áàçîâûé êëàññ Container</reserved7>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>cnt</objname>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_S071370H6</uniqueid>
		<timestamp>0</timestamp>
		<class>custom</class>
		<classloc/>
		<baseclass>custom</baseclass>
		<objname>cst</objname>
		<parent/>
		<properties>Name = "cst"
</properties>
		<protected/>
		<methods>PROCEDURE getprop
LPARAMETERS tcProperty
RETURN EVAL("THIS." + tcProperty)
ENDPROC
PROCEDURE release
RELEASE THIS
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3>*release &lt;public/nouser/default&gt; Óäàëÿåò îáúåêò èç ïàìÿòè.
*getprop &lt;public/nouser/default&gt; ×òåíèå çíà÷åíèÿ protected ñâîéñòâà. Èìÿ ñâîéñòâà óêàçûâàåòñÿ â êà÷åñòâå ïàðàìåòðà.
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7>Áàçîâûé êëàññ Custom</reserved7>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>cst</objname>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18G1CL3W4</uniqueid>
		<timestamp>0</timestamp>
		<class>editbox</class>
		<classloc/>
		<baseclass>editbox</baseclass>
		<objname>edt</objname>
		<parent/>
		<properties>Height = 53
Width = 100
_usedbfieldproperty = .F.
_highlightobject = 
_highlightobjectcolor = RGB(0,0,128)
_highlightself = .T.
_highlightselfcolor = RGB(255,255,0)
_rightclickmenu = txtMenu.mpr
Name = "edt"
</properties>
		<protected>highlight
dbfieldpropertyget
</protected>
		<methods>PROCEDURE dbfieldpropertyget
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: TXT.DBFIELDPROPERTYGET
* Called by.......: &lt;.Init().
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;protected/nouser/default&gt; ×òåíèå èç áàçû äàííûõ òåêóùèõ óñòàíîâîê
*					äëÿ ïîëÿ, óêàçàííîãî â ControlSource textbox-à.
*-------------------------------------------------------
WITH This

*28.12.2003 14:02 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcOldDatabase, ;
		lcOldAlias, ;
		lcControlSource, ;
		lcAlias, ;
		lcField, ;
		lcDatabase, ;
		lcSourceName, ;
		lcFormat, ;
		lcInputMask
lcOldDatabase 	= SET([DATABASE])		
*------------------------------------------------------------------------------

*26.12.2003 19:10 -&gt;Êàêèå-ëèáî ñâîéñòâà ÷èòàåì è ìåíÿåì òîëêî åñëè ðàçðåøåíî ôëàãîì ._UseDBFieldProperty
IF ._UseDBFieldProperty AND !EMPTY(.ControlSource)
	lcControlSource = ALLTRIM(.ControlSource)
	lcAlias = IIF([.]$lcControlSource,LEFT(lcControlSource,AT([.],lcControlSource)-1),ALIAS())
	lcField = IIF([.]$lcControlSource,SUBSTR(lcControlSource,AT([.],lcControlSource)+1),lcControlSource)
	***
	IF !EMPTY(lcAlias) AND USED(lcAlias)
		lcDatabase  = ALLTRIM(CURSORGETPROP([DATABASE],lcAlias))
		lcDatabase  = IIF([\]$lcDatabase,SUBSTR(lcDatabase,RAT([\],lcDatabase)+1),lcDatabase)
		lcDatabase  = IIF([.]$lcDatabase,SUBSTR(lcDatabase,1,RAT([.],lcDatabase)-1),lcDatabase)
		lcSourceName = ALLTRIM(CURSORGETPROP([SOURCENAME],lcAlias))
		IF !EMPTY(lcDatabase) AND DBUSED(lcDatabase)
			IF !(lcOldDatabase==lcDatabase)
				SET DATABASE TO (lcDatabase)
			ENDIF	
			lcFormat	= DBGETPROP(lcSourceName+[.]+lcField,[Field],[Format])
			lcInputMask	= DBGETPROP(lcSourceName+[.]+lcField,[Field],[InputMask])
			.Format		= IIF(!EMPTY(.Format),.Format,lcFormat)
			.InputMask	= IIF(!EMPTY(.InputMask),.InputMask,lcInputMask)
		ENDIF				
	ENDIF
	***
	IF TYPE(.ControlSource) == [C]
		.MaxLength = LEN(EVAL(.ControlSource))
	ENDIF	
ENDIF	
*------------------------------------------------------------------------------

*28.12.2003 14:42 -&gt;Âîññòàíîâèì òåêóùóþ ÁÄ
IF !EMPTY(lcOldDatabase) AND DBUSED(lcOldDatabase) AND lcOldDatabase#SET([DATABASE])
	SET DATABASE TO (lcOldDatabase)
ENDIF
*------------------------------------------------------------------------------	

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE GotFocus
This.HighLight(.T.)
ENDPROC
PROCEDURE highlight
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE.VCX
* Class.Module....: TXT.HIGHLIGHT
* Called by.......: &lt;.GotFocus();.LostFocus()&gt;
* Parameters......: &lt;.T. - âêëþ÷åíèå ïîäñâåòêè; .F. - âûêëþ÷åíèå ïîäñâåòêè&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;protected/nouser/default&gt; Âêëþ÷åíèå/âûêëþ÷åíèå ïîäñâåòêè öâåòîì
*					ñàìîãî textbox-à è îáúåêòà, óêàçàííîãî â ñâîéñòâå ._HighLightObject.
*-------------------------------------------------------
LPARAMETERS	tlHighLightOn

*26.12.2003 18:51 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	loHighLightObject
*------------------------------------------------------------------------------

WITH THIS

*20.01.2004 18:00 -&gt;Ïðîâåäåì îïåðàöèè ñ ñîáîé
IF ._HighLightSelf
	IF tlHighLightOn
		IF .ReadOnly
			.DisabledBackColor = EVAL(._HighLightSelfColor)
		ELSE	
			.BackColor = EVAL(._HighLightSelfColor)
		ENDIF
	ELSE
		IF .ReadOnly
			.ResetToDefault([DisabledBackColor])
		ELSE
			.ResetToDefault([BackColor])
		ENDIF	
	ENDIF	
ENDIF
*------------------------------------------------------------------------------

*20.01.2004 18:00 -&gt;Ïðîâåäåì îïåðàöèþ ñ ïîäñâå÷èâàåìûìè îáúåêòàìè
IF !EMPTY(._HighLightObject)
	IF [;]$(._HighLightObject)
		lnHighLightObjectCount = OCCURS([;],._HighLightObject)+1
		FOR lnHighLightObjectCounter = 1 TO lnHighLightObjectCount
			lnStartPosition   = IIF(lnHighLightObjectCounter=1,1,AT([;],._HighLightObject,lnHighLightObjectCounter-1)+1)
			lnEndPosition     = IIF(lnHighLightObjectCounter=lnHighLightObjectCount,LEN(._HighLightObject)+1,AT([;],._HighLightObject,lnHighLightObjectCounter))
			lcHighLightObject = ALLTRIM(SUBSTR(._HighLightObject,lnStartPosition,lnEndPosition-lnStartPosition))
			loHighLightObject = EVAL(lcHighLightObject)
			IF tlHighLightOn
				loHighLightObject.ForeColor = EVAL(._HighLightObjectColor)
			ELSE
				loHighLightObject.ResetToDefault([ForeColor])
			ENDIF	
		ENDFOR
	ELSE		
		loHighLightObject = EVAL(._HighLightObject)
		IF tlHighLightOn
			loHighLightObject.ForeColor = EVAL(._HighLightObjectColor)
		ELSE
			loHighLightObject.ResetToDefault([ForeColor])
		ENDIF	
	ENDIF		
ENDIF	
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE Init
This.DBFieldPropertyGet()
ENDPROC
PROCEDURE InteractiveChange
This._HandleAnyChange()
ENDPROC
PROCEDURE LostFocus
This.HighLight(.F.)
ENDPROC
PROCEDURE ProgrammaticChange
This._HandleAnyChange()
ENDPROC
PROCEDURE RightClick
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: TXT.RIGHTCLICK
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;sysevent&gt; Âûçîâ êîíòåêñòíîãî ìåíþ îïðåäåëåííîãî â ñâîéñòâå _RightClickMenu
*-------------------------------------------------------
DO (This._RightClickMenu)
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3>_usedbfieldproperty &lt;public/design&gt; Ôëàã èñïîëüçîâàòü/íåèñïîëüçîâàòü ñâîéñòâà ïîëÿ, îïðåäåëåííûå â áàçå äàííûõ.
_highlightobject &lt;public/design&gt; Èìÿ îáúåêòà, êîòîðûé äîëæåí ïîäñâå÷èâàòüñÿ ïðè ïîëó÷åíèè îáúåêòîì ôîêóñà.
_highlightobjectcolor &lt;public/design&gt; Öâåò äëÿ ïîäñâåòêè îáúåêòà, çàäàííîãî ñâîéñòâîì ._HighLightObject. Ôîðìàò: ñèìâîëüíîå âûðàæåíèå, äàþùåå ïðè EVAL() ÷èñëåííîå âûðàæåíèå öâåòà â äèàïàçîíå îò 0 äî 16777215. Ïî óìîë÷àíèþ RGB(0,0,128).
_highlightself &lt;public/design&gt; Ôëàã ðàçðåøåíèÿ/çàïðåùåíèÿ ïîäñâåòêè îáúåêòà öâåòîì ïðè ïîëó÷åíèè ôîêóñà.
_highlightselfcolor &lt;public/design&gt; Öâåò äëÿ ïîäñâåòêè îáúåêòà öâåòîì ïðè ïîëó÷åíèè ôîêóñà. Ôîðìàò: ñèìâîëüíîå âûðàæåíèå, äàþùåå ïðè EVAL() ÷èñëåííîå âûðàæåíèå öâåòà â äèàïàçîíå îò 0 äî 16777215. Ïî óìîë÷àíèþ RGB(255,255,0).
_rightclickmenu &lt;public/design&gt; Ìåíþ, âûçûâàåìîå ïðè îáðàáîòêå ñîáûòèÿ RightClick(). 
*highlight &lt;protected/nouser/default&gt; Âêëþ÷åíèå/âûêëþ÷åíèå ïîäñâåòêè öâåòîì ñàìîãî textbox-à è îáúåêòà, óêàçàííîãî â ñâîéñòâå ._HighLightObject.
*_handleanychange &lt;public/user/nodefault&gt; Îáðàáîòêà èçìåíåíèÿ çíà÷åíèÿ îáúåêòà.
*dbfieldpropertyget &lt;protected/nouser/default&gt; ×òåíèå èç áàçû äàííûõ òåêóùèõ óñòàíîâîê äëÿ ïîëÿ, óêàçàííîãî â ControlSource textbox-à.
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>edt</objname>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_S0713BATW</uniqueid>
		<timestamp>0</timestamp>
		<class>image</class>
		<classloc/>
		<baseclass>image</baseclass>
		<objname>img</objname>
		<parent/>
		<properties>Name = "img"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7>Áàçîâûé êëàññ Image</reserved7>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>img</objname>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_QYW0ZYVNR</uniqueid>
		<timestamp>0</timestamp>
		<class>label</class>
		<classloc/>
		<baseclass>label</baseclass>
		<objname>lbl</objname>
		<parent/>
		<properties>AutoSize = .T.
Caption = "Ââåäèòå çàãîëîâîê"
Name = "lbl"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3/>
		<reserved4>..\bitmaps\label.bmp</reserved4>
		<reserved5>..\bitmaps\label.bmp</reserved5>
		<reserved6>Pixels</reserved6>
		<reserved7>Áàçîâûé êëàññ Label</reserved7>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>lbl</objname>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_15P0Q92RV</uniqueid>
		<timestamp>0</timestamp>
		<class>line</class>
		<classloc/>
		<baseclass>line</baseclass>
		<objname>lin</objname>
		<parent/>
		<properties>Height = 68
Width = 68
Name = "lin"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>lin</objname>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_QZ919RBBM</uniqueid>
		<timestamp>0</timestamp>
		<class>listbox</class>
		<classloc/>
		<baseclass>listbox</baseclass>
		<objname>lst</objname>
		<parent/>
		<properties>Name = "lst"
</properties>
		<protected/>
		<methods>PROCEDURE InteractiveChange
This._HandleAnyChange()
ENDPROC
PROCEDURE ProgrammaticChange
This._HandleAnyChange()
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3>*_handleanychange &lt;public/user/nodefault&gt; Îáðàáîòêà èçìåíåíèÿ çíà÷åíèÿ îáúåêòà.
</reserved3>
		<reserved4>..\bitmaps\listbox.bmp</reserved4>
		<reserved5>..\bitmaps\listbox.bmp</reserved5>
		<reserved6>Pixels</reserved6>
		<reserved7>Áàçîâûé êëàññ ListBox</reserved7>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>lst</objname>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18Q1AD3DW</uniqueid>
		<timestamp>0</timestamp>
		<class>optiongroup</class>
		<classloc/>
		<baseclass>optiongroup</baseclass>
		<objname>opg</objname>
		<parent/>
		<properties>Value = 0
Height = 46
Width = 71
Name = "opg"
</properties>
		<protected/>
		<methods>PROCEDURE InteractiveChange
This._HandleAnyChange()
ENDPROC
PROCEDURE ProgrammaticChange
This._HandleAnyChange()
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3>*_handleanychange &lt;public/user/nodefault&gt; Îáðàáîòêà èçìåíåíèÿ çíà÷åíèÿ îáúåêòà.
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>opg</objname>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_15P0REBL0</uniqueid>
		<timestamp>0</timestamp>
		<class>pageframe</class>
		<classloc/>
		<baseclass>pageframe</baseclass>
		<objname>pgf</objname>
		<parent/>
		<properties>ErasePage = .T.
ActivePage = 0
_allowresize = .F.
_allowresizecontent = .F.
Name = "pgf"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3>_allowresize &lt;public/design&gt; Ôëàã ðàçðåøåíèÿ/çàïðåùåíèÿ èçìåíåíèÿ ðàçìåðîâ îáúåêòà ïðè èçìåíåíèè ðàçìåðà ôîðìû.
_allowresizecontent &lt;public/design&gt; Ôëàã ðàçðåøåíèÿ/çàïðåùåíèÿ èçìåíåíèÿ ðàçìåðîâ äî÷åðíèõ îáúåêòîâ ïðè èçìåíåíèè ðàçìåðà ôîðìû.
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>pgf</objname>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_QYW0ZUF9W</uniqueid>
		<timestamp>0</timestamp>
		<class>shape</class>
		<classloc/>
		<baseclass>shape</baseclass>
		<objname>shp</objname>
		<parent/>
		<properties>Name = "shp"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3/>
		<reserved4>..\bitmaps\shape.bmp</reserved4>
		<reserved5>..\bitmaps\shape.bmp</reserved5>
		<reserved6>Pixels</reserved6>
		<reserved7>Áàçîâûé êëàññ Shape</reserved7>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>shp</objname>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_18Q1AQ65V</uniqueid>
		<timestamp>0</timestamp>
		<class>spinner</class>
		<classloc/>
		<baseclass>spinner</baseclass>
		<objname>spn</objname>
		<parent/>
		<properties>Height = 23
Width = 121
Name = "spn"
</properties>
		<protected/>
		<methods>PROCEDURE InteractiveChange
This._HandleAnyChange()
ENDPROC
PROCEDURE ProgrammaticChange
This._HandleAnyChange()
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3>*_handleanychange &lt;public/user/nodefault&gt; Îáðàáîòêà èçìåíåíèÿ çíà÷åíèÿ îáúåêòà.
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>spn</objname>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1540Q0PA5</uniqueid>
		<timestamp>0</timestamp>
		<class>separator</class>
		<classloc/>
		<baseclass>separator</baseclass>
		<objname>spr</objname>
		<parent/>
		<properties>Height = 0
Width = 0
Name = "spr"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>spr</objname>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_R020K4VL1</uniqueid>
		<timestamp>0</timestamp>
		<class>toolbar</class>
		<classloc/>
		<baseclass>toolbar</baseclass>
		<objname>tlbapp</objname>
		<parent/>
		<properties>Caption = ""
Height = 19
Left = 6
Top = 6
Width = 33
ControlBox = .T.
ShowWindow = 1
nindex = 0
lenabled = .T.
Name = "tlbapp"
</properties>
		<protected>nindex
</protected>
		<methods>PROCEDURE Destroy
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: MAINTOOLBAR.VCX
* Class.Module....: TLBMAIN.DESTROY
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;sysevent&gt;Âûçîâ ìåòîäà ñîõðàíåíèÿ ïîçèöèè ïàíåëè èíñòðóìåíòîâ,
*					ñîîáùåíèå Application î çàêðûòèè çàðåãèñòðèðîâàííîãî îêíà.
*-------------------------------------------------------
WITH This

*11.01.2004 13:53 -&gt;Âûçîâ ìåòîäà ñîõðàíåíèÿ ïîçèöèè ïàíåëè èíñòðóìåíòîâ
.TlbPositionSave()
*------------------------------------------------------------------------------
		
*14.12.2003 15:09 -&gt;Ñîîáùåíèå Application î çàêðûòèè çàðåãèñòðèðîâàííîãî îêíà
IF .nIndex#0 AND TYPE([oApp])==[O] AND !ISNULL(oApp)
	oApp.WindowEventDestroy(.nIndex)
ENDIF
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE Init
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: TLB.INIT
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;sysevent&gt; Âûçîâ ìåòîäà âîññòàíîâëåíèÿ ïîçèöèè ïàíåëè èíñòðóìåíòîâ, ;
*					è ìåòîäà óñòàíîâêè àêòèâíîñòè âñå êíîïîê ïàíåëè èíñòðóìåíòîâ, ñîãëàñíî
*					íà÷àëüíîìó çíà÷åíèþ ñâîéñòâà .lEnabled.
*-------------------------------------------------------
WITH This

*11.01.2004 14:07 -&gt;Âûçîâ ìåòîäà âîññòàíîâëåíèÿ ïîçèöèè ïàíåëè èíñòðóìåíòîâ.
.TlbPositionRestore()
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE Release
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: MAINTOOLBAR.VCX
* Class.Module....: TLBMAIN.RELEASE
* Called by.......: &lt;Misc Ext Calls&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt;Óäàëåíèå ïàíåëè èíñòðóìåíòîâ.
*-------------------------------------------------------
RELEASE This
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE setenabled
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: MAINTOOLBAR.VCX
* Class.Module....: TLBMAIN.SETENABLED
* Called by.......: &lt;.Init(); Misc Ext Calls&gt;
* Parameters......: &lt;tlEnabled&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Ìåòîä èçìåíåíèÿ ñâîéñòâà .lEnabled.
*-------------------------------------------------------
LPARAMETERS	tlEnabled

WITH This

*11.01.2004 16:02 -&gt;Óñòàíîâèì ñâîéñòâî äîñòóïíîñòè
.lEnabled = tlEnabled
*------------------------------------------------------------------------------

*11.01.2004 16:03 -&gt;Åñëè ïàíåëü èíñòðóìåíòîâ îòêëþ÷àåòñÿ - îòêëþ÷èì âñå êíîïêè
IF !.lEnabled
	.SetAll([Enabled],.F.)
ENDIF	
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE setindex
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: MAINTOOLBAR.VCX
* Class.Module....: TLBMAIN.SETINDEX
* Called by.......: &lt;oApp.DoToolBar()&gt;
* Parameters......: &lt;tnIndex - èíäåêñ ýêçåìïëÿðà ïàíåëè èíñòðóìåíòîâ â ìàññèâå aWindows îáúåêòà Application&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Ñîõðàíåíèå èíäåêñà ýêçåìïëÿðà ïàíåëè èíñòðóìåíòîâ â ìàññèâå
*					aWindows îáúåêòà Application â ñâîéñòâå .nIndex.
*-------------------------------------------------------
LPARAMETERS	tnIndex

*11.01.2004 14:14 -&gt;Ñîõðàíèì èíäåêñ
This.nIndex = tnIndex
*------------------------------------------------------------------------------
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE tlbpositionrestore
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: MAINTOOLBAR.VCX
* Class.Module....: TLBMAIN.TLBPOSITIONRESTORE
* Called by.......: &lt;.Init()&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;protected/nouser/default&gt; Âîññòàíîâëåíèå ïîëîæåíèÿ ïàíåëè èñòðóìåíòîâ.
*-------------------------------------------------------
WITH This

*11.01.2004 14:15 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnDocPosition, ;
		lnLeft, ;
		lnTop, ;
		lcString
***
lnDocPosition = 0
lnLeft = 0
lnTop = 0
*------------------------------------------------------------------------------

*11.01.2004 14:15 -&gt;Âîññòàíîâèì ïîëîæåíèå ïàíåëè èíñòðóìåíòîâ
IF TYPE([oRes])==[O] AND !ISNULL(oRes)
	lcString = oRes.GetParam([ToolBarPosition],.Name,FULLPATH([User.INI]))
	IF !EMPTY(lcString) AND OCCURS([;],lcString)=2
		lnDocPosition = VAL(SUBSTR(lcString,1,AT([;],lcString)-1))
		lnLeft 		  = VAL(SUBSTR(lcString,AT([;],lcString)+1,AT([;],lcString,2)-1))
		lnTop 		  = VAL(SUBSTR(lcString,AT([;],lcString,2)+1))
	ENDIF
ENDIF
.Dock(lnDocPosition,lnLeft,lnTop)
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE tlbpositionsave
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: MAINTOOLBAR.VCX
* Class.Module....: TLBMAIN.TLBPOSITIONSAVE
* Called by.......: &lt;.Init()&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;protected/nouser/default&gt; Ñîõðàíåíèå ïîëîæåíèÿ ïàíåëè èíñòðóìåíòîâ.
*-------------------------------------------------------
WITH This

*11.01.2004 14:24 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcString
*------------------------------------------------------------------------------

*11.01.2004 14:24 -&gt;Ñîõðàíèì ïîëîæåíèå ïàíåëè èíñòðóìåíòîâ
IF TYPE([oRes])==[O] AND !ISNULL(oRes)
	lcString =	ALLTRIM(STR(.DockPosition))+[;]+ ;
				ALLTRIM(STR(.Left))+[;]+ ;
				ALLTRIM(STR(.Top))
	oRes.WriteParam([ToolBarPosition],.Name,lcString,FULLPATH([User.INI]))
ENDIF
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3>nindex
lenabled &lt;public/runtime/design&gt; Ôëàã äîñòóïíîñòè ïàíåëè èíñòðóìåíòîâ. Äëÿ ïàíåëè èíñòðóìåíòîâ ïðèëîæåíèÿ äîëæåí áûòü âûñòàâëåí â .T., äëÿ ïàíåëè èíñòðóìåíòîâ ôîðìû äîëæåí áûòü âûñòàâëåí â .F., åãî çíà÷åíèå áóäåò ìåíÿòüñÿ ñ ïîìîùüþ  ìåòîäà .SetEnabled().
*setindex &lt;public/nouser/default&gt; Ñîõðàíåíèå èíäåêñà ýêçåìïëÿðà ôîðìû â ìàññèâå aWindows îáúåêòà Application â ñâîéñòâå .nIndex.
*tlbpositionsave 
*tlbpositionrestore 
*setenabled &lt;public/nouser/default&gt; Ìåòîä èçìåíåíèÿ ñâîéñòâà .lEnabled.
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7>Áàçîâûé êëàññ ToolBar</reserved7>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>tlbapp</objname>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1AH0REOT4</uniqueid>
		<timestamp>0</timestamp>
		<class>timer</class>
		<classloc/>
		<baseclass>timer</baseclass>
		<objname>tmrtlbfrm</objname>
		<parent/>
		<properties>Height = 23
Width = 23
Enabled = .F.
Interval = 1
_msg = 
ocmd = .NULL.
Name = "tmrtlbfrm"
</properties>
		<protected/>
		<methods>PROCEDURE Init
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: TMRTLBFRM.INIT
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;toCmd, tcMsg&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;~&gt;
*-------------------------------------------------------
LPARAMETERS	toCmd, tcMsg

DODEFAULT()

This.oCmd = toCmd
This._Msg = tcMsg
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE Timer
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: TMRTLBFRM.TIMER
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;~&gt;
*-------------------------------------------------------
This.Enabled = .F.
This.oCmd.cstMsgHandler.HandleMsg(This._Msg)
This.oCmd = .NULL.
RELEASE This
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3>_msg
ocmd
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>tmrtlbfrm</objname>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_R6I0STXQF</uniqueid>
		<timestamp>944933972</timestamp>
		<class>form</class>
		<classloc/>
		<baseclass>form</baseclass>
		<objname>frm</objname>
		<parent/>
		<properties>DataSession = 2
Top = 0
Left = 0
Height = 250
Width = 415
DoCreate = .T.
ShowTips = .T.
BufferMode = 2
Caption = "Ôîðìà"
MinHeight = 50
MinWidth = 50
nindex = 0
lformactive = .F.
lbeforefirstshowexecuted = .F.
_standarttoolbar = 
_customtoolbar = 
_allowmultiple = .F.
_customtoolbarinstancenm = 
_customtoolbarparamstring = 
_allowsaveandrestorelayout = .F.
Name = "frm"
</properties>
		<protected>lbeforefirstshowexecuted
</protected>
		<methods>PROCEDURE Activate
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: FRM.ACTIVATE
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;sysevent&gt; Âûïîëíåíèå ïîëüçîâàòåëüñêîãî ìåòîäà BeforeFirstShow, ñîîáùåíèå
*					Application îá àêòèâàöèè çàðåãèñòðèðîâàííîé ôîðìû, óñòàíîâêà ôëàãà
*					àêòèâíîñòè ôîðìû.
*-------------------------------------------------------
WITH This

*14.12.2003 14:59 -&gt;Åñëè ïåðâîå ïîÿâëåíèå ôîðìû - âûïîëíèì ïîëüçîâàëüêèé ìåòîä
IF !.lBeforeFirstShowExecuted
	*14.12.2003 15:02 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
	LOCAL	llOldLockScreen
	llOldLockScreen = .LockScreen
	*------------------------------------------------------------------------------
	
	*14.12.2003 15:02 -&gt;Âûïîëíÿåì ïîëüçîâàòåëüñêèé ìåòîä
	.LockScreen = .T.
	.Resize()
	._BeforeFirstShow()
	.LockScreen = llOldLockScreen
	*------------------------------------------------------------------------------
	
	*14.12.2003 15:02 -&gt;Ñòàâèì ôëàã, ÷òî ìåòîä áûë âûïîëíåí
	.lBeforeFirstShowExecuted = .T.
	*------------------------------------------------------------------------------
ENDIF
*------------------------------------------------------------------------------

*14.12.2003 15:00 -&gt;Ñîîáùèì Application îá àêòèâàöèè çàðåãèñòðèðîâàííîé ôîðìû
IF .nIndex#0 AND TYPE([oApp])==[O] AND !ISNULL(oApp)
	oApp.WindowEventActivate(.nIndex)
ENDIF
*------------------------------------------------------------------------------

*07.07.2003 14:25 -&gt;Ïîñòàâèì ôëàã àêòèâíîñòè ôîðìû
.lFormActive = .T.
*------------------------------------------------------------------------------	

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE Deactivate
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: FRM.DEACTIVATE
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;sysevent&gt; Cîîáùåíèå Application îá äåàêòèâàöèè çàðåãèñòðèðîâàííîé
*					ôîðìû, ñáðîñ ôëàãà àêòèâíîñòè ôîðìû.
*-------------------------------------------------------
WITH This

*14.12.2003 15:00 -&gt;Ñîîáùèì Application îá äåàêòèâàöèè çàðåãèñòðèðîâàííîé ôîðìû
IF .nIndex#0 AND TYPE([oApp])==[O] AND !ISNULL(oApp)
	oApp.WindowEventDeActivate(.nIndex)
ENDIF
*------------------------------------------------------------------------------

*14.12.2003 15:05 -&gt;Ñíèìåì ôëàã àêòèâíîñòè ôîðìû
.lFormActive = .F.
*------------------------------------------------------------------------------	

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE Destroy
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: FRM.DESTROY
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;sysevent&gt; Âûçîâ ìåòîäà ñîõðàíåíèÿ ïîçèöèè è ðàçìåðà îêíà,
*					ñîîáùåíèå Application î çàêðûòèè çàðåãèñòðèðîâàííîãî îêíà
*-------------------------------------------------------
WITH This

*28.12.2004 16:01 -&gt;Ñîõðàíèì ïàðàìåòðû îòîáðàæåíèÿ ôîðìû è Grid-îâ
.cstResizable.LayoutSave(This)
*------------------------------------------------------------------------------
		
*14.12.2003 15:09 -&gt;Cîîáùåíèå Application î çàêðûòèè çàðåãèñòðèðîâàííîãî îêíà
IF	.nIndex#0 AND TYPE([oApp])==[O] AND !ISNULL(oApp)
	oApp.WindowEventDestroy(.nIndex)
ENDIF
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE Init
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: FRM.INIT
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;sysevent&gt; Âûçîâ ìåòîäà âîññòàíîâëåíèÿ ïîçèöèè è ðàçìåðà ôîðìû.
*-------------------------------------------------------
WITH This

*28.12.2004 16:01 -&gt;Âîññòàíîâèì ïàðàìåòðû îòîáðàæåíèÿ ôîðìû è Grid-îâ
.cstResizable.LayoutRestore(This)
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE Load
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: FRM.LOAD
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;sysevent&gt; Âûçîâ ìåòîäà óñòàíîâêè íàñòðîéêè ñåññèè äàííûõ.
*-------------------------------------------------------
WITH This

*14.12.2003 15:14 -&gt;Âûçîâ ìåòîäà óñòàíîâêè íàñòðîéêè ñåññèè äàííûõ
IF .DataSession=2 AND TYPE([oEnv])==[O] AND !ISNULL(oEnv)
	oEnv.Set(.DataSessionId)
ENDIF
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE refreshform
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: FRM.REFRESHFORM
* Called by.......: &lt;External Calls&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........:	&lt;public/user/default&gt; Ïîëüçîâàòåëüñêîå îáíîâëåíèå îêíà.
*-------------------------------------------------------
WITH This

*14.12.2003 15:02 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	llOldLockScreen
llOldLockScreen = .LockScreen
*------------------------------------------------------------------------------
	
*14.12.2003 15:02 -&gt;Âûïîëíÿåì îáíîâëåíèå îêíà
.LockScreen = .T.
.Refresh()
.LockScreen = llOldLockScreen
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE Resize
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: FRM.RESIZE
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;sysevent&gt; Âûçîâ ìåòîäà îáðàáîòêè èçìåíåíèÿ ðàçìåðîâ ôîðìû.
*-------------------------------------------------------

WITH This

*14.01.2004 13:36 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	llOldLockScreen
llOldLockScreen = .LockScreen
*------------------------------------------------------------------------------
	
*14.01.2004 13:36 -&gt;Âûïîëíÿåì èçìåíåíèå ðàçìåðîâ ôîðìû
.LockScreen = .T.
.cstResizable.DoResize()
.LockScreen = llOldLockScreen
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE setindex
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: FRM.SETINDEX
* Called by.......: &lt;oApp.DoForm();oApp.DoFormObj()&gt;
* Parameters......:	&lt;tnIndex - èíäåêñ ýêçåìïëÿðà ôîðìû â ìàññèâå aWindows îáúåêòà Application&gt;
* Returns.........:	&lt;none&gt;
* Notes...........:	&lt;public/nouser/default&gt; Ñîõðàíåíèå èíäåêñà ýêçåìïëÿðà ôîðìû â ìàññèâå
*					aWindows îáúåêòà Application â ñâîéñòâå .nIndex
*-------------------------------------------------------
LPARAMETERS	tnIndex

*14.12.2003 15:17 -&gt;Ñîõðàíèì èíäåêñ
This.nIndex = tnIndex
*------------------------------------------------------------------------------

************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>4</reserved2>
		<reserved3>nindex &lt;protected/runtime&gt; Èíäåêñ îêíà, ïîä êîòîðûì îíî ÷èñëèòñÿ â ìàññèâå aWindows îáúåêòà Application.
lformactive &lt;public/runtime&gt; Ôëàã àêòèâíîñòè ôîðìû.
lbeforefirstshowexecuted &lt;protected/runtime&gt; Ôëàã, óêàçûâàþùèé íà òî áûë ëè âûïîëíåí ìåòîä BeforeFirstShow ïðè àêòèâàöèè ôîðìû.
_standarttoolbar &lt;public/design&gt; Ñòðîêà ñîäåðæàùàÿ îïðåäåëåíèå êëàññà ñòàíäàðòíîé ïàíåëè èíñòðóìåíòîâ â ôîðìàòå cClassName[;cLibName[;cContainFileName]]
_customtoolbar &lt;public/design&gt; Ñòðîêà ñîäåðæàùàÿ îïðåäåëåíèå êëàññà ïîëüçîâàòåëüñêîé ïàíåëè èíñòðóìåíòîâ â ôîðìàòå cClassName[;cLibName[;cContainFileName]]
_allowmultiple &lt;public/design&gt; Ôëàã ðàçðåøàþùèé/çàïðåùàþùèé çàïóñê íåñêîëüêèõ ýêçåìïëÿðîâ ôîðìû.
_customtoolbarinstancenm &lt;public/design/optional&gt; Ñòðîêà ñîäåðæàùàÿ èìÿ ýêçåìïëÿðà ñîçäàâàåìîé ïàíåëè èíñòðóìåíòîâ
_customtoolbarparamstring &lt;public/design&gt; Ñòðîêà ñîäåðæàùàÿ ñïèñîê ïàðàìåòðîâ, ïåðåäàâàåìûõ â ìåòîä Init() ñîçäàâàåìîé ïàíåëè èíñòðóìåíòîâ uParam1[,uParam2...[;uParamN]]
_allowsaveandrestorelayout &lt;public/design&gt; Ôëàã ðàçðåøàþùèé/çàïðåùàþùèé ñîõðàíåíèå/âîññòàíîâëåíèå ïàðàìåòðîâ îòîáðàæåíèÿ ôîðìû
*refreshform &lt;public/user/default&gt; Ïîëüçîâàòåëüñêîå îáíîâëåíèå îêíà. 
*setindex &lt;public/nouser/default&gt; Ñîõðàíåíèå èíäåêñà ýêçåìïëÿðà ôîðìû â ìàññèâå aWindows îáúåêòà Application â ñâîéñòâå .nIndex
*_beforefirstshow &lt;public/user/nodefault&gt; Ìåòîä, âûïîëíÿþùèéñÿ ïåðåä ïåðâûì ïîêàçîì ôîðìû.
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7>Áàçîâûé êëàññ Form</reserved7>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_14911U6VB</uniqueid>
		<timestamp>0</timestamp>
		<class>cstmsghandler</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>custom</baseclass>
		<objname>cstMsgHandler</objname>
		<parent>frm</parent>
		<properties>Top = 0
Left = 0
Name = "cstMsgHandler"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1560T8425</uniqueid>
		<timestamp>0</timestamp>
		<class>cstresizable</class>
		<classloc>resizable_v1.vcx</classloc>
		<baseclass>custom</baseclass>
		<objname>cstResizable</objname>
		<parent>frm</parent>
		<properties>Top = 2
Left = 22
Name = "cstResizable"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2AX11KSFR</uniqueid>
		<timestamp>944933972</timestamp>
		<class>img</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>image</baseclass>
		<objname>Img1</objname>
		<parent>frm</parent>
		<properties>Picture = ..\graphic\sba_basis.jpg
Stretch = 2
Height = 60
Left = -122
Top = 0
Visible = .F.
Width = 542
Name = "Img1"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>frm</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_17X0YJA9K</uniqueid>
		<timestamp>948327694</timestamp>
		<class>textbox</class>
		<classloc/>
		<baseclass>textbox</baseclass>
		<objname>txtgrd</objname>
		<parent/>
		<properties>BorderStyle = 0
Height = 23
Margin = 0
ReadOnly = .T.
ForeColor = 0,0,0
BackColor = 255,255,255
Name = "txtgrd"
</properties>
		<protected/>
		<methods>PROCEDURE applydynamicbackcolor
WITH This

lcDynBackColor = .parent.DynamicBackColor
IF TYPE(lcDynBackColor)==[N]
	.BackColor = EVAL(lcDynBackColor)
ENDIF

ENDWITH
ENDPROC
PROCEDURE DblClick
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: TXTGR.DBLCLICK
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Ïåðåäà÷à ñîîáùåíèÿ Edit ðîäèòåëüñêîìó îáúåêòó.
*-------------------------------------------------------
This.parent.parent.HandleMsg([EDIT])
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE GotFocus
This.ApplyDynamicBackColor()
ENDPROC
PROCEDURE KeyPress
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: TXTGR.KEYPRESS
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;tnKeyCode, tnShiftAltCtrl&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Ïåðåäà÷à îáðàáîòêè ñîáûòèÿ KeyPress ðîäèòåëüñêîìó Grid-ó
*-------------------------------------------------------
LPARAMETERS tnKeyCode, tnShiftAltCtrl

IF This.Parent.Parent.HandleKey(tnKeyCode, tnShiftAltCtrl)
	NODEFAULT
ENDIF

************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************	

ENDPROC
PROCEDURE RightClick
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: TXTGR.RIGHTCLICK
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Âûçîâ ìåòîäà RightClick ðîäèòåëüñêîãî Grid-à
*-------------------------------------------------------
This.parent.parent.RightClick()
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3>*applydynamicbackcolor 
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>txtgrd</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_QYW0ZV9O9</uniqueid>
		<timestamp>949058848</timestamp>
		<class>commandbutton</class>
		<classloc/>
		<baseclass>commandbutton</baseclass>
		<objname>cmd</objname>
		<parent/>
		<properties>Height = 25
Width = 100
Caption = "Ââåäèòå òåêñò"
starting = 
Name = "cmd"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3>starting Íàçâàíèå îïåðàöèè, êîòîðóþ çàïóñêàåò äàííàÿ êíîïî÷êà
</reserved3>
		<reserved4>..\bitmaps\pushb.bmp</reserved4>
		<reserved5>..\bitmaps\pushb.bmp</reserved5>
		<reserved6>Pixels</reserved6>
		<reserved7>Áàçîâûé êëàññ CommandButton</reserved7>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>cmd</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_12Z0YONGL</uniqueid>
		<timestamp>949837194</timestamp>
		<class>custom</class>
		<classloc/>
		<baseclass>custom</baseclass>
		<objname>cstmsghandler</objname>
		<parent/>
		<properties>Name = "cstmsghandler"
</properties>
		<protected>linprocess
refreshtoolbar
</protected>
		<methods>PROCEDURE gethandledmsg
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Base_v1.vcx
* Class.Module....: cstMsgHandler.getHandledMsg
* Called by.......: &lt;Misc Ext Call's&gt;
* Parameters......: &lt;lnMsgSRef&gt;
* Returns.........: &lt;lnHandledMsgCount - êîëè÷åñòâî ñîîáùåíèé&gt;
* Notes...........: Âîçðàùàåò ñîîáùåíèå, ïî íîìåðó ñòðîêè â ìàññèâå
*------------------------------------------------------------------------------
LPARAMETERS lnMsgSRef

WITH This

*15.08.2005 16:31 -Ïðîâåðèì çàïðîñ
IF ISNULL(.aMsgHandlingObjects) OR lnMsgSRef &gt; ALEN(.aMsgHandlingObjects,1)
	ASSERT .F. MESSAGE [cstMsgHandler.HandleMsg: çàïðîñ ñîîáùåíèÿ èç ñïèñêà ñ èíäåêñîì çà ïðåäåëîì ñïèñêà]
	RETURN .F.
ENDIF
*------------------------------------------------------------------------------

*15.08.2005 16:42 -&gt;Âåðíåì ñîîáùåíèå
RETURN .aMsgHandlingObjects[lnMsgSRef,1]
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
	

ENDPROC
PROCEDURE gethandledmsgcount
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Base_v1.vcx
* Class.Module....: cstMsgHandler.getHandledMsgCount
* Called by.......: &lt;Misc Ext Call's&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;lnHandledMsgCount - êîëè÷åñòâî ñîîáùåíèé&gt;
* Notes...........: Âîçðàùàåò êîëè÷åñòâî ñîîáùåíèé, êîòîðûå ìîãóò áûòü îáðàáîòàíû
*					îáðàáîò÷èêîì â òåêóùåì êîíòåêñòå
*------------------------------------------------------------------------------
WITH THis

*15.08.2005 16:19 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnHandledMsgCount
*------------------------------------------------------------------------------

*14.12.2003 17:21 -&gt;Ôîðìèðóåì êîëè÷åñòâî ñîîáùåíèé
IF ISNULL(.aMsgHandlingObjects)
	
	*15.08.2005 16:19 -&gt;Íåò íè îäíîãî ñîááùåíèé
	lnHandledMsgCount = 0
	*------------------------------------------------------------------------------
	
ELSE
	
	*14.12.2003 17:21 -&gt;Êîëè÷åñòâî îáðàáàòûâàåìûõ ñîîáùåíèé = êîëè÷åñòâó ñòðîê â ìàññèâå
	lnHandledMsgCount = ALEN(.aMsgHandlingObjects,1)
	*------------------------------------------------------------------------------
	
ENDIF	
*------------------------------------------------------------------------------

*15.08.2005 16:23 -&gt;Âåðíåì êîëè÷åñòâî îáðàáàòûâàåìûõ îáúåêòîâ
RETURN lnHandledMsgCount
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE handlemsg
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: CSTMSGHANDLER.HANDLEMSG
* Called by.......: &lt;External Calls&gt;
* Parameters......: &lt;tcMessage&gt;
* Returns.........: &lt;none&gt;
* Last Edit Date..: 29, October, 2003
* Notes...........: (public) Îáðàáîòêà ñîîáùåíèÿ
*-------------------------------------------------------
LPARAMETERS	tcMessage

*29.10.2003 20:08 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcMessage, ;
		lnCounter, ;
		lnIndex, ;
		lcHandlingObjectHierarchy, ;
		lcFormObjectHierarchy, ;
		lcRelativeObjectHierarchy, ;
		loHandlingObject
lcMessage = UPPER(ALLTRIM(tcMessage))
lnIndex = 0
*------------------------------------------------------------------------------

WITH This

*29.10.2003 20:10 -&gt;Ïðîâåðÿåì çàðåãèñòðèðîâàí ó íàñ îáðàáîò÷èê äàííîãî ñîîáùåíèÿ èëè íåò
IF !ISNULL(.aMsgHandlingObjects)

	*29.10.2003 20:10 -&gt;Ïðîâåðÿåì ìàññèâ íà íàëè÷èå çàðåãèñòðèðîâàííîãî îáðàáîò÷èêà
	FOR lnCounter = 1 TO ALEN(.aMsgHandlingObjects,1)
		IF .aMsgHandlingObjects[lnCounter,1]==lcMessage
			lnIndex = lnCounter
			EXIT
		ENDIF
	ENDFOR
	*------------------------------------------------------------------------------
	
	*29.10.2003 20:10 -&gt;Åñëè íàéäåí îáðàáîò÷èê äàííîãî ñîîáùåíèÿ, ïåðåäàäèì íà îáðàáîòêó
	IF lnIndex&gt;0
		*29.10.2003 20:18 -&gt;Îïðåäåëèìñÿ ñ îáúåêòîì
		lcHandlingObjectHierarchy = .aMsgHandlingObjects[lnCounter,2]
		lcFormObjectHierarchy = UPPER(ALLTRIM(SYS(1272,ThisForm)))
		lcRelativeObjectHierarchy = SUBSTR(lcHandlingObjectHierarchy,LEN(lcFormObjectHierarchy)+1)
		WITH ThisForm
			loHandlingObject = EVAL(lcRelativeObjectHierarchy)
		ENDWITH	
		*------------------------------------------------------------------------------
		
		*29.10.2003 20:14 -&gt;Åñëè åñòü ìåòîä îáðàáîòêè ñîáûòèÿ - âûçîâåì
		IF 	TYPE([loHandlingObject])==[O] AND ;
			PEMSTATUS(loHandlingObject,[HandleMsg],5) AND ;
			!PEMSTATUS(loHandlingObject,[HandleMsg], 2)
			*{
			loHandlingObject.HandleMsg(lcMessage)
			*}
		ENDIF
		*------------------------------------------------------------------------------	
	ELSE
		ASSERT .F. MESSAGE [CSTMSGHANDLER.HANDLEMSG: íå íàéäåí îáðàáîò÷èê äëÿ ñîîáùåíèÿ: ]+lcMessage
	ENDIF
	*------------------------------------------------------------------------------	
ENDIF	
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE Init
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: CSTMSGHANDLER.INIT
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Last Edit Date..: 29, October, 2003
* Notes...........: Îáíóëåíèå ìàññèâà îáðàáîò÷èêîâ
*-------------------------------------------------------
This.aMsgHandlingObjects = .NULL.
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE ismsghandled
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: CSTMSGHANDLER.ISMSGHANDLED
* Called by.......: &lt;BASE_V1.VCX::tlb.RefreshEnabledMsg()&gt;
* Parameters......: &lt;tcMessage&gt;
* Returns.........: &lt;.T./.F. - èìååò/íå èìååò ñîîáùåíèå çàðåãèñòðèðîâàííûé îáðàáîò÷èê&gt;
* Notes...........: &lt;public/nouser/default&gt; Âîçâðàùàåò .T., åñëè ñîîáùåíèå, ïåðåäàííîå â êà÷åñòâå ïàðàìåòðà,
*					èìååò çàðåãèñòðèðîâàííûé îáðàáîò÷èê èëè .F., åñëè íå èìååò.
*-------------------------------------------------------
LPARAMETERS	tcMessage

*11.01.2004 18:47 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcMessage, ;
		llResult, ;
		lnCounter
***
lcMessage = UPPER(ALLTRIM(tcMessage))
llResult = .F.
*------------------------------------------------------------------------------

WITH This

*11.01.2004 18:47 -&gt;Ïðîâåðÿåì çàðåãèñòðèðîâàí ó íàñ îáðàáîò÷èê äàííîãî ñîîáùåíèÿ èëè íåò
IF !ISNULL(.aMsgHandlingObjects)
	*11.01.2004 18:47 -&gt;Ïðîâåðÿåì ìàññèâ íà íàëè÷èå çàðåãèñòðèðîâàííîãî îáðàáîò÷èêà
	FOR lnCounter = 1 TO ALEN(.aMsgHandlingObjects,1)
		IF .aMsgHandlingObjects[lnCounter,1]==lcMessage
			llResult = .T.
			EXIT
		ENDIF
	ENDFOR
	*------------------------------------------------------------------------------
ENDIF	
*------------------------------------------------------------------------------

*11.01.2004 18:49 -&gt;Âåðíåì çíà÷åíèå
RETURN llResult
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************

ENDPROC
PROCEDURE refreshtoolbar
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: CSTMSGHANDLER.REFRESHTOOLBAR
* Called by.......: &lt;.RegMsgHandler();.UnRegMsgHandler();.RegMultipleMsgHandler();.UnRegMultipleMsgHandler()&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;protected/nouser/default&gt; Îáíîâëåíèå ïàíåëåé èíñòðóìåíòîâ ïðè èçìåíèè ñïèñêà ñîîáùåíé,
*					äëÿ êîòîðûõ çàðåãèñòðèðîâàí îáðàáîò÷èê.
*-------------------------------------------------------
WITH This

*11.01.2004 16:39 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	luTlbIndex, ;
		loTlbRef
*------------------------------------------------------------------------------

*11.01.2004 16:26 -&gt;Áóäåì âûïîëíÿòü äàííûé ìåòîä, òîëüêî åñëè âûçîâ ïðîèçîøåë íå â ïðîöåññå âûïîëíåíèÿ äðóãîé îïåðàöèè
IF !.lInProcess
	*11.01.2004 16:28 -&gt;Ìåòîäû îáíîâëåíèÿ ïàíåëåé èíñòðóìåíòîâ áóäåì âûïîëíÿòü òîëüêî â òîì ñëó÷àå
	*åñëè ôîðìà çàðåãèñòðèðîâàíà â Application è îáúåêò Application ñóùåñòâóåò
	IF ThisForm.nIndex#0 AND TYPE([oApp])==[O] AND !ISNULL(oApp)
		*15.12.2003 12:04 -&gt;Ïðîâåðèì åñòü ëè ñòàíäàðòíàÿ ïàíåëü èíñòðóìåíòîâ ó ðîäèòåëüñêîé ôîðìû
		luTlbIndex = oApp.WindowInfoGet(cnWINDOWS_INDEX,ThisForm.nIndex,cnWINDOWS_STD_TLB_INDEX)
		***
		IF !ISNULL(luTlbIndex) AND luTlbIndex#0
			loTlbRef = oApp.WindowInfoGet(cnWINDOWS_INDEX,luTlbIndex,cnWINDOWS_OBJ_REF)
			IF TYPE([loTlbRef])=[O] AND !ISNULL(loTlbRef)
				loTlbRef.RefreshEnabledMsg()
			ELSE
				ASSERT .F. MESSAGE [CSTMSGHANDLER.REFRESHTOOLBAR: ïàíåëü èíñòðóìåíòîâ íå íàéäåíà.]	
			ENDIF
		ENDIF
		*------------------------------------------------------------------------------

		*15.12.2003 12:04 -&gt;Ïðîâåðèì åñòü ëè ïîëüçîâàòåëüñêàÿ ïàíåëü èíñòðóìåíòîâ ó àêòèâèçèðóþùåéñÿ ôîðìû
		luTlbIndex = oApp.WindowInfoGet(cnWINDOWS_INDEX,ThisForm.nIndex,cnWINDOWS_CST_TLB_INDEX)
		***
		IF !ISNULL(luTlbIndex) AND luTlbIndex#0
			loTlbRef = oApp.WindowInfoGet(cnWINDOWS_INDEX,luTlbIndex,cnWINDOWS_OBJ_REF)
			IF TYPE([loTlbRef])=[O] AND !ISNULL(loTlbRef)
				loTlbRef.RefreshEnabledMsg()
			ELSE
				ASSERT .F. MESSAGE [CSTMSGHANDLER.REFRESHTOOLBAR: ïàíåëü èíñòðóìåíòîâ íå íàéäåíà.]	
			ENDIF
		ENDIF
		*------------------------------------------------------------------------------
	ENDIF
	*------------------------------------------------------------------------------
ENDIF	
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE regmsghandler
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: CSTMSGHANDLER.REGMSGHANDLER
* Called by.......: &lt;External Calls&gt;
* Parameters......: &lt;tcMessage, tcHandlingObjectHierarchy&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Ðåãèñòðàöèÿ îáúåêòà - îáðàáîò÷èêà ñîîáùåíèÿ.
*-------------------------------------------------------
LPARAMETERS	tcMessage, tcHandlingObjectHierarchy

*14.12.2003 17:21 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcMessage, ;
		lcHandlingObjectHierarchy, ;
		lnIndex, ;
		lnCounter
lcMessage = UPPER(ALLTRIM(tcMessage))
lcHandlingObjectHierarchy = UPPER(ALLTRIM(tcHandlingObjectHierarchy))
lnIndex = 0
*------------------------------------------------------------------------------

WITH This

*14.12.2003 17:21 -&gt;Ïðîâåðÿåì çàðåãèñòðèðîâàí ó íàñ îáðàáîò÷èê äàííîãî ñîîáùåíèÿ èëè íåò
IF ISNULL(.aMsgHandlingObjects)
	*14.12.2003 17:24 -&gt;Äîáàâëÿåì ïåðâûé ýëåìåíò â ìàññèâ
	lnIndex = 1
	DIMENSION .aMsgHandlingObjects[lnIndex,2]
	*------------------------------------------------------------------------------
ELSE
	*14.12.2003 17:21 -&gt;Ïðîâåðÿåì ìàññèâ íà íàëè÷èå çàðåãèñòðèðîâàííîãî îáðàáîò÷èêà
	FOR lnCounter = 1 TO ALEN(.aMsgHandlingObjects,1)
		IF .aMsgHandlingObjects[lnCounter,1]==lcMessage
			lnIndex = lnCounter
			EXIT
		ENDIF
	ENDFOR
	*------------------------------------------------------------------------------
	
	*29.10.2003 16:43 -&gt;Åñëè îáðàáîò÷èê íà íàøëè äîáàâëÿåì
	IF lnIndex = 0
		lnIndex = ALEN(.aMsgHandlingObjects,1)+1
		DIMENSION .aMsgHandlingObjects[lnIndex,2]
	ENDIF	
	*------------------------------------------------------------------------------
ENDIF	
*------------------------------------------------------------------------------

*29.10.2003 16:44 -&gt;Ðåãèñòðèðóåì îáðàáîò÷èê
.aMsgHandlingObjects[lnIndex,1] = lcMessage
.aMsgHandlingObjects[lnIndex,2] = lcHandlingObjectHierarchy
*------------------------------------------------------------------------------

*11.01.2004 16:46 -&gt;Îáíîâëÿåì ñîñòîÿíèå ïàíåëåé èíñòðóìåíòîâ
.RefreshToolBar()
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE regmultiplemsghandler
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: CSTMSGHANDLER.REGMULTIPLEMSGHANDLER
* Called by.......: &lt;External Calls&gt;
* Parameters......: &lt;tcMessagesList, tcHandlingObjectHierarchy&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Ðåãèñòðàöèÿ îáúåêòà - îáðàáîò÷èêà íåñêîëüêèõ ñîîáùåíèé.
*-------------------------------------------------------
LPARAMETERS	tcMessagesList, tcHandlingObjectHierarchy

WITH This

*29.10.2003 21:14 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcMessagesList, ;
		lnMessagesCount, ;
		lnCounter, ;
		lnStartPos, ;
		lnEndPos, ;
		lcMessage
***		
lcMessagesList = UPPER(ALLTRIM(tcMessagesList))		
*------------------------------------------------------------------------------		

*14.12.2003 17:13 -&gt;Ïðîâåðèì, ÷òîáû ïåðåäàííûé ñïèñîê ñîîáùåíèé íå áûë ïóñò
IF !EMPTY(lcMessagesList)

	*11.01.2004 16:48 -&gt;Óñòàíàâëèâàåì ôëàã, ÷òîáû ïàíåëè èíñòðóìåíòîâ íå îáíîâëÿëèñü ïðè ðåãèñòðàöèè êàæäîãî ñîîáùåíèÿ
	.lInProcess = .T.
	*------------------------------------------------------------------------------
	
	*29.10.2003 21:19 -&gt;Ðåãèñòðèðóåì îáúåêò â êà÷åñòâå îáðàáîò÷èêà êàæäîãî ñîîáùåíèÿ
	lnMessagesCount = IIF(EMPTY(lcMessagesList),0,OCCURS([;],lcMessagesList)+1)
	***
	FOR lnCounter = 1 TO lnMessagesCount
		lnStartPos = IIF(lnCounter=1,1,AT([;],lcMessagesList,lnCounter-1)+1)
		lnEndPos = IIF(lnCounter=lnMessagesCount,LEN(lcMessagesList),AT([;],lcMessagesList,lnCounter)-1)
		lcMessage = SUBSTR(lcMessagesList,lnStartPos,lnEndPos-lnStartPos+1)
		.RegMsgHandler(lcMessage, tcHandlingObjectHierarchy)
	ENDFOR
	*------------------------------------------------------------------------------

	*11.01.2004 16:49 -&gt;Ñíèìàåì ôëàã
	.lInProcess = .F.
	*------------------------------------------------------------------------------
	
	*11.01.2004 16:46 -&gt;Îáíîâëÿåì ñîñòîÿíèå ïàíåëåé èíñòðóìåíòîâ
	.RefreshToolBar()
	*------------------------------------------------------------------------------

ENDIF
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE unregmsghandler
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: CSTMSGHANDLER.UNREGMSGHANDLER
* Called by.......: &lt;External Calls&gt;
* Parameters......: &lt;tcMessage, tcHandlingObjectHierarchy&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Óäàëåíèå ðåãèñòðàöèè îáúåêòà - îáðàáîò÷èêà ñîîáùåíèÿ.
*-------------------------------------------------------
LPARAMETERS tcMessage, tcHandlingObjectHierarchy

*14.12.2003 17:21 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcMessage, ;
		lcHandlingObjectHierarchy, ;
		lnIndex, ;
		lnCounter
***		
lcMessage = UPPER(ALLTRIM(tcMessage))
lcHandlingObjectHierarchy = UPPER(ALLTRIM(tcHandlingObjectHierarchy))
lnIndex = 0
*------------------------------------------------------------------------------

WITH This

*14.12.2003 17:29 -&gt;Ïðîâåðÿåì çàðåãèñòðèðîâàí ó íàñ îáðàáîò÷èê äàííîãî ñîîáùåíèÿ èëè íåò
IF !ISNULL(.aMsgHandlingObjects)
	*29.10.2003 16:42 -&gt;Ïðîâåðÿåì ìàññèâ íà íàëè÷èå çàðåãèñòðèðîâàííîãî îáðàáîò÷èêà
	FOR lnCounter = 1 TO ALEN(.aMsgHandlingObjects,1)
		IF .aMsgHandlingObjects[lnCounter,1]==lcMessage
			lnIndex = lnCounter
			EXIT
		ENDIF
	ENDFOR
	*------------------------------------------------------------------------------
	
	*14.12.2003 17:30 -&gt;Åñëè äàííîé ñîîáùåíèå çàðåãèñòðèðîâàííî äàííûì îáúåêòîì
	IF lnIndex &gt; 0 AND .aMsgHandlingObjects[lnIndex,2]==lcHandlingObjectHierarchy
		*14.12.2003 17:32 -&gt;Óäàëÿåì ñòðîêó èç ìàññèâà
		ADEL(.aMsgHandlingObjects,lnIndex)
		***
		IF ALEN(.aMsgHandlingObjects,1) = 1
			.aMsgHandlingObjects = .NULL.
		ELSE	
			DIMENSION .aMsgHandlingObjects[ALEN(.aMsgHandlingObjects,1)-1,2]
		ENDIF	
		*------------------------------------------------------------------------------	
	ENDIF
	*------------------------------------------------------------------------------	
ENDIF	
*------------------------------------------------------------------------------

*11.01.2004 16:46 -&gt;Îáíîâëÿåì ñîñòîÿíèå ïàíåëåé èíñòðóìåíòîâ
.RefreshToolBar()
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE unregmultiplemsghandler
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: CSTMSGHANDLER.UNREGMULTIPLEMSGHANDLER
* Called by.......: &lt;External Calls&gt;
* Parameters......: &lt;tcMessagesList,tcHandlingObjectHierarchy&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Óäàëåíèå ðåãèñòðàöèè îáúåêòà - îáðàáîò÷èêà íåñêîëüêèõ ñîîáùåíèé.
*-------------------------------------------------------
LPARAMETERS	tcMessagesList, tcHandlingObjectHierarchy

WITH This

*29.10.2003 21:14 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcMessagesList, ;
		lnMessagesCount, ;
		lnCounter, ;
		lnStartPos, ;
		lnEndPos, ;
		lcMessage
***		
lcMessagesList = UPPER(ALLTRIM(tcMessagesList))
*------------------------------------------------------------------------------		

*14.12.2003 17:13 -&gt;Ïðîâåðèì, ÷òîáû ïåðåäàííûé ñïèñîê ñîîáùåíèé íå áûë ïóñò
IF !EMPTY(lcMessagesList)

	*11.01.2004 16:48 -&gt;Óñòàíàâëèâàåì ôëàã, ÷òîáû ïàíåëè èíñòðóìåíòîâ íå îáíîâëÿëèñü ïðè óäàëåíèè êàæäîãî ñîîáùåíèÿ
	.lInProcess = .T.
	*------------------------------------------------------------------------------
	
	*11.01.2004 16:48 -&gt;Âûçûâàåì ìåòîä óäàëåíèÿ ðåãèñòðàöèè äëÿ êàæäîãî ñîîáùåíèÿ
	lnMessagesCount = IIF(EMPTY(lcMessagesList),0,OCCURS([;],lcMessagesList)+1)
	***
	FOR lnCounter = 1 TO lnMessagesCount
		lnStartPos = IIF(lnCounter=1,1,AT([;],lcMessagesList,lnCounter-1)+1)
		lnEndPos = IIF(lnCounter=lnMessagesCount,LEN(lcMessagesList),AT([;],lcMessagesList,lnCounter)-1)
		lcMessage = SUBSTR(lcMessagesList,lnStartPos,lnEndPos-lnStartPos+1)
		.UnRegMsgHandler(lcMessage, tcHandlingObjectHierarchy)
	ENDFOR
	*------------------------------------------------------------------------------
	
	*11.01.2004 16:49 -&gt;Ñíèìàåì ôëàã
	.lInProcess = .F.
	*------------------------------------------------------------------------------
	
	*11.01.2004 16:46 -&gt;Îáíîâëÿåì ñîñòîÿíèå ïàíåëåé èíñòðóìåíòîâ
	.RefreshToolBar()
	*------------------------------------------------------------------------------
ENDIF
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3>linprocess &lt;protected/runtime&gt; Ôëàã, ÷òî îáúåêò íàõîäèòñÿ â ïðîöåññå âûïîëíåíèÿ îïåðàöèè. Êîãäà ôëàã âûñòàâëåí, ìåòîäû îáíîâëåíèÿ ïàíåëåé èíñòðóìåíòîâ è ìåíþ âûïîëíÿòñÿ íà áóäóò.
*regmsghandler &lt;public/nouser/default&gt; Ðåãèñòðàöèÿ îáúåêòà - îáðàáîò÷èêà ñîîáùåíèÿ.
*unregmsghandler &lt;public/nouser/default&gt; Óäàëåíèå ðåãèñòðàöèè îáúåêòà - îáðàáîò÷èêà ñîîáùåíèÿ.
^amsghandlingobjects[1,0] 
*handlemsg 
*regmultiplemsghandler &lt;public/nouser/default&gt; Ðåãèñòðàöèÿ îáúåêòà - îáðàáîò÷èêà íåñêîëüêèõ ñîîáùåíèé.
*unregmultiplemsghandler &lt;public/nouser/default&gt; Óäàëåíèå ðåãèñòðàöèè îáúåêòà - îáðàáîò÷èêà íåñêîëüêèõ ñîîáùåíèé.
*refreshtoolbar &lt;protected/nouser/default&gt; Îáíîâëåíèå ïàíåëåé èíñòðóìåíòîâ ïðè èçìåíèè ñïèñêà ñîîáùåíé, äëÿ êîòîðûõ çàðåãèñòðèðîâàí îáðàáîò÷èê.
*ismsghandled &lt;public/nouser/default&gt; Âîçâðàùàåò .T., åñëè ñîîáùåíèå ïåðåäàííîå â êà÷åñòâå ïàðàìåòðà èìååò çàðåãèñòðèðîâàííûé îáðàáîò÷èê èëè .F. åñëè íå èìååò.
*gethandledmsgcount 
*gethandledmsg 
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7/>
		<reserved8>..\include\base_v1_cstmsghandler.h</reserved8>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>cstmsghandler</objname>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1></reserved1>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1530W8VEY</uniqueid>
		<timestamp>949898871</timestamp>
		<class>commandbutton</class>
		<classloc/>
		<baseclass>commandbutton</baseclass>
		<objname>cmdtlbapp_old</objname>
		<parent/>
		<properties>Height = 22
Width = 22
Caption = ""
nscrfrmid = 0
Name = "cmdtlbapp"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3>nscrfrmid
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>cmdtlbapp_old</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_R020K4VL1</uniqueid>
		<timestamp>950492070</timestamp>
		<class>toolbar</class>
		<classloc/>
		<baseclass>toolbar</baseclass>
		<objname>tlbfrm</objname>
		<parent/>
		<properties>Caption = ""
Height = 19
Width = 33
ControlBox = .T.
ShowWindow = 1
nindex = 0
lenabled = .F.
Name = "tlbfrm"
</properties>
		<protected>nindex
</protected>
		<methods>PROCEDURE Destroy
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: TLB.DESTROY
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;sysevent&gt;Âûçîâ ìåòîäà ñîõðàíåíèÿ ïîçèöèè ïàíåëè èíñòðóìåíòîâ,
*					ñîîáùåíèå Application î çàêðûòèè çàðåãèñòðèðîâàííîãî îêíà.
*-------------------------------------------------------
WITH This

*11.01.2004 13:53 -&gt;Âûçîâ ìåòîäà ñîõðàíåíèÿ ïîçèöèè ïàíåëè èíñòðóìåíòîâ
.TlbPositionSave()
*------------------------------------------------------------------------------
		
*14.12.2003 15:09 -&gt;Ñîîáùåíèå Application î çàêðûòèè çàðåãèñòðèðîâàííîãî îêíà
IF .nIndex#0 AND TYPE([oApp])==[O] AND !ISNULL(oApp)
	oApp.WindowEventDestroy(.nIndex)
ENDIF
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE handlemsg
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: TLB.HANDLEMSG
* Called by.......: &lt;.oControls[i].Click()&gt;
* Parameters......: &lt;tcMessage&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Îáðàáîòêà ñîîáùåíèÿ, ñãåíåðèðîâàííîãî êíîïêîé.
*-------------------------------------------------------
LPARAMETERS	tcMessage

WITH This

*11.01.2004 18:37 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	loActiveForm
***		
loActiveForm = oApp.WindowActiveGet()
*------------------------------------------------------------------------------

*11.01.2004 18:36 -&gt;Ïðîõîäèì ïî âñåì êíîïêàì
IF 	TYPE([loActiveForm])==[O] AND !ISNULL(loActiveForm) AND ;
	TYPE([loActiveForm.cstMsgHandler])==[O] AND !ISNULL(loActiveForm.cstMsgHandler)
	*{
	.oTimer = CREATEOBJECT([tmrtlbfrm],loActiveForm,tcMessage)
	.oTimer.Enabled = .T.
	*}
ENDIF	
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************

ENDPROC
PROCEDURE Init
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: TLB.INIT
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;sysevent&gt; Âûçîâ ìåòîäà âîññòàíîâëåíèÿ ïîçèöèè ïàíåëè èíñòðóìåíòîâ, ;
*					è ìåòîäà óñòàíîâêè àêòèâíîñòè âñå êíîïîê ïàíåëè èíñòðóìåíòîâ, ñîãëàñíî
*					íà÷àëüíîìó çíà÷åíèþ ñâîéñòâà .lEnabled.
*-------------------------------------------------------
WITH This

*11.01.2004 14:07 -&gt;Âûçîâ ìåòîäà âîññòàíîâëåíèÿ ïîçèöèè ïàíåëè èíñòðóìåíòîâ.
.TlbPositionRestore()
*------------------------------------------------------------------------------
*11.01.2004 15:59 -&gt;Óñòàíîâèì íà÷àëüíóþ àêòèâíîñòü âñåõ êíîïîê ïàíåëè èíñòðóìåíòîâ.
.SetEnabled(.lEnabled)
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE refreshenabledmsg
*-------------------------------------------------------
* Project.........: GLOBA.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: TLB.REFRESHENABLEDMSG
* Called by.......: &lt;_screen.ActiveForm.cstMsgHandler.RefreshToolBar()&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Îáíîâëåíèå äîñòóïíîñòè êàæäîé êíîïêè.
*-------------------------------------------------------
WITH This

*11.01.2004 18:37 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	loActiveForm, ;
		loControl
***		
loActiveForm = oApp.WindowActiveGet()
*------------------------------------------------------------------------------

*11.01.2004 18:36 -&gt;Ïðîõîäèì ïî âñåì êíîïêàì
IF 	TYPE([loActiveForm])==[O] AND !ISNULL(loActiveForm) AND ;
	TYPE([loActiveForm.cstMsgHandler])==[O] AND !ISNULL(loActiveForm.cstMsgHandler)
	*{
	FOR EACH loControl IN .Controls
		IF UPPER(ALLTRIM(loControl.Class))==[CMDTLBFRM]
			loControl.Enabled = loActiveForm.cstMsgHandler.IsMsgHandled(loControl._Msg)
		ENDIF
	ENDFOR
	*}
ENDIF	
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************

ENDPROC
PROCEDURE Release
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: TLB.RELEASE
* Called by.......: &lt;Misc Ext Calls&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt;Óäàëåíèå ïàíåëè èíñòðóìåíòîâ.
*-------------------------------------------------------
RELEASE This
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE setenabled
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: TLB.SETENABLED
* Called by.......: &lt;.Init(); Misc Ext Calls&gt;
* Parameters......: &lt;tlEnabled&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Ìåòîä èçìåíåíèÿ ñâîéñòâà .lEnabled.
*-------------------------------------------------------
LPARAMETERS	tlEnabled

WITH This

*11.01.2004 16:02 -&gt;Óñòàíîâèì ñâîéñòâî äîñòóïíîñòè
.lEnabled = tlEnabled
*------------------------------------------------------------------------------

*11.01.2004 16:03 -&gt;Åñëè ïàíåëü èíñòðóìåíòîâ îòêëþ÷àåòñÿ - îòêëþ÷èì âñå êíîïêè
IF !.lEnabled
	.SetAll([Enabled],.F.)
ENDIF	
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE setindex
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: TLB.SETINDEX
* Called by.......: &lt;oApp.DoToolBar()&gt;
* Parameters......: &lt;tnIndex - èíäåêñ ýêçåìïëÿðà ïàíåëè èíñòðóìåíòîâ â ìàññèâå aWindows îáúåêòà Application&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Ñîõðàíåíèå èíäåêñà ýêçåìïëÿðà ïàíåëè èíñòðóìåíòîâ â ìàññèâå
*					aWindows îáúåêòà Application â ñâîéñòâå .nIndex.
*-------------------------------------------------------
LPARAMETERS	tnIndex

*11.01.2004 14:14 -&gt;Ñîõðàíèì èíäåêñ
This.nIndex = tnIndex
*------------------------------------------------------------------------------
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE tlbpositionrestore
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: TLB.TLBPOSITIONRESTORE
* Called by.......: &lt;.Init()&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;protected/nouser/default&gt; Âîññòàíîâëåíèå ïîëîæåíèÿ ïàíåëè èñòðóìåíòîâ.
*-------------------------------------------------------
WITH This

*11.01.2004 14:15 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnDocPosition, ;
		lnLeft, ;
		lnTop, ;
		lcString
***
lnDocPosition = 0
lnLeft = 0
lnTop = 0
*------------------------------------------------------------------------------

*11.01.2004 14:15 -&gt;Âîññòàíîâèì ïîëîæåíèå ïàíåëè èíñòðóìåíòîâ
IF TYPE([oRes])==[O] AND !ISNULL(oRes)
	lcString = oRes.GetParam([ToolBarPosition],.Name,FULLPATH([User.INI]))
	IF !EMPTY(lcString) AND OCCURS([;],lcString)=2
		lnDocPosition = VAL(SUBSTR(lcString,1,AT([;],lcString)-1))
		lnLeft 		  = VAL(SUBSTR(lcString,AT([;],lcString)+1,AT([;],lcString,2)-1))
		lnTop 		  = VAL(SUBSTR(lcString,AT([;],lcString,2)+1))
	ENDIF
ENDIF
.Dock(lnDocPosition,lnLeft,lnTop)
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE tlbpositionsave
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: TLB.TLBPOSITIONSAVE
* Called by.......: &lt;.Init()&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;protected/nouser/default&gt; Ñîõðàíåíèå ïîëîæåíèÿ ïàíåëè èíñòðóìåíòîâ.
*-------------------------------------------------------
WITH This

*11.01.2004 14:24 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcString
*------------------------------------------------------------------------------

*11.01.2004 14:24 -&gt;Ñîõðàíèì ïîëîæåíèå ïàíåëè èíñòðóìåíòîâ
IF TYPE([oRes])==[O] AND !ISNULL(oRes)
	lcString =	ALLTRIM(STR(.DockPosition))+[;]+ ;
				ALLTRIM(STR(.Left))+[;]+ ;
				ALLTRIM(STR(.Top))
	oRes.WriteParam([ToolBarPosition],.Name,lcString,FULLPATH([User.INI]))
ENDIF
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3>nindex
lenabled &lt;public/runtime/design&gt; Ôëàã äîñòóïíîñòè ïàíåëè èíñòðóìåíòîâ. Äëÿ ïàíåëè èíñòðóìåíòîâ ïðèëîæåíèÿ äîëæåí áûòü âûñòàâëåí â .T., äëÿ ïàíåëè èíñòðóìåíòîâ ôîðìû äîëæåí áûòü âûñòàâëåí â .F., åãî çíà÷åíèå áóäåò ìåíÿòüñÿ ñ ïîìîùüþ  ìåòîäà .SetEnabled().
otimer
*setindex &lt;public/nouser/default&gt; Ñîõðàíåíèå èíäåêñà ýêçåìïëÿðà ôîðìû â ìàññèâå aWindows îáúåêòà Application â ñâîéñòâå .nIndex.
*tlbpositionsave 
*tlbpositionrestore 
*setenabled &lt;public/nouser/default&gt; Ìåòîä èçìåíåíèÿ ñâîéñòâà .lEnabled.
*refreshenabledmsg &lt;public/nouser/default&gt; Îáíîâëåíèå äîñòóïíîñòè êàæäîé êíîïêè.
*handlemsg &lt;public/nouser/default&gt; Îáðàáîòêà ñîîáùåíèÿ, ñãåíåðèðîâàííîãî êíîïêîé.
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7>Áàçîâûé êëàññ ToolBar</reserved7>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>tlbfrm</objname>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2D40NIXA8</uniqueid>
		<timestamp>950492162</timestamp>
		<class>olecontrol</class>
		<classloc/>
		<baseclass>olecontrol</baseclass>
		<objname>cmdtlb</objname>
		<parent/>
		<properties>Height = 50
Width = 50
nscrfrmid = 0
_msg = 
Name = "cmdtlb"
</properties>
		<protected/>
		<methods>PROCEDURE Init
*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Base_v1.vcx
* Class.Module....: cmdTlbFrm.Init
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;tcMsg,tcBmpFileNM,tcToolTipText&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Äîáàâëåíèå êíîïêè íà ïàíåëü èíñòðóìåíòîâ
*-------------------------------------------------------
LPARAMETERS tcMsg,tcBmpFileNM,tcToolTipText
RETURN
WITH This

	.image = '' &amp;&amp;FILETOSTR(.Picture)
	.Picture =''

*06.12.2004 16:55 -&gt;Åñëè óêàçàíà êàðòèíêà - ïðèöåïèì å¸
IF	TYPE([tcBmpFileNM])==[C] AND !EMPTY(tcBmpFileNM) AND !ISNULL(tcBmpFileNM) AND FILE(tcBmpFileNM)
	*.Picture = tcBmpFileNM
*	.cmd.image =FILETOSTR(tcBmpFileNM)
ENDIF
**	.cmd.Image = "gBHJJGHA5MIkAAjAD3AAAAsPEpFOAlKBwHZbPY7Mp7IsYIplQsVQpbOCQjCQjcoQqbOErPaQTcvUsrmabWEwm6lWE2Xc6nq"+;
				 "7XawWE+WFAotAXbFoDFpTFaFKpNNp1OaFVqjQbdVbdbbblr1Zctbr9ecrwrzws1oeD7sz7twBuFxuVzul1u13vF5vV7vl9v"+;
				 "1/wGBwWDwmFw2HxGJxWLxmNx2PyGLhoAEL5AgBhr/AAsyYAhEKAAIzT/BIcJCwUDBQYICb+NZBQTERQWFpWJCcbBCULFQom"+;
				 "LCwCDBWKhY6OEhSHi8LDQQiLSYoKaiMiRQSEBASFBGLxESJCUpNTYsIqoSBoKLEZqfFJbUTYRKQYhOT5AP6yDARYTEBIVA5"+;
				 "VFg8HAMAhmkTYNhiPA0EUYRQCoCoWigJAgBAQJiiqSgRBgNByjUeBAgQRAVioSBUFAQAAkOVYRBkLAsDWAQVCCCQJBAIwqD"+;
				 "CERCAOBoIgoShekyIRiG8BwuCuChOCAIRYCIChCh6MBkEgQJAi6So0mqIxLCYaBAjAXAVBgQ4YG4AJhkMYgHiUXBsFwa5hk"+;
				 "QU5SASJR8HACA3C4CgTiYGB6lATJZnOBQ0hCe5miaOBhEMc4RCgfAnEaXIYDWVoJAoFBcDAEQTCEBRnmGeZqj8HAYjqeBwg"+;
				 "8LQLhwWAOFCQgEgSYBDm+AARDMYhvmqK4NgQUBgB2YQEgkDAYAALJ5iCE4pDyYAkhAQAAAeCBCkgBQEl4KpAkAB4KFwAI3j"+;
				 "AJoiGAQQHngCgqkIU5AlgYAAAYZAbg+BAHDa1AAAiKgqGoAIJEAOoNASB4GEgQA5gKPxgGARQSCqAAxjKU5UhgQIAgOKgcG"+;
				 "+AQeEkehngMBIaAAcg0iYBwQCCPADhYLBAEkAZAmgEgEFOIIiAEAhwhKRJyiAEgaEgABLkEVIAHMOYFkcPIoEyBIqAAaIBg"+;
				 "mKAYHKAA3BMUhBAIIoHFIAQCjyLQSDIUBCAsNR0FCRATFUdBREYGw9CgIAAB2gIA=="
*------------------------------------------------------------------------------

*06.12.2004 16:55 -&gt;Åñëè óêàçàí ToolTipText - óêàæåì
IF	TYPE([tcToolTipText])==[C] AND !EMPTY(tcToolTipText) AND !ISNULL(tcToolTipText)
	.ToolTipText = tcToolTipText
ENDIF
*12.05.2004 13:44 -&gt;Åñëè äèíàìè÷åñêîå ïîñòðîåíèå ïàíåëè èíñòðóìåíòîâ - íàñòðîèì êíîïêó
IF !EMPTY(tcMsg)
	*06.12.2004 16:55 -&gt;Ñîõðàíèì ñîîáùåíèå
	._msg = ALLTRIM(tcMsg)
	*------------------------------------------------------------------------------
	*------------------------------------------------------------------------------
ENDIF
*------------------------------------------------------------------------------
	
ENDWITH
DODEFAULT()
SET STEP ON
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
</methods>
		<objcode/>
		<ole>0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7////+/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABCTWK4DsMgBAwAAAMABAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAEAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAA4AAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAQAAAAAAAAAAwAAAP7////+////BAAAAAUAAAAGAAAA/v////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////86IKLzKGt0Sp3JQGXRwKKdAAMAACsFAAArBQAAAwAAAAAAAwAAAAAAEwDw8PAAEwASAACACQAAAAAAAAAAAAAAOAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB3AAAAAAAAAAEAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAd3cAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAADADAAAAADAAAAAAADAAAAAAADAPQBAAADAIgTAAALAP//CAACAAAAAAAIABgAAABPAGwAZQBjAG8AbgB0AHIAbwBsADEAAAADAAEAAAAIAAIAAAAAAAgAAgAAAAAAAwAAAAAAAwABAAAACwAAAAMAAAAAAAsA//8LAAAAAwABAAAAAwABAAAACwAAAAkAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAMAAAAAAAMAAAAAAAsAAAAJAANS4wuRj84RneMAqgBLuFEBAQAAkAGAOAEABUFyaWFsAwDEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/AAD/AAD/AAAAAAAAAA==</ole>
		<ole2>OLEObject = C:\WINDOWS\system32\ExButton.dll
</ole2>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3>nscrfrmid
_msg
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>cmdtlb</objname>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2CX0Q70QW</uniqueid>
		<timestamp>950492898</timestamp>
		<class>cnt</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cmdtlbfrm_ex</objname>
		<parent/>
		<properties>Width = 50
Height = 50
_msg = 
Name = "cmdtlbfrm"
</properties>
		<protected/>
		<methods>PROCEDURE Click
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: CMDTLB.CLICK
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;sysevent&gt; Ãåíåðèðóåì ñîîáùåíèå
*-------------------------------------------------------
SET STEP ON
*11.01.2004 18:59 -&gt;Ãåíåðèðóåì ñîîáùåíèå
This.parent.HandleMsg(This._Msg)
*------------------------------------------------------------------------------

************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE Init
*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Base_v1.vcx
* Class.Module....: cmdTlbFrm.Init
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;tcMsg,tcBmpFileNM,tcToolTipText&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Äîáàâëåíèå êíîïêè íà ïàíåëü èíñòðóìåíòîâ
*-------------------------------------------------------
LPARAMETERS tcMsg,tcBmpFileNM,tcToolTipText

WITH This

	.cmd.image ='' &amp;&amp;FILETOSTR(.Picture)
	.Picture =''
	
*06.12.2004 16:55 -&gt;Åñëè óêàçàíà êàðòèíêà - ïðèöåïèì å¸
IF	TYPE([tcBmpFileNM])==[C] AND !EMPTY(tcBmpFileNM) AND !ISNULL(tcBmpFileNM) AND FILE(tcBmpFileNM)
	*.Picture = tcBmpFileNM
*	.cmd.image =FILETOSTR(tcBmpFileNM)
ENDIF
**	.cmd.Image = "gBHJJGHA5MIkAAjAD3AAAAsPEpFOAlKBwHZbPY7Mp7IsYIplQsVQpbOCQjCQjcoQqbOErPaQTcvUsrmabWEwm6lWE2Xc6nq"+;
				 "7XawWE+WFAotAXbFoDFpTFaFKpNNp1OaFVqjQbdVbdbbblr1Zctbr9ecrwrzws1oeD7sz7twBuFxuVzul1u13vF5vV7vl9v"+;
				 "1/wGBwWDwmFw2HxGJxWLxmNx2PyGLhoAEL5AgBhr/AAsyYAhEKAAIzT/BIcJCwUDBQYICb+NZBQTERQWFpWJCcbBCULFQom"+;
				 "LCwCDBWKhY6OEhSHi8LDQQiLSYoKaiMiRQSEBASFBGLxESJCUpNTYsIqoSBoKLEZqfFJbUTYRKQYhOT5AP6yDARYTEBIVA5"+;
				 "VFg8HAMAhmkTYNhiPA0EUYRQCoCoWigJAgBAQJiiqSgRBgNByjUeBAgQRAVioSBUFAQAAkOVYRBkLAsDWAQVCCCQJBAIwqD"+;
				 "CERCAOBoIgoShekyIRiG8BwuCuChOCAIRYCIChCh6MBkEgQJAi6So0mqIxLCYaBAjAXAVBgQ4YG4AJhkMYgHiUXBsFwa5hk"+;
				 "QU5SASJR8HACA3C4CgTiYGB6lATJZnOBQ0hCe5miaOBhEMc4RCgfAnEaXIYDWVoJAoFBcDAEQTCEBRnmGeZqj8HAYjqeBwg"+;
				 "8LQLhwWAOFCQgEgSYBDm+AARDMYhvmqK4NgQUBgB2YQEgkDAYAALJ5iCE4pDyYAkhAQAAAeCBCkgBQEl4KpAkAB4KFwAI3j"+;
				 "AJoiGAQQHngCgqkIU5AlgYAAAYZAbg+BAHDa1AAAiKgqGoAIJEAOoNASB4GEgQA5gKPxgGARQSCqAAxjKU5UhgQIAgOKgcG"+;
				 "+AQeEkehngMBIaAAcg0iYBwQCCPADhYLBAEkAZAmgEgEFOIIiAEAhwhKRJyiAEgaEgABLkEVIAHMOYFkcPIoEyBIqAAaIBg"+;
				 "mKAYHKAA3BMUhBAIIoHFIAQCjyLQSDIUBCAsNR0FCRATFUdBREYGw9CgIAAB2gIA=="
*------------------------------------------------------------------------------

*06.12.2004 16:55 -&gt;Åñëè óêàçàí ToolTipText - óêàæåì
IF	TYPE([tcToolTipText])==[C] AND !EMPTY(tcToolTipText) AND !ISNULL(tcToolTipText)
	.cmd.ToolTipText = tcToolTipText
ENDIF
*12.05.2004 13:44 -&gt;Åñëè äèíàìè÷åñêîå ïîñòðîåíèå ïàíåëè èíñòðóìåíòîâ - íàñòðîèì êíîïêó
IF !EMPTY(tcMsg)
	*06.12.2004 16:55 -&gt;Ñîõðàíèì ñîîáùåíèå
	._msg = ALLTRIM(tcMsg)
	*------------------------------------------------------------------------------
	*------------------------------------------------------------------------------
ENDIF
*------------------------------------------------------------------------------
	
ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>2</reserved2>
		<reserved3>_msg
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2CX0Q82T3</uniqueid>
		<timestamp>949904082</timestamp>
		<class>olecontrol</class>
		<classloc/>
		<baseclass>olecontrol</baseclass>
		<objname>cmd</objname>
		<parent>cmdtlbfrm_ex</parent>
		<properties>Top = 0
Left = 0
Height = 50
Width = 50
Name = "cmd"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole>0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7////+/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKD+m+QGsMgBAwAAAMABAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALgEAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAA4AAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAADQAAAAAAAAAAwAAAP7////+////BAAAAAUAAAAGAAAA/v////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////86IKLzKGt0Sp3JQGXRwKKdAAMAACsFAAArBQAAAwAAAAAAAwAAAAAAEwD///8AEwAIAACACQADUuMLkY/OEZ3jOAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAC+tQAA/wAAAAEAAIAIAAAAQ2FwdGlvbgAJAAAASAAAAAAAAAAABgAAAFN0YXRlAAkAAABJCgAAAAAAAAAAAAAAAAAAAAAAAAAAqgBLuFEBAAAAkAFEQgEABUFyaWFsCQAAAAAAAAAAAAAAAAAAAAAAAwAwAAAAAwAAAAAAAwAAAAAAAwD0AQAAAwCIEwAACwD//wgAAgAAAAAACAACAAAAAAADAAEAAAAIAAIAAAAAAAgAAgAAAAAAAwAAAAAAAwABAAAACwAAAAMAAAAAAAsA//8LAAAAAwABAAAAAwABAAAACwAAAAkAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAMAAAAAAAMAAAAAAAsAAAAJAANS4wuRj84RneMAqgBLuFEBAQAAkAGAOAEABUFyaWFsAwDEAAAAcwBWAFEAcABiAE8AQwBRAGoAQwBRAGoAYwBvAFEAcQBiAE8ARQByAFAAYQBRAFQAYwB2AFUAcwByAG0AYQBiAFcARQB3AG0ANgBsAFcARQAyAA==</ole>
		<ole2>OLEObject = C:\WINDOWS\system32\ExButton.dll
</ole2>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>cmdtlbfrm_ex</objname>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2CX0Q70QW</uniqueid>
		<timestamp>950492923</timestamp>
		<class>cnt</class>
		<classloc>base_v1.vcx</classloc>
		<baseclass>container</baseclass>
		<objname>cmdtlbapp_ex</objname>
		<parent/>
		<properties>Width = 50
Height = 50
_msg = 
nscrfrmid = 0
Name = "cmdtlbapp"
</properties>
		<protected/>
		<methods>PROCEDURE Click
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: CMDTLB.CLICK
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;sysevent&gt; Ãåíåðèðóåì ñîîáùåíèå
*-------------------------------------------------------
SET STEP ON
*11.01.2004 18:59 -&gt;Ãåíåðèðóåì ñîîáùåíèå
This.parent.HandleMsg(This._Msg)
*------------------------------------------------------------------------------

************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE Init
*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Base_v1.vcx
* Class.Module....: cmdTlbFrm.Init
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;tcMsg,tcBmpFileNM,tcToolTipText&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Äîáàâëåíèå êíîïêè íà ïàíåëü èíñòðóìåíòîâ
*-------------------------------------------------------
LPARAMETERS tcMsg,tcBmpFileNM,tcToolTipText

WITH This

	.cmd.image ='' &amp;&amp;FILETOSTR(.Picture)
	.Picture =''
	
*06.12.2004 16:55 -&gt;Åñëè óêàçàíà êàðòèíêà - ïðèöåïèì å¸
IF	TYPE([tcBmpFileNM])==[C] AND !EMPTY(tcBmpFileNM) AND !ISNULL(tcBmpFileNM) AND FILE(tcBmpFileNM)
	*.Picture = tcBmpFileNM
*	.cmd.image =FILETOSTR(tcBmpFileNM)
ENDIF
**	.cmd.Image = "gBHJJGHA5MIkAAjAD3AAAAsPEpFOAlKBwHZbPY7Mp7IsYIplQsVQpbOCQjCQjcoQqbOErPaQTcvUsrmabWEwm6lWE2Xc6nq"+;
				 "7XawWE+WFAotAXbFoDFpTFaFKpNNp1OaFVqjQbdVbdbbblr1Zctbr9ecrwrzws1oeD7sz7twBuFxuVzul1u13vF5vV7vl9v"+;
				 "1/wGBwWDwmFw2HxGJxWLxmNx2PyGLhoAEL5AgBhr/AAsyYAhEKAAIzT/BIcJCwUDBQYICb+NZBQTERQWFpWJCcbBCULFQom"+;
				 "LCwCDBWKhY6OEhSHi8LDQQiLSYoKaiMiRQSEBASFBGLxESJCUpNTYsIqoSBoKLEZqfFJbUTYRKQYhOT5AP6yDARYTEBIVA5"+;
				 "VFg8HAMAhmkTYNhiPA0EUYRQCoCoWigJAgBAQJiiqSgRBgNByjUeBAgQRAVioSBUFAQAAkOVYRBkLAsDWAQVCCCQJBAIwqD"+;
				 "CERCAOBoIgoShekyIRiG8BwuCuChOCAIRYCIChCh6MBkEgQJAi6So0mqIxLCYaBAjAXAVBgQ4YG4AJhkMYgHiUXBsFwa5hk"+;
				 "QU5SASJR8HACA3C4CgTiYGB6lATJZnOBQ0hCe5miaOBhEMc4RCgfAnEaXIYDWVoJAoFBcDAEQTCEBRnmGeZqj8HAYjqeBwg"+;
				 "8LQLhwWAOFCQgEgSYBDm+AARDMYhvmqK4NgQUBgB2YQEgkDAYAALJ5iCE4pDyYAkhAQAAAeCBCkgBQEl4KpAkAB4KFwAI3j"+;
				 "AJoiGAQQHngCgqkIU5AlgYAAAYZAbg+BAHDa1AAAiKgqGoAIJEAOoNASB4GEgQA5gKPxgGARQSCqAAxjKU5UhgQIAgOKgcG"+;
				 "+AQeEkehngMBIaAAcg0iYBwQCCPADhYLBAEkAZAmgEgEFOIIiAEAhwhKRJyiAEgaEgABLkEVIAHMOYFkcPIoEyBIqAAaIBg"+;
				 "mKAYHKAA3BMUhBAIIoHFIAQCjyLQSDIUBCAsNR0FCRATFUdBREYGw9CgIAAB2gIA=="
*------------------------------------------------------------------------------

*06.12.2004 16:55 -&gt;Åñëè óêàçàí ToolTipText - óêàæåì
IF	TYPE([tcToolTipText])==[C] AND !EMPTY(tcToolTipText) AND !ISNULL(tcToolTipText)
	.cmd.ToolTipText = tcToolTipText
ENDIF
*12.05.2004 13:44 -&gt;Åñëè äèíàìè÷åñêîå ïîñòðîåíèå ïàíåëè èíñòðóìåíòîâ - íàñòðîèì êíîïêó
IF !EMPTY(tcMsg)
	*06.12.2004 16:55 -&gt;Ñîõðàíèì ñîîáùåíèå
	._msg = ALLTRIM(tcMsg)
	*------------------------------------------------------------------------------
	*------------------------------------------------------------------------------
ENDIF
*------------------------------------------------------------------------------
	
ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>2</reserved2>
		<reserved3>_msg
nscrfrmid
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_2CX0Q82T3</uniqueid>
		<timestamp>949904082</timestamp>
		<class>olecontrol</class>
		<classloc/>
		<baseclass>olecontrol</baseclass>
		<objname>cmd</objname>
		<parent>cmdtlbapp_ex</parent>
		<properties>Top = 0
Left = 0
Height = 50
Width = 50
Name = "cmd"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole>0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7////+/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACDG5gEHsMgBAwAAAMABAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALgEAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAA4AAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAADQAAAAAAAAAAwAAAP7////+////BAAAAAUAAAAGAAAA/v////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////86IKLzKGt0Sp3JQGXRwKKdAAMAACsFAAArBQAAAwAAAAAAAwAAAAAAEwD///8AEwAIAACACQADUuMLkY/OEZ3jOAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAC+tQAA/wAAAAEAAIAIAAAAQ2FwdGlvbgAJAAAASAAAAAAAAAAABgAAAFN0YXRlAAkAAABJCgAAAAAAAAAAAAAAAAAAAAAAAAAAqgBLuFEBAAAAkAFEQgEABUFyaWFsCQAAAAAAAAAAAAAAAAAAAAAAAwAwAAAAAwAAAAAAAwAAAAAAAwD0AQAAAwCIEwAACwD//wgAAgAAAAAACAACAAAAAAADAAEAAAAIAAIAAAAAAAgAAgAAAAAAAwAAAAAAAwABAAAACwAAAAMAAAAAAAsA//8LAAAAAwABAAAAAwABAAAACwAAAAkAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAMAAAAAAAMAAAAAAAsAAAAJAANS4wuRj84RneMAqgBLuFEBAQAAkAGAOAEABUFyaWFsAwDEAAAAcwBWAFEAcABiAE8AQwBRAGoAQwBRAGoAYwBvAFEAcQBiAE8ARQByAFAAYQBRAFQAYwB2AFUAcwByAG0AYQBiAFcARQB3AG0ANgBsAFcARQAyAA==</ole>
		<ole2>OLEObject = C:\WINDOWS\system32\ExButton.dll
</ole2>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>cmdtlbapp_ex</objname>
		<parent/>
		<properties/>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1530W8VEY</uniqueid>
		<timestamp>953649673</timestamp>
		<class>commandbutton</class>
		<classloc/>
		<baseclass>commandbutton</baseclass>
		<objname>cmdtlbfrm</objname>
		<parent/>
		<properties>Height = 30
Width = 34
Caption = ""
SpecialEffect = 2
_msg = 
Name = "cmdtlbfrm"
</properties>
		<protected/>
		<methods>PROCEDURE Click
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: CMDTLB.CLICK
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;sysevent&gt; Ãåíåðèðóåì ñîîáùåíèå
*-------------------------------------------------------

*11.01.2004 18:59 -&gt;Ãåíåðèðóåì ñîîáùåíèå
This.parent.HandleMsg(This._Msg)
*------------------------------------------------------------------------------

************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE Init
*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Base_v1.vcx
* Class.Module....: cmdTlbFrm.Init
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;tcMsg,tcBmpFileNM,tcToolTipText&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Äîáàâëåíèå êíîïêè íà ïàíåëü èíñòðóìåíòîâ
*-------------------------------------------------------
LPARAMETERS tcMsg,tcBmpFileNM,tcToolTipText

WITH This

*12.05.2004 13:44 -&gt;Åñëè äèíàìè÷åñêîå ïîñòðîåíèå ïàíåëè èíñòðóìåíòîâ - íàñòðîèì êíîïêó
IF !EMPTY(tcMsg)
	*06.12.2004 16:55 -&gt;Ñîõðàíèì ñîîáùåíèå
	._msg = ALLTRIM(tcMsg)
	*------------------------------------------------------------------------------
	
	*06.12.2004 16:55 -&gt;Åñëè óêàçàíà êàðòèíêà - ïðèöåïèì å¸
	IF	TYPE([tcBmpFileNM])==[C] AND !EMPTY(tcBmpFileNM) AND !ISNULL(tcBmpFileNM) AND FILE(tcBmpFileNM)
		.Picture = tcBmpFileNM
	ENDIF
	*------------------------------------------------------------------------------
	
	*06.12.2004 16:55 -&gt;Åñëè óêàçàí ToolTipText - óêàæåì
	IF	TYPE([tcToolTipText])==[C] AND !EMPTY(tcToolTipText) AND !ISNULL(tcToolTipText)
		.ToolTipText = tcToolTipText
	ENDIF
	*------------------------------------------------------------------------------
ENDIF
*------------------------------------------------------------------------------
	
ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3>_msg &lt;public/design&gt; Ñîîáùåíèå, êîòîðîå ãåíåðèðóåòñÿ ïðè íàæàòèè äàííîé êíîïêè.
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>cmdtlbfrm</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_1530W8VEY</uniqueid>
		<timestamp>953649686</timestamp>
		<class>commandbutton</class>
		<classloc/>
		<baseclass>commandbutton</baseclass>
		<objname>cmdtlbapp</objname>
		<parent/>
		<properties>Height = 30
Width = 34
Caption = ""
SpecialEffect = 2
nscrfrmid = 0
Name = "cmdtlbapp"
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3>nscrfrmid
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>cmdtlbapp</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_13Z0ZHENJ</uniqueid>
		<timestamp>959073719</timestamp>
		<class>grid</class>
		<classloc/>
		<baseclass>grid</baseclass>
		<objname>grd</objname>
		<parent/>
		<properties>AllowHeaderSizing = .F.
AllowRowSizing = .F.
DeleteMark = .F.
Height = 200
Highlight = .F.
ReadOnly = .T.
RecordMark = .T.
SplitBar = .F.
Width = 313
lgridactive = .F.
ersstate = 0
nrsrecno = 0
_handledstandartmsglist = FIRST;PREV;NEXT;LAST;;ADD;EDIT;INFO;DELE;COPY;;FIND;;PRNDOC;PRNREP;;EXCEL
_handledcustommsglist = 
_refreshhandledcustommsglistonrsrecnochange = .T.
_refreshhandledstandartmsglistonrsrecnochange = .F.
_refreshhandledstandartmsglistonrsstatechange = .T.
_refreshhandledcustommsglistonrsstatechange = .T.
_positionkeyslist = 
csortedcdxfile = 
csortedcolumn = 
nsortedheaderoldcolor = 0
nsortedtype = 0
_sortedheadercolorasc = [up.bmp]
_sortedheadercolordesc = [down.bmp]
_allowresize = .T.
resizekf = 0
_refreshrelatedobjectsonrsrecnochange = .T.
_dynamicimagecolumnindex = 0
_dynamicimagealias = 
_dynamicimagefieldnamefilename = 
_dynamicimagefieldnameindex = 
_handledstandartmsgpromptlist = ;;;;;Äîáàâèòü;Ðåäàêòèðîâàòü;Ïðîñìîòð;Óäàëèòü;Ñêîïèðîâàòü;\-;Ïîèñê;\-;Ïîäãîòîâèòü äîêóìåíò;Ïîäãîòîâèòü îò÷åò;\-;Ýêñïîðò â Excel
_handledcustommsgpromptlist = 
_interactivesearchdefaultmode = 1
_interactivesearchallowlocate = .T.
_interactivesearchallowfilter = .T.
lnoextendedrefresh = .F.
lhotkeyset = .F.
_activerowhighlight = .F.
_activerowhighlightcoloractive = RGB(0,0,128)
_activerowhighlightcolorunactive = RGB(128,0,0)
ccursorsetold = 
lcursorset = .F.
_activerowhighlightexcludecolumnlist = 
_allowsaveandrestorelayout = .T.
cexceltablecaption = 
_columndisalist = 
chandledstandartmsglist = .F.
chandledcustommsglist = .F.
Name = "grd"
</properties>
		<protected>csortedcdxfile
csortedcolumn
nsortedheaderoldcolor
nsortedtype
ccursorsetold
lcursorset
refreshhandledstandartmsglist
refreshhandledcustommsglist
apositionkeysvalues
asources
filterregister
interactivesearch
interactivesearchreset
interactivesearchsetmode
activerowhighlightset
</protected>
		<methods>PROCEDURE _excel
*------------------------------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Base_v1.vcx
* Class.Module....: GRD._EXCEL
* Called by.......: &lt;.HandleMsg([FIRST])&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Ýêñïîðò äàííûõ â Excel
*------------------------------------------------------------------------------

*10.03.2006 16:37 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	llError, ;
		lcRSAlias, ;
		loExcel, ;
		lcErrorMsg, ;
		lnSheetCnt, ;
		lnColumnCnt, ;
		lnGridColumnCnt, ;
		lnRecNo, ;
		lnRowCnt, ;
		lcCaption, ;
		lcFileNM, ;
		loError AS Exception
***
llError = .F.
*------------------------------------------------------------------------------

WITH This

*10.03.2006 16:39 -&gt;Ïðîâåðèì âîçìîæíîñòü ýêñïîðòà
IF EMPTY(.RecordSource) OR ;
!USED(.RecordSource) OR ;
!INLIST(.RecordSourceType,0,1)
	***
	RETURN .F.
	***
ENDIF
*------------------------------------------------------------------------------

*10.03.2006 16:42 -&gt;Ñîõðàíèì èìÿ RS
lcRSAlias = .RecordSource
*------------------------------------------------------------------------------

*10.03.2006 16:45 -&gt;Ñîçäàäèì îáúåêò Excel
WAIT WINDOW [Ñîçäàäèì îáúåêò Excel] NOWAIT NOCLEAR
SET MESSAGE TO [Ñîçäàäèì îáúåêò Excel]
***
TRY
	***
	loExcel = GETOBJECT(.Name, [Excel.Application])
	IF ISNULL(loExcel)
		***
		llError = .T.
		***
		WAIT CLEAR
		SET MESSAGE TO []
		***
	ENDIF
	***
CATCH TO loError
llError = .T.
lcErrorMsg = [Îøèáêà ¹ :]	 + ALLTRIM(STR(loError.ErrorNo)) + CHR(13) + ;
				 [Òåñò îøèáêè :] + loError.Message + CHR(13) + ;
				 [Êîìàíäà :]	 + loError.LineContents
MESSAGEBOX(lcErrorMsg,[Îøèáêà âûãðóçêè äàííûõ â Excel!],1)
ENDTRY
***

IF llError
RETURN .F.
ENDIF
*------------------------------------------------------------------------------

*10.03.2006 16:52 -&gt;Ñîçäàåì ëèñò
WAIT WINDOW [Ôîðìèðóåì ðàáî÷èé ëèñò Excel] NOWAIT NOCLEAR
SET MESSAGE TO [Ôîðìèðóåì ðàáî÷èé ëèñò Excel]
***
WITH loExcel
	.WorkBooks.Add
	.DisplayAlerts = .F.
	FOR lnSheetCnt = 1 TO .Sheets.Count - 1
		.Sheets(lnSheetCnt ).Delete
	ENDFOR
	.Sheets(1).Select
	.Sheets(1).Name = [Ëèñò1]
ENDWITH
*------------------------------------------------------------------------------

*10.03.2006 16:55 -&gt;Îïðåäåëÿåì àòðèáóòû ëèñòà
*10.03.2006 16:57 -&gt;Ôîðìèðóåì çàãîëîâêè ñòîëáöîâ
WAIT WINDOW [Ôîðìèðóåì çàãîëîâêè ñòîëáöîâ òàáëèöû Excel] NOWAIT NOCLEAR
SET MESSAGE TO [Ôîðìèðóåì çàãîëîâêè ñòîëáöîâ òàáëèöû Excel]
***
FOR lnColumnCnt = 1 TO .ColumnCount
	***
	WITH loExcel.Cells(3,1)
		.Value = [¹ ï/ï]
		.HorizontalAlignment = 3
		.Orientation = 0
		.WrapText	 = .F.
		.ShrinkToFit = .F.
		.MergeCells	 = .F.
		WITH .Font
			.Bold = .T.
			.Size = 12
		ENDWITH
	ENDWITH
	***
	WITH loExcel.Cells(3,lnColumnCnt+1)
		FOR lnGridColumnCnt = 1 TO This.ColumnCount
			IF lnColumnCnt = This.Columns(lnGridColumnCnt).ColumnOrder
			.Value = This.Columns(lnGridColumnCnt).Header1.Caption
				EXIT
			ENDIF
		ENDFOR
		.HorizontalAlignment = 3
		.Orientation = 0
		.WrapText	 = .F.
		.ShrinkToFit = .F.
		.MergeCells	 = .F.
		WITH .Font
			.Bold = .T.
			.Size = 12
		ENDWITH
	ENDWITH
ENDFOR
*------------------------------------------------------------------------------


*10.03.2006 17:05 -&gt;Âûãðóæàåì äàííûå â Excel
WAIT WINDOW [Âûãðóæàåì äàííûå â Excel] NOWAIT NOCLEAR
SET MESSAGE TO [Âûãðóæàåì äàííûå â Excel]
***
lnRecno = IIF(EOF(lcRSAlias),0,RECNO(lcRSAlias))
SELECT (lcRSAlias)
GOTO TOP
lnRowCnt = 5

*10.03.2006 17:11 -&gt;Ñîõðàíÿåì äàííûå â ÿ÷åéêó
SCAN
	***
	loExcel.Cells(lnRowCnt,1).Value = lnRowCnt-4
	FOR lnColumnCnt = 1 TO .ColumnCount
		luValue = []
		FOR lnGridColumnCnt = 1 TO .ColumnCount
			IF lnColumnCnt = .Columns(lnGridColumnCnt).ColumnOrder
				luValue = EVALUATE(.Columns(lnGridColumnCnt).ControlSource)
				EXIT
			ENDIF
		ENDFOR
	
		*10.03.2006 17:09 -&gt;Ôîðìàòèðîâàíèå ÿ÷åéêè Excel â ñîîòâåòñòâèè ñ òèïîì äàííûõ
		WITH loExcel.Cells(lnRowCnt,lnColumnCnt+1)
			DO CASE
				CASE VARTYPE(luValue) == [N]
					.Value = IIF(luValue=0,[],luValue)
				CASE VARTYPE(luValue) == [C]
					.Value = ALLTRIM(luValue)
				CASE VARTYPE(luValue) == [D]
					.Value = IIF(EMPTY(luValue),[],luValue)
					.NumberFormat = [m/d/yyyy]
				CASE VARTYPE(luValue) == [T]
					.Value = IIF(EMPTY(luValue),[],luValue)
					.NumberFormat = [m/d/yyyy h:mm]
				OTHERWISE
					.Value = luValue
			ENDCASE
		ENDWITH
	ENDFOR
	***
	lnRowCnt = lnRowCnt + 1
	***
ENDSCAN
*------------------------------------------------------------------------------

loExcel.Columns("A:AZ").EntireColumn.AutoFit
*------------------------------------------------------------------------------

*30.03.2006 10:56 -&gt;Ñîõðàíèì êîëè÷åñòâî êîëîíîê
lnColumnCnt = .ColumnCount

*10.03.2006 17:14 -&gt;Ïðÿ÷åì íåâèäèìûå êîëîíêè
FOR lnGrigColumnCnt = 1 TO .ColumnCount
	IF (.Columns(lnGrigColumnCnt).Width &lt;= 0) OR !.Columns(lnGrigColumnCnt).Visible
loExcel.Columns(loSource.Columns(lnGrigColumnCnt).ColumnOrder + 1).Select
loExcel.Selection.EntireColumn.Hidden = .T.
lnColumnCnt = lnColumnCnt - 1
	ENDIF
ENDFOR
*------------------------------------------------------------------------------

*10.03.2006 17:13 -&gt;Ôîðìèðóåì çàãîëîâîê òàáëèöû Excel
IF !EMPTY(This.cExcelTableCaption)
	
	*30.03.2006 10:58 -&gt;Îòôîðìàòèðóåì çàãîëîâîê
	loExcel.Range([A1:]+CHR(ASC([A])+lnColumnCnt)+[1]).Select
	WITH loExcel.Selection
	.HorizontalAlignment = -4108 &amp;&amp; xlCenter
		.MergeCells = .T.
	ENDWITH
	*------------------------------------------------------------------------------

	*30.03.2006 10:58 -&gt;Ñîõðàíèì çàãîëîâîê
	WITH loExcel.Cells(1, 1)
		.Value = This.cExcelTableCaption
		WITH .Font
			.Bold = .T.
			.Size = 14
		ENDWITH
	ENDWITH
	*------------------------------------------------------------------------------
	
ENDIF
*------------------------------------------------------------------------------

*10.03.2006 17:15 -&gt;Âåðíåìñÿ íà èñõîäíóþ çàïèñü
IF lnRecNo &gt; 0
GOTO (lnRecno)
ENDIF
*------------------------------------------------------------------------------

*10.03.2006 17:15 -&gt;Ñîõðàíÿåì ôàéë
IF PEMSTATUS(This.Parent,[CAPTION],5) AND !EMPTY(This.Parent.Caption)
loExcel.Workbooks(1).SaveAs(This.Parent.Caption)
ENDIF
*------------------------------------------------------------------------------

*10.03.2006 17:16 -&gt;Çàêðûâàåì ôàéë
IF VARTYPE(loExcel) == [O] AND !ISNULL(loExcel)
	loExcel.Quit
ENDIF
*------------------------------------------------------------------------------

*10.03.2006 17:16 -&gt;Óäàëÿåì èç ïàìÿòè Excel
RELEASE loExcel
*------------------------------------------------------------------------------

ENDWITH

*10.03.2006 17:20 -&gt;Óáåðåì ñîîáùåíèÿ
WAIT CLEAR
SET MESSAGE TO []
*------------------------------------------------------------------------------

RETURN .T.
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE _first
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD._FIRST
* Called by.......: &lt;.HandleMsg([FIRST])&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Îáðàáîòêà ñòàíäàðòíîãî ñîîáùåíèÿ FIRST. Ïåðåõîä íà ïåðâóþ çàïèñü.
*-------------------------------------------------------
WITH This

*11.01.2004 19:02 -&gt;Ïðîâåðèì â òîì ëè ìû ñîñòîÿíèè, ÷òî áû ïåðåéòè íà ïåðâóþ çàïèñü.
IF !INLIST(.eRSState,__RS_MIDDLE,__RS_EOF)
	ASSERT .F. MESSAGE [GRD._PREV: â äàííîì ñîñòîÿíèè Grid íå ìîæåò ïåðåéòè íà ïåðâóþ çàïèñü.]
	RETURN .F.
ENDIF
*------------------------------------------------------------------------------

*23.04.2004 12:46 -&gt;Äëÿ êîððåêòíîãî ó÷åòà ÏÎÈÑÊîâ ïðè íàâèãàöèè
.FilterApply(.T.)
*------------------------------------------------------------------------------

*11.01.2004 19:04 -&gt;Ïåðåéäåì íà ïåðâóþ çàïèñü.
GO TOP IN (.RecordSource)
*------------------------------------------------------------------------------

*23.04.2004 12:46 -&gt;Äëÿ êîððåêòíîãî ó÷åòà ÏÎÈÑÊîâ ïðè íàâèãàöèè
.FilterApply()
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE _gethandledcustommsglist
*-------------------------------------------------------
* Project.........:	BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD._GETHANDLEDCUSTOMMSGLIST
* Called by.......: &lt;.RefreshHandledCustomMsgList();.RightClick()&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;lcHandledCustomMsgList&gt;
* Notes...........: &lt;public/user/nodefault&gt; Ôîðìèðîâàíèå ñïèñêà ïîëüçîâàòåëüñêèõ ñîîáùåíèé íà îñíîâàíèè
*					ñïèñêà ñîîáùåíèé, óêàçàííûõ â ñâîéñòâå ._HandledCustomMsgList, ïóòåì óäàëåíèÿ ñîîáùåíèé,
*					êîòîðûå íå ìîãóò áûòü îáðàáîòàíû â äàííîì êîíòåêñòå.
*-------------------------------------------------------
WITH This

*27.03.2006 11:05 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcHandledCustomMsgList, ;
		lcHandledCustomMsgCount, ;
		lcHandledCustomMsg
*------------------------------------------------------------------------------
IF EMPTY(this.cHandledCustomMsgList)
*27.03.2006 11:04 -&gt; Äîáàâëÿåì ñëåâà è ñïðàâà ïî ; ÷òîáû êîððåêòíî îáðàáûòûâàòü "êðàéíèå" ñîîáùåíèÿ
lcHandledCustomMsgList = [;]+UPPER(ALLTRIM(._HandledCustomMsgList))+[;]
*------------------------------------------------------------------------------

*27.03.2006 10:04 -&gt; Ïðîâåðêà ïðàâ ïîëüçîâàòåëÿ
lcHandledCustomMsgCount = OCCURS([;],lcHandledCustomMsgList) - 1
FOR lnCounter = lcHandledCustomMsgCount TO 1 STEP -1
	lcHandledCustomMsg = SUBSTR(lcHandledCustomMsgList,AT([;],lcHandledCustomMsgList,lnCounter)+1,AT([;],lcHandledCustomMsgList,lnCounter+1)-AT([;],lcHandledCustomMsgList,lnCounter)-1)
	IF !_spVerifyUserGrant(oApp.nUserKod, [CustomFunc], lcHandledCustomMsg)
		lcHandledCustomMsgList = STRTRAN(lcHandledCustomMsgList,[;] + lcHandledCustomMsg + [;],[;])
	ENDIF
ENDFOR
*------------------------------------------------------------------------------
this.cHandledCustomMsgList = lcHandledCustomMsgList
ENDIF
*27.03.2006 11:04 -&gt; Âåðíåì ñïèñîê ñîîáùåíèé
RETURN this.cHandledCustomMsgList
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE _gethandledstandartmsglist
*-------------------------------------------------------
* Project.........:	BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD._GETHANDLEDSTANDARTMSGLIST
* Called by.......: &lt;.RefreshHandledStandartMsgList();.RightClick()&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;lcHandledStandartMsgList&gt;
* Notes...........: &lt;public/user/default&gt; Ôîðìèðîâàíèå ñïèñêà ñòàíäàðòíûõ ñîîáùåíèé íà îñíîâàíèè
*					ñïèñêà ñîîáùåíèé, óêàçàííûõ â ñâîéñòâå ._HandledStandartMsgList, ïóòåì óäàëåíèÿ ñîîáùåíèé,
*					êîòîðûå íå ìîãóò áûòü îáðàáîòàíû â äàííîì êîíòåêñòå.
*-------------------------------------------------------
WITH This

*30.10.2003 20:37 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcHandledStandartMsgList, ;
		lnHandledStandartMsgCount, ;
		lcHandledStandartMsg
*------------------------------------------------------------------------------
*31.10.2003 17:20 -&gt;Äîáàâëÿåì ñëåâà è ñïðàâà ïî ; ÷òîáû êîððåêòíî îáðàáûòûâàòü "êðàéíèå" ñîîáùåíèÿ
lcHandledStandartMsgList = [;]+UPPER(ALLTRIM(._HandledStandartMsgList))+[;]
*------------------------------------------------------------------------------

*30.10.2003 20:38 -&gt;Óäàëÿåì òå ñîîáùåíèÿ èç ñïèñêà, êîòîðûå íå ìîãóò áûòü îáðàáîòàíû â äàííîì êîíòåêñòå
*** (FIRST) &amp; (PREV)
IF !INLIST(.eRSState,__RS_MIDDLE,__RS_EOF)
	lcHandledStandartMsgList = STRTRAN(lcHandledStandartMsgList,[;FIRST;],[;])
	lcHandledStandartMsgList = STRTRAN(lcHandledStandartMsgList,[;PREV;],[;])
ENDIF
*** (NEXT) &amp; (LAST)
IF !INLIST(.eRSState,__RS_BOF,__RS_MIDDLE)
	lcHandledStandartMsgList = STRTRAN(lcHandledStandartMsgList,[;NEXT;],[;])
	lcHandledStandartMsgList = STRTRAN(lcHandledStandartMsgList,[;LAST;],[;])
ENDIF
*** (ADD)
IF !INLIST(.eRSState,__RS_EMPTY,__RS_ONE_REC,__RS_BOF,__RS_MIDDLE,__RS_EOF)
	lcHandledStandartMsgList = STRTRAN(lcHandledStandartMsgList,[;ADD;],[;])
ENDIF
*** (EDIT) &amp; (INFO) &amp; (DELE) &amp; (COPY) &amp; (PRN_DOC)
IF !INLIST(.eRSState,__RS_ONE_REC,__RS_BOF,__RS_MIDDLE,__RS_EOF)
	lcHandledStandartMsgList = STRTRAN(lcHandledStandartMsgList,[;EDIT;],[;])
	lcHandledStandartMsgList = STRTRAN(lcHandledStandartMsgList,[;INFO;],[;])	
	lcHandledStandartMsgList = STRTRAN(lcHandledStandartMsgList,[;DELE;],[;])	
	lcHandledStandartMsgList = STRTRAN(lcHandledStandartMsgList,[;COPY;],[;])	
	lcHandledStandartMsgList = STRTRAN(lcHandledStandartMsgList,[;PRNDOC;],[;])	
	lcHandledStandartMsgList = STRTRAN(lcHandledStandartMsgList,[;EXCEL;],[;])	
ENDIF
*** (FIND)
IF !INLIST(.eRSState,__RS_BOF,__RS_MIDDLE,__RS_EOF)
	lcHandledStandartMsgList = STRTRAN(lcHandledStandartMsgList,[;FIND;],[;])
ENDIF
*** (PRN_REP)
IF !INLIST(.eRSState,__RS_EMPTY,__RS_ONE_REC,__RS_BOF,__RS_MIDDLE,__RS_EOF)
	lcHandledStandartMsgList = STRTRAN(lcHandledStandartMsgList,[;PRNREP;],[;])
ENDIF
*------------------------------------------------------------------------------


IF EMPTY(this.cHandledStandartMsgList)
		*27.03.2006 10:04 -&gt; Ïðîâåðêà ïðàâ ïîëüçîâàòåëÿ òîëüêî ïðè ïåðâîì çàïóñêå ýòîé ôîðìû
		IF PEMSTATUS(ThisForm,[nScrFrmID],5) AND ThisForm.nScrFrmID # 0
			lnHandledStandartMsgCount = OCCURS([;],lcHandledStandartMsgList) - 1
			FOR lnCounter = lnHandledStandartMsgCount TO 1 STEP -1
				lcHandledStandartMsg = SUBSTR(lcHandledStandartMsgList,AT([;],lcHandledStandartMsgList,lnCounter)+1,AT([;],lcHandledStandartMsgList,lnCounter+1)-AT([;],lcHandledStandartMsgList,lnCounter)-1)
				IF !_spVerifyUserGrant(oApp.nUserKod, [ScreenForm], ThisForm.nScrFrmID, lcHandledStandartMsg)
					lcHandledStandartMsgList = STRTRAN(lcHandledStandartMsgList,[;] + lcHandledStandartMsg  + [;],[;])
				ENDIF
			ENDFOR
		ENDIF
ENDIF
*------------------------------------------------------------------------------

*31.10.2003 17:22 -&gt;Óäàëÿåì ñëåâà è ñïðàâà ; äîáàâëåííûå ðàíåå
IF !(lcHandledStandartMsgList==[;])
	lcHandledStandartMsgList = SUBSTR(lcHandledStandartMsgList,2,LEN(lcHandledStandartMsgList)-2)
ELSE
	lcHandledStandartMsgList = []
ENDIF	
*------------------------------------------------------------------------------
this.cHandledStandartMsgList = lcHandledStandartMsgList
*27.03.2006 09:54 -&gt; Âîçâðàùàåì ðåçóëüòàò
RETURN this.cHandledStandartMsgList
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE _handlecustommsg
*-------------------------------------------------------
* Project.........:	GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD._HANDLECUSTOMMSG
* Called by.......: &lt;.HendleMsg()&gt;
* Parameters......: &lt;tcMessage&gt;
* Returns.........: &lt;.T.&gt;
* Notes...........: &lt;public/user/nodefault&gt; Îáðàáîòêà ñîîáùåíèÿ èç ñïèñêà ïîëüçîâàòåëüñêèõ ñîîáùåíèé.
*-------------------------------------------------------
LPARAMETERS	tcMessage
RETURN .T.
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE _last
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD._LAST
* Called by.......: &lt;.HandleMsg([LAST])&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Îáðàáîòêà ñòàíäàðòíîãî ñîîáùåíèÿ LAST. Ïåðåõîä íà ïîñëåäíþþ çàïèñü.
*-------------------------------------------------------
WITH This

*11.01.2004 19:02 -&gt;Ïðîâåðèì â òîì ëè ìû ñîñòîÿíèè, ÷òî áû ïåðåéòè íà ïîñëåäíþþ çàïèñü.
IF !INLIST(.eRSState,__RS_MIDDLE,__RS_BOF)
	ASSERT .F. MESSAGE [GRD._PREV: â äàííîì ñîñòîÿíèè Grid íå ìîæåò ïåðåéòè íà ïîñëåäíþþ çàïèñü.]
	RETURN .F.
ENDIF
*------------------------------------------------------------------------------

*23.04.2004 12:46 -&gt;Äëÿ êîððåêòíîãî ó÷åòà ÏÎÈÑÊîâ ïðè íàâèãàöèè
.FilterApply(.T.)
*------------------------------------------------------------------------------

*11.01.2004 19:04 -&gt;Ïåðåéäåì íà ïîñëåäíþþ çàïèñü.
GO BOTTOM IN (.RecordSource)
*------------------------------------------------------------------------------

*23.04.2004 12:46 -&gt;Äëÿ êîððåêòíîãî ó÷åòà ÏÎÈÑÊîâ ïðè íàâèãàöèè
.FilterApply()
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE _next
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD._NEXT
* Called by.......: &lt;.HandleMsg([NEXT])&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Îáðàáîòêà ñòàíäàðòíîãî ñîîáùåíèÿ NEXT. Ïåðåõîä íà ñëåäóþùóþ çàïèñü.
*-------------------------------------------------------
WITH This

*11.01.2004 19:02 -&gt;Ïðîâåðèì â òîì ëè ìû ñîñòîÿíèè, ÷òî áû ïåðåéòè íà ñëåäóþùóþ çàïèñü.
IF !INLIST(.eRSState,__RS_MIDDLE,__RS_BOF)
	**ASSERT .F. MESSAGE [GRD._PREV: â äàííîì ñîñòîÿíèè Grid íå ìîæåò ïåðåéòè íà ñëåäóþùóþ çàïèñü.]
	MESSAGEBOX([Ñëåäóþùàÿ çàïèñü îòñóòñòâóåò ...],0+64+4096,'Ïðåäóïðåæäåíèå',1200)
	RETURN .F.
ENDIF
*------------------------------------------------------------------------------

*23.04.2004 12:46 -&gt;Äëÿ êîððåêòíîãî ó÷åòà ÏÎÈÑÊîâ ïðè íàâèãàöèè
.FilterApply(.T.)
*------------------------------------------------------------------------------

*11.01.2004 19:04 -&gt;Ïåðåéäåì íà ñëåäóþùóþ çàïèñü.
IF !EOF(.RecordSource)
	SKIP 1 IN (.RecordSource)
ENDIF	
*------------------------------------------------------------------------------

*23.04.2004 12:46 -&gt;Äëÿ êîððåêòíîãî ó÷åòà ÏÎÈÑÊîâ ïðè íàâèãàöèè
.FilterApply()
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE _prev
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD._PREV
* Called by.......: &lt;.HandleMsg([PREV])&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Îáðàáîòêà ñòàíäàðòíîãî ñîîáùåíèÿ PREV. Ïåðåõîä íà ïðåäûäóùóþ çàïèñü.
*-------------------------------------------------------
WITH This

*11.01.2004 19:02 -&gt;Ïðîâåðèì â òîì ëè ìû ñîñòîÿíèè, ÷òî áû ïåðåéòè íà ïðåäûäóùóþ çàïèñü.
IF !INLIST(.eRSState,__RS_MIDDLE,__RS_EOF)
	**ASSERT .F. MESSAGE [GRD._PREV: â äàííîì ñîñòîÿíèè Grid íå ìîæåò ïåðåéòè íà ïðåäûäóùóþ çàïèñü.]
	MESSAGEBOX([Ïðåäûäóùàÿ çàïèñü îòñóòñòâóåò ...],0+64+4096,'Ïðåäóïðåæäåíèå',1200)
	RETURN .F.
ENDIF
*------------------------------------------------------------------------------

*23.04.2004 12:46 -&gt;Äëÿ êîððåêòíîãî ó÷åòà ÏÎÈÑÊîâ ïðè íàâèãàöèè
.FilterApply(.T.)
*------------------------------------------------------------------------------

*11.01.2004 19:04 -&gt;Ïåðåéäåì íà ïðåäûäóùóþ çàïèñü
IF !BOF(.RecordSource)
	SKIP -1 IN (.RecordSource)
ENDIF	
*------------------------------------------------------------------------------

*23.04.2004 12:46 -&gt;Äëÿ êîððåêòíîãî ó÷åòà ÏÎÈÑÊîâ ïðè íàâèãàöèè
.FilterApply()
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE _rsrequery
this.sortclear()
ENDPROC
PROCEDURE activerowhighlightset
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.ACTIVEROWHIGHLIGHTSET
* Called by.......: &lt;.Init()&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;protected/nouser/default&gt; Óñòàíîâêà ñâîéñòâ Grid-à äëÿ ïîäñâåòêè òåêóùåé ñòðîêè.
*-------------------------------------------------------

*03.11.2003 16:52 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcExcludeColumnList, ;
		lnColumnCounter, ;
		lcDynBackColorExp, ;
		lcDynForeColorExp, ;
		loControl
*------------------------------------------------------------------------------

WITH This

*03.11.2003 16:52 -&gt;Óñòàíîâèì ïîëüçîâàòåëüñêóþ ïîäñâåòêó ñòðîêè, åñëè ðàçðåøåíî ôëàãîì RowHighLight
IF ._ActiveRowHighLight

	*03.11.2003 16:53 -&gt;Ïðîõîäèìñÿ ïî âñåì êîëîíêàì, êîòîðûå íå âñòðå÷àþòñÿ â ñïèñêå ._ActiveRowHighLightExcludeColumnList
	lcExcludeColumnList = [;]+ALLTRIM(._ActiveRowHighLightExcludeColumnList)+[;]
	***
	FOR lnColumnCounter = 1 TO .ColumnCount
		IF  NOT (([;]+ALLTRIM(STR(lnColumnCounter))+[;])$lcExcludeColumnList)
			WITH .Columns(lnColumnCounter)
				
				*04.05.2004 18:35 -&gt;Ôîðìèðóåì âûðàæåíèå .DynaicBackColor
				IF !EMPTY(.DynamicBackColor)
				
					*03.11.2003 16:53 -&gt;Ôîðìèðóåì âûðàæåíèå .DynaicBackColor, äëÿ êîëîíîê ñ ïîëüçîâàòåëüñêèì .DynamicBackColor
					lcDynBackColorExp = ;
						[IIF(RECNO("]+This.RecordSource+[")=This.nRSRecNo,]+ ;
							[IIF(This.lGridActive,]+ALLTRIM(STR(EVAL(This._ActiveRowHighLightColorActive),8,0))+[,]+ALLTRIM(STR(EVAL(This._ActiveRowHighLightColorUnActive),8,0))+[),]+ ;
							.DynamicBackColor+[)]
					*------------------------------------------------------------------------------		
					
				ELSE
					
					*04.05.2004 18:37 -&gt;Ôîðìèðóåì âûðàæåíèå .DynaicBackColor, äëÿ êîëîíîê áåç ïîëüçîâàòåëüñêîãî .DynamicBackColor
					lcDynBackColorExp = ;
						[IIF(RECNO("]+This.RecordSource+[")=This.nRSRecNo,]+ ;
							[IIF(This.lGridActive,]+ALLTRIM(STR(EVAL(This._ActiveRowHighLightColorActive),8,0))+[,]+ALLTRIM(STR(EVAL(This._ActiveRowHighLightColorUnActive),8,0))+[),]+ ;
							ALLTRIM(STR(.BackColor,8,0))+[)]
					*------------------------------------------------------------------------------
						
				ENDIF
				*------------------------------------------------------------------------------
				
				*04.05.2004 18:35 -&gt;Ôîðìèðóåì âûðàæåíèå .DynamicForeColor
				IF !EMPTY(.DynamicForeColor)			
				
					*04.05.2004 18:24 -&gt;Ôîðìèðóåì âûðàæåíèå .DynamicForeColor, äëÿ êîëîíîê ñ ïîëüçîâàòåëüñêèì .DynamicForeColor
					lcDynForeColorExp = ;
						[IIF(RECNO("]+This.RecordSource+[")=This.nRSRecNo,]+ ;
							[IIF(This.lGridActive,]+ALLTRIM(STR(16777215-EVAL(This._ActiveRowHighLightColorActive),8,0))+[,]+ALLTRIM(STR(16777215-EVAL(This._ActiveRowHighLightColorUnActive),8,0))+[),]+ ;
							.DynamicForeColor+[)]
					*------------------------------------------------------------------------------			
				
				ELSE
					
					*04.05.2004 18:40 -&gt;Ôîðìèðóåì âûðàæåíèå .DynamicForeColor, äëÿ êîëîíîê áåç ïîëüçîâàòåëüñêîãî .DynamicForeColor
					lcDynForeColorExp = ;
						[IIF(RECNO("]+This.RecordSource+[")=This.nRSRecNo,]+ ;
							[IIF(This.lGridActive,]+ALLTRIM(STR(16777215-EVAL(This._ActiveRowHighLightColorActive),8,0))+[,]+ALLTRIM(STR(16777215-EVAL(This._ActiveRowHighLightColorUnActive),8,0))+[),]+ ;
							ALLTRIM(STR(.ForeColor,8,0))+[)]
					*------------------------------------------------------------------------------
					
				ENDIF
				*------------------------------------------------------------------------------
				
				*04.05.2004 18:42 -&gt;Ïîäêëþ÷àåì îáà âûðàæåíèÿ ê êîëîíêå
				.DynamicBackColor = lcDynBackColorExp
				.DynamicForeColor = lcDynForeColorExp
				*------------------------------------------------------------------------------
				
				*04.05.2004 18:43 -&gt;Èçìåíÿåì öâåò ó òåêóùåãî ýëåìåíòà Grid-à
				loControl = EVAL([.]+.CurrentControl)
				loControl.BackColor = EVAL(This._ActiveRowHighLightColorActive)
				loControl.ForeColor = 16777215-EVAL(This._ActiveRowHighLightColorActive)
				*------------------------------------------------------------------------------
				
			ENDWITH
		ENDIF	
	ENDFOR
	*------------------------------------------------------------------------------

ENDIF
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE AfterRowColChange
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.AFTERROWCOLCHANGE
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;tnColIndex&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;sysevent&gt; Ñáðîñ èíòåðàêòèâíîãî ïîèñêà, åñëè ïîèñêîâàÿ êîëîíêà íå àêòèâíà.
*					Âûïîëíåíèå ìåòîäà àêòóàëèçàöèè RunTime ñâîéñòâ Grid-à.
*-------------------------------------------------------
LPARAMETERS tnColIndex

WITH This

*23.04.2004 12:06 -&gt;Ñáðàñûâåì èíòåðàêòèâíîãî ïîèñê, åñëè ïîèñêîâàÿ êîëîíêà íå àêòèâíà.
.InteractiveSearchReset(cnRESET_LOCATE_UNACTIVE_COLUMN)
*------------------------------------------------------------------------------

*23.03.2004 19:21 -&gt;Âûïîëíÿåì ìåòîä àêòóàëèçàöèè RunTime ñâîéñòâ Grid-à
.RefreshRunTimeProps()
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE arrayelementget
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.ARRAYELEMENTGET
* Called by.......: &lt;Misc Internal Calls&gt;
* Parameters......: &lt;tcArrayName,teSearchColumn,tuSearchValue[,teReturnColumn]&gt;
* Returns.........: &lt;luFoundSRef/luFoundValue - luReturnValue&gt;
* Notes...........: &lt;public/nouser/default&gt;Ïîèñê ýëåìåíòà â äâóìåðíîì ìàññèâå.
*					Èíòåðôåéñ .ArrayElementGet(tcArrayName,teSearchColumn,tuSearchValue[,teReturnColumn])
*					1. tcArrayName - èìÿ ìàññèâà. Ññûëêà íà ìàññèâ ìîæåò õðàíèòñÿ â ñâ-âå äàííîãî îáúåêòà,
*					â ñâ-âå äðóãîãî îáúåêòà, â ïåðåìåííîé.
*					Åñëè ññûëêà íà ìàññèâ õðàíèòñÿ â ñâ-âå îáúåêòà: tcArrayName = [.ArrayName].
*					Åñëè ññûëêà íà ìàññèâ õðàíèòñÿ â ñâ-âå äðóãîãî îáúåêòà: tcArrayName = [ObjectName.ArrayName].
*					Åñëè ññûëêà íà ìàññèâ õðàíèòñÿ â ïåðåìåííîé: tcArrayName = [paArrayName].
*					2. teSearchColumn - íîìåð êîëîíêè â ìàññèâå, â êîòîðîé îñóùåñòâëÿåòñÿ ïîèñê tuSearchValue.
*					3. tuSearchValue - çíà÷åíèå, êîòîðîå èùåòñÿ â teSearchColumn.
*					4. teReturnColumn - îïöèîíàëüíûé íîìåð êîëîíêè, çíà÷åíèå êîòîðîé âîçâðàùàåòñÿ.
*					*------------------------------------------------------------------------------
*					Ìåòîä îñóùåñòâëÿåò ïîèñê â äâóìåðíîì ìàññèâå (tcArrayName) â êîëîíêå (teSearchColumn)
*					çíà÷åíèå (tuSearchValue). Åñëè ýëåìåíò íàéäåí òîãäà âîçâðàùÿåòñÿ èíäåêñ ýëåìåíòà ëèáî
*					çíà÷åíèå êîëîíêè (teReturnColumn). Åñëè ýëåìåíò íå íàéäåí, âîçâðàùàåòñÿ NULL.
*-------------------------------------------------------
LPARAMETERS	tcArrayName, ;
			teSearchColumn, ;
			tuSearchValue, ;
			teReturnColumn

*05.04.2004 13:45 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnCurrSRef, ;
		luReturnValue
***
luReturnValue = .NULL.
*------------------------------------------------------------------------------

WITH This

*05.04.2004 13:46 -&gt;Îñóùåñòâëÿåì ïîèñê ñâîéñòâà
IF !ISNULL(&amp;tcArrayName)
	FOR lnCurrSRef = 1 TO ALEN(&amp;tcArrayName,1)
		IF	TYPE([&amp;tcArrayName(lnCurrSRef,teSearchColumn)]) == TYPE([tuSearchValue]) AND ;
			&amp;tcArrayName(lnCurrSRef,teSearchColumn) == tuSearchValue
			*{
			IF TYPE([teReturnColumn])==[N]
				luReturnValue = &amp;tcArrayName(lnCurrSRef,teReturnColumn)
				EXIT
			ELSE
				luReturnValue = lnCurrSRef
				EXIT
			ENDIF
			*}
		ENDIF
	ENDFOR
ENDIF
*------------------------------------------------------------------------------

ENDWITH

*05.04.2004 13:46 -&gt;Âåðíåì çíà÷åíèå
RETURN luReturnValue
*------------------------------------------------------------------------------

************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE DblClick
This.HandleMsg([ADD])
ENDPROC
PROCEDURE Destroy
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.DESTROY
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;sysevent&gt;Ñáðîñ ôëàãà àêòèâíîñòè Grid-à.
*					Ñáðîñ íàçíà÷åíèé ãîðÿ÷èõ êëàâèø äëÿ Grid-à.
*					Âîññòàíîâëåíèå êóðñîðà.
*-------------------------------------------------------
WITH This

*29.04.2004 03:24 -&gt;Ñáðàñûâàåì ôëàã àêòèâíîñòè Grid-à.
.lGridActive = .F.
*------------------------------------------------------------------------------

*27.12.2004 17:07 -&gt;Ñîõðàíèì ïàðàìåòðû îòîáðàæåíèå Grid-à
.GridLayoutSave()
*------------------------------------------------------------------------------

*29.04.2004 03:26 -&gt;Ñáðàñûâàåì íàçíà÷åíèå ãîðÿ÷èõ êëàâèø äëÿ Grid-à.
.RefreshHandledHotKey()
*------------------------------------------------------------------------------

*29.04.2004 03:35 -&gt;Âîññòàíîâèì êóðñîð
.RefreshCursorSet()
*------------------------------------------------------------------------------

*23.04.2004 14:01 -&gt;Ñáðàñûâàåì òåêóùèå èíòåðàêòèâíûå ôèëüòðû/ïîèñêè
.InteractiveSearchReset(cnRESET_ALLCOLUMNS)
*------------------------------------------------------------------------------

*28.04.2004 00:10 -&gt;Ïðèîñòàíàâëèâàåì äåéñòâèå âíåøíåãî ôèëüòðà.
.FilterExternalDisable()
*------------------------------------------------------------------------------

*28.04.2004 00:10 -&gt;Îòìåíÿåì ñîðòèðîâêó è óäàëÿåì âðåìåííûå èíäåêñíûå ôàéëû.
.SortClear()
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
*-*COMMENT:	Ïîñêîëüêó ïðè çàêðûòèè ôîðìû ñîáûòèå .Valid ó Grid-à íå âûïîëíÿåòñÿ,
*-*			â äàííîì ìåòîäÿ íà âàæíî îòìåíèòü íàçíà÷åíèÿ ãîðÿ÷èõ êëàâèø.
*-*			Â ìåòîä Destroy âêëþ÷åí âûçîâ ìåòîäà SourceReset äëÿ îòìåíû âñåé èíòåðàêòèâíîé
*-*			ôèëüòðàöèè/ïîèñêîâ, îòêëþ÷åíèÿ âíåøíåãî ôèëüòðà, ñáðîñà ñîðòèðîâêè è óäàëåíèÿ èíäåêñîâ.
ENDPROC
PROCEDURE dynamicimagereset
*-------------------------------------------------------
* Project.........: Basis.pjx
* Library.........: Base_v1.vcx
* Class.Module....: grd.DynamicImageReset
* Called by.......: &lt;~&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;~&gt;
*-------------------------------------------------------
WITH This

*30.06.2005 15:28 -&gt; Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcOldAlias, ;
		lcCurrentObjectName, ;
		lcFullObjectName
***
lcOldAlias = ALIAS()
*------------------------------------------------------------------------------

*30.03.2004 23:20 -&gt;Çàãðóçèì êàðòèíêè â íóæíóþ êîëîíêó
IF 	TYPE([._DynamicImageColumnIndex])==[N] AND !EMPTY(._DynamicImageColumnIndex) AND ;
	TYPE([._DynamicImageAlias])==[C] AND !EMPTY(._DynamicImageAlias) AND ;
	TYPE([._DynamicImageFieldNameIndex])==[C] AND !EMPTY(._DynamicImageFieldNameIndex) AND ;
	TYPE([._DynamicImageFieldNameFileName])==[C] AND !EMPTY(._DynamicImageFieldNameFileName)
	*{
	
	*30.03.2004 23:26 -&gt;Çàãðóçèì áèáëèîòåêó
	IF !([BASE_V1.VCX]$SET([CLASSLIB]))
		SET CLASSLIB TO BASE_V1.VCX ALIAS BASE_V1 ADDITIVE
		llLibLoad = .T.
	ELSE
		llLibLoad = .F.	
	ENDIF
	*------------------------------------------------------------------------------
	
	*30.06.2005 15:37 -&gt; Äîáàâèì îáúåêòû Img:Image
	SELECT(._DynamicImageAlias)
	REQUERY()
	***
	SCAN ALL

		lcCurrentObjectName = [img]+ALLTRIM(STR(EVAL(._DynamicImageFieldNameIndex),10,0))
		lcFullObjectName	= [.Columns(._DynamicImageColumnIndex).]+lcCurrentObjectName
		***
		IF TYPE(lcFullObjectName)#[O] OR ISNULL(&amp;lcFullObjectName)
			.Columns(._DynamicImageColumnIndex).AddObject(lcCurrentObjectName,[img])
			&amp;lcFullObjectName..Picture = FULLPATH(EVAL(._DynamicImageFieldNameFileName))
		ENDIF

	ENDSCAN
	*------------------------------------------------------------------------------
	
	*30.03.2004 23:25 -&gt;Âûãðóçèì áèáëèîòåêó åñëè çàãðóæàëè
	IF llLibLoad
		RELEASE CLASSLIB ALIAS BASE_V1
	ENDIF
	*------------------------------------------------------------------------------
	
	*}
ENDIF	
*------------------------------------------------------------------------------

ENDWITH
*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE dynamicimageset
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.DYNAMICIMAGESET
* Called by.......: .Init()
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;~&gt;
*-------------------------------------------------------
WITH This

*30.03.2004 23:24 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcOldAlias, ;
		lcCurrentObjectName
***
lcOldAlias = ALIAS()
*------------------------------------------------------------------------------

*30.03.2004 23:20 -&gt;Çàãðóçèì êàðòèíêè â íóæíóþ êîëîíêó
IF 	TYPE([._DynamicImageColumnIndex])==[N] AND !EMPTY(._DynamicImageColumnIndex) AND ;
	TYPE([._DynamicImageAlias])==[C] AND !EMPTY(._DynamicImageAlias) AND ;
	TYPE([._DynamicImageFieldNameIndex])==[C] AND !EMPTY(._DynamicImageFieldNameIndex) AND ;
	TYPE([._DynamicImageFieldNameFileName])==[C] AND !EMPTY(._DynamicImageFieldNameFileName)
	*{
	
	*30.03.2004 23:26 -&gt;Çàãðóçèì áèáëèîòåêó
	IF !([BASE_V1.VCX]$SET([CLASSLIB]))
		SET CLASSLIB TO BASE_V1.VCX ALIAS BASE_V1 ADDITIVE
		llLibLoad = .T.
	ELSE
		llLibLoad = .F.	
	ENDIF
	*------------------------------------------------------------------------------
	
	*30.03.2004 23:26 -&gt;Äîáàâèì îáúåêòû Img:Image
	SELECT(._DynamicImageAlias)
	***
	SCAN ALL
		lcCurrentObjectName = [img]+ALLTRIM(STR(EVAL(._DynamicImageFieldNameIndex),10,0))
		.Columns(._DynamicImageColumnIndex).AddObject(lcCurrentObjectName,[img])
		***
		lcCurrentObjectName = [.Columns(._DynamicImageColumnIndex).]+lcCurrentObjectName
		&amp;lcCurrentObjectName..Picture = FULLPATH(EVAL(._DynamicImageFieldNameFileName))
	ENDSCAN
	*------------------------------------------------------------------------------
	
	*30.03.2004 23:25 -&gt;Âûãðóçèì áèáëèîòåêó åñëè çàãðóæàëè
	IF llLibLoad
		RELEASE CLASSLIB ALIAS BASE_V1
	ENDIF
	*------------------------------------------------------------------------------
	
	*30.03.2004 23:32 -&gt;Ñôîðìèðóåì âûðàæåíèå DynamicCurrentControl äëÿ êîëîíêè
	.Columns(._DynamicImageColumnIndex).DynamicCurrentControl = ["IMG"+ALLTRIM(STR(]+.Columns(._DynamicImageColumnIndex).ControlSource+[,10,0))]
	*------------------------------------------------------------------------------
	
	*30.03.2004 23:59 -&gt;Âûñòàâèì äîïîëíèòåëüíûå ïàðàìåòðû
	.Columns(._DynamicImageColumnIndex).Resizable = .F.
	.Columns(._DynamicImageColumnIndex).Sparse = .F.
	*------------------------------------------------------------------------------
	*}
ENDIF	
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE filterapply
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.FILTERAPPLY
* Called by.......: &lt;Refresh();RefreshRunTimeProps()&gt;
* Parameters......: &lt;tlIncludeLocate&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Ôîðìèðîâàíèå óñëîâèÿ ôèëüòðà èç óñëîâèÿ âíåøíåãî
*					ôèëüòðà è âíóòðåííèõ ôèëüòðîâ è íàëîæåíèå åãî íà èñòî÷íèê äàííûõ.
*					Åñëè ïåðåäàí ïàðìåòð tlIncludeLocate = .T., òî â óñëîâèå ôèëüòðà
*					âêëþ÷àåòñÿ óñëîâèå ïîèñêà â òåêóùåé êîëîíêå.
*-------------------------------------------------------
LPARAMETERS	tlIncludeLocate

WITH This

*26.04.2004 23:46 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcOldAlias, ;
		lcFilterExp, ;
		lnCurrSRef, ;
		lcFilterString, ;
		lnFilterMode, ;
		lcFilterField, ;
		llFilterActive
		
***
lcOldAlias  = ALIAS()
lcFilterExp = []
*------------------------------------------------------------------------------

*26.04.2004 23:46 -&gt;Åñëè ìàññèâ ïóñòîé - ôèëüòð íàëàãàòü íå òðåáóåòñÿ
IF !ISNULL(.aFilters)
	
	*27.04.2004 00:17 -&gt;Íàáèðàåì âûðàæåíèå ôèëüòðà ó÷èòûâàÿ âñå ýëåìåíòû ìàññèâà
	FOR lnCurrSRef = 1 TO ALEN(.aFilters,1)
		
		*27.04.2004 00:37 -&gt;Äîáàâëÿåì âûðàæåíèå ê ôèëüòó, òîëüêî åñëè ñòðîêà ïîèñêà íå ïóñòàÿ
		lcFilterString = STRTRAN(.aFilters[lnCurrSRef,cnFILTER_STRING],']',[])
		***
		IF !EMPTY(lcFilterString)
		
			*27.04.2004 00:23 -&gt;Âûïîëíÿåì ñâîé àëãîðèòì äëÿ êàæäîãî òèïà ôèëüòðà/ïîèñêà		
			lnFilterMode = .aFilters[lnCurrSRef,cnFILTER_MODE]
			***
			DO CASE
				CASE (lnFilterMode = cnMODE_FILTER_CONTEXT OR (lnFilterMode = cnMODE_LOCATE_CONTEXT AND tlIncludeLocate))
					
					*27.04.2004 00:30 -&gt;Ôîðìèðóåì âûðàæåíèå êîíòåêñòíîãî ôèëüòðà
					lcFilterField = .aFilters[lnCurrSRef,cnFILTER_FIELD]
					***
					lcFilterExp = lcFilterExp+" AND ["+UPPER(lcFilterString)+"] $ UPPER("+lcFilterField+")"
					*------------------------------------------------------------------------------
					
				CASE (lnFilterMode = cnMODE_FILTER_SEQUENTIAL OR (lnFilterMode = cnMODE_LOCATE_SEQUENTIAL AND tlIncludeLocate))
				
					*27.04.2004 00:33 -&gt;Ôîðìèðóåì âûðàæåíèå ïîñëåäîâàòåëüíîãî ôèëüòðà
					lcFilterField = .aFilters[lnCurrSRef,cnFILTER_FIELD]
					***
					lcFilterExp = lcFilterExp+ ;
									" AND UPPER(LEFT("+lcFilterField+","+ALLTRIM(STR(LEN(lcFilterString)))+"))"+ ;
									" == ["+UPPER(lcFilterString)+"]"		
					*------------------------------------------------------------------------------
					
				CASE (lnFilterMode = cnMODE_FILTER_EXTERNAL)	
				
					*27.04.2004 00:36 -&gt;Äîáàâëÿåì âûðàæåíèå âíåøíåãî ôèëüòðà, åñëè îí àêòèâåí
					IF .aFilters[lnCurrSRef,cnFILTER_ACTIVE]
						lcFilterExp = lcFilterExp+[ AND ]+lcFilterString
					ENDIF
					*------------------------------------------------------------------------------	
					
			ENDCASE		
			*------------------------------------------------------------------------------
			
		ENDIF	
		*------------------------------------------------------------------------------
		
	ENDFOR
	*------------------------------------------------------------------------------
	
ENDIF
*------------------------------------------------------------------------------

*27.04.2004 00:40 -&gt;Óñòàíàâëèâàåì âûðàæåíèå ôèëüòðà
SELECT (.RecordSource)
IF !EMPTY(lcFilterExp)
	SET FILTER TO .T. &amp;lcFilterExp
ELSE
	SET FILTER TO
ENDIF		
*------------------------------------------------------------------------------

*27.04.2004 00:40 -&gt;Âîññòàíîâèì òåêóùèé Alias
IF !EMPTY(lcOldAlias) AND USED(lcOldAlias) AND lcOldAlias#ALIAS()
	SELECT(lcOldAlias)
ENDIF
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE filterexternaldisable
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.FILTEREXTERNALDISABLE
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;protected/nouser/default&gt; Ïðèîñòàíîâëåíèå äåéñòâèÿ âíåøíåãî ôèëüòðà.
*-------------------------------------------------------
WITH This

*27.04.2004 00:56 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnSRef
*------------------------------------------------------------------------------

*27.04.2004 00:56 -&gt;Åñëè ôèëüòð çàðåãèñòðèðîâàí, çàïèñûâàåì .F. â ñâîéñòâî cnFILTER_ACTIVE
lnSRef = .ArrayElementGet([This.aFilters],cnFILTER_MODE,cnMODE_FILTER_EXTERNAL)
***
IF !ISNULL(lnSRef)
	
	*28.04.2004 00:11 -&gt;Âûñòàâëÿåì ïðèçíàê íåàêòèâíîñòè âíåøíåãî ôèëüòðà
	.aFilters[lnSRef,cnFILTER_ACTIVE] = .F.
	*------------------------------------------------------------------------------
	
	*28.04.2004 00:12 -&gt;Ïðèìåíÿåì ìîäèôèöèðîâàííûé ôèëüòð
	.FilterApply()
	*------------------------------------------------------------------------------
	
ENDIF
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE filterexternaldrop
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.FILTEREXTERNALDROP
* Called by.......: &lt;Ext Calls&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Óäàëåíèå âíåøíåãî ôèëüòðà.
*-------------------------------------------------------
WITH This

*27.04.2004 00:56 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnSRef
*------------------------------------------------------------------------------

*27.04.2004 00:56 -&gt;Åñëè ôèëüòð çàðåãèñòðèðîâàí, çàïèñûâàåì ïóñòóþ ñòðîêó â âûðàæåíèå ôèëüòðà
lnSRef = .ArrayElementGet([This.aFilters],cnFILTER_MODE,cnMODE_FILTER_EXTERNAL)
***
IF !ISNULL(lnSRef)
	.aFilters[lnSRef,cnFILTER_STRING] = []
ENDIF
*------------------------------------------------------------------------------

*27.04.2004 00:56 -&gt;Îáíîâëÿåì Grid
.Refresh()
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE filterexternalenable
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.FILTEREXTERNALENABLE
* Called by.......: &lt;NA&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;protected/nouser/default&gt; Âîññòàíîâëåíèå äåéñòâèÿ âíåøíåãî ôèëüòðà.
*-------------------------------------------------------
WITH This

*27.04.2004 00:56 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnSRef
*------------------------------------------------------------------------------

*27.04.2004 00:56 -&gt;Åñëè ôèëüòð çàðåãèñòðèðîâàí, çàïèñûâàåì .T. â ñâîéñòâî cnFILTER_ACTIVE
lnSRef = .ArrayElementGet([This.aFilters],cnFILTER_MODE,cnMODE_FILTER_EXTERNAL)
***
IF !ISNULL(lnSRef)
	
	*28.04.2004 00:11 -&gt;Âûñòàâëÿåì ïðèçíàê àêòèâíîñòè âíåøíåãî ôèëòðà
	.aFilters[lnSRef,cnFILTER_ACTIVE] = .T.
	*------------------------------------------------------------------------------

	*28.04.2004 00:12 -&gt;Ïðèìåíÿåì ìîäèôèöèðîâàííûé ôèëüòð
	.FilterApply()
	*------------------------------------------------------------------------------

ENDIF
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE filterexternalset
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.FILTEREXTERNALSET
* Called by.......: &lt;Ext Calls&gt;
* Parameters......: &lt;tcFilterExp&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Óñòàíîâêà âíåøíåãî ôèëüòðà íà èñòî÷íèê äàííûõ.
*-------------------------------------------------------
LPARAMETERS	tcFilterExp

WITH This

*27.04.2004 00:56 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnSRef
*------------------------------------------------------------------------------

*29.04.2004 05:11 -&gt;Ñáðîñèì èíòåðàòèâíóþ ôèëüòðàöèþ/ïîèñê
.InteractiveSearchReset(cnRESET_ALLCOLUMNS)
*------------------------------------------------------------------------------

*27.04.2004 00:56 -&gt;Åñëè ôèëüòð íå çàðåãèñòðèðîâàí - ðåãèñòðèðóåì, èíà÷å ìåíÿåì âûðàæåíèå
lnSRef = .ArrayElementGet([This.aFilters],cnFILTER_MODE,cnMODE_FILTER_EXTERNAL)
***
IF !ISNULL(lnSRef)
	.aFilters[lnSRef,cnFILTER_STRING] = tcFilterExp
ELSE
	.FilterRegister(cnMODE_FILTER_EXTERNAL,tcFilterExp)
ENDIF
*------------------------------------------------------------------------------

*27.04.2004 00:56 -&gt;Îáíîâëÿåì Grid
.Refresh()
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
*-*COMMENT:	Ñìîòðè RFC.1.
ENDPROC
PROCEDURE filterregister
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.FILTERREGISTER
* Called by.......: &lt;.FilterSet();.SearchChangeMode()&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;protected/nouser/default&gt; Ðåãèñòðàöèÿ ôèëüòðà/ïîèñêà.
*-------------------------------------------------------
LPARAMETERS	tnFilterMode, ;
			tcFilterString, ;
			tuFilterColumn, ;
			tuFilterField, ;
			tuFilterHeaderCaption

WITH This

*27.04.2004 01:31 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnSRef
*------------------------------------------------------------------------------

*27.04.2004 01:31 -&gt;Èçìåíÿåì ðàçìåðíîñòü ìàññèâà
IF ISNULL(.aFilters)
	lnSRef = 1
ELSE
	lnSRef = ALEN(.aFilters,1) + 1
ENDIF
***
DIMENSION .aFilters[lnSRef,cnFILTER_ARRAY_COLS]
*------------------------------------------------------------------------------

*27.04.2004 01:31 -&gt;Çàïîëíÿåì ìàññèâ
.aFilters[lnSRef,cnFILTER_MODE]			= tnFilterMode
.aFilters[lnSRef,cnFILTER_ACTIVE]		= .T.
.aFilters[lnSRef,cnFILTER_STRING]		= tcFilterString
.aFilters[lnSRef,cnFILTER_COLUMN]		= tuFilterColumn
.aFilters[lnSRef,cnFILTER_FIELD]		= tuFilterField
.aFilters[lnSRef,cnFILTER_HEADERCAPTION]= tuFilterHeaderCaption
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE handlekey
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.HANDLEKEY
* Called by.......:
* Parameters......: &lt;tnKeyCode, tnShiftAltCtrl&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Îáðàáîòêà íàæàòèÿ ïîëüçîâàòåëåì êëàâèøè.
*-------------------------------------------------------
LPARAMETERS	tnKeyCode, tnShiftAltCtrl

WITH This

*12.04.2004 11:24 -&gt;Îáðàáîòàåì ãîðÿ÷èå êëàâèøè
DO CASE
	CASE tnKeyCode = 1 AND tnShiftAltCtrl = 0		&amp;&amp;HOME
		
		*22.04.2004 11:43 -&gt;Âûïîëíÿåì êîìàíäó ïåðåõîäà ê ïåðâîé çàïèñè
		.HandleMsg([FIRST])
		RETURN.T.
		*------------------------------------------------------------------------------

	CASE tnKeyCode = 5 AND tnShiftAltCtrl = 0	&amp;&amp;UPArrow
		
		*22.04.2004 11:44 -&gt;Âûïîëíÿåì êîìàíäó ïåðåõîäà ê ïðåäûäóùåé çàïèñè
		.HandleMsg([PREV])
		RETURN.T.
		*------------------------------------------------------------------------------
		
	CASE tnKeyCode = 24	AND tnShiftAltCtrl = 0	&amp;&amp;DOWNArrow
		
		*22.04.2004 11:44 -&gt;Âûïîëíÿåì êîìàíäó ïåðåõîäà ê ñëåäóþùåé çàïèñè
		.HandleMsg([NEXT])
		RETURN.T.
		*------------------------------------------------------------------------------
		
	CASE tnKeyCode = 6 AND tnShiftAltCtrl = 0		&amp;&amp;END

		*22.04.2004 11:42 -&gt;Âûïîëíÿåì êîìàíäó ïåðåõîäà ê ïîñëåäíåé çàïèñè
		.HandleMsg([LAST])
		RETURN.T.
		*------------------------------------------------------------------------------


	CASE tnKeyCode = 14 AND tnShiftAltCtrl = 2	&amp;&amp;Ctrl+N
		
		*22.04.2004 11:41 -&gt;Âûïîëíÿåì êîìàíäó äîáàâëåíèÿ çàïèñè
		.HandleMsg([ADD])
		RETURN.T.
		*------------------------------------------------------------------------------

	CASE tnKeyCode = 5 AND tnShiftAltCtrl = 2	&amp;&amp;Ctrl+E
		*22.04.2004 11:41 -&gt;Âûïîëíÿåì êîìàíäó ðåäàêòèðîâàíèÿ
		.HandleMsg([EDIT])
		RETURN.T.
		*------------------------------------------------------------------------------
		
	CASE tnKeyCode = 9 AND tnShiftAltCtrl = 2	&amp;&amp;Ctrl+I
		
		*22.04.2004 11:40 -&gt;Âûïîëíèì êîìàíäó âûâîäà èíôîðìàöèè î îáúåêòå/çàïèñè
		.HandleMsg([INFO])
		RETURN.T.
		*------------------------------------------------------------------------------
	
	CASE tnKeyCode = 4 AND tnShiftAltCtrl = 2	&amp;&amp;Ctrl+D
		
		*22.04.2004 11:40 -&gt;Âûïîëíèì êîìàíäó óäàëåíèÿ
		.HandleMsg([DELE])
		RETURN.T.
		*------------------------------------------------------------------------------

	CASE tnKeyCode = 3 AND tnShiftAltCtrl = 2	&amp;&amp;Ctrl+C
		
		*22.04.2004 11:33 -&gt;Âûïîëíèì êîìàíäó êîïèðîâàíèÿ îáúåêòà/çàïèñè
		.HandleMsg([COPY])
		RETURN.T.
		*------------------------------------------------------------------------------
		
	CASE tnKeyCode = 6 AND tnShiftAltCtrl = 2	&amp;&amp;Ctrl+F
		
		*22.04.2004 11:32 -&gt;Âûïîëíèì êîìàíäó ïîèñêà
		.HandleMsg([FIND])
		RETURN.T.
		*------------------------------------------------------------------------------
		
	CASE tnKeyCode = 16 AND tnShiftAltCtrl = 2	&amp;&amp;Ctrl+P
		
		*22.04.2004 11:31 -&gt;Âûïîëíèì êîìàíäó ïå÷àòè äîêóìåíòà
		.HandleMsg([PRNDOC])
		RETURN.T.
		*------------------------------------------------------------------------------
		
	CASE tnKeyCode = 18 AND tnShiftAltCtrl = 2	&amp;&amp;Ctrl+R
		
		*22.04.2004 11:31 -&gt;Âûïîëíèì êîìàíäó ïå÷àòè îò÷åòà
		.HandleMsg([PRNREP])
		RETURN.T.
		*------------------------------------------------------------------------------
		
	CASE tnKeyCode = 13	&amp;&amp;Enter
		
		*22.04.2004 11:29 -&gt;Ñáðîñèì ïîèñê/ôèëüòð âî âñåõ êîëîíêàõ
		.InteractiveSearchReset(cnRESET_USER_ALLCOLUMNS)
		RETURN.T.
		*------------------------------------------------------------------------------
		
	CASE tnKeyCode = 127 AND tnShiftAltCtrl = 2	&amp;&amp;Ctrl+BackSpace
		
		*22.04.2004 11:29 -&gt;Ñáðîñèì ïîèñê/ôèëüòð â òåêóùåé êîëîíêå
		.InteractiveSearchReset(cnRESET_USER_ACTIVECOLUMN)
		RETURN.T.
		*------------------------------------------------------------------------------

	CASE tnKeyCode = 0   &amp;&amp; Alt+0 (ON KEY LABEL)
		
		*22.04.2004 11:25 -&gt;Îòêëþ÷èì ïîèñê â òåêóùåé êîëîíêå
		.InteractiveSearchSetMode(cnMODE_NO_SEARCH)
		RETURN.T.
		*------------------------------------------------------------------------------

	CASE tnKeyCode = 0.1 &amp;&amp; Alt+1 (ON KEY LABEL)
	
		*22.04.2004 11:26 -&gt;Èçìåíèì ðåæèì ïîèñêà â òåêóùåé êîëîíêå íà êîíòåêñòíûé
		.InteractiveSearchSetMode(cnMODE_LOCATE_CONTEXT)
		RETURN.T.
		*------------------------------------------------------------------------------

	CASE tnKeyCode = 0.2 &amp;&amp; Alt+2 (ON KEY LABEL)
		
		*22.04.2004 11:26 -&gt;Èçìåíèì ðåæèì ïîèñêà â òåêóùåé êîëîíêå íå ïîñëåäîâàòåëüíûé
		.InteractiveSearchSetMode(cnMODE_LOCATE_SEQUENTIAL)
		RETURN.T.
		*------------------------------------------------------------------------------
		
	CASE tnKeyCode = 0.3 &amp;&amp; Alt+3 (ON KEY LABEL)
		
		*22.04.2004 11:27 -&gt;Èçìåíèì ðåæèì ïîèñêà â òåêóùåé êîëîíêå íà êîíòåêñòíóþ ôèëüòðàöèþ
		.InteractiveSearchSetMode(cnMODE_FILTER_CONTEXT)
		RETURN.T.
		*------------------------------------------------------------------------------

	CASE tnKeyCode = 0.4 &amp;&amp; Alt+4 (ON KEY LABEL)
		
		*22.04.2004 11:27 -&gt;Èçìåíèì ðåæèì ïîèñêà â òåêóùåé êîëíêå íà ïîñëåäîâàòåëüíóþ ôèëüòðàöèþ
		.InteractiveSearchSetMode(cnMODE_FILTER_SEQUENTIAL)
		RETURN.T.
		*------------------------------------------------------------------------------

	CASE BETWEEN(tnKeyCode, 32, 125)  OR ;	&amp;&amp;Ñèìâîëüíûå LAT
		 BETWEEN(tnKeyCode, 192, 255) OR ;	&amp;&amp;Ñèìâîëüíûå RUS
		 tnKeyCode = 127 					&amp;&amp;BackSpace
		
		*22.04.2004 11:28 -&gt;Âûïîëíèì ïîèñê â àêòèâíîé êîëîíêå ïîäñòðîêè
		.InteractiveSearch(tnKeyCode)
		RETURN.T.
		*------------------------------------------------------------------------------
		
	OTHERWISE
		
		*22.04.2004 11:28 -&gt;Ñ÷èòàåì ÷òî íàæàòèå êëàâèøè íå îáðàáîòàíî
		RETURN .F.
		*------------------------------------------------------------------------------
		
ENDCASE
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE handlemsg
*-------------------------------------------------------
* Project.........:	GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.HANDLEMSG
* Called by.......: &lt;Miscellaneous Calls&gt;
* Parameters......: &lt;tcMessage&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Îáðàáîòêà ñîáùåíèÿ, äëÿ êîòîðîãî Grid çàðåãèñòðèðîâàí
*					êàê îáðàáîò÷èê, åñëè ñîîáùåíèå îòíîñòèñÿ ê ñòàíäàðòíûì - âûçîâ ñîîòâåòñòâóþùåãî ìåòîäà,
*					åñëè ýòî ïîëüçîâàòåëüñêîå ñîîáùåíèå, òî âûçîâ ìåòîäà ._HandleCustomMsg().
*-------------------------------------------------------
LPARAMETERS	tcMessage

*05.04.2004 18:20 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcMessage, ;
		lcHandledStandartMsgList, ;
		lcHandledCustomMsgList, ;
		lcMethod
***		
lcMessage = UPPER(ALLTRIM(tcMessage))
*------------------------------------------------------------------------------

WITH This

*31.10.2003 17:20 -&gt;Äîáàâëÿåì ñëåâà è ñïðàâà ïî ; ÷òîáû êîððåêòíî îáðàáûòûâàòü "êðàéíèå" ñîîáùåíèÿ
lcHandledStandartMsgList = [;]+._GetHandledStandartMsgList()+[;]
lcHandledCustomMsgList = [;]+._GetHandledCustomMsgList()+[;]
*------------------------------------------------------------------------------

*12.04.2004 12:56 -&gt;Âûïîëíÿåì ñîîòâåòñòâóþùèé ìåòîä, åñëè ñîîáùåíèå ìîæåò áûòü îáðàáîòàíî â äàííîì êîíòåêñòå
DO CASE
	
	*12.04.2004 13:11 -&gt;Ïðîâåðÿåì ÿâëÿåòñÿ ëè ñîîáùåíèå ñòàíäàðòíûì ñîîáùåíèåì,
	*12.04.2004 13:12 -&gt;êîòîðîå ìîæíî îáðàáîòàòü â äàííîì êîíòåêñòå
	CASE ([;]+lcMessage+[;])$lcHandledStandartMsgList
		lcMethod = [_]+lcMessage
		IF PEMSTATUS(This,lcMethod,5)
			lcMethod = [.]+lcMethod		
			&amp;lcMethod
		ELSE
			ASSERT .F. MESSAGE [GRD.HANDLEMSG: Ñîîáùåíèå, ïåðå÷èñëåííîå â ñïèñêå ñòàíäàðòíûõ íå èìååò ìåòîäà äëÿ îáðàáîòêè.]
		ENDIF
		RETURN .T.
	*------------------------------------------------------------------------------
	
	*12.04.2004 13:11 -&gt;Ïðîâåðÿåì ÿâëÿåòñÿ ëè ñîîáùåíèå ïîëüçîâàòåëüñêèì ñîîáùåíèåì,
	*12.04.2004 13:12 -&gt;êîòîðîå ìîæíî îáðàáîòàòü â äàííîì êîíòåêñòå
	CASE ([;]+lcMessage+[;])$lcHandledCustomMsgList
		._HandleCustomMsg(lcMessage)
		RETURN .T.
	*------------------------------------------------------------------------------
	
	*12.04.2004 13:16 -&gt;Ñîîáùåíèå íå ìîæåò áûòü îáðàáîòàíî â äàííîì êîíòåêñòå
	OTHERWISE
		?? CHR(7)
		RETURN .T.
	*------------------------------------------------------------------------------	

ENDCASE
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE Init
*-------------------------------------------------------
* Project.........:	GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.INIT
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: (sysevent) Âûçîâ ìåòîäà .RowHighLightSet äëÿ óñòàíîâêè ïîäñâåòêè òåêóùåé ñòðîêè
*					è ìåòîäà .RefreshRunTimeProps() äëÿ îáíîâëåíèÿ ñâîéñòâ .nRSRecNo, .nRSState.
*-------------------------------------------------------
WITH This

*27.12.2004 17:08 -&gt;Âîññòàíîâèì ïàðàìåòðû îòîáðàæåíèÿ Grid-à
.GridLayoutRestore()
*------------------------------------------------------------------------------

*22.04.2004 16:30 -&gt;"Îáíóëèì" ìàññèâ ôèëüòðîâ/ïîèñêà â òåêóùåé êîëîíêå
.aFilters = .NULL.
*------------------------------------------------------------------------------

*22.04.2004 16:31 -&gt;Ñäåëàåì óñòàíîâêè .DynamicBackColor äëÿ ïîäñâåòêè òåêóùåé çàïèñè
.ActiveRowHighLightSet()
*------------------------------------------------------------------------------

*22.04.2004 16:31 -&gt;Âûïîëíèì ìåòîä äëÿ ïîäãðóçêè êàðòèíîê, îòîáðàæàþùèõñÿ â Grid-å
.DynamicImageSet()
*------------------------------------------------------------------------------

*22.04.2004 16:32 -&gt;Âûïîëíèì îáíîâëåíèå RunTime ñâîéñòâ Grid-à
.RefreshRunTimeProps()
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE interactivesearch
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.INTERACTIVESEARCH
* Called by.......: &lt;.HandleKey()&gt;
* Parameters......: &lt;tnKeyCode&gt;
* Returns.........: &lt;.T./.F. â çàâèñèìîñòè îò óñïåøíîñòè ïîèñêà.&gt;
* Notes...........: &lt;protected/nouser/default&gt; Èíòåðàêòèâíàÿ ôèëüòðàöèÿ/ïîèñê
*					ïîäñòðîêè â ñèìâîëüíûõ ïîëÿõ èñòî÷íèêà äàííûõ.
*-------------------------------------------------------
LPARAMETERS	tnKeyCode

WITH This

*27.04.2004 02:22 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcOldAlias, ;
		lnActiveColumn, ;
		lnSRef, ;
		lnFilterMode, ;
		lcFilterString, ;
		luCurrentControl
***
lcOldAlias = ALIAS()
lnActiveColumn = .ActiveColumn
*------------------------------------------------------------------------------

*27.04.2004 02:23 -&gt;Ïðîâåðèì çàðåãèñòðèðîâàíà òåêóùàÿ êîëîíêà êàê ïîèñêîâàÿ
lnSRef = .ArrayElementGet([This.aFilters],cnFILTER_COLUMN,lnActiveColumn)
***
IF ISNULL(lnSRef)	&amp;&amp;íå çàðåãèñòðèðîâàíà

	*27.04.2004 02:25 -&gt;Åñëè ïîëüçîâàòåëü íàæàë ñèìâîëüíóþ êëàâèøó - âêëþ÷àåì ïîèñê ñ ðåæèìîì ïî óìîë÷àíèþ
	IF tnKeyCode # 127 AND .InteractiveSearchSetMode(._InteractiveSearchDefaultMode)
		lnSRef = .ArrayElementGet([This.aFilters],cnFILTER_COLUMN,lnActiveColumn)
	ELSE	
		?? CHR(7)
		RETURN .F.
	ENDIF
	*------------------------------------------------------------------------------

ENDIF
*------------------------------------------------------------------------------

*27.04.2004 14:46 -&gt;Ïðîâåðÿåì ðåæèì ïîèñêà â òåêóùåé êîëîíêå
lnFilterMode	= .aFilters[lnSRef,cnFILTER_MODE]
***
IF lnFilterMode = cnMODE_NO_SEARCH
	?? CHR(7)
	RETURN .F.
ENDIF	
*------------------------------------------------------------------------------

*27.04.2004 02:34 -&gt;Ìîäèôèöèðóåì ïîèñêîâóþ ñòðîêó
lcFilterString	= .aFilters[lnSRef,cnFILTER_STRING]
***
IF	tnKeyCode = 127	&amp;&amp;BackSpace

	*27.04.2004 02:41 -&gt;Åñëè äëèíà ïîèñêîâîé ñòðîêè 0 ñèìâîëîâ - îøèáêà, 1 - ñáðîñ, 2 ìîäèôèêàöèÿ
	DO CASE
		CASE LEN(lcFilterString) = 0
			
			*27.04.2004 14:51 -&gt;Ñîîáùàåì îá îøèáêå
			?? CHR(7)
			RETURN .F.
			*------------------------------------------------------------------------------
			
		CASE LEN(lcFilterString) = 1

			*23.04.2004 01:26 -&gt;Âûïîëíÿåì îïåðàöèþ ñáðîñà âíóòðåííåãî ïîèñêà/ôèëüòðàöèè â òåêóùåé êîëîíêå
			.InteractiveSearchReset(cnRESET_USER_ACTIVECOLUMN)
			RETURN .T.
			*------------------------------------------------------------------------------
			
		CASE LEN(lcFilterString) &gt; 1
		
			*27.04.2004 02:42 -&gt;Ìîäèôèöèðóåì ïîèñêîâóþ ñòðîêó
			.aFilters[lnSRef,cnFILTER_STRING] = SUBSTR(lcFilterString,1,LEN(lcFilterString)-1)
			*------------------------------------------------------------------------------
			
	ENDCASE
	*------------------------------------------------------------------------------
	
ELSE &amp;&amp;Symbol or Digit
	
	*27.04.2004 14:52 -&gt;Ìîäèôèöèðóåì ñòðîêó
	.aFilters[lnSRef,cnFILTER_STRING] = lcFilterString + CHR(tnKeyCode)
	*------------------------------------------------------------------------------
		
ENDIF

*27.04.2004 03:10 -&gt;Ïðîâåðÿåì åñòü ëè çàïèñü ñîîñòâåòñòâóþùàÿ óñëîâèþ ìîäèôèöèðîâàííîãî ôèëüòðà
.FilterApply(.T.)	&amp;&amp;âûñòàâëÿåì ôèëüòð ñ ó÷¸òîì ïîèñêà â òåêóùåé êîëîíêå
SELECT (.RecordSource)
LOCATE
***
IF FOUND()

	*23.04.2004 01:25 -&gt;Âûâîäèì ïîèñêîâóþ ñòðîêó â çàãîëîâîê êîëîíêè
	.Columns[lnActiveColumn].Header1.Caption = .aFilters[lnSRef,cnFILTER_STRING]
	***
	luCurrentControl = .Columns[lnActiveColumn].CurrentControl
	luCurrentControl = .Columns[lnActiveColumn].&amp;luCurrentControl
	luCurrentControl.StatusBarText = .aFilters[lnSRef,cnFILTER_STRING]
	*------------------------------------------------------------------------------
	
	*27.04.2004 03:13 -&gt;Âûñòàâëÿåì ôèëüòð áåç ó÷åòà ïîèñêà â òåêóùåé êîëîíêå
	.FilterApply()		
	*------------------------------------------------------------------------------

	*27.04.2004 02:55 -&gt;Îáíîâëÿåì Grid
	.Refresh()
	*------------------------------------------------------------------------------
	
	*27.04.2004 02:55 -&gt;Âîçâðàùàåì ôëàã óñïåøíîñòè îïåðàöèè
	RETURN .T.
	*------------------------------------------------------------------------------
	
ELSE
	
	*27.04.2004 03:15 -&gt;Âîññòàíàâëèâàåì ñòàðóþ ñòðîêó ïîèñêà
	.aFilters[lnSRef,cnFILTER_STRING] = lcFilterString
	*------------------------------------------------------------------------------

	*27.04.2004 03:13 -&gt;Âûñòàâëÿåì ôèëüòð áåç ó÷åòà ïîèñêà â òåêóùåé êîëîíêå
	.FilterApply()		
	*------------------------------------------------------------------------------
	
	*27.04.2004 03:18 -&gt;Âîçâðàùàåìñÿ íà ñòàðóþ çàïèñü
	GOTO .nRSRecNo
	*------------------------------------------------------------------------------
	
	*27.04.2004 03:21 -&gt;Ñîîáùàåì î íåóñïåõå
	?? CHR(7)
	RETURN .F.
	*------------------------------------------------------------------------------
	
ENDIF
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************

ENDPROC
PROCEDURE interactivesearchreset
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.INTERACTIVESEARCHRESET
* Called by.......: &lt;.AfterRowColChange(); .Valid(); HandleKey(); InteractiveSearch(); InteractiveSe
* Parameters......: &lt;tnResetMode&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;protected/nouser/default&gt; Îòìåíà èíòåðàêòèâíîé ôèëüòðàöèè/ïîèñêà
*					ïîäñòðîêè â ñèìâîëüíûõ ïîëÿõ èñòî÷íèêà äàííûõ.
*-------------------------------------------------------
LPARAMETERS	tnResetMode

WITH This

*27.04.2004 04:29 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnCurrentColumn, ;
		lnCurrentSRef, ;
		luCurrentControl, ;
		llInteractiveLocateDropped, ;
		llInteractiveFilterDropped
***
llInteractiveLocateDropped = .F.
llInteractiveFilterDropped = .F.
*------------------------------------------------------------------------------

*27.04.2004 04:28 -&gt;Ðåæèì îòìåíû çàâèñèò îò ïàðàìåòðà
DO CASE

	CASE tnResetMode = cnRESET_USER_ACTIVECOLUMN	&amp;&amp; ïîëüçîâàòåëüñêàÿ îòìåíà èíòåðàêòèâíîé ôèëüòðàöèè/ïîèñêà â òåêóùåé êîëîíêå
		
		*28.04.2004 15:09 -&gt;Ðàáîòàåì ñ àêòèâíîé êîëîíêîé
		lnCurrentColumn = .ActiveColumn
		*------------------------------------------------------------------------------
		
		*27.04.2004 04:28 -&gt;Èùåì èíôîðìàöèþ î ôèëüòðå/ïîèñêå â äàííîé êîëîíêå
		lnCurrentSRef   = .ArrayElementGet([This.aFilters],cnFILTER_COLUMN,lnCurrentColumn)
		*------------------------------------------------------------------------------
		
		*27.04.2004 23:46 -&gt;Åñëè àêòèâíàÿ êîëîíêà íå çàðåãèñòðèðîâàíà êàê ïîèñêîâàÿ èëè ñòðîêà ïîèñêà ïóñòàÿ -&gt; îøèáêà
		IF ISNULL(lnCurrentSRef) OR EMPTY(.aFilters[lnCurrentSRef,cnFILTER_STRING])
			?? CHR(7)
			RETURN .F.
		ENDIF
		*------------------------------------------------------------------------------
			
		*27.04.2004 13:11 -&gt;Ñáðàñûâàåì ñòðîêó ïîèñêà
		.aFilters[lnCurrentSRef,cnFILTER_STRING] = []
		*------------------------------------------------------------------------------
		
		*27.04.2004 13:12 -&gt;Âîññòàíàâëèâàåì çàãîëîâîê êîëîíêè
		.Columns(lnCurrentColumn).Header1.Caption = .aFilters[lnCurrentSRef,cnFILTER_HEADERCAPTION]
		*------------------------------------------------------------------------------
		
		*27.04.2004 13:12 -&gt;Î÷èùàåì òåêñò ïàíåëè ñîñòîÿíèÿ
		luCurrentControl = .Columns(lnCurrentColumn).CurrentControl
		luCurrentControl = .Columns(lnCurrentColumn).&amp;luCurrentControl
		luCurrentControl.StatusBarText = [ ]
		*------------------------------------------------------------------------------
		
		*29.04.2004 04:47 -&gt;Âûñòàâëÿåì ôëàã, åñëè áûëà ñáðîøåíà èíòåðàêòèâíàÿ ôèëüòðàöèÿ	
		llInteractiveFilterDropped = INLIST(.aFilters[lnCurrentSRef,cnFILTER_MODE],cnMODE_FILTER_CONTEXT,cnMODE_FILTER_SEQUENTIAL)
		*------------------------------------------------------------------------------

		*27.04.2004 13:23 -&gt;Åñëè áûëà ñáðîøåíà èíòåðàêòèâàíÿ ôèëüòðàöèÿ -&gt; îáíîâèì Grid
		IF llInteractiveFilterDropped
			.Refresh()
		ENDIF	
		*------------------------------------------------------------------------------
		
	CASE tnResetMode = cnRESET_USER_ALLCOLUMNS	&amp;&amp;ïîëüçîâàòåëüñêàÿ îòìåíà ñîðòèðîâêè âî âñåõ êîëîíêàõ
		
		*27.04.2004 13:02 -&gt;Åñëè ìàññèâ ïóñòîé -&gt; îøèáêà
		IF ISNULL(.aFilters)
			?? CHR(7)
			RETURN .F.
		ENDIF
		*------------------------------------------------------------------------------	
			
		*27.04.2004 13:17 -&gt;Ïðîõîäèì ïî âñåì ýëåìåíòàì ìàññèâà
		FOR lnCurrentSRef = 1 TO ALEN(.aFilters,1)
		
			*27.04.2004 13:25 -&gt;Åñëè ôèëüòð - èíòåðàêòèâàíàÿ ôèëüòðàöèÿ/ïîèñê è ñòðîêà ôèëüòðà íå ïóñòàÿ
			IF	INLIST(.aFilters[lnCurrentSRef,cnFILTER_MODE], ;
						cnMODE_LOCATE_CONTEXT,cnMODE_LOCATE_SEQUENTIAL, ;
						cnMODE_FILTER_CONTEXT,cnMODE_FILTER_SEQUENTIAL) AND ;
				!EMPTY(.aFilters[lnCurrentSRef,cnFILTER_STRING])
				
				*28.04.2004 15:28 -&gt;×èòàåì íîìåð ïîèñêîâîé êîëîíêè
				lnCurrentColumn = .aFilters[lnCurrentSRef,cnFILTER_COLUMN]
				*------------------------------------------------------------------------------
									
				*27.04.2004 13:11 -&gt;Ñáðàñûâàåì ñòðîêó ïîèñêà
				.aFilters[lnCurrentSRef,cnFILTER_STRING] = []
				*------------------------------------------------------------------------------
				
				*27.04.2004 13:12 -&gt;Âîññòàíàâëèâàåì çàãîëîâîê êîëîíêè
				.Columns(lnCurrentColumn).Header1.Caption = .aFilters[lnCurrentSRef,cnFILTER_HEADERCAPTION]
				*------------------------------------------------------------------------------
				
				*27.04.2004 13:12 -&gt;Î÷èùàåì òåêñò ïàíåëè ñîñòîÿíèÿ
				luCurrentControl = .Columns(lnCurrentColumn).CurrentControl
				luCurrentControl = .Columns(lnCurrentColumn).&amp;luCurrentControl
				luCurrentControl.StatusBarText = [ ]
				*------------------------------------------------------------------------------
				
				*29.04.2004 04:47 -&gt;Âûñòàâëÿåì ôëàã, åñëè áûëà ñáðîøåíà èíòåðàêòèâíàÿ ôèëüòðàöèÿ	
				llInteractiveFilterDropped = INLIST(.aFilters[lnCurrentSRef,cnFILTER_MODE],cnMODE_FILTER_CONTEXT,cnMODE_FILTER_SEQUENTIAL)
				*------------------------------------------------------------------------------

				*29.04.2004 04:47 -&gt;Âûñòàâëÿåì ôëàã, åñëè áûë ñáðîøåí èíòåðàêòèâíûé ïîèñê	
				llInteractiveLocateDropped = INLIST(.aFilters[lnCurrentSRef,cnFILTER_MODE],cnMODE_LOCATE_CONTEXT,cnMODE_LOCATE_SEQUENTIAL)
				*------------------------------------------------------------------------------
									
			ENDIF
			*------------------------------------------------------------------------------
			
		ENDFOR &amp;&amp;* lnCounter = 1 TO ALEN(.aFilters,1)
		*------------------------------------------------------------------------------

		*28.04.2004 15:35 -&gt;Åñëè íå ñáðîñèëè íå îäíîé èíòåðàêòèâíîé ôèëüòðàöèè/ïîèñêà -&gt; îøèáêà
		IF !llInteractiveFilterDropped AND !llInteractiveLocateDropped
			?? CHR(7)
			RETURN .F.
		ENDIF	
		*------------------------------------------------------------------------------
		
		*27.04.2004 13:23 -&gt;Åñëè áûëà ñáðîøåíà èíòåðàêòèâàíÿ ôèëüòðàöèÿ -&gt; îáíîâèì Grid
		IF llInteractiveFilterDropped
			.Refresh()
		ENDIF	
		*------------------------------------------------------------------------------
	
	CASE tnResetMode = cnRESET_LOCATE_UNACTIVE_COLUMN	&amp;&amp; îòìåíà ïîèñêà, åñëè êîëîíêà ïîèñêà íå àêòèâíà (AfterRowColChange)
	
		*27.04.2004 13:02 -&gt;Åñëè ìàññèâ ïóñòîé -&gt; ñáðàñûâàòü íå÷åãî -&gt; OK
		IF ISNULL(.aFilters)
			RETURN .T.
		ENDIF
		*------------------------------------------------------------------------------	
			
		*27.04.2004 13:17 -&gt;Ïðîõîäèì ïî âñåì ýëåìåíòàì ìàññèâà
		FOR lnCurrentSRef = 1 TO ALEN(.aFilters,1)
		
			*27.04.2004 13:25 -&gt;Åñëè ôèëüòð - èíòåðàêòèâàíàÿ ôèëüòðàöèÿ/ïîèñê è ñòðîêà ôèëüòðà íå ïóñòàÿ
			IF	INLIST(.aFilters[lnCurrentSRef,cnFILTER_MODE], ;
						cnMODE_LOCATE_CONTEXT,cnMODE_LOCATE_SEQUENTIAL) AND ;
				!EMPTY(.aFilters[lnCurrentSRef,cnFILTER_STRING])
				

				*28.04.2004 15:28 -&gt;×èòàåì íîìåð ïîèñêîâîé êîëîíêè
				lnCurrentColumn = .aFilters[lnCurrentSRef,cnFILTER_COLUMN]
				*------------------------------------------------------------------------------

				*29.04.2004 05:00 -&gt;Åñëè êîëîíêà íå ÿâëÿåòñÿ òåêóùåé -&gt; ñáðàñûâàåì ïîèñê
				IF lnCurrentColumn # .ActiveColumn
														
					*27.04.2004 13:11 -&gt;Ñáðàñûâàåì ñòðîêó ïîèñêà
					.aFilters[lnCurrentSRef,cnFILTER_STRING] = []
					*------------------------------------------------------------------------------
					
					*27.04.2004 13:12 -&gt;Âîññòàíàâëèâàåì çàãîëîâîê êîëîíêè
					.Columns(lnCurrentColumn).Header1.Caption = .aFilters[lnCurrentSRef,cnFILTER_HEADERCAPTION]
					*------------------------------------------------------------------------------
					
					*27.04.2004 13:12 -&gt;Î÷èùàåì òåêñò ïàíåëè ñîñòîÿíèÿ
					luCurrentControl = .Columns(lnCurrentColumn).CurrentControl
					luCurrentControl = .Columns(lnCurrentColumn).&amp;luCurrentControl
					luCurrentControl.StatusBarText = [ ]
					*------------------------------------------------------------------------------
				
				ENDIF
				*------------------------------------------------------------------------------	
				
				*29.04.2004 04:58 -&gt;Ïîñêîëüêó ó íàñ ìîæåò áûòü òîëüêî îäíà êîëîíêà ñ ðåæèìîì
				*èíòåðàêòèâíîãî ïîèñêà è íå ïóñòîé ñòðîêîé ïîèñêà -&gt; âûõîäèì èç ïðîñìîòðà êîëîíîê
				EXIT
				*------------------------------------------------------------------------------
												
			ENDIF
			*------------------------------------------------------------------------------
			
		ENDFOR &amp;&amp;* lnCounter = 1 TO ALEN(.aFilters,1)
		*------------------------------------------------------------------------------

	CASE tnResetMode = cnRESET_LOCATE	&amp;&amp; îòìåíà ïîèñêà (Valid)
	
		*27.04.2004 13:02 -&gt;Åñëè ìàññèâ ïóñòîé -&gt; ñáðàñûâàòü íå÷åãî -&gt; OK
		IF ISNULL(.aFilters)
			RETURN .T.
		ENDIF
		*------------------------------------------------------------------------------	
			
		*27.04.2004 13:17 -&gt;Ïðîõîäèì ïî âñåì ýëåìåíòàì ìàññèâà
		FOR lnCurrentSRef = 1 TO ALEN(.aFilters,1)
		
			*27.04.2004 13:25 -&gt;Åñëè ôèëüòð - èíòåðàêòèâàíàÿ ôèëüòðàöèÿ/ïîèñê è ñòðîêà ôèëüòðà íå ïóñòàÿ
			IF	INLIST(.aFilters[lnCurrentSRef,cnFILTER_MODE], ;
						cnMODE_LOCATE_CONTEXT,cnMODE_LOCATE_SEQUENTIAL) AND ;
				!EMPTY(.aFilters[lnCurrentSRef,cnFILTER_STRING])
				

				*28.04.2004 15:28 -&gt;×èòàåì íîìåð ïîèñêîâîé êîëîíêè
				lnCurrentColumn = .aFilters[lnCurrentSRef,cnFILTER_COLUMN]
				*------------------------------------------------------------------------------
								
				*27.04.2004 13:11 -&gt;Ñáðàñûâàåì ñòðîêó ïîèñêà
				.aFilters[lnCurrentSRef,cnFILTER_STRING] = []
				*------------------------------------------------------------------------------
				
				*27.04.2004 13:12 -&gt;Âîññòàíàâëèâàåì çàãîëîâîê êîëîíêè
				.Columns(lnCurrentColumn).Header1.Caption = .aFilters[lnCurrentSRef,cnFILTER_HEADERCAPTION]
				*------------------------------------------------------------------------------
				
				*27.04.2004 13:12 -&gt;Î÷èùàåì òåêñò ïàíåëè ñîñòîÿíèÿ
				luCurrentControl = .Columns(lnCurrentColumn).CurrentControl
				luCurrentControl = .Columns(lnCurrentColumn).&amp;luCurrentControl
				luCurrentControl.StatusBarText = [ ]
				*------------------------------------------------------------------------------
				
				*29.04.2004 04:58 -&gt;Ïîñêîëüêó ó íàñ ìîæåò áûòü òîëüêî îäíà êîëîíêà ñ ðåæèìîì
				*èíòåðàêòèâíîãî ïîèñêà è íå ïóñòîé ñòðîêîé ïîèñêà -&gt; âûõîäèì èç ïðîñìîòðà êîëîíîê
				EXIT
				*------------------------------------------------------------------------------
												
			ENDIF
			*------------------------------------------------------------------------------
			
		ENDFOR &amp;&amp;* lnCounter = 1 TO ALEN(.aFilters,1)
		*------------------------------------------------------------------------------

	CASE tnResetMode = cnRESET_ALLCOLUMNS	&amp;&amp; îòìåíà ïîèñêà âî âñåõ êîëîíêàõ
		
		*27.04.2004 13:02 -&gt;Åñëè ìàññèâ ïóñòîé -&gt; ñáðàñûâàòü íå÷åãî -&gt; OK
		IF ISNULL(.aFilters)
			RETURN .T.
		ENDIF
		*------------------------------------------------------------------------------	
			
		*27.04.2004 13:17 -&gt;Ïðîõîäèì ïî âñåì ýëåìåíòàì ìàññèâà
		FOR lnCurrentSRef = 1 TO ALEN(.aFilters,1)
		
			*27.04.2004 13:25 -&gt;Åñëè ôèëüòð - èíòåðàêòèâàíàÿ ôèëüòðàöèÿ/ïîèñê è ñòðîêà ôèëüòðà íå ïóñòàÿ
			IF	INLIST(.aFilters[lnCurrentSRef,cnFILTER_MODE], ;
						cnMODE_LOCATE_CONTEXT,cnMODE_LOCATE_SEQUENTIAL, ;
						cnMODE_FILTER_CONTEXT,cnMODE_FILTER_SEQUENTIAL) AND ;
				!EMPTY(.aFilters[lnCurrentSRef,cnFILTER_STRING])
				
				*28.04.2004 15:28 -&gt;×èòàåì íîìåð ïîèñêîâîé êîëîíêè
				lnCurrentColumn = .aFilters[lnCurrentSRef,cnFILTER_COLUMN]
				*------------------------------------------------------------------------------
									
				*27.04.2004 13:11 -&gt;Ñáðàñûâàåì ñòðîêó ïîèñêà
				.aFilters[lnCurrentSRef,cnFILTER_STRING] = []
				*------------------------------------------------------------------------------
				
				*27.04.2004 13:12 -&gt;Âîññòàíàâëèâàåì çàãîëîâîê êîëîíêè
				.Columns(lnCurrentColumn).Header1.Caption = .aFilters[lnCurrentSRef,cnFILTER_HEADERCAPTION]
				*------------------------------------------------------------------------------
				
				*27.04.2004 13:12 -&gt;Î÷èùàåì òåêñò ïàíåëè ñîñòîÿíèÿ
				luCurrentControl = .Columns(lnCurrentColumn).CurrentControl
				luCurrentControl = .Columns(lnCurrentColumn).&amp;luCurrentControl
				luCurrentControl.StatusBarText = [ ]
				*------------------------------------------------------------------------------
				
				*29.04.2004 04:47 -&gt;Âûñòàâëÿåì ôëàã, åñëè áûëà ñáðîøåíà èíòåðàêòèâíàÿ ôèëüòðàöèÿ	
				llInteractiveFilterDropped = INLIST(.aFilters[lnCurrentSRef,cnFILTER_MODE],cnMODE_FILTER_CONTEXT,cnMODE_FILTER_SEQUENTIAL)
				*------------------------------------------------------------------------------
								
			ENDIF
			*------------------------------------------------------------------------------
			
		ENDFOR &amp;&amp;* lnCounter = 1 TO ALEN(.aFilters,1)
		*------------------------------------------------------------------------------

		*27.04.2004 13:23 -&gt;Åñëè áûëà ñáðîøåíà èíòåðàêòèâàíÿ ôèëüòðàöèÿ -&gt; ïðèìåíèì èçìåíåííûé ôèëüòð
		IF llInteractiveFilterDropped
			.FilterApply()
		ENDIF	
		*------------------------------------------------------------------------------
	
ENDCASE
*------------------------------------------------------------------------------	

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE interactivesearchsetmode
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.INTERACTIVESEARCHSETMODE
* Called by.......: &lt;.HandleKey();.InteractiveSearch()&gt;
* Parameters......: &lt;tnFilterMode&gt;
* Returns.........:  &lt;.T./.F. â çàâèñèìîñòè îò óñïåøíîñòè óñòàíîêè ðåæèìà.&gt;
* Notes...........: &lt;protected/nouser/default&gt; Óñòàíîâêà ðåæèìà èíòåðàêòèâíîé
*					ôèëüòðàöèè/ïîèñêà ïîäñòðîêè â ñèìâîëüíûõ ïîëÿõ èñòî÷íèêà äàííûõ.
*-------------------------------------------------------
LPARAMETERS	tnFilterMode
WITH This

*27.04.2004 03:31 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnActiveColumn, ;
		lnSRef, ;
		lcFilterString, ;
		lnCounter
***
lnActiveColumn = .ActiveColumn
*------------------------------------------------------------------------------
**VAL(SUBSTR([Column1],7))

*27.04.2004 03:33 -&gt;Ñðàçó ïðîâåðèì çíà÷åíèå .ActiveColumn, ò.ê. äàííûé ìåòîä âûçûâàåòñÿ
*27.04.2004 03:34 -&gt;ãëîáàëüíûìè ìàêðîñàìè ON KEY LABEL è âîçìîæåí âûçîâ, êîãäà èñòî÷íèê
*27.04.2004 03:35 -&gt;äàííûõ íå ñîäåðæèò íè îäíîé çàïèñè, ñëåäîâàòåëüíî .ActiveColumn = 0
IF lnActiveColumn = 0
	?? CHR(7)
	RETURN .F.
ENDIF
*------------------------------------------------------------------------------

*27.04.2004 03:37 -&gt;Ïðîâåðÿåì ðàçðåø¸í ëè íàñòðîéêàìè Grid-à äàííûé ðåæèì ïîèñêà
IF	NOT ((INLIST(tnFilterMode,cnMODE_LOCATE_CONTEXT,cnMODE_LOCATE_SEQUENTIAL) AND ._InteractiveSearchAllowLocate) OR ;
		 (INLIST(tnFilterMode,cnMODE_FILTER_CONTEXT,cnMODE_FILTER_SEQUENTIAL) AND ._InteractiveSearchAllowFilter) OR ;
		 (tnFilterMode = cnMODE_NO_SEARCH))
	*{
	?? CHR(7)
	RETURN .F.
	*}
ENDIF		
*------------------------------------------------------------------------------

*27.04.2004 03:41 -&gt;Ïðîâåðèì çàðåãèñòðèðîâàíà ëè àêòèâíàÿ êîëîíêà êàê ïîèñêîâàÿ
lnSRef = .ArrayElementGet([This.aFilters],cnFILTER_COLUMN,lnActiveColumn)
***
IF ISNULL(lnSRef)	&amp;&amp;íå çàðåãèñòðèðîâàíà

	*27.04.2004 03:43 -&gt;Ïðîâåðÿåì âîçìîæåí ëè ïîèñê â äàííîé êîëîíêå
	IF TYPE(.Columns[lnActiveColumn].ControlSource) # [C] &amp;&amp;íå ñèìâîëüíîå ïîëå
		?? CHR(7)
		RETURN .F.
	ENDIF
	*------------------------------------------------------------------------------
	
	*27.04.2004 03:43 -&gt;Ðåãèñòðèðóåì ñ òðåáóåìûì ðåæèìîì ïîèñêà
	.FilterRegister(tnFilterMode,[],lnActiveColumn,.Columns[lnActiveColumn].ControlSource,.Columns[lnActiveColumn].Header1.Caption)
	*------------------------------------------------------------------------------
	
ELSE	&amp;&amp;çàðåãèñòðèðîâàíà
		
	*27.04.2004 03:50 -&gt;Åñëè ðåæèì ïîèñêà ìåíÿåòñÿ
	IF .aFilters[lnSRef,cnFILTER_MODE] # tnFilterMode
		
		*27.04.2004 14:06 -&gt;Ñîõðàíÿåì ñòàðóþ ñòðîêó ïîèñêà
		lcFilterString = .aFilters[lnSRef,cnFILTER_STRING]
		*------------------------------------------------------------------------------
		
		*27.04.2004 14:08 -&gt;Åñëè ñòðîêà íå ïóñòàÿ è â íîâîì ðåæèìå ïîèñê íå îòêëþ÷åí - çàïðåùàåì îáíîâëåíèå
		IF !EMPTY(lcFilterString) AND tnFilterMode # cnMODE_NO_SEARCH
			.lNoExtendedRefresh = .T.
		ENDIF
		*------------------------------------------------------------------------------
					
		*27.04.2004 04:09 -&gt;Åñëè ðàíåå â êîëîíêå áûë ïîèñê - ñáðàñûâàåì
		IF !EMPTY(lcFilterString)
			.InteractiveSearchReset(cnRESET_USER_ACTIVECOLUMN)
		ENDIF	
		*------------------------------------------------------------------------------
			
		*27.04.2004 13:51 -&gt;Èçìåíÿåì ðåæèì
		.aFilters[lnSRef,cnFILTER_MODE] = tnFilterMode
		*------------------------------------------------------------------------------
		
		*27.04.2004 14:11 -&gt;Åñëè ñòðîêà íå ïóñòàÿ è â íîâîì ðåæèìå ïîèñê íå îòêëþ÷åí - âîññòàíàâëèâàåì ïîèñê
		IF !EMPTY(lcFilterString) AND tnFilterMode # cnMODE_NO_SEARCH
			FOR lnCounter = 1 TO LEN(lcFilterString)
				IF !.InteractiveSearch(ASC(SUBSTR(lcFilterString,lnCounter,1)))
					EXIT
				ENDIF	
			ENDFOR
			***
			.lNoExtendedRefresh = .F.
			***
			.Refresh()
		ENDIF
		*------------------------------------------------------------------------------
								
	ENDIF
	*------------------------------------------------------------------------------
		
ENDIF
*------------------------------------------------------------------------------

*22.04.2004 20:08 -&gt;Ñîîáùèì ïîëüçîâàòåëþ î íîâîì/òåêóùåì ðåæèìå ïîèñêà
DO CASE
	CASE tnFilterMode = cnMODE_NO_SEARCH
		WAIT WINDOW [Ðåæèì: ïîèñê îòêëþ÷åí.] NOWAIT
	CASE tnFilterMode = cnMODE_LOCATE_CONTEXT
		WAIT WINDOW [Ðåæèì: êîíòåêñòíûé ïîèñê.] NOWAIT
	CASE tnFilterMode = cnMODE_LOCATE_SEQUENTIAL
		WAIT WINDOW [Ðåæèì: ïîñëåäîâàòåëüíûé ïîèñê.] NOWAIT
	CASE tnFilterMode = cnMODE_FILTER_CONTEXT	
		WAIT WINDOW [Ðåæèì: êîíòåêñòíûé ôèëüòð.] NOWAIT
	CASE tnFilterMode = cnMODE_FILTER_SEQUENTIAL
		WAIT WINDOW [Ðåæèì: ïîñëåäîâàòåëüíûé ôèëüòð.] NOWAIT
ENDCASE
*------------------------------------------------------------------------------

*27.04.2004 03:50 -&gt;Âîçâðàùàåì ôëàã óñïåøíîñòè îïåðàöèè
RETURN .T.
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************

ENDPROC
PROCEDURE positionkeep
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.POSITIONKEEP
* Called by.......: &lt;Miscelanous Calls&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Ñîõðàíåíèå â ìàññèâå .aPositionKeysValues
*					èíôîðìàöèè î ïîçèöèè â Alias-å, óêàçàííîì â RecordSource, íà îñíîâàíèè
*					ñïèñêà êëþ÷åé, óêàçàííîãî â ñâîéñòâå ._PositionKeysList.
*-------------------------------------------------------

*06.10.2003 16:34 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcOldAlias, ;
		lcOldCentury, ;
		lnKeysCount, ;
		lnKeysCounter, ;
		lnStart, ;
		lnEnd, ;
		lcKey, ;
		luValue, ;
		lcCharSymbol, ;
		lcCharSymbo2
lcOldAlias = ALIAS()		
lcOldCentury = SET([CENTURY])
SET CENTURY ON
*------------------------------------------------------------------------------

WITH THIS

*06.10.2003 16:34 -&gt;Ñîõðàíÿåì çíà÷åíèÿ êëþ÷åé â ìàññèâå, åñëè óêàçàíû RecordSource ó Grid-à è cPositionKeys
IF !EMPTY(._PositionKeysList) AND !EMPTY(.RecordSource) AND USED(.RecordSource)
	lnKeysCount = OCCURS([;],ALLTRIM(._PositionKeysList))+1
	DIMENSION .aPositionKeysValues[lnKeysCount,2]
	SELECT(.RecordSource)
	FOR lnKeysCounter = 1 TO lnKeysCount
		lnStart = IIF(lnKeysCounter=1,1,AT([;],ALLTRIM(._PositionKeysList),lnKeysCounter-1)+1)
		lnEnd  = IIF(lnKeysCounter=lnKeysCount,LEN(ALLTRIM(._PositionKeysList))+1,AT([;],ALLTRIM(._PositionKeysList),lnKeysCounter))
		lcKey = SUBSTR(ALLTRIM(._PositionKeysList),lnStart,lnEnd - lnStart)
		.aPositionKeysValues(lnKeysCounter,1) = lcKey
		luValue = &amp;lcKey
		DO CASE
			CASE TYPE([luValue])=[C]
				lcCharSymbol1 = IIF(!(["]$luValue),["],IIF(!([']$luValue),['],"["))
				lcCharSymbol2 = IIF(!(["]$luValue),["],IIF(!([']$luValue),['],"]"))
				.aPositionKeysValues(lnKeysCounter,1) = [ALLTRIM(]+lcKey+[)]
				.aPositionKeysValues(lnKeysCounter,2) = lcCharSymbol1+ALLTRIM(luValue)+lcCharSymbol2
			CASE TYPE([luValue])=[N]
				.aPositionKeysValues(lnKeysCounter,2) = ALLTRIM(STR(luValue))
			CASE TYPE([luValue])=[D]
				.aPositionKeysValues(lnKeysCounter,2) = [{]+ALLTRIM(DTOC(luValue))+[}]
			CASE TYPE([luValue])=[T]
				.aPositionKeysValues(lnKeysCounter,2) = [{]+ALLTRIM(TTOC(luValue))+[}]
			CASE TYPE([luValue])=[L]
				.aPositionKeysValues(lnKeysCounter,2) = IIF(luValue,[.T.],[.F.])
		ENDCASE
	ENDFOR &amp;&amp;* lnKeysCounter = 1 TO lonCountKeys
ENDIF
*------------------------------------------------------------------------------

ENDWITH

*06.10.2003 16:45 -&gt;Âîññòàíîâèì òåêóùèé Alias
IF !EMPTY(lcOldAlias) AND USED(lcOldAlias) AND lcOldAlias#ALIAS()
	SELECT(lcOldAlias)
ENDIF
*------------------------------------------------------------------------------

*08.12.2003 17:39 -&gt;Âîñòàíîâèì óñòàíîâêó âåêà
SET CENTURY &amp;lcOldCentury
*------------------------------------------------------------------------------
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE positionrecall
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.POSITIONRECALL
* Called by.......: &lt;Miscelanous Calls&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Âîññòàíîâëåíèå ïîçèöèè â Alias-å,
*					óêàçàííîì â .RecordSource, íà îñíîâàíèè ñïèñêà êëþ÷åé,
*					óêàçàííîãî â ñâîéñòâå ._PositionKeysList è èíôîðìàöèè,
*					ñîõðàíåííîé ìåòîäîì .PositionKeep() â ìàññèâå .aPositionKeysValues.
*-------------------------------------------------------

*08.12.2003 15:58 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcOldAlias, ;
		lnKeysCounter, ;
		lcLocateExp
lcOldAlias = ALIAS()		
*------------------------------------------------------------------------------

WITH THIS

*08.12.2003 15:59 -&gt;Âåðíåìñÿ íà ñòàðóþ ïîçèöèþ â ALIAS-å, óêàçàííîì â RecordSource
IF !EMPTY(._PositionKeysList) AND !EMPTY(.RecordSource) AND USED(.RecordSource)

	*08.10.2003 12:07 -&gt;Ïðîâåðèì áûëà ëè ñîõðàíåíà èíôîðìàöèÿ î ïîçèöèè â Alias-å
	IF ALEN(.aPositionKeysValues)&lt;2
		ASSERT .F. MESSAGE [Íåò èíôîðìàöèè äëÿ âîññòàíîâëåíèÿ ïîçèöèè â ALIAS-å. Ïðîâåðüòå âûçîâ KeepPosition ïåðåä âûçîâîì RecallPosition.]
		RETURN
	ENDIF	
	*------------------------------------------------------------------------------
	
	*08.10.2003 12:08 -&gt;Ôîðìèðìèðóåì óñëîâèå äëÿ ïîèñêà
	lcLocateExp = [FOR .T.]
	FOR lnKeysCounter=1 TO ALEN(.aPositionKeysValues,1)
		lcLocateExp=lcLocateExp+[ AND ]+.aPositionKeysValues(lnKeysCounter,1)+[ = ]+.aPositionKeysValues(lnKeysCounter,2)
	ENDFOR
	*------------------------------------------------------------------------------
	
	*08.10.2003 12:09 -&gt;Ïðîèçâîäèì ïîèñê
	SELECT(.RecordSource)
	LOCATE ALL &amp;lcLocateExp
	IF !FOUND()
		GO TOP
	ENDIF
	*------------------------------------------------------------------------------
ENDIF
*------------------------------------------------------------------------------

*08.12.2003 15:59 -&gt;Âîññòàíîâèì òåêóùèé Alias
IF !EMPTY(lcOldAlias) AND USED(lcOldAlias) AND lcOldAlias#ALIAS()
	SELECT(lcOldAlias)
ENDIF
*------------------------------------------------------------------------------

*08.12.2003 17:41 -&gt;Îáíîâèì Grid
.Refresh()
*------------------------------------------------------------------------------

ENDWITH	
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE Refresh
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Parameters......: &lt;tlForceHandling - ïðèíóäèòåëüíûé âûçîâ îáðàáîò÷èêîâ èçìåíåíèé.&gt;
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.REFRESH
* Called by.......: &lt;Sys Event + Misc Int &amp; Ext Calls&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;sysevent&gt; Âûçîâ ìåòîäà àêòóàëèçàöèè RunTime ñâîéñòâ Grid-à.
*-------------------------------------------------------
LPARAMETERS	tuForceHandling,tuNoCallRefreshRunTimeProps

WITH This

*29.04.2004 04:22 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnOldRSRecNo
*------------------------------------------------------------------------------

*27.04.2004 01:09 -&gt;Îáíîâëÿåì RunTime ñâîéñòâà
IF NOT (TYPE([tuNoCallRefreshRunTimeProps])==[L] AND tuNoCallRefreshRunTimeProps)
	.RefreshRunTimeProps(tuForceHandling)
ENDIF	
*------------------------------------------------------------------------------

*29.04.2004 04:21 -&gt;Çàïîìíèì ïîçèöèþ óêàçàòåëÿ òåêóùåé çàïèñè
lnOldRSRecNo = .nRSRecNo
*------------------------------------------------------------------------------

*29.04.2004 04:22 -&gt;Çàïðåòèì ïîëíîå îáíîâëåíèå
.lNoExtendedRefresh = .T.
*------------------------------------------------------------------------------

*28.04.2004 16:42 -&gt;Âûïîëíèì ìåòîä áàçîâîãî êëàññà
DODEFAULT()
*------------------------------------------------------------------------------
* Ñêðûâàåì êîëîíêè
IF NOT EMPTY(._columndisalist)

ENDIF

*29.04.2004 04:06 -&gt;Âîññòàíîâèì óêàçàòåëü òåêóùåé çàïèñè
IF lnOldRSRecNo # 0 AND .nRSRecNo # lnOldRSRecNo
	GOTO (lnOldRSRecNo) IN (.RecordSource)
ENDIF	
*------------------------------------------------------------------------------

*29.04.2004 04:23 -&gt;Ðàçðåøèì ïîëíîå îáíîâëåíèå
.lNoExtendedRefresh = .F.
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
*-*COMMENT:	Ïðè èçìåíåíèè ôèëüòðà èëè ñîðòèðîâêè â èñòî÷íèêå äàííûõ ÷àñòî ïîñëå
*-*			âûïîëíåíèÿ DODEFAULT ïðèñõîäèò ïðîèçâîëüíûé ïåðåõîä íà äðóãóþ çàïèñü.
*-*			Äëÿ ïðåäîòâðàùåíèÿ äàííîé ñèòóàöèè ïîñëå âûïîëíåíèÿ DODEFAULT() ïîëîæåíèå
*-*			óêàçàòåëÿ òåêóùåé çàïèñè âîññòàíàâëèâàåòñÿ.
*-*			Çàïðåò ïîëíîãî îáíîâëåíèÿ ñâÿçàí ñ òåì, ÷òî:
*-*			1. Åñëè ïðîèçâîëüíîãî ïåðåõîäà íà äðóãóþ çàïèñü íå ïðèçîéäåò, ó íàñ ñðàáîòàåò
*-*			AfterRowColChange, âûçâàâ ïðè ýòîì RefreshRunTimeProps. Ò.ê. çàïèñü îñòàëàñü
*-*			òà æå, ÷òî è ïðè âûçîâå RefreshRunTimeProps èç äàííîãî ìåòîäà, çàïðåò ïîëíîãî
*-*			îáíîâëåíèÿ íå ñûãðàåò ðîëè.
*-*			2. Åñëè ïðîèçîéäåò ïðîèçâîëüíûé ïåðåõîä íà äðóãóþ çàïèñü,  ó íàñ ñðàáîòàåò
*-*			AfterRowColChange, âûçâàâ ïðè ýòîì RefreshRunTimeProps. Ò.ê. ïðîèçîùåë ïåðåõîä
*-*			íà äðóãóþ çàïèñü, ó íàñ äîëæíî ïðîéòè ïîëíîå îáíîâëåíèå, ÷òî ìû è ïðåäîòâðàùàåì.
			
			
ENDPROC
PROCEDURE refreshcursorset
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.REFRESHCURSORSET
* Called by.......: &lt;.When();.Valid();.Destroy()&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;protected/nouser/default&gt; Îáíîâëåíèå óñòàíîâêè SET CURSOR.
*-------------------------------------------------------
WITH This

*23.04.2004 13:32 -&gt;Åñëè Grid àêòèâåí - îòêëþ÷àåì êóðñîð
IF .lGridActive
	
	IF !.lCursorSet
		
		*29.04.2004 06:18 -&gt;Ñîõðàíèì óñòàíîâêó SET CURSOR â ñâîéñòâå .cCursorSetOld
		.cCursorSetOld = SET([CURSOR])
		*------------------------------------------------------------------------------					
		
		*29.04.2004 06:19 -&gt;Îòêëþ÷àåì êóðñîð
		SET CURSOR OFF
		*------------------------------------------------------------------------------
		
		*29.04.2004 05:38 -&gt;Âûñòàâëÿåì ôëàã, ÷òî êóðñîð îòêëþ÷åí
		.lCursorSet = .T.
		*------------------------------------------------------------------------------
		
	ENDIF	
		
ELSE
	
	IF .lCursorSet
	
		*23.04.2004 13:32 -&gt;Âîññòàíîâèì ñòàðóþ óñòàíîâêó SET CURSOR èç ñâîéñòâà .cCursorSetOld
		LOCAL	lcCursorSetOld
		***
		lcCursorSetOld = .cCursorSetOld
		SET CURSOR &amp;lcCursorSetOld
		*------------------------------------------------------------------------------
		
		*29.04.2004 06:21 -&gt;Ñáðàñûâàåì ôëàã, ÷òî êóðñîð îòêëþ÷åí
		.lCursorSet = .F.
		*------------------------------------------------------------------------------
		
	ENDIF
	
ENDIF
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE refreshhandledcustommsglist
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.REFRESHHANDLEDCUSTOMMSGLIST
* Called by.......: &lt;.When();.RefreshRunTimeProps();.Valid()&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;protected/nouser/default&gt; Îáíîâëåíèå ðåãèñòðàöèè îáúåêòà êàê îáðàáîò÷èêà ñïèñêà
*					ïîëüçîâàòåëüñêèõ ñîîáùåíèé, êîòîðûå ìîãóò áûòü îáðàáîòàíû â äàííîì êîíòåêñòå.
*-------------------------------------------------------
WITH This

*29.04.2004 03:54 -&gt;Îáíîâëÿåì ñïèñîê ñîîáùåíèé, êîòîðûå ìîæåò îáðàáîòàòü äàííûé îáúåêò.
IF 	TYPE([ThisForm.cstMsgHandler])==[O] AND !ISNULL(ThisForm.cstMsgHandler)
	
	*29.04.2004 03:52 -&gt;Óäàëÿåì ðåãèñòðàöèþ îáúåêòà äëÿ âñåõ ïîëüçîâàòåëüñêèõ ñîîáùåíèé
	ThisForm.cstMsgHandler.UnRegMultipleMsgHandler(._HandledCustomMsgList,SYS(1272,This))
	*------------------------------------------------------------------------------

	*29.04.2004 03:53 -&gt;Åñëè Grid àêòèâåí ðåãèñòðèðóåì ñîîáùåíèÿ, êîòîðûå ìîãóò áûòü îáðàáîòàíû â äàííîì êîíòåêñòå
	IF 	.lGridActive
		ThisForm.cstMsgHandler.RegMultipleMsgHandler(._GetHandledCustomMsgList(),SYS(1272,This))
	ENDIF
	*------------------------------------------------------------------------------

ENDIF	
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE refreshhandledhotkey
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.REFRESHHANDLEDHOTKEY
* Called by.......: &lt;.When();.Valid();.Destroy()&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Îáíîâëåíèå ñïèñêà íàçíà÷åíèé ãîðÿ÷èõ êëàâèø.
*-------------------------------------------------------
WITH This

*23.04.2004 13:32 -&gt;Åñëè Grid àêòèâåí - âûñòàâëÿåì ãîðÿ÷èå êëàâèøè, èíà÷å îòìåíÿåì
IF .lGridActive
	
	IF !.lHotKeySet
					
		*23.04.2004 13:32 -&gt;Âû÷èñëèì àáñîëþòíóþ èåðàðõèþ íàøåãî îáúåêòà îòíîñèòåëüíî ôîðìû
		LOCAL lcObjectHierarchy
		***
		lcObjectHierarchy = SYS(1272, This)
		lcObjectHierarchy = [_SCREEN.ACTIVEFORM] + SUBSTR(lcObjectHierarchy, AT([.], lcObjectHierarchy))
		*------------------------------------------------------------------------------
		
		*23.04.2004 13:32 -&gt;Ñîõðàíèì â ñòåêå íàçíà÷åííûå êîìáèíàöèè êëàâèø è óñòàíîâèì ñâîè
		PUSH KEY
		ON KEY LABEL Alt+0 &amp;lcObjectHierarchy..HandleKey(0)
		ON KEY LABEL Alt+1 &amp;lcObjectHierarchy..HandleKey(0.1)
		ON KEY LABEL Alt+2 &amp;lcObjectHierarchy..HandleKey(0.2)
		ON KEY LABEL Alt+3 &amp;lcObjectHierarchy..HandleKey(0.3)
		ON KEY LABEL Alt+4 &amp;lcObjectHierarchy..HandleKey(0.4)
		*------------------------------------------------------------------------------
		
		*29.04.2004 05:38 -&gt;Âûñòàâëÿåì ôëàã, ÷òî ãîðÿ÷èå êëàâèøè íàçíà÷åíû
		.lHotKeySet = .T.
		*------------------------------------------------------------------------------
		
	ENDIF	
		
ELSE
	
	IF .lHotKeySet
	
		*23.04.2004 13:32 -&gt;Âîññòàíîâèì ñòàðîå íàçíà÷åíèå ãîðÿ÷èõ êëàâèø
		POP KEY
		*------------------------------------------------------------------------------

		*29.04.2004 05:38 -&gt;Ñáðàñûâàåì ôëàã, ÷òî ãîðÿ÷èå êëàâèøè íàçíà÷åíû
		.lHotKeySet = .F.
		*------------------------------------------------------------------------------
		
	ENDIF
	
ENDIF
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE refreshhandledstandartmsglist
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.REFRESHHANDLEDSTANDARTMSGLIST
* Called by.......: &lt;.When();.RefreshRunTimeProps();.Valid()&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;protected/nouser/default&gt; Îáíîâëåíèå ðåãèñòðàöèè îáúåêòà êàê îáðàáîò÷èêà ñïèñêà
*					ñòàíäàðòíûõ ñîîáùåíèé, êîòîðûå ìîãóò áûòü îáðàáîòàíû â äàííîì êîíòåêñòå.
*-------------------------------------------------------
WITH This

*29.04.2004 03:55 -&gt;Îáíîâëÿåì ñïèñîê ñîîáùåíèé, êîòîðûå ìîæåò îáðàáîòàòü äàííûé îáúåêò.
IF 	TYPE([ThisForm.cstMsgHandler])==[O] AND !ISNULL(ThisForm.cstMsgHandler)
	
	*29.04.2004 03:52 -&gt;Óäàëÿåì ðåãèñòðàöèþ îáúåêòà äëÿ âñåõ ñòàíäàðòíûõ ñîîáùåíèé
	ThisForm.cstMsgHandler.UnRegMultipleMsgHandler(._HandledStandartMsgList,SYS(1272,This))
	*------------------------------------------------------------------------------
	
	*29.04.2004 03:53 -&gt;Åñëè Grid àêòèâåí ðåãèñòðèðóåì ñîîáùåíèÿ, êîòîðûå ìîãóò áûòü îáðàáîòàíû â äàííîì êîíòåêñòå
	IF 	.lGridActive
		ThisForm.cstMsgHandler.RegMultipleMsgHandler(._GetHandledStandartMsgList(),SYS(1272,This))
	ENDIF
	*------------------------------------------------------------------------------

ENDIF	
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE refreshrsstate
*-------------------------------------------------------
* Project.........:	GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.REFRESHRSSTATE
* Called by.......: &lt;.RefreshRunTimeProps()&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;protected/nouser/default&gt; Êîððåêòíîå ïîçèöèîíèðîâàíèå
*					óêàçàòåëÿ òåêóùåé çàïèñè è îáíîâëåíèå çíà÷åíèÿ ñâîéñòâà .eRSState.
*-------------------------------------------------------
WITH This
*08.12.2003 00:48 -&gt;Îáÿúâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	llFoxEof, ;
		llTestEof, ;
		llFoxBof, ;
		llTestBof
*------------------------------------------------------------------------------

*28.04.2004 18:34 -&gt;Åñëè íå îïðåäåëåí RecordSource
IF EMPTY(.RecordSource)
	.eRSState = __RS_NOT_DEFINED
	.nRSRecNo = 0
	RETURN
ENDIF
*------------------------------------------------------------------------------

*28.04.2004 18:34 -&gt;Åñëè Alias íå îòêðûò
IF !USED(.RecordSource)
	.eRSState = __RS_NOT_USED
	.nRSRecNo = 0
	RETURN
ENDIF
*------------------------------------------------------------------------------

*28.04.2004 18:34 -&gt;Ïðèìåíèì ê èñòî÷íèêó äàííûõ ôèëüòð ñ ó÷¸òîì èíòåðàêòèâíûõ ïîèñêîâ
.FilterApply(.T.)
*------------------------------------------------------------------------------

*29.04.2004 01:06 -&gt;Ïîçèöèîíèðóåì óêàçàòåëü çàïèñè
IF !BOF(.RecordSource)
	SKIP -1 IN (.RecordSource)
	IF BOF(.RecordSource)
		GO TOP IN (.RecordSource)
	ELSE
		SKIP 1 IN (.RecordSource)
		IF EOF(.RecordSource)
			GO BOTTOM IN (.RecordSource)
		ENDIF
	ENDIF
ENDIF
***
IF !EOF(.RecordSource)
	SKIP 1 IN (.RecordSource)
	IF EOF(.RecordSource)
		GO BOTTOM IN (.RecordSource)
	ELSE
		SKIP -1 IN (.RecordSource)
		IF BOF(.RecordSource)
			GO TOP IN (.RecordSource)
		ENDIF
	ENDIF
ENDIF
*------------------------------------------------------------------------------

*29.04.2004 01:33 -&gt;Îöåíèâàåì ïîçèöèþ óêàçàòåëÿ çàïèñè
IF BOF(.RecordSource)
	llFoxBof  = .T.
	llTestBof = .T.
ELSE
	SKIP -1 IN (.RecordSource)
	IF BOF(.RecordSource)
		llTestBof = .T.
		GO TOP IN (.RecordSource)
	ELSE
		SKIP 1 IN (.RecordSource)
		IF EOF(.RecordSource)
			GO BOTTOM IN (.RecordSource)
		ENDIF	
	ENDIF
ENDIF					
***
IF EOF(.RecordSource)
	llFoxEof  = .T.
	llTestEof = .T.
ELSE
	SKIP 1 IN (.RecordSource)
	IF EOF(.RecordSource)
		llTestEof = .T.
		GO BOTTOM IN (.RecordSource)
	ELSE
		SKIP -1 IN (.RecordSource)
		IF BOF(.RecordSource)
			GO TOP IN (.RecordSource)
		ENDIF	
	ENDIF
ENDIF
*------------------------------------------------------------------------------

*28.04.2004 18:34 -&gt;Ïðèìåíèì ôèëüòð ê èñòî÷íèêó äàííûõ ôèëüòð áåç ó÷¸òà èíòåðàêòèâíûõ ïîèñêîâ
.FilterApply()
*------------------------------------------------------------------------------

*08.12.2003 00:46 -&gt;Âûñòàâëÿåì ñîîòâåòñòâóþùåå çíà÷åíèå
DO CASE
	CASE (llFoxEof AND llTestBof)
		.eRSState = __RS_EMPTY
	CASE (llTestEof AND llTestBof)
		.eRSState = __RS_ONE_REC
	CASE (llTestEof AND !llTestBof)	
		.eRSState = __RS_EOF
	CASE (!llTestEof AND llTestBof)	
		.eRSState = __RS_BOF
	OTHERWISE
		.eRSState = __RS_MIDDLE
ENDCASE		
*------------------------------------------------------------------------------

*29.04.2004 02:26 -&gt;Îáíîâèì ñâîéñòâî .nRSRecNo
IF .eRSState = __RS_EMPTY
	.nRSRecNo = 0
ELSE
	.nRSRecNo = RECNO(.RecordSource)
ENDIF
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
*-*COMMENT:	Ñòîëü ñòðàííûé êîä ïî ïîçèöèîíèðîâàíèþ è îöåíêå ïîëîæåíèÿ çàïèñè ñâÿçàí
*-*			ñ íåñêîëüêèìè "èíòåðåñíûìè îñîáåííîñòÿìè" VFP. Íàïðèìåð, òåì, ÷òî:
*-*			1. VFP ïðèíöèïèàëüíî íå ïðèìåíÿåò ôèëüòð, ïîñëå SET FILTER.
*-*			2. Ìîæíî ñäåëàòü DELETE NEXT 1 è ïðè SET DELETED ON ñòîÿòü íà óäàëåííîé
*-*			   çàïèñè.
*-*			3. Ìîæíî ñäåëàòü SET FILTER TO .F. çàòåì GOTO 98 è ïîëó÷èòü EOF()=.F.,
*-*			   BOF()=.F., RECNO()=98.
ENDPROC
PROCEDURE refreshruntimeprops
*-------------------------------------------------------
* Project.........:	GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.REFRESHRUNTIMEPROPS
* Called by.......: &lt;.Init(),.When(),.AfterRowColChange(),.Refresh()&gt;
* Parameters......: tlForceRefresh - ôëàã ïðèíóäèòåëüíîãî îáíîâëåíèÿ ñ îáíîâëåíèåì
*					ñïèñêîâ äîñòóïíûõ ñîîáùåíèé è âûçîâîì âñåõ îáðàáîò÷èêîâ èçìåíåíèé
* Returns.........: &lt;none&gt;
* Notes...........: &lt;protected/nouser/default&gt; Îáíîâëåíèå RunTime ñâîéñòâ Grid-à (.eRSState, .nRSRecNo)
*-------------------------------------------------------
LPARAMETERS tlForceRefresh

WITH This

*07.12.2003 23:31 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnOldRSState, ;
		lnOldRSRecNo, ;
		llRSStateChanged, ;
		llRSRecNoChanged
***		
lnOldRSState = .eRSState
lnOldRSRecNo = .nRSRecNo
*------------------------------------------------------------------------------

*29.04.2004 02:26 -&gt;Îáíîâèì RunTime ñâîéñòâà Grid-à, ñâÿçàííûå ñ ñîñòîÿíèåì èñòî÷íèêà äàííûõ
.RefreshRSState()
*------------------------------------------------------------------------------

*24.03.2004 18:05 -&gt;Îïðåäåëèìñÿ, êàêîå ñâîéñòâî áûëî èçìåíåíî
llRSStateChanged = tlForceRefresh OR (.eRSState # lnOldRSState)
llRSRecNoChanged = tlForceRefresh OR (.nRSRecNo # lnOldRSRecNo)
*------------------------------------------------------------------------------

*24.03.2004 18:00 -&gt;Âûïîëíèì .Refresh(.T.,.T.) äëÿ ïîäñâåòêè òåêóùåé ñòðîêè
IF llRSRecNoChanged AND ._ActiveRowHighLight
	.Refresh(.T.,.T.)
ENDIF	
*------------------------------------------------------------------------------

*29.04.2004 02:36 -&gt;Åñëè íå çàïðåùåíî ïîëíîå îáíîâëåíèå ñ îáíîâëåíèåì ñîîáùåíèé è ñâÿçàííûõ îáúåêòîâ
IF !.lNoExtendedRefresh

	*24.03.2004 18:09 -&gt;Âûïîëíèì .RefreshHandledStandartMsgList()
	IF 	(llRSStateChanged AND ._RefreshHandledStandartMsgListOnRSStateChange) OR ;
		(llRSRecNoChanged AND ._RefreshHandledStandartMsgListOnRSRecNoChange)
		*{
		.RefreshHandledStandartMsgList()
		*}
	ENDIF
	*------------------------------------------------------------------------------

	*24.03.2004 18:09 -&gt;Âûïîëíèì .RefreshHandledCustomMsgList()
	IF 	(llRSStateChanged AND ._RefreshHandledCustomMsgListOnRSStateChange) OR ;
		(llRSRecNoChanged AND ._RefreshHandledCustomMsgListOnRSRecNoChange)
		*{
		.RefreshHandledCustomMsgList()
		*}
	ENDIF
	*------------------------------------------------------------------------------

	*24.03.2004 18:09 -&gt;Âûïîëíèì ._RefreshRelatedObjects()
	IF 	(llRSRecNoChanged AND ._RefreshRelatedObjectsOnRSRecNoChange)
		*{
		._RefreshRelatedObjects()
		*}
	ENDIF
	*------------------------------------------------------------------------------

ENDIF
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE RightClick
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.RIGHTCLICK
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: Ïðîãðàìíîå ñîçäàíèå êîíòåêñòíîãî ìåíþ.
*-------------------------------------------------------

*05.04.2004 13:52 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnMsgCount, ;
		lnMsgCounter, ;
		lnStartPos, ;
		lnEndPos, ;
		lcPrompt, ;
		lcMsg, ;
		lnCurSRef, ;
		lcHandledCustomMsgList, ;
		lcHandledStandartMsgList, ;
		lnItemCountAfterSeparator, ;
		lcRelativeHierarchy, ;
		lcActionMacro, ;
		lnAddBarIndex
***		
LOCAL ARRAY 	paStdContextActions[1], ;
				paCstContextActions[1]
***
paStdContextActions = .NULL.
paCstContextActions = .NULL.
*------------------------------------------------------------------------------
WITH This

*******************************************************************************
*1. ×èòàåì â ìàññèâ ñïèñîê ïóíêòîâ ìåíþ è ñïèñîê ñîîáùåíèé	  				  *
*******************************************************************************

*05.04.2004 14:01 -&gt;Ïðîâåðÿåì ðàçìåðíîñòè âñåõ ñïèñêîâ
IF OCCURS([;],._HandledStandartMsgList) # OCCURS([;],._HandledStandartMsgPromptList)
	ASSERT .F. MESSAGE [GRD.RIGHTCLICK: ðàçìåðíîñòü ñïèñêà ñòàíäàðòíûõ ñîîáùåíèé îòëè÷íà îò ðàçìåðíîñòè ñïèñêà ñòàíäàðòíûõ ïóíêòîâ ìåíþ.]
	RETURN .F.
ENDIF
***
IF OCCURS([;],._HandledCustomMsgList) # OCCURS([;],._HandledCustomMsgPromptList)
	ASSERT .F. MESSAGE [GRD.RIGHTCLICK: ðàçìåðíîñòü ñïèñêà ïîëüçîâàòåëüñêèõ ñîîáùåíèé îòëè÷íà îò ðàçìåðíîñòè ñïèñêà ïîëüçîâàòåëüñêèõ ïóíêòîâ ìåíþ.]
	RETURN .F.
ENDIF
*------------------------------------------------------------------------------
*05.04.2004 14:09 -&gt;×èòàåì â ìàññèâ ñòàíäàðòíûå ñîîáùåíèÿ
lnMsgCount = OCCURS([;],._HandledStandartMsgPromptList)+1
***
FOR lnMsgCounter = 1 TO lnMsgCount
	lnStartPos = IIF(lnMsgCounter = 1, 1, AT([;],._HandledStandartMsgPromptList,lnMsgCounter-1)+1)
	lnEndPos   = IIF(lnMsgCounter = lnMsgCount, LEN(._HandledStandartMsgPromptList), AT([;],._HandledStandartMsgPromptList,lnMsgCounter)-1)
	lcPrompt   = SUBSTR(._HandledStandartMsgPromptList,lnStartPos,lnEndPos-lnStartPos+1)
	***
	lnStartPos = IIF(lnMsgCounter = 1, 1, AT([;],._HandledStandartMsgList,lnMsgCounter-1)+1)
	lnEndPos   = IIF(lnMsgCounter = lnMsgCount, LEN(._HandledStandartMsgList), AT([;],._HandledStandartMsgList,lnMsgCounter)-1)
	lcMsg   = SUBSTR(._HandledStandartMsgList,lnStartPos,lnEndPos-lnStartPos+1)
	***
	IF !EMPTY(lcPrompt)
		IF ISNULL(paStdContextActions)
			lnCurSRef = 1
		ELSE
			lnCurSRef = ALEN(paStdContextActions,1)+1
		ENDIF
		***
		DIMENSION paStdContextActions(lnCurSRef,2)
		***
		paStdContextActions(lnCurSRef,cnCMA_PROMPT) = lcPrompt
		paStdContextActions(lnCurSRef,cnCMA_MSG) = lcMsg
	ENDIF	
	***
ENDFOR
*------------------------------------------------------------------------------

*05.04.2004 14:09 -&gt;×èòàåì â ìàññèâ ïîëüçîâàòåëüñêèå ñîîáùåíèÿ ñîîáùåíèÿ
lnMsgCount = OCCURS([;],._HandledCustomMsgPromptList)+1
***
FOR lnMsgCounter = 1 TO lnMsgCount
	lnStartPos = IIF(lnMsgCounter = 1, 1, AT([;],._HandledCustomMsgPromptList,lnMsgCounter-1)+1)
	lnEndPos   = IIF(lnMsgCounter = lnMsgCount, LEN(._HandledCustomMsgPromptList), AT([;],._HandledCustomMsgPromptList,lnMsgCounter)-1)
	lcPrompt   = SUBSTR(._HandledCustomMsgPromptList,lnStartPos,lnEndPos-lnStartPos+1)
	***
	lnStartPos = IIF(lnMsgCounter = 1, 1, AT([;],._HandledCustomMsgList,lnMsgCounter-1)+1)
	lnEndPos   = IIF(lnMsgCounter = lnMsgCount, LEN(._HandledCustomMsgList), AT([;],._HandledCustomMsgList,lnMsgCounter)-1)
	lcMsg   = SUBSTR(._HandledCustomMsgList,lnStartPos,lnEndPos-lnStartPos+1)
	***
	IF !EMPTY(lcPrompt)
		IF ISNULL(paCstContextActions)
			lnCurSRef = 1
		ELSE
			lnCurSRef = ALEN(paCstContextActions,1)+1
		ENDIF
		***
		DIMENSION paCstContextActions(lnCurSRef,2)
		***
		paCstContextActions(lnCurSRef,cnCMA_PROMPT) = lcPrompt
		paCstContextActions(lnCurSRef,cnCMA_MSG) = lcMsg
	ENDIF	
	***
ENDFOR
*------------------------------------------------------------------------------

*******************************************************************************
*2. Îïðåäåëÿåì ñïèñîê äîñòóïíûõ ñîîáùåíèé â êàæäîé ãðóïïå	  				  *
*******************************************************************************

*05.04.2004 15:32 -&gt;Îïðåäåëèì ñïèñîê ñîîáùåíèé
lcHandledStandartMsgList = [;]+._GetHandledStandartMsgList()+[;]
lcHandledCustomMsgList = [;]+._GetHandledCustomMsgList()+[;]
*------------------------------------------------------------------------------

*******************************************************************************
*3. Ñòðîèì êîíòåêñòíîå ìåíþ									  				  *
*******************************************************************************
*05.04.2004 15:33 -&gt;Îïðåäåëÿåì ìåíþ
DEFINE POPUP grdshortcut SHORTCUT RELATIVE FROM MROW(),MCOL()
*------------------------------------------------------------------------------
*05.04.2004 15:34 -&gt;Ïðîõîäèìñÿ ïî ìàññèâó ñòàíäàðòíûõ ñîîáùåíèé
lnItemCountAfterSeparator = 0
IF !ISNULL(paStdContextActions)
	FOR lnCurSRef = 1 TO ALEN(paStdContextActions,1)
		IF	paStdContextActions(lnCurSRef,cnCMA_PROMPT) == [\-]
			IF lnItemCountAfterSeparator &gt; 0
				DEFINE BAR lnCurSRef OF grdshortcut PROMPT [\-]
				lnItemCountAfterSeparator = 0
			ENDIF	
		ELSE
			IF ([;]+paStdContextActions(lnCurSRef,cnCMA_MSG)+[;])$lcHandledStandartMsgList
				lcRelativeHierarchy = SYS(1272,This)
				lcRelativeHierarchy = IIF([.]$lcRelativeHierarchy,SUBSTR(lcRelativeHierarchy,AT([.],lcRelativeHierarchy)+1),lcRelativeHierarchy)
				lcActionMacro = [_screen.ActiveForm.]+lcRelativeHierarchy+[.HandleMsg("]+paStdContextActions(lnCurSRef,cnCMA_MSG)+[")]
				***
				DEFINE BAR lnCurSRef OF grdshortcut PROMPT paStdContextActions(lnCurSRef,cnCMA_PROMPT)
				ON SELECTION BAR lnCurSRef OF grdshortcut &amp;lcActionMacro
			ELSE
				DEFINE BAR lnCurSRef OF grdshortcut PROMPT paStdContextActions(lnCurSRef,cnCMA_PROMPT) SKIP FOR .T.
			ENDIF
			***
			lnItemCountAfterSeparator = lnItemCountAfterSeparator + 1
		ENDIF
	ENDFOR
ENDIF	
*------------------------------------------------------------------------------

*14.05.2004 11:48 -&gt;Ñè÷òàåì íàðîùåíèå èíäåêñà äëÿ ñîîáùåíèé ïîëüçîâàòåëüñêîé ãðóïïû
IF !ISNULL(paStdContextActions)
	lnAddBarIndex = ALEN(paStdContextActions,1)
ELSE
	lnAddBarIndex = 0	
ENDIF
*------------------------------------------------------------------------------	

*14.05.2004 11:45 -&gt;Äîáàâëÿåì ðàçäåëèòåëü ì/ä ñòàíäàðòíûìè è ïîëüçîâàòåëüñêèìè
IF lnItemCountAfterSeparator &gt; 0 AND !ISNULL(paCstContextActions)
	DEFINE BAR lnAddBarIndex+1 OF grdshortcut PROMPT [\-]
	lnAddBarIndex = lnAddBarIndex+1
ENDIF
*------------------------------------------------------------------------------

*05.04.2004 15:34 -&gt;Ïðîõîäèìñÿ ïî ìàññèâó ïîëüçîâàòåëüñêèõ ñîîáùåíèé
lnItemCountAfterSeparator = 0
IF !ISNULL(paCstContextActions)
	FOR lnCurSRef = 1 TO ALEN(paCstContextActions,1)
		IF	paCstContextActions(lnCurSRef,cnCMA_PROMPT) == [\-]
			IF lnItemCountAfterSeparator &gt; 0
				DEFINE BAR lnAddBarIndex+lnCurSRef OF grdshortcut PROMPT [\-]
				lnItemCountAfterSeparator = 0
			ENDIF	
		ELSE
			IF ([;]+paCstContextActions(lnCurSRef,cnCMA_MSG)+[;])$lcHandledCustomMsgList
				lcRelativeHierarchy = SYS(1272,This)
				lcRelativeHierarchy = IIF([.]$lcRelativeHierarchy,SUBSTR(lcRelativeHierarchy,AT([.],lcRelativeHierarchy)+1),lcRelativeHierarchy)
				lcActionMacro = [_screen.ActiveForm.]+lcRelativeHierarchy+[.HandleMsg("]+paCstContextActions(lnCurSRef,cnCMA_MSG)+[")]
				***
				DEFINE BAR lnAddBarIndex+lnCurSRef OF grdshortcut PROMPT paCstContextActions(lnCurSRef,cnCMA_PROMPT)
				ON SELECTION BAR lnAddBarIndex+lnCurSRef OF grdshortcut &amp;lcActionMacro
			ELSE
				DEFINE BAR lnAddBarIndex+lnCurSRef OF grdshortcut PROMPT paCstContextActions(lnCurSRef,cnCMA_PROMPT) SKIP FOR .T.
			ENDIF
			***
			lnItemCountAfterSeparator = lnItemCountAfterSeparator + 1
		ENDIF
	ENDFOR
ENDIF	
*------------------------------------------------------------------------------

ENDWITH

*05.04.2004 15:57 -&gt;Àêòèâèðóåì ìåíþ
ACTIVATE POPUP grdshortcut
*------------------------------------------------------------------------------

************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE sort
*------------------------------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.SORT
* Called by.......: &lt;This.Columns(i).Header1.Click();ContextMenu Calling&gt;
* Parameters......: &lt;luParameter&gt;
* Returns.........: &lt;none&gt;
* Notes...........:	&lt;public/nouser/default&gt; Ñîðòèðîâêà Alias-à. Âîçìîæíû òðè âàðèàíòà âûçîâà:
*					1. Êîãäà âîçìîæíî â âûçîâå îïðåäåëèòü òðåáóåìûé ïîðÿäîê ñîðòèðîâêè, íî íåâîçìîæíî
*					îïðåäåëèòü èìÿ îáúåêòà Column, äëÿ êîòîðîãî íåîáõîäèìà ñîðòèðîâêà:
*						1.1. Âûçîâ èç ìåíþ ïóíêòàìè:
*							"ñîðòèðîâàòü ïî âîçðàñòàíèþ",
*							"ñîðòèðîâàòü ïî óáûâàíèþ",
*							"îòìåíèòü ñîðòèðîâêó";
*						1.2. Âûçîâ ãîðÿ÷èìè êëàâèøàìè, íàïðèìåð
*							Ctrl+Alt+DownArrow - ïî âîçðàñòàíèþ,
*							Ctrl+Alt+UpArrow - ïî óáûâàíèþ,
*							Ctrl+Alt+LeftArrow èëè Ctrl+Alt+RightArrow - îòìåíà ñîðòèðîâêè;
*					2. Êîãäà íåâîçìîæíî â âûçîâå îïðåäåëèòü òåáóåìûé ïîðÿäîê ñîðòèðîâêè, íî âîçìîæíî
*					îïðåäåëèòü èìÿ îáúåêòà Column, äëÿ êîòîðîãî íåîáõîäèìà ñîðòèðîâêà:
*						2.1. Âûçîâ èç Grd.Columns(i).Header1.Click() èëè Grd.Columns(i).Header1.DblClick().
*					3. Êîãäà íåâîçìîæíî îïðåäåëèòü íå òî è íå äðóãîå
*						1.1. Âûçîâ èç ìåíþ ïóíêòàìè	"ñîðòèðîâàòü";
*						1.2. Âûçîâ ãîðÿ÷èìè êëàâèøàìè (íàïðèìåð Ctrl+Alt+S - ñîðòèðîâàòü).
*					*------------------------------------------------------------------------------
*					1. Äëÿ ïåðâîãî âàðèàíòà âûçîâà ïåðåäàåòñÿ ïàðàìåòð òèïà NUMERIC, ñîäåðæàùèé êîíñòàíòû
*					(0-îòìåíà ñîðòèðîâêè, 1-ñîðòèðîâêà ïî âîçðàñòàíèþ, 2-ñîðòèðîâêà ïî óáûâàíèþ), èìÿ ïîëÿ
*					ïî êîòîðîìó ïðîèçâîäèòñÿ ñîðòèðîâêà, îïðåäåëÿåòñÿ ïî ControlSource àêòèâíîé êîëîíêè.
*					2. Äëÿ âòîðîãî âàðèàíòà âûçîâà ïðåäàåòñÿ  ïàðàìåòð òèïà CHARACTER, ñîäåðæàùèé èìÿ îáúåêòà
*					Column,	äëÿ êîòîðîãî íåîáõîäèìà ñîðòèðîâêà, òèï ñîðòèðîâêè îïðåäåëÿåòñÿ ïî òèïó ïðåäûäóùåé
*					ñîðòèðîâêè ïî äàííîé êîëîíêå (íåò=&gt;ïî âîçðàñòàíèþ=&gt;ïî óáûâàíèþ=&gt;íåò).
*					3. Äëÿ òðåòüåãî âàðèàíòà íè÷åãî íå ïåðåäàåòñÿ, èìÿ ïîëÿ	ïî êîòîðîìó ïðîèçâîäèòñÿ ñîðòèðîâêà,
*					îïðåäåëÿåòñÿ ïî ControlSource àêòèâíîé êîëîíêè, òèï ñîðòèðîâêè îïðåäåëÿåòñÿ ïî òèïó ïðåäûäóùåé
*					ñîðòèðîâêè ïî äàííîé êîëîíêå (íåò=&gt;ïî âîçðàñòàíèþ=&gt;ïî óáûâàíèþ=&gt;íåò).
*					*------------------------------------------------------------------------------
*------------------------------------------------------------------------------
LPARAMETERS	luParameter

*08.10.2003 15:10 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcOldAlias, ;
		lnOldRecNo, ;
		lnLocalCounter, ;
		lcSortColumnName, ;
		lcSortFieldName, ;
		lcSortTag, ;
		lnSortType, ;
		loColumn, ;
		loControl, ;
		lcTagList, ;
		lcSortFldExp, ;
		lcIndexExp, ;
		lcOrderExp
lcOldAlias = ALIAS()		
*------------------------------------------------------------------------------

WITH This

*10.12.2003 18:45 -&gt;Ëþáûå äåéñòâèÿ ïðîèçâîäèì, òîëüêî åñëè RecordSource óêàçàí è äîñòóïåí
IF !INLIST(.eRsState,__RS_NOT_DEFINED,__RS_NOT_USED)
	
	*09.10.2003 18:28 -&gt;Ïåðåéäåì â Alias, óêàçàííûé â RecordSource
	SELECT (.RecordSource)
	lnOldRecNo = RECNO()
	*------------------------------------------------------------------------------

	*08.10.2003 15:04 -&gt;Îïðåäåëÿåì èìÿ ïîëÿ ïî êîòîðîìó ìû ñîáèðàåìñÿ ñîðòèðîâàòü è íàçâàíèå òýãà
	IF TYPE([luParameter])==[C]
		lcSortColumnName = ALLTRIM(luParameter)
		lcSortFieldName = ALLTRIM(EVAL([.]+lcSortColumnName+[.]+[ControlSource]))
	ELSE
		lcSortColumnName = ALLTRIM(.Columns[.ActiveColumn].Name)
		lcSortFieldName = ALLTRIM(.Columns[.ActiveColumn].ControlSource)
	ENDIF
	lcSortFieldName = IIF([.]$lcSortFieldName,SUBSTR(lcSortFieldName,RAT([.],lcSortFieldName)+1),lcSortFieldName)
	lcSortTag = LEFT(UPPER(lcSortFieldName),10)
	*------------------------------------------------------------------------------

	*08.10.2003 15:12 -&gt;Îïðåäåëÿåì òðåáóåìûé ïîðÿäîê ñîðòèðîâêè
	IF TYPE([luParameter])==[N]
		lnSortType = luParameter
	ELSE
		IF .cSortedColumn == lcSortColumnName
			lnSortType = IIF(.nSortedType=2,0,.nSortedType+1)
		ELSE
			lnSortType = 1	
		ENDIF	
	ENDIF
	*------------------------------------------------------------------------------

	*09.10.2003 13:49 -&gt;Åñëè íåîáõîäèìà ïðîñòî îòìåíà ñîðòèðîâêè ñäåëàåì å¸ çäåñü è âûéäåì èç ìåòîäà
	IF lnSortType = 0 AND !EMPTY(.cSortedColumn)

		*09.10.2003 18:33 -&gt;Îòìåíèì ñîðòèðîâêó
		SET ORDER TO
		*------------------------------------------------------------------------------
				
		*09.10.2003 14:37 -&gt;Âûêëþ÷èì ïîäñâåòêó çàãîëîâêà
		loColumn = EVAL([.]+.cSortedColumn)
		loColumn.SetAll([PICTURE],.nSortedHeaderOldColor,[HEADER])
**		loColumn.SetAll([BACKCOLOR],.nSortedHeaderOldColor,[HEADER])
		*------------------------------------------------------------------------------

		*09.10.2003 18:21 -&gt;Ñáðîñèì ïàðàìåòðû ñîðòèðîâêè
		.cSortedColumn = []
		.nSortedType = 0
		*-----------------------------------------------------------------------------
		
		*29.04.2004 05:23 -&gt;Îáíîâèì Grid
		.Refresh()
		*------------------------------------------------------------------------------
		
		*09.10.2003 18:32 -&gt;Âîññòàíîâèì òåêóùèé Alias
		IF !EMPTY(lcOldAlias) AND USED(lcOldAlias) AND lcOldAlias#ALIAS()
			SELECT(lcOldAlias)
		ENDIF
		*------------------------------------------------------------------------------

		*09.10.2003 18:33 -&gt;Âûéäåì èç ìåòîäà
		RETURN .T.
		*------------------------------------------------------------------------------
		
	ENDIF
	*------------------------------------------------------------------------------

	*08.10.2003 15:20 -&gt;Òåïåðü ïðîâåðèì îòëè÷àåòñÿ ëè çàòðåáîâàíûé ïîðÿäîê ñîðòèðîâêè îò òîãî, ÷òî ìû óæå èìååì
	IF .cSortedColumn == lcSortColumnName AND .nSortedType=lnSortType

		*09.10.2003 18:32 -&gt;Âîññòàíîâèì òåêóùèé Alias
		IF !EMPTY(lcOldAlias) AND USED(lcOldAlias) AND lcOldAlias#ALIAS()
			SELECT(lcOldAlias)
		ENDIF
		*------------------------------------------------------------------------------

		*09.10.2003 18:33 -&gt;Âûéäåì èç ìåòîäà
		RETURN .T.
		*------------------------------------------------------------------------------
		
	ENDIF
	*------------------------------------------------------------------------------

	*09.10.2003 14:50 -&gt;Îòêëþ÷àåì ñòàðóþ ñîðòèðîâêó
	IF !EMPTY(.cSortedColumn)

		*09.10.2003 18:33 -&gt;Îòìåíèì ñîðòèðîâêó
		SET ORDER TO
		*------------------------------------------------------------------------------
			
		*09.10.2003 14:37 -&gt;Âûêëþ÷èì ïîäñâåòêó çàãîëîâêà
		loColumn = EVAL([.]+.cSortedColumn)
		loColumn.SetAll([PICTURE],.nSortedHeaderOldColor,[HEADER])
**		loColumn.SetAll([BACKCOLOR],.nSortedHeaderOldColor,[HEADER])
		*------------------------------------------------------------------------------
		
	ENDIF
	*------------------------------------------------------------------------------

	*08.10.2003 15:24 -&gt;Ïðîâåðÿåì íàëè÷èå èíäåêñíîãî ôàéëà, íàëè÷èå â íåì íåîáõîäèìîãî òýãà, åñëè íóæíî èíäåêñèðóåì
	IF !EMPTY(.cSortedCDXFile)
		
		*08.10.2003 15:28 -&gt;Ñîñòàâëÿåì ñïèñîê òýãîâ, ñóùåñòâóþùèõ â äàííîì ôàéëå
		lnLocalCounter = 1
		lcTagList = []
		***
		DO WHILE !EMPTY(TAG(.cSortedCDXFile,lnLocalCounter))
			lcTagList = lcTagList+[;]+TAG(.cSortedCDXFile,lnLocalCounter)+[;]
			lnLocalCounter = lnLocalCounter+1
		ENDDO
		*------------------------------------------------------------------------------
		
		*08.10.2003 15:32 -&gt;Åñëè Tag-à íåò ôîðìèðóåì
		IF !(([;]+lcSortTag+[;])$lcTagList)
			
			*22.12.2004 14:42 -&gt;Ôîðìèðóåì èíäåêñíîå âûðàæåíèå
			DO CASE
				CASE TYPE(lcSortFieldName)==[C]
					lcSortFldExp = [LEFT(]+lcSortFieldName+[,115)]
				CASE TYPE(lcSortFieldName)==[D]
					lcSortFldExp = [DTOC(]+lcSortFieldName+[,1)]
				CASE TYPE(lcSortFieldName)==[T]
					lcSortFldExp = [TTOC(]+lcSortFieldName+[,1)]
				OTHERWISE
					lcSortFldExp = lcSortFieldName
			ENDCASE
			*------------------------------------------------------------------------------
			
			*09.10.2003 15:04 -&gt;Èíäåêñèðóåì
			lcIndexExp = [INDEX ON ]+lcSortFldExp+[ TAG ]+lcSortTag+[ OF tmp\]+.cSortedCDXFile+[ COMPACT]
			&amp;lcIndexExp
			*------------------------------------------------------------------------------
			
		ENDIF	
		*------------------------------------------------------------------------------
		
	ELSE
	
		*09.10.2003 15:03 -&gt;Ôîðìèðóåì íàçâàíèå èíäåêñíîãî ôàéëà
		.cSortedCDXFile = SUBSTR(SYS(2015),3,10) + [.CDX]
		*------------------------------------------------------------------------------
		
		*22.12.2004 14:42 -&gt;Ôîðìèðóåì èíäåêñíîå âûðàæåíèå
		DO CASE
			CASE TYPE(lcSortFieldName)==[C]
				lcSortFldExp = [LEFT(]+lcSortFieldName+[,115)]
			CASE TYPE(lcSortFieldName)==[D]
				lcSortFldExp = [DTOC(]+lcSortFieldName+[,1)]
			CASE TYPE(lcSortFieldName)==[T]
				lcSortFldExp = [TTOC(]+lcSortFieldName+[,1)]
			OTHERWISE
				lcSortFldExp = lcSortFieldName
		ENDCASE
		*------------------------------------------------------------------------------
		
		*09.10.2003 15:04 -&gt;Èíäåêñèðóåì
		lcIndexExp = [INDEX ON ]+lcSortFldExp+[ TAG ]+lcSortTag+[ OF tmp\]+.cSortedCDXFile+[ COMPACT]
		&amp;lcIndexExp
		*------------------------------------------------------------------------------
		
	ENDIF
	*------------------------------------------------------------------------------

	*09.10.2003 15:58 -&gt;Óñòàíàâëèâàåì ïîðÿäîê ñîðòèðîâêè
	lcOrderExp = [SET ORDER TO TAG ]+lcSortTag+[ OF ]+.cSortedCDXFile+IIF(lnSortType=2,[ DESCENDING],[ ASCENDING])
	&amp;lcOrderExp
	*------------------------------------------------------------------------------

	*09.10.2003 16:10 -&gt;Ïðî÷èòàåì è ñîõðàíèì ñòàðûé öâåò çàãîëîâêà êîëîíêè, è óñòàíîâèì íîâûé
	loColumn = EVAL([.]+lcSortColumnName)
	FOR EACH loControl IN loColumn.Controls
		IF UPPER(ALLTRIM(loControl.BaseClass))==[HEADER]
			.nSortedHeaderOldColor = loControl.Picture
	**		.nSortedHeaderOldColor = loControl.BackColor
			loControl.Picture = EVAL(IIF(lnSortType=2,._SortedHeaderColorDesc,._SortedHeaderColorAsc))
	**		loControl.BackColor = EVAL(IIF(lnSortType=2,._SortedHeaderColorDesc,._SortedHeaderColorAsc))
	**._SortedHeaderColorDesc = RGB(192,128,128)
	**._SortedHeaderColorAsc = RGB(128,128,192)
		ENDIF
	ENDFOR
	*------------------------------------------------------------------------------

	*09.10.2003 18:21 -&gt;Ñîõðàíèì ïàðàìåòðû ñîðòèðîâêè
	.cSortedColumn = lcSortColumnName
	.nSortedType = lnSortType
	*------------------------------------------------------------------------------

	*29.04.2004 05:25 -&gt;Îáíîâèì Grid
	.Refresh()
	*------------------------------------------------------------------------------
	
ENDIF
*------------------------------------------------------------------------------

ENDWITH

*09.10.2003 21:55 -&gt;Âîññòàíîâèì òåêóùèé Alias
IF !EMPTY(lcOldAlias) AND USED(lcOldAlias) AND lcOldAlias#ALIAS()
	SELECT(lcOldAlias)
ENDIF
*------------------------------------------------------------------------------

*******************************************************************************
********************************* END METHOD **********************************
*******************************************************************************
ENDPROC
PROCEDURE sortclear
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.SORTCLEAR
* Called by.......: &lt;This.Destroy(); External Calls&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Îòìåíà ñîðòèðîâêè, î÷èñòêà âñåõ âðåìåííûõ ôàéëîâ ñ èíäåêñàìè.
*-------------------------------------------------------

*28.10.2003 11:15 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	loColumn, ;
		lcOldAlias
***
lcOldAlias = ALIAS()		
*------------------------------------------------------------------------------
IF SELECT(.RecordSource)&lt;1
	RETURN
ENDIF
WITH This

*10.12.2003 18:45 -&gt;Ëþáûå äåéñòâèÿ ïðîèçâîäèì, òîëüêî åñëè RecordSource óêàçàí è äîñòóïåí
IF !INLIST(.eRsState,__RS_NOT_DEFINED,__RS_NOT_USED)

	*28.10.2003 11:23 -&gt;Åñëè äàííûå îòñòîðòèðîâàíû îòìåíèì ñîðòèðîâêó
	IF !EMPTY(.cSortedColumn)
	
		*28.10.2003 11:23 -&gt;Îòìåíèì ñîðòèðîâêó
		SET ORDER TO 0 IN (.RecordSource)
		*------------------------------------------------------------------------------

		*09.10.2003 14:37 -&gt;Âûêëþ÷èì ïîäñâåòêó çàãîëîâêà
		loColumn = EVAL([.]+.cSortedColumn)
		loColumn.SetAll([PICTURE],.nSortedHeaderOldColor,[HEADER])
**		loColumn.SetAll([BACKCOLOR],.nSortedHeaderOldColor,[HEADER])
		*------------------------------------------------------------------------------

*!*			*09.10.2003 18:21 -&gt;Ñáðîñèì ïàðàìåòðû ñîðòèðîâêè
*!*			.cSortedColumn = []
*!*			.nSortedType = 0
*!*			*-----------------------------------------------------------------------------
		
	ENDIF
	*------------------------------------------------------------------------------
	
	*28.10.2003 11:32 -&gt;Óäàëèì âðåìåííûé ôàéë
	IF !EMPTY(.cSortedCDXFile)
	
		*28.10.2003 12:25 -&gt;Çàêðûâàåì è óäàëÿåì CDX ôàéë, ñáðàñûâàåì ñâîéñòâî
		SELECT (.RecordSource)
		CLOSE INDEXES
		ERASE ([tmp\]+.cSortedCDXFile)
		.cSortedCDXFile = []
		*------------------------------------------------------------------------------
		
	ENDIF
	*------------------------------------------------------------------------------
	
	*11.05.2004 22:09 -&gt;Âîññòàíîâèì òåêóùèé Alias
	IF !EMPTY(lcOldAlias) AND USED(lcOldAlias) AND lcOldAlias#ALIAS()
		SELECT(lcOldAlias)
	ENDIF
	*------------------------------------------------------------------------------
	
ENDIF
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE sourcekeep
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.SOURCEKEEP
* Called by.......: &lt;Miscelanous Calls&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Ñîõðàíåíèå â ìàññèâå .aSources èíôîðìàöèè î
*					.ControlSource âñåõ êîëîíîê è .RecordSource ñàìîãî Grid-à.
*-------------------------------------------------------
WITH This

*08.12.2003 15:53 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnColumnCount, ;
		lnColumnCounter
lnColumnCount = .ColumnCount
*------------------------------------------------------------------------------

*08.12.2003 15:53 -&gt;Ñîõðàíÿåì èíôîðìàöèþ î ControlSource âñåõ êîëîíîê
DIMENSION .aSources(lnColumnCount+1)
***
FOR lnColumnCounter=1 TO lnColumnCount
	.aSources(lnColumnCounter)=.Columns(lnColumnCounter).ControlSource
ENDFOR
*------------------------------------------------------------------------------

*08.12.2003 15:53 -&gt;Ñîõðàíÿåì èíôîðìàöèþ î RecordSource Grid-à
.aSources(lnColumnCount+1)=.RecordSource
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE sourcerecall
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.SOURCERECALL
* Called by.......: &lt;Miscelanous Calls&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Âîññòàíîâëåíèå .ControlSource
*					âñåõ êîëîíîê è .RecordSource ñàìîãî Grid-à íà îñíîâàíèè èíôîðìàöèè,
*					ñîõðàíåííîé ìåòîäîì .SourceKeep() â ìàññèâå .aSources.
*-------------------------------------------------------
WITH This

*08.12.2003 15:55 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnColumnCount, ;
		lnColumnCounter
lnColumnCount = .ColumnCount
*------------------------------------------------------------------------------

*08.12.2003 15:55 -&gt;Ïðîâåðèì ìîæíî ëè âîññòàíàâëèâàòü
IF ALEN(.aSources)#lnColumnCount+1
	ASSERT .F. MESSAGE [Íåò èíôîðìàöèè äëÿ âîññòàíîâëåíèÿ èñòî÷íèêîâ äàííûõ äëÿ Grid-à, ëèáî êîíôèãóðàöèÿ Grid-à èçìåíèëàñü. Ïðîâåðüòå âûçîâ KeepSources ïåðåä âûçîâîì RecallSources.]
	RETURN
ENDIF	
***
IF !USED(.aSources(lnColumnCount+1))
	ASSERT .F. MESSAGE [Îáëàñòü äàííûõ, êîòîðàÿ äîëæíà áûòü îòîáðàæåíà â Grid-å íå íàéäåíà.]
	RETURN
ENDIF	
*------------------------------------------------------------------------------

*08.12.2003 15:55 -&gt;Âîññòàíàâëèâàåì èíôîðìàöèþ î RecordSource Grid-à
.RecordSource = .aSources(lnColumnCount+1)
*------------------------------------------------------------------------------

*08.12.2003 15:55 -&gt;Âîññòàíàâëèâàåì èíôîðìàöèþ î ControlSource âñåõ êîëîíîê
FOR lnColumnCounter = 1 TO lnColumnCount
	.Columns(lnColumnCounter).ControlSource = .aSources(lnColumnCounter)
ENDFOR
*------------------------------------------------------------------------------

*28.04.2004 00:21 -&gt;Âîññòàíàâëèâàåì äåéñòâèå âíåøíåãî ôèëüòðà
.FilterExternalEnable()
*------------------------------------------------------------------------------

*08.12.2003 17:41 -&gt;Îáíîâèì Grid
.Refresh(.T.)
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE sourcereset
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.SOURCERESET
* Called by.......: &lt;Miscelanous Calls&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Ñáðîñ .ControlSource âñåõ êîëîíîê è
*					.RecordSource ñàìîãî Grid-à.
*-------------------------------------------------------
WITH This

*08.12.2003 15:56 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lnColumnCount, ;
		lnColumnCounter
lnColumnCount = .ColumnCount
*------------------------------------------------------------------------------

*23.04.2004 14:01 -&gt;Ñáðàñûâàåì òåêóùèå èíòåðàêòèâíûå ôèëüòðû/ïîèñêè
.InteractiveSearchReset(cnRESET_ALLCOLUMNS)
*------------------------------------------------------------------------------

*28.04.2004 00:10 -&gt;Ïðèîñòàíàâëèâàåì äåéñòâèå âíåøíåãî ôèëüòðà.
.FilterExternalDisable()
*------------------------------------------------------------------------------

*!*	*28.04.2004 00:10 -&gt;Îòìåíÿåì ñîðòèðîâêó è óäàëÿåì âðåìåííûå èíäåêñíûå ôàéëû.
*!*	.SortClear() &amp;&amp; Çàêîììåíòàðèë äàííûé êîä ââèäó òîãî, ÷òî ñëåòàåò ñîðòèðîâêà ïîñëå ðåäàêòèðîâàíèÿ
*!*	*------------------------------------------------------------------------------

*08.12.2003 15:56 -&gt;Îòöåïëÿåì ControlSource âñåõ êîëîíîê
FOR lnColumnCounter = 1 TO lnColumnCount
	.Columns(lnColumnCounter).ControlSource = []
ENDFOR
*------------------------------------------------------------------------------

*08.12.2003 15:56 -&gt;Îòöåïëÿåì RecordSource Grid-à
.RecordSource = []
*------------------------------------------------------------------------------

*08.12.2003 17:41 -&gt;Îáíîâèì Grid
*.Refresh()
*------------------------------------------------------------------------------
*29.04.2008 10:00 îòêëþ÷àåì ïåðåðèñîâêó èç-çà áîëüøèõ âðåìåííûõ çàòðàò
ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE Valid
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.VALID
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;sysevent&gt; Ñáðîñ ôëàãà àêòèâíîñòè Grid-à.
*					Ñáðîñ èíòåðàêòèâíîãî ïîèñêà äëÿ âñåõ êîëîíîê.
*					Ñáðîñ íàçíà÷åíèé ãîðÿ÷èõ êëàâèø äëÿ Grid-à.
*					Âîññòàíîâëåíèå êóðñîðà.
*					Âûïîëíåíèå ìåòîäà îáíîâëåíèÿ ðåãèñòðàöèè îáúåêòà êàê îáðàáîò÷èêà ñîîáùåíèé.
*-------------------------------------------------------
WITH This

IF .lGridActive

	*29.04.2004 03:24 -&gt;Ñáðàñûâàåì ôëàã àêòèâíîñòè Grid-à.
	.lGridActive = .F.
	*------------------------------------------------------------------------------

	*29.04.2004 03:24 -&gt;Ñáðàñûâàåì èíòåðàêòèâíûé ïîèñê äëÿ âñåõ êîëîíîê.
	.InteractiveSearchReset(cnRESET_LOCATE)
	*------------------------------------------------------------------------------

	*29.04.2004 03:26 -&gt;Ñáðàñûâàåì íàçíà÷åíèå ãîðÿ÷èõ êëàâèø äëÿ Grid-à.
	.RefreshHandledHotKey()
	*------------------------------------------------------------------------------

	*29.04.2004 03:35 -&gt;Âîññòàíîâèì êóðñîð
	.RefreshCursorSet()
	*------------------------------------------------------------------------------

	*29.04.2004 03:38 -&gt;Âûïîëíèì ìåòîä îáíîâëåíèÿ ðåãèñòðàöèè îáúåêòà êàê îáðàáîò÷èêà ñîîáùåíèé.
	.RefreshHandledStandartMsgList()
	.RefreshHandledCustomMsgList()
	*------------------------------------------------------------------------------		
	.AllowCellSelection =.f.	
ENDIF

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
*-*COMMENT:	Ìåòîä îáíîâëåíèÿ ðåãèñòðàöèè îáúåêòà êàê îáðàáîò÷èêà ñîîáùåíèé ïðè ïîòåðå
*-*			Grid-îì ôîêóñà âûçûâàåòñÿ äëÿ óäàëåíèÿ ðåãèñòðàöèè îáúåêòà êàê îáðàáîòèêà
*-*			âñåõ ñîîáùåíèé, îáðàáîò÷èêîì êîòîðûõ îáúåêò ìîã áûòü çàðåãèñòðèðîâàí.
ENDPROC
PROCEDURE When
*-------------------------------------------------------
* Project.........: BASIS.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: GRD.WHEN
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;sysevent&gt; Óñòàíîâêà ôëàãà àêòèâíîñòè Grid-à.
*					Âûïîëíåíèå ìåòîäà àêòóàëèçàöèè RunTime ñâîéñò Grid-à.
*					Íàçíà÷åíèå ãîðÿ÷èõ êëàâèø äëÿ Grid-à.
*					Îòêëþ÷åíèå êóðñîðà.
*					Âûïîëíåíèå ìåòîäà îáíîâëåíèÿ ðåãèñòðàöèè îáúåêòà êàê îáðàáîò÷èêà ñîîáùåíèé.
*-------------------------------------------------------
WITH This

IF !.lGridActive

	*29.04.2004 03:34 -&gt;Óñòàíîâèì ôëàã àêòèâíîñòè Grid-à
	.lGridActive = .T.
	*------------------------------------------------------------------------------

	*29.04.2004 03:36 -&gt;Âûïîëíèì ìåòîä àêòóàëèçàöèè RunTime ñâîéñò Grid-à.
	.RefreshRunTimeProps()
	*------------------------------------------------------------------------------

	*29.04.2004 03:35 -&gt;Íàçíà÷èì ãîðÿ÷èå êëàâèøè äëÿ Grid-à.
	.RefreshHandledHotKey()
	*------------------------------------------------------------------------------

	*29.04.2004 03:35 -&gt;Îòêëþ÷èì êóðñîð
	.RefreshCursorSet()
	*------------------------------------------------------------------------------
		
	*29.04.2004 03:38 -&gt;Âûïîëíèì ìåòîä îáíîâëåíèÿ ðåãèñòðàöèè îáúåêòà êàê îáðàáîò÷èêà ñîîáùåíèé.
	.RefreshHandledStandartMsgList()
	.RefreshHandledCustomMsgList()
	*------------------------------------------------------------------------------		
	.AllowCellSelection =.t.	

ENDIF

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
*-*COMMENT:	Íåñìîòðÿ íà òî, ÷òî ìåòîä îáíîâëåíèÿ ðåãèñòðàöèè îáúåêòà êàê îáðàáîò÷èêà
*-*			ñîîáùåíèé âûçûâàåòñÿ ïðè èçìåíåíèè RunTime ñâîéñòâ Grid-à, â äàííîì
*-*			ñîáûòèè ìû ïðèíóäèòåëüíî âûçûâàåì äàííûé ìåòîä, ò.ê. ìåæäó ïîòåðåé ôîêóñà
*-*			Grid-îì (âûïîëíåíèåì ñîáûòèÿ .Valid()) è ïîëó÷åíèåì ôîêóñà (âûïîëíåíèåì
*-*			ñîáûòèÿ When()) RunTime ñâ-âà ìîãóò íå èçìåíèòüñÿ, à ïðè ïîòåðå ôîêóñà,
*-*			Grid óäàëÿåò ðåãèñòðàöèþ ñåáÿ êàê îáðàáîò÷èêà ñîîáùåíèé.

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3>lgridactive &lt;public/runtime&gt; Ôëàã àêòèâíîñòè Grid-à.
ersstate &lt;public/runtime&gt; Ñîñòîÿíèå èñòî÷íèêà äàííûõ, óêàçàííîãî â ñâîéñòâå .RecordSource. Ìîæåò ïðèíèìàòü çíà÷åíèå èç ñïèñêà êîíñòàíò îáúÿâëåííûõ â RSStates.h.
nrsrecno &lt;public/runtime&gt; Íîìåð òåêóùåé çàïèñè â Alias-å, óêàçàííîì â ñâîéñòâå .RecordSource.
_handledstandartmsglist &lt;public/design&gt; Ñïèñîê ñòàíäàðòíûõ ñîîáùåíèé (÷åðåç ;)  êîòîðûå ìîæåò îáðàáàòûâàòü äàííûé îáúåêò.
_handledcustommsglist &lt;public/design&gt; Ñïèñîê ïîëüçîâàòåëüñêèõ ñîîáùåíèé (÷åðåç ;)  êîòîðûå ìîæåò îáðàáàòûâàòü äàííûé îáúåêò.
_refreshhandledcustommsglistonrsrecnochange &lt;public/design&gt; Ôëàã îáíîâëÿòü/íå îáíîâëÿòü ñïèñîê îáðàáàòûâàåìûõ ïîëüçîâàòåëüñêèõ ñîîáùåíèé ïðè ïåðåõîäå íà äðóãóþ ñòðîêó (èçìåíåíèè ñâîéñòâà .nRSRecNo).
_refreshhandledstandartmsglistonrsrecnochange &lt;public/design&gt; Ôëàã îáíîâëÿòü/íå îáíîâëÿòü ñïèñîê îáðàáàòûâàåìûõ ñòàíäàðòíûõ ñîîáùåíèé ïðè ïåðåõîäå íà äðóãóþ ñòðîêó (èçìåíåíèè ñâîéñòâà .nRSRecNo).
_refreshhandledstandartmsglistonrsstatechange &lt;public/design&gt; Ôëàã îáíîâëÿòü/íå îáíîâëÿòü ñïèñîê îáðàáàòûâàåìûõ ñòàíäàðòíûõ ñîîáùåíèé ïðè èçìåíåíèè ñîñòîÿíèÿ èñòî÷íèêà äàííûõ (ñâîéñòâà .eRSState).
_refreshhandledcustommsglistonrsstatechange &lt;public/design&gt; Ôëàã îáíîâëÿòü/íå îáíîâëÿòü ñïèñîê îáðàáàòûâàåìûõ ïîëüçîâàòåëüñêèõ ñîîáùåíèé ïðè èçìåíåíèè ñîñòîÿíèÿ èñòî÷íèêà äàííûõ (ñâîéñòâà .eRSState).
_positionkeyslist &lt;public/design&gt; Ñïèñîê ïîëåé (÷åðåç ;) ïî êîòîðûì óíèêàëüíî îïðåäåëÿåòñÿ çàïèñü ïðè ïîèñêå ïîñëå ïåðå÷èòûâàíèè RecordSource Grid-à.
csortedcdxfile &lt;protected/runtime&gt; Èìÿ âðåìåííîãî CDX ôàéëà, èñïîëüçóåìîãî ïðè ñîðòèðîâêå Alias-à.
csortedcolumn &lt;protected/runtime&gt; Èìÿ îáúåêòà Column, ïî êîòîðîìó îòñîðòèðîâàí Alias.
nsortedheaderoldcolor &lt;protected/runtime&gt; Ñòàðûé öâåò Header-à êîëîíêè, ïî êîòîðîé îòñîðòèðîâàí Alias.
nsortedtype &lt;protected/runtime&gt; Òèï òåêóùåé ñîðòèðîâêè êîëîíêè, óêàçàííîé â cSortedColumn.
_sortedheadercolorasc &lt;public/design&gt; Öâåò ïîäñâåòêè Header-à, ïðè ñîðòèðîâêå ïî âîçðàñòàíèþ.
_sortedheadercolordesc &lt;public/design&gt; Öâåò ïîäñâåòêè Header-à, ïðè ñîðòèðîâêå ïî óáûâàíèþ.
_allowresize &lt;public/design&gt; Ôëàã ðàçðåøåíèÿ/çàïðåùåíèÿ èçìåíåíèÿ ðàçìåðà ýëåìåíòà óïðàâëåíèÿ ïðè èçìåíåíèè ðàçìåðà ôîðìû.
resizekf &lt;public/runtime&gt; Êîýôôèöèåíò èçìåíåíèÿ ðàçìåðà êîëîíîê. Äëÿ èñïîëüçîâàíèÿ îáúåêòîì .cstResizable().
_refreshrelatedobjectsonrsrecnochange &lt;public/design&gt; Ôëàã âûïîëíÿòü/íå âûïîëíÿòü ïîëüçîâàòåëüñêèé ìåòîä ïî îáíîâëåíèþ îáúåêòîâ ñâÿçàííûõ ïî äàííûì ïðè ïåðåõîäå íà äðóãóþ ñòðîêó (èçìåíåíèè ñâîéñòâà .nRSRecNo).
_dynamicimagecolumnindex
_dynamicimagealias
_dynamicimagefieldnamefilename
_dynamicimagefieldnameindex
_handledstandartmsgpromptlist
_handledcustommsgpromptlist
_interactivesearchdefaultmode &lt;public/design&gt; Ðåæèì èíòåðàêòèâíîãî ïîèñêà â Grid-å ïî óìîë÷àíèþ.
_interactivesearchallowlocate &lt;public/design&gt; Ôëàã ðàçðåøàþùèé èñïîëüçîâàòü â ñèìâîëüíûõ ïîëÿõ èñòî÷íèêà äàííûõ èíòåðàêòèâíûé ïîèñê.
_interactivesearchallowfilter &lt;public/design&gt; Ôëàã,ðàçðåøàþùèé èñïîëüçîâàòü â ñèìâîëüíûõ ïîëÿõ èñòî÷íèêà äàííûõ èíòåðàêòèâíóþ ôèëüòðàöèþ.
lnoextendedrefresh &lt;public/runtime&gt; Ôëàã çàïðåùàþùèé ïîëíîå îáíîâëåíèå. Åñëè ôëàã âûñòàâëåí, îáíîâëÿþòñÿ .eRSState, .nRSRecNo; íå îáíîâëÿåòñÿ ðåãèñòðàöèÿ îáúåêòà êàê îáðàáîò÷èêà ñîîáùåíèé, íå âûïîëíÿåòñÿ ïîëüçîâàòåëüñêèé ìåòîä ._RefreshRelatedObjects(). 
lhotkeyset &lt;public/runtime&gt; Ôëàã ÷òî ãëîáàëüíûå (ON KEY) ãîðÿ÷èå êëàâèøè óñòàíîâëåíû.
_activerowhighlight &lt;public/design&gt; Ôëàã ðàçðåøåíèÿ/çàïðåùåíèÿ ïîäñâåòêè òåêóùåé ñòðîêè öâåòîì.
_activerowhighlightcoloractive &lt;public/design&gt; Öâåò äëÿ ïîäñâåòêè òåêóùåé ñòðîêè ïðè àêòèâíîì Grid-å. Ôîðìàò: ñèìâîëüíîå âûðàæåíèå, äàþùåå ïðè EVAL() ÷èñëåííîå âûðàæåíèå öâåòà â äèàïàçîíå îò 0 äî 16777215. Ïî óìîë÷àíèþ RGB(0,0,128).
_activerowhighlightcolorunactive &lt;public/design&gt; Öâåò äëÿ ïîäñâåòêè òåêóùåé ñòðîêè ïðè íå àêòèâíîì Grid-å. Ôîðìàò: ñèìâîëüíîå âûðàæåíèå, äàþùåå ïðè EVAL() ÷èñëåííîå âûðàæåíèå öâåòà â äèàïàçîíå îò 0 äî 16777215. Ïî óìîë÷àíèþ RGB(128,0,0).
ccursorsetold &lt;protected/runtime&gt; Èñõîäíàÿ óñòàíîâêà SET CURSOR.
lcursorset &lt;protected/runtime&gt; Ôëàã, ÷òî óñòàíîâêà SET CURSOR áûëà èçìåíåíà.
_activerowhighlightexcludecolumnlist &lt;public/user/design&gt; Ñïèñîê íîìåðîâ êîëîíîê, êîòîðûå íå äîëæíû ïîäñâå÷èâàòüñÿ ïðè ïîäñâåòêå òåêóùåé ñòðîêè.
_allowsaveandrestorelayout &lt;public/design&gt; Ôëàã ðàçðåøàþùèé/çàïðåùàþùèé ñîõðàíåíèå/âîññòàíîâëåíèå ïàðàìåòðîâ îòîáðàæåíèÿ Grid-à
cexceltablecaption çàãîëîâîê òàáëèöû Excel
_columndisalist Ñïèñîê êîëîíîê, êòîðûå íàäî ñêðûòü
chandledstandartmsglist ñïèñîê ñòàíäàðòûõ ñîîáùåíèé, îïðåäåëÿåòñÿ âî âðåìÿ ïåðâîãî çàïóñêà ôîðìû
chandledcustommsglist ñïèñîê ïîëüçîâàòåëüñêèõ ñîîáùåíèé, ôîðìèðóåòñÿ ïðè ïåðâîì çàïóñêå ôîðìû
*refreshrsstate &lt;protected/nouser/default&gt; Îáíîâëåíèå çíà÷åíèÿ ñâîéñòâà .eRSState.
*refreshruntimeprops &lt;protected/nouser/default&gt; Îáíîâëåíèå RunTime ñâîéñòâ Grid-à (.eRSState, .nRSRecNo).
*refreshhandledstandartmsglist &lt;protected/nouser/default&gt; Îáíîâëåíèå ðåãèñòðàöèè îáúåêòà êàê îáðàáîò÷èêà ñïèñêà ñòàíäàðòíûõ ñîîáùåíèé, êîòîðûå ìîãóò áûòü îáðàáîòàíû â äàííîì êîíòåêñòå.
*refreshhandledcustommsglist &lt;protected/nouser/default&gt; Îáíîâëåíèå ðåãèñòðàöèè îáúåêòà êàê îáðàáîò÷èêà ñïèñêà ïîëüçîâàòåëüñêèõ ñîîáùåíèé, êîòîðûå ìîãóò áûòü îáðàáîòàíû â äàííîì êîíòåêñòå.
*_gethandledstandartmsglist &lt;public/user/default&gt; Ôîðìèðîâàíèå ñïèñêà ñòàíäàðòíûõ ñîîáùåíèé íà îñíîâàíèè ñïèñêà ñîîáùåíèé, óêàçàííûõ â ñâîéñòâå ._HandledStandartMsgList, ïóòåì óäàëåíèÿ ñîîáùåíèé, êîòîðûå íå ìîãóò áûòü îáðàáîòàíû â äàííîì êîíòåêñòå.
*_gethandledcustommsglist &lt;public/user/nodefault&gt; Ôîðìèðîâàíèå ñïèñêà ïîëüçîâàòåëüñêèõ ñîîáùåíèé íà îñíîâàíèè ñïèñêà ñîîáùåíèé, óêàçàííûõ â ñâîéñòâå ._HandledCustomMsgList, ïóòåì óäàëåíèÿ ñîîáùåíèé, êîòîðûå íå ìîãóò áûòü îáðàáîòàíû â äàííîì êîíòåêñòå.
*handlemsg &lt;public/nouser/default&gt; Îáðàáîòêà ñîáùåíèÿ, äëÿ êîòîðîãî Grid çàðåãèñòðèðîâàí êàê îáðàáîò÷èê, åñëè ñîîáùåíèå îòíîñòèñÿ ê ñòàíäàðòíûì - âûçîâ ñîîòâåòñòâóþùåãî ìåòîäà, åñëè ýòî ïîëüçîâàòåëüñêîå ñîîáùåíèå, òî âûçîâ ìåòîäà ._HandleCustomMsg().
*_handlecustommsg &lt;public/user/nodefault&gt; Îáðàáîòêà ñîîáùåíèÿ èç ñïèñêà ïîëüçîâàòåëüñêèõ ñîîáùåíèé.
*_first &lt;public/nouser/default&gt; Îáðàáîòêà ñòàíäàðòíîãî ñîîáùåíèÿ FIRST. Ïåðåõîä íà ïåðâóþ çàïèñü.
*_prev &lt;public/nouser/default&gt; Îáðàáîòêà ñòàíäàðòíîãî ñîîáùåíèÿ PREV. Ïåðåõîä íà ïðåäûäóùóþ çàïèñü.
*_next &lt;public/nouser/default&gt; Îáðàáîòêà ñòàíäàðòíîãî ñîîáùåíèÿ NEXT. Ïåðåõîä íà ñëåäóþùóþ çàïèñü.
*_last &lt;public/nouser/default&gt; Îáðàáîòêà ñòàíäàðòíîãî ñîîáùåíèÿ LAST. Ïåðåõîä íà ïîñëåäíþþ çàïèñü.
*_add &lt;public/user/default&gt; Îáðàáîòêà ñòàíäàðòíîãî ñîîáùåíèÿ ADD.
*_edit &lt;public/user/default&gt; Îáðàáîòêà ñòàíäàðòíîãî ñîîáùåíèÿ EDIT.
*_info &lt;public/user/default&gt; Îáðàáîòêà ñòàíäàðòíîãî ñîîáùåíèÿ INFO.
*_dele &lt;public/user/default&gt; Îáðàáîòêà ñòàíäàðòíîãî ñîîáùåíèÿ _DELE.
*_copy &lt;public/user/default&gt; Îáðàáîòêà ñòàíäàðòíîãî ñîîáùåíèÿ COPY.
*_find &lt;public/user/default&gt; Îáðàáîòêà ñòàíäàðòíîãî ñîîáùåíèÿ FIND.
*_prndoc &lt;public/user/default&gt; Îáðàáîòêà ñòàíäàðòíîãî ñîîáùåíèÿ PRNDOC.
*_prnrep &lt;public/user/default&gt; Îáðàáîòêà ñòàíäàðòíîãî ñîîáùåíèÿ PRNREP.
*positionkeep &lt;public/nouser/default&gt; Ñîõðàíåíèå â ìàññèâå .aPositionKeysValues èíôîðìàöèè î ïîçèöèè â Alias-å, óêàçàííîì â .RecordSource, íà îñíîâàíèè ñïèñêà êëþ÷åé, óêàçàííîãî â ñâîéñòâå ._PositionKeysList.
*sourcerecall &lt;public/nouser/default&gt; Âîññòàíîâëåíèå .ControlSource âñåõ êîëîíîê è .RecordSource ñàìîãî Grid-à íà îñíîâàíèè èíôîðìàöèè, ñîõðàíåííîé ìåòîäîì .SourceKeep() â ìàññèâå .aSources.
*positionrecall &lt;public/nouser/default&gt; Âîññòàíîâëåíèå ïîçèöèè â Alias-å, óêàçàííîì â .RecordSource, íà îñíîâàíèè ñïèñêà êëþ÷åé, óêàçàííîãî â ñâîéñòâå ._PositionKeysList è èíôîðìàöèè, ñîõðàíåííîé ìåòîäîì .PositionKeep() â ìàññèâå .aPositionKeysValues.
*sourcekeep &lt;public/nouser/default&gt; Ñîõðàíåíèå â ìàññèâå .aSources èíôîðìàöèè î .ControlSource âñåõ êîëîíîê è .RecordSource ñàìîãî Grid-à.
*sourcereset &lt;public/nouser/default&gt; Ñáðîñ .ControlSource âñåõ êîëîíîê è .RecordSource ñàìîãî Grid-à.
^apositionkeysvalues[1,0] &lt;protected/runtime&gt; Ìàññèâ äëÿ ñîõðàíåíèÿ çíà÷åíèé ïîëåé, óêàçàííûõ â ñâîéñòâå _PostionKeysList, äëÿ ïîèñêà çàïèñè ïðè ïåðå÷èòûâàíèè .RecordSource Grid-à.
^asources[1,0] &lt;protected/runtime&gt; Ìàññèâ äëÿ ñîõðàíåíèÿ .ControlSource âñåõ êîëîíîê è .RecordSource ñàìîãî Grid-à ïðè åãî ïåðå÷èòûâàíèè.
*sort &lt;public/nouser/default&gt; Ñîðòèðîâêà Alias-à.
*sortclear &lt;public/nouser/defaul&gt; Îòìåíà ñîðòèðîâêè, î÷èñòêà âñåõ âðåìåííûõ ôàéëîâ ñ èíäåêñàìè.
*_rsrequery &lt;public/user/nodefault&gt; Ìåòîä îáíîâëåíèÿ äàííûõ ïðåäñòàâëåííûõ â Grid-å. Åñëè Grid íåçàâèñèìûé -  ìåòîä ìîæåò âûçûâàòüñÿ ïðè íàæàòèè êíîïêè "Îáíîâèòü". Åñëè Grid çàâèñèì - ïðè èçìåíèè ñîñòîÿíèÿ îáúåêòà, îò êîòîðîãî çàâèñèì.
*_refreshrelatedobjects &lt;public/user/nodefault&gt; Ïîëüçîâàòåëüñêèé ìåòîä ïî îáíîâëåíèþ îáúåêòîâ ñâÿçàííûõ ïî äàííûì. Âûçûâàåòñÿ ïðè èçìåíåèè ñâîéñòâà .nRSRecNo, åñëè ðàçðåøåíî ñâîéñòâîì ._RefreshRelatedObjectsOnRSRecNoChange.
*dynamicimageset 
*arrayelementget &lt;public/nouser/default&gt; Èíòåðôåéñ .ArrayElementGet(tcArrayName,teSearchColumn,tuSearchValue[,teReturnColumn]). Ìåòîä îñóùåñòâëÿåò ïîèñê â äâóìåðíîì ìàññèâå (tcArrayName) â êîëîíêå (teSearchColumn) çíà÷åíèå (tuSearchValue).
*handlekey &lt;public/nouser/default&gt; Îáðàáîòêà íàæàòèÿ ïîëüçîâàòåëåì êëàâèøè.
*refreshhandledhotkey &lt;public/nouser/default&gt; Îáíîâëåíèå ñïèñêà íàçíà÷åíèé ãîðÿ÷èõ êëàâèø.
*filterapply &lt;public/nouser/default&gt; Ôîðìèðîâàíèå óñëîâèÿ ôèëüòðà èç óñëîâèÿ âíåøíåãî ôèëüòðà è âíóòðåííèõ ôèëüòðîâ è íàëîæåíèå åãî íà èñòî÷íèê äàííûõ. Åñëè ïåðåäàí ïàðìåòð tlIncludeLocate = .T., òî â óñëîâèå ôèëüòðà âêëþ÷àåòñÿ óñëîâèå ïîèñêà â òåêóùåé êîëîíêå.
^afilters[1,0] &lt;protected/runtime&gt; Ìàññèâ äëÿ õðàíåíèÿ óñëîâèé âíåøíåãî ôèëüòðà, âíóòðåííèõ ôèëüòðîâ è  âíóòðåííèõ ïîèñêîâ.
*filterexternalset &lt;public/nouser/default&gt; Óñòàíîâêà âíåøíåãî ôèëüòðà íà èñòî÷íèê äàííûõ.
*filterexternaldrop &lt;public/nouser/default&gt; Óäàëåíèå âíåøíåãî ôèëüòðà.
*filterexternaldisable &lt;public/nouser/default&gt; Ïðèîñòàíîâëåíèå äåéñòâèÿ âíåøíåãî ôèëüòðà.
*filterexternalenable &lt;public/nouser/default&gt; Âîññòàíîâëåíèå äåéñòâèÿ âíåøíåãî ôèëüòðà.
*filterregister &lt;protected/nouser/default&gt; Ðåãèñòðàöèÿ ôèëüòðà/ïîèñêà.
*interactivesearch &lt;protected/nouser/default&gt; Èíòåðàêòèâíàÿ ôèëüòðàöèÿ/ïîèñê ïîäñòðîêè â ñèìâîëüíûõ ïîëÿõ èñòî÷íèêà äàííûõ.
*interactivesearchreset &lt;protected/nouser/default&gt; Îòìåíà èíòåðàêòèâíîé ôèëüòðàöèè/ïîèñêà ïîäñòðîêè â ñèìâîëüíûõ ïîëÿõ èñòî÷íèêà äàííûõ.
*interactivesearchsetmode &lt;protected/nouser/default&gt; Óñòàíîâêà ðåæèìà èíòåðàêòèâíîé ôèëüòðàöèè/ïîèñêà ïîäñòðîêè â ñèìâîëüíûõ ïîëÿõ èñòî÷íèêà äàííûõ.
*activerowhighlightset &lt;protected/nouser/default&gt; Óñòàíîâêà ñâîéñòâ Grid-à äëÿ ïîäñâåòêè òåêóùåé ñòðîêè.
*refreshcursorset &lt;protected/nouser/default&gt; Îáíîâëåíèå óñòàíîâêè SET CURSOR.
*_rowhighlight &lt;public/user/nodefault&gt; Óñòàíîâêà ïîëüçîâàòåëüñêîé ïîäñâåòêè ñòðîê.
*_rsrequeryone &lt;public/user/nodefault&gt; Ìåòîä îáíîâëåíèÿ ñòðîêè äàííûõ ïðåäñòàâëåííûõ â Grid-å. Âûçûâàåòñÿ ïîñëå óñïåøíîãî âûïîëíåíèè îïåðàöèè íàä ñòðîêîé.
*gridlayoutsave &lt;public/nouser/default&gt; Ñîõðàíåíèå ïàðàìåòðîâ îòîáðàæåíèÿ Grid-à
*gridlayoutrestore &lt;public/nouser/default&gt; Âîññòàíîâëåíèå ïàðàìåòðîâ îòîáðàæåíèÿ Grid-à
*dynamicimagereset 
*_excel ýêñïîðò äàííûõ â Excel
</reserved3>
		<reserved4/>
		<reserved5/>
		<reserved6>Pixels</reserved6>
		<reserved7/>
		<reserved8>..\include\base_v1_grd.h</reserved8>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>grd</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1></reserved1>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>WINDOWS</platform>
		<uniqueid>_QZ919RZC7</uniqueid>
		<timestamp>959215145</timestamp>
		<class>textbox</class>
		<classloc/>
		<baseclass>textbox</baseclass>
		<objname>txt</objname>
		<parent/>
		<properties>Height = 23
_calculatorclass = 
_calendarclass = frmcalendar;comctl_v1.vcx
_convertcommatopoint = .F.
_usedbfieldproperty = .F.
_highlightobject = 
_highlightobjectcolor = RGB(0,0,128)
_highlightself = .T.
_highlightselfcolor = RGB(255,255,0)
_rightclickmenu = txtMenu.mpr
_calendarshowondblclick = .F.
_calculatorshowondblclick = .F.
Name = "txt"
</properties>
		<protected>highlight
dbfieldpropertyget
</protected>
		<methods>PROCEDURE dbfieldpropertyget
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: TXT.DBFIELDPROPERTYGET
* Called by.......: &lt;.Init().
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;protected/nouser/default&gt; ×òåíèå èç áàçû äàííûõ òåêóùèõ óñòàíîâîê
*					äëÿ ïîëÿ, óêàçàííîãî â ControlSource textbox-à.
*-------------------------------------------------------
WITH This

*28.12.2003 14:02 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	lcOldDatabase, ;
		lcOldAlias, ;
		lcControlSource, ;
		lcAlias, ;
		lcField, ;
		lcDatabase, ;
		lcSourceName, ;
		lcFormat, ;
		lcInputMask
lcOldDatabase 	= SET([DATABASE])		
*------------------------------------------------------------------------------

*26.12.2003 19:10 -&gt;Êàêèå-ëèáî ñâîéñòâà ÷èòàåì è ìåíÿåì òîëüêî åñëè ðàçðåøåíî ôëàãîì ._UseDBFieldProperty
IF ._UseDBFieldProperty AND !EMPTY(.ControlSource)
	lcControlSource = ALLTRIM(.ControlSource)
	lcAlias = IIF([.]$lcControlSource,LEFT(lcControlSource,AT([.],lcControlSource)-1),ALIAS())
	lcField = IIF([.]$lcControlSource,SUBSTR(lcControlSource,AT([.],lcControlSource)+1),lcControlSource)
	***
	IF !EMPTY(lcAlias) AND USED(lcAlias)
		lcDatabase  = ALLTRIM(CURSORGETPROP([DATABASE],lcAlias))
		lcDatabase  = IIF([\]$lcDatabase,SUBSTR(lcDatabase,RAT([\],lcDatabase)+1),lcDatabase)
		lcDatabase  = IIF([.]$lcDatabase,SUBSTR(lcDatabase,1,RAT([.],lcDatabase)-1),lcDatabase)
		lcSourceName = ALLTRIM(CURSORGETPROP([SOURCENAME],lcAlias))
		***
		IF !EMPTY(lcDatabase) AND DBUSED(lcDatabase)
			IF !(lcOldDatabase==lcDatabase)
				SET DATABASE TO (lcDatabase)
			ENDIF	
			lcFormat	= DBGETPROP(lcSourceName+[.]+lcField,[Field],[Format])
			lcInputMask	= DBGETPROP(lcSourceName+[.]+lcField,[Field],[InputMask])
			.Format		= IIF(!EMPTY(.Format),.Format,lcFormat)
			.InputMask	= IIF(!EMPTY(.InputMask),.InputMask,lcInputMask)
		ENDIF				
	ENDIF
	***
	IF TYPE(.ControlSource) == [C]
		.MaxLength = LEN(EVAL(.ControlSource))
	ENDIF	
ENDIF	
*------------------------------------------------------------------------------

*28.12.2003 14:42 -&gt;Âîññòàíîâèì òåêóùóþ ÁÄ
IF !EMPTY(lcOldDatabase) AND DBUSED(lcOldDatabase) AND lcOldDatabase#SET([DATABASE])
	SET DATABASE TO (lcOldDatabase)
ENDIF
*------------------------------------------------------------------------------	

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE DblClick
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: TXT.DBLCLICK
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;sysevent&gt; Åñëè ðàçðåøåíî ôëàãàìè ._CalendarShowOnDblClick èëè
*					._CalculatorShowOnDblClick âûçîâ ìåòîäà .ShowCalendar() èëè .ShowCalculator()
*-------------------------------------------------------
WITH This

*28.12.2003 15:31 -&gt;Âûçîâ ìåòîäîâ, åñëè ðàçðåøåíî ôëàãàìè
IF ._CalendarShowOnDblClick
	.ShowCalendar()
ENDIF	
***
IF ._CalculatorShowOnDblClick
	.ShowCalculator()
ENDIF
*------------------------------------------------------------------------------	

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************

ENDPROC
PROCEDURE GotFocus
This.HighLight(.T.)
SET CURSOR ON
ENDPROC
PROCEDURE highlight
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE.VCX
* Class.Module....: TXT.HIGHLIGHT
* Called by.......: &lt;.GotFocus();.LostFocus()&gt;
* Parameters......: &lt;.T. - âêëþ÷åíèå ïîäñâåòêè; .F. - âûêëþ÷åíèå ïîäñâåòêè&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;protected/nouser/default&gt; Âêëþ÷åíèå/âûêëþ÷åíèå ïîäñâåòêè öâåòîì
*					ñàìîãî textbox-à è îáúåêòà, óêàçàííîãî â ñâîéñòâå ._HighLightObject.
*-------------------------------------------------------
LPARAMETERS	tlHighLightOn

*26.12.2003 18:51 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	loHighLightObject
*------------------------------------------------------------------------------

WITH THIS

*20.01.2004 18:00 -&gt;Ïðîâåäåì îïåðàöèè ñ ñîáîé
IF ._HighLightSelf
	IF tlHighLightOn
		IF .ReadOnly
			.DisabledBackColor = EVAL(._HighLightSelfColor)
		ELSE	
			.BackColor = EVAL(._HighLightSelfColor)
		ENDIF
	ELSE
		IF .ReadOnly
			.ResetToDefault([DisabledBackColor])
		ELSE
			.ResetToDefault([BackColor])
		ENDIF	
	ENDIF	
ENDIF
*------------------------------------------------------------------------------

*20.01.2004 18:00 -&gt;Ïðîâåäåì îïåðàöèþ ñ ïîäñâå÷èâàåìûìè îáúåêòàìè
IF !EMPTY(._HighLightObject)
	IF [;]$(._HighLightObject)
		lnHighLightObjectCount = OCCURS([;],._HighLightObject)+1
		FOR lnHighLightObjectCounter = 1 TO lnHighLightObjectCount
			lnStartPosition   = IIF(lnHighLightObjectCounter=1,1,AT([;],._HighLightObject,lnHighLightObjectCounter-1)+1)
			lnEndPosition     = IIF(lnHighLightObjectCounter=lnHighLightObjectCount,LEN(._HighLightObject)+1,AT([;],._HighLightObject,lnHighLightObjectCounter))
			lcHighLightObject = ALLTRIM(SUBSTR(._HighLightObject,lnStartPosition,lnEndPosition-lnStartPosition))
			loHighLightObject = EVAL(lcHighLightObject)
			IF tlHighLightOn
				loHighLightObject.ForeColor = EVAL(._HighLightObjectColor)
			ELSE
				loHighLightObject.ResetToDefault([ForeColor])
			ENDIF	
		ENDFOR
	ELSE		
		loHighLightObject = EVAL(._HighLightObject)
		IF tlHighLightOn
			loHighLightObject.ForeColor = EVAL(._HighLightObjectColor)
		ELSE
			loHighLightObject.ResetToDefault([ForeColor])
		ENDIF	
	ENDIF		
ENDIF	
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE Init
This.DBFieldPropertyGet()
ENDPROC
PROCEDURE InteractiveChange
This._HandleAnyChange()
ENDPROC
PROCEDURE KeyPress
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: TXT.KEYPRESS
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;tnKeyCode, tnShiftAltCtrl&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;sysevent&gt; Ïðè âââîäå ÷èñëîâûõ çíà÷åíèå ïðåîáðàçîâàíèå , â .
*-------------------------------------------------------
LPARAMETERS	tnKeyCode, tnShiftAltCtrl

WITH This

*28.12.2003 15:06 -&gt;Ïðåîáðàçîâàíèå çàïÿòîé â òî÷êó
IF tnKeyCode=44 AND ._ConvertCommaToPoint AND INLIST(TYPE([.Value]),[N],[Y])
	DODEFAULT(46,tnShiftAltCtrl)	
	NODEFAULT
ENDIF
*------------------------------------------------------------------------------
** ïðè íàæàòèè Ctrl+Enter
*!*	IF tnKeyCode=13 AND tnShiftAltCtrl=0 &amp;&amp; Enter
*!*		NODEFAULT
*!*		KEYBOARD '{DNARROW}' PLAIN
*!*	ENDIF


ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE LostFocus
SET CURSOR ON
This.HighLight(.F.)
ENDPROC
PROCEDURE ProgrammaticChange
This._HandleAnyChange()
ENDPROC
PROCEDURE RightClick
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: TXT.RIGHTCLICK
* Called by.......: &lt;Sys Event&gt;
* Parameters......: &lt;none&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;sysevent&gt; Âûçîâ êîíòåêñòíîãî ìåíþ îïðåäåëåííîãî â ñâîéñòâå _RightClickMenu
*-------------------------------------------------------
DO (This._RightClickMenu)
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************
ENDPROC
PROCEDURE showcalculator
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: TXT.SHOWCALCULATOR
* Called by.......: &lt;.DblClick();Misc Ext Calls&gt;
* Parameters......: &lt;tnRow, tnCol - optional&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Âûâîä îêíà ñ êàëüêóëÿòîðîì.
*-------------------------------------------------------
LPARAMETERS tnRow, tnCol

*28.12.2003 14:46 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	luResultValue
*------------------------------------------------------------------------------

WITH This

*28.12.2003 14:46 -&gt;Åñëè êîîðäèíàòû íå çàäàíû, òî êîîðäèíàòàìè ÿâëÿþòñÿ êîîðäèíàòû êóðñîðà ìûøè.
IF !(TYPE([tnRow])==[N] AND TYPE([tnCol])==[N])
	tnRow = MROW([SCREEN],3)
	tnCol = MCOL([SCREEN],3)
ENDIF
*------------------------------------------------------------------------------

*28.12.2003 14:48 -&gt;Âûâîäèì êàëüêóëÿòîð
IF TYPE([.Value])$[N] AND !EMPTY(._CalculatorClass) AND TYPE([oApp])==[O] AND !ISNULL([oApp])
	*28.12.2003 14:49 -&gt;Ñîçäàåì ôîðìó ñ êàëüêóëÿòîðîì
	luResultValue = oApp.DoModalFormRetValObj(._CalculatorClass,.Value,tnRow,tnCol)
	*------------------------------------------------------------------------------
	
	*28.12.2003 14:52 -&gt;Ïðîâåðÿåì çíà÷åíèå, êîòîðîå âåðíóëà ôîðìà ñ êàëüêóëÿòîðîì
	IF TYPE([luResultValue])==[N]
		.Value = luResultValue
	ENDIF
	*------------------------------------------------------------------------------
ENDIF
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************

ENDPROC
PROCEDURE showcalendar
*-------------------------------------------------------
* Project.........: GLOBAL.PJX
* Library.........: BASE_V1.VCX
* Class.Module....: TXT.SHOWCALENDAR
* Called by.......: &lt;.DblClick();Misc Ext Calls&gt;
* Parameters......: &lt;tnRow, tnCol - optional&gt;
* Returns.........: &lt;none&gt;
* Notes...........: &lt;public/nouser/default&gt; Âûâîä îêíà ñ êàëåíäàðåì.
*-------------------------------------------------------
LPARAMETERS tnRow, tnCol

*28.12.2003 14:46 -&gt;Îáúÿâëåíèå è èíèöèàëèçàöèÿ ïåðåìåííûõ
LOCAL	luResultValue
*------------------------------------------------------------------------------

WITH This

*28.12.2003 14:46 -&gt;Åñëè êîîðäèíàòû íå çàäàíû, òî êîîðäèíàòàìè ÿâëÿþòñÿ êîîðäèíàòû êóðñîðà ìûøè.
IF !(TYPE([tnRow])==[N] AND TYPE([tnCol])==[N])
	tnRow = MROW([SCREEN],3)
	tnCol = MCOL([SCREEN],3)
ENDIF
*------------------------------------------------------------------------------

*28.12.2003 14:48 -&gt;Âûâîäèì êàëåíäàðü
IF TYPE([.Value])$[DT] AND !EMPTY(._CalendarClass) AND TYPE([oApp])==[O] AND !ISNULL([oApp])
	*28.12.2003 14:49 -&gt;Ñîçäàåì ôîðìó ñ êàëåíäàðåì
**	luResultValue = oApp.DoModalFormRetValObj(._CalendarClass,IIF(!EMPTY(.Value),IIF(TYPE([This.Value])=[D],.Value,TTOD(.Value)),DATE()),tnRow,tnCol)
	luResultValue = oApp.DoModalFormRetValObj(._CalendarClass,IIF(!EMPTY(.Value) AND INLIST(VARTYPE(This.Value),[D],[T]),.Value,DATETIME()),tnRow,tnCol)
	*------------------------------------------------------------------------------
	
	*28.12.2003 14:52 -&gt;Ïðîâåðÿåì çíà÷åíèå, êîòîðîå âåðíóëà ôîðìà ñ êàëåíäàðåì	
	IF INLIST(VARTYPE(luResultValue),[D],[T])
		.Value = luResultValue
	ENDIF
	*------------------------------------------------------------------------------
ENDIF
*------------------------------------------------------------------------------

ENDWITH
************************************************************************************
**********************************  END OF METHOD **********************************
************************************************************************************

ENDPROC
</methods>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1>Class</reserved1>
		<reserved2>1</reserved2>
		<reserved3>_calculatorclass &lt;public/design&gt; Îïðåäåëåíèå êëàññà êàëüêóëÿòîðà â ôîðìàòå cClassName[;cLibName[;cContainFileName]]
_calendarclass &lt;public/design&gt; Îïðåäåëåíèå êëàññà êàëåíäàðÿ â ôîðìàòå cClassName[;cLibName[;cContainFileName]]
_convertcommatopoint &lt;public/design&gt; Ôëàã êîíâåðòèðîâàòü/íå êîíâåðòèðîâàòü ïðè ââîäå çàïÿòóþ â òî÷êó.
_usedbfieldproperty &lt;public/design&gt; Ôëàã èñïîëüçîâàòü/íåèñïîëüçîâàòü ñâîéñòâà ïîëÿ, îïðåäåëåííûå â áàçå äàííûõ.
_highlightobject &lt;public/design&gt; Èìÿ îáúåêòà, êîòîðûé äîëæåí ïîäñâå÷èâàòüñÿ ïðè ïîëó÷åíèè îáúåêòîì ôîêóñà.
_highlightobjectcolor &lt;public/design&gt; Öâåò äëÿ ïîäñâåòêè îáúåêòà, çàäàííîãî ñâîéñòâîì ._HighLightObject. Ôîðìàò: ñèìâîëüíîå âûðàæåíèå, äàþùåå ïðè EVAL() ÷èñëåííîå âûðàæåíèå öâåòà â äèàïàçîíå îò 0 äî 16777215. Ïî óìîë÷àíèþ RGB(0,0,128).
_highlightself &lt;public/design&gt; Ôëàã ðàçðåøåíèÿ/çàïðåùåíèÿ ïîäñâåòêè îáúåêòà öâåòîì ïðè ïîëó÷åíèè ôîêóñà.
_highlightselfcolor &lt;public/design&gt; Öâåò äëÿ ïîäñâåòêè îáúåêòà öâåòîì ïðè ïîëó÷åíèè ôîêóñà. Ôîðìàò: ñèìâîëüíîå âûðàæåíèå, äàþùåå ïðè EVAL() ÷èñëåííîå âûðàæåíèå öâåòà â äèàïàçîíå îò 0 äî 16777215. Ïî óìîë÷àíèþ RGB(255,255,0).
_rightclickmenu &lt;public/design&gt; Ìåíþ, âûçûâàåìîå ïðè îáðàáîòêå ñîáûòèÿ RightClick(). 
_calendarshowondblclick &lt;public/design&gt; Ôëàã âûâîäèòü/íå âûâîäèòü êàëåíäàðü ïðè îáðàáîòêå ìåòîäà DblClick().
_calculatorshowondblclick &lt;public/design&gt; Ôëàã âûâîäèòü/íå âûâîäèòü êàëüêóëÿòîð ïðè îáðàáîòêå ìåòîäà DblClick().
*showcalendar &lt;public/nouser/default&gt; Âûâîä îêíà ñ êàëåíäàðåì.
*showcalculator &lt;public/nouser/default&gt; Âûâîä îêíà ñ êàëüêóëÿòîðîì.
*highlight &lt;protected/nouser/default&gt; Âêëþ÷åíèå/âûêëþ÷åíèå ïîäñâåòêè öâåòîì ñàìîãî textbox-à è îáúåêòà, óêàçàííîãî â ñâîéñòâå ._HighLightObject.
*_handleanychange &lt;public/user/nodefault&gt; Îáðàáîòêà èçìåíåíèÿ çíà÷åíèÿ îáúåêòà.
*dbfieldpropertyget &lt;protected/nouser/default&gt; ×òåíèå èç áàçû äàííûõ òåêóùèõ óñòàíîâîê äëÿ ïîëÿ, óêàçàííîãî â ControlSource textbox-à.
</reserved3>
		<reserved4>..\bitmaps\textbox.bmp</reserved4>
		<reserved5>..\bitmaps\textbox.bmp</reserved5>
		<reserved6>Pixels</reserved6>
		<reserved7>Áàçîâûé êëàññ TextBox</reserved7>
		<reserved8/>
		<user/>
	</record>
	<record>
		<platform>COMMENT</platform>
		<uniqueid>RESERVED</uniqueid>
		<timestamp>0</timestamp>
		<class/>
		<classloc/>
		<baseclass/>
		<objname>txt</objname>
		<parent/>
		<properties>Arial, 0, 9, 5, 15, 12, 32, 3, 0
</properties>
		<protected/>
		<methods/>
		<objcode/>
		<ole/>
		<ole2/>
		<reserved1/>
		<reserved2/>
		<reserved3/>
		<reserved4/>
		<reserved5/>
		<reserved6/>
		<reserved7/>
		<reserved8/>
		<user/>
	</record>
</VFPData>
